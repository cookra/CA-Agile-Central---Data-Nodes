<!DOCTYPE html>
<html>
<head>
    <title>nodes</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                !function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.cytoscape=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict"},{}],2:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util"),is=_dereq_("./is"),Promise=_dereq_("./promise"),Animation=function(target,opts,opts2){if(!(this instanceof Animation))return new Animation(target,opts,opts2);var _p=this._private=util.extend({duration:1e3},opts,opts2);_p.target=target,_p.style=_p.style||_p.css,_p.started=!1,_p.playing=!1,_p.hooked=!1,_p.applying=!1,_p.progress=0,_p.completes=[],_p.frames=[],_p.complete&&is.fn(_p.complete)&&_p.completes.push(_p.complete),this.length=1,this[0]=this},anifn=Animation.prototype;util.extend(anifn,{instanceString:function(){return"animation"},hook:function(){var _p=this._private;if(!_p.hooked){var q,tAni=_p.target._private.animation;q=_p.queue?tAni.queue:tAni.current,q.push(this),is.elementOrCollection(_p.target)&&_p.target.cy().addToAnimationPool(_p.target),_p.hooked=!0}return this},play:function(){var _p=this._private;return 1===_p.progress&&(_p.progress=0),_p.playing=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var _p=this._private;return _p.applying=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var _p=this._private;return _p.playing=!1,_p.started=!1,this},stop:function(){var _p=this._private;return _p.playing=!1,_p.started=!1,_p.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(t){var _p=this._private;return void 0===t?_p.progress*_p.duration:this.progress(t/_p.duration)},progress:function(p){var _p=this._private,wasPlaying=_p.playing;return void 0===p?_p.progress:(wasPlaying&&this.pause(),_p.progress=p,_p.started=!1,wasPlaying&&this.play(),this)},completed:function(){return 1===this._private.progress},reverse:function(){var _p=this._private,wasPlaying=_p.playing;wasPlaying&&this.pause(),_p.progress=1-_p.progress,_p.started=!1;var swap=function(a,b){var _pa=_p[a];_p[a]=_p[b],_p[b]=_pa};swap("zoom","startZoom"),swap("pan","startPan"),swap("position","startPosition");for(var i=0;i<_p.style.length;i++){var prop=_p.style[i],name=prop.name,startStyleProp=_p.startStyle[name];_p.startStyle[name]=prop,_p.style[i]=startStyleProp}return wasPlaying&&this.play(),this},promise:function(type){var _p=this._private,arr;switch(type){case"frame":arr=_p.frames;break;default:case"complete":case"completed":arr=_p.completes}return new Promise(function(resolve,reject){arr.push(function(){resolve()})})}}),anifn.complete=anifn.completed,module.exports=Animation},{"./is":83,"./promise":86,"./util":100}],3:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),elesfn={aStar:function(options){var eles=this;options=options||{};var reconstructPath=function(start,end,cameFromMap,pathAcum){if(start==end)return pathAcum.push(cy.getElementById(end)),pathAcum;if(end in cameFromMap){var previous=cameFromMap[end],previousEdge=cameFromEdge[end];return pathAcum.push(cy.getElementById(end)),pathAcum.push(cy.getElementById(previousEdge)),reconstructPath(start,previous,cameFromMap,pathAcum)}},findMin=function(openSet,fScore){if(0!==openSet.length){for(var minPos=0,tempScore=fScore[openSet[0]],i=1;i<openSet.length;i++){var s=fScore[openSet[i]];s<tempScore&&(tempScore=s,minPos=i)}return minPos}},cy=this._private.cy;if(null!=options&&null!=options.root){var source=is.string(options.root)?this.filter(options.root)[0]:options.root[0];if(null!=options.goal){var target=is.string(options.goal)?this.filter(options.goal)[0]:options.goal[0];if(null!=options.heuristic&&is.fn(options.heuristic))var heuristic=options.heuristic;else var heuristic=function(){return 0};if(null!=options.weight&&is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;var closedSet=[],openSet=[source.id()],cameFrom={},cameFromEdge={},gScore={},fScore={};gScore[source.id()]=0,fScore[source.id()]=heuristic(source);for(var edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),steps=0;openSet.length>0;){var minPos=findMin(openSet,fScore),cMin=cy.getElementById(openSet[minPos]);if(steps++,cMin.id()==target.id()){var rPath=reconstructPath(source.id(),target.id(),cameFrom,[]);return rPath.reverse(),{found:!0,distance:gScore[cMin.id()],path:eles.spawn(rPath),steps:steps}}closedSet.push(cMin.id()),openSet.splice(minPos,1);var vwEdges=cMin.connectedEdges();directed&&(vwEdges=vwEdges.stdFilter(function(ele){return ele.data("source")===cMin.id()})),vwEdges=vwEdges.intersect(edges);for(var i=0;i<vwEdges.length;i++){var e=vwEdges[i],w=e.connectedNodes().stdFilter(function(n){return n.id()!==cMin.id()}).intersect(nodes);if(closedSet.indexOf(w.id())==-1){var tempScore=gScore[cMin.id()]+weightFn.apply(e,[e]);openSet.indexOf(w.id())!=-1?tempScore<gScore[w.id()]&&(gScore[w.id()]=tempScore,fScore[w.id()]=tempScore+heuristic(w),cameFrom[w.id()]=cMin.id()):(gScore[w.id()]=tempScore,fScore[w.id()]=tempScore+heuristic(w),openSet.push(w.id()),cameFrom[w.id()]=cMin.id(),cameFromEdge[w.id()]=e.id())}}}return{found:!1,distance:void 0,path:void 0,steps:steps}}}}};module.exports=elesfn},{"../../is":83}],4:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),util=_dereq_("../../util"),elesfn={bellmanFord:function(options){var eles=this;if(options=options||{},null!=options.weight&&is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;if(null!=options.root){if(is.string(options.root))var source=this.filter(options.root)[0];else var source=options.root[0];for(var cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,id2position={},i=0;i<numNodes;i++)id2position[nodes[i].id()]=i;for(var cost=[],predecessor=[],predEdge=[],i=0;i<numNodes;i++)nodes[i].id()===source.id()?cost[i]=0:cost[i]=1/0,predecessor[i]=void 0;for(var flag=!1,i=1;i<numNodes;i++){flag=!1;for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()],targetIndex=id2position[edges[e].target().id()],weight=weightFn.apply(edges[e],[edges[e]]),temp=cost[sourceIndex]+weight;if(temp<cost[targetIndex]&&(cost[targetIndex]=temp,predecessor[targetIndex]=sourceIndex,predEdge[targetIndex]=edges[e],flag=!0),!directed){var temp=cost[targetIndex]+weight;temp<cost[sourceIndex]&&(cost[sourceIndex]=temp,predecessor[sourceIndex]=targetIndex,predEdge[sourceIndex]=edges[e],flag=!0)}}if(!flag)break}if(flag)for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()],targetIndex=id2position[edges[e].target().id()],weight=weightFn.apply(edges[e],[edges[e]]);if(cost[sourceIndex]+weight<cost[targetIndex])return util.error("Graph contains a negative weight cycle for Bellman-Ford"),{pathTo:void 0,distanceTo:void 0,hasNegativeWeightCycle:!0}}for(var position2id=[],i=0;i<numNodes;i++)position2id.push(nodes[i].id());var res={distanceTo:function(to){if(is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();return cost[id2position[toId]]},pathTo:function(to){var reconstructPathAux=function(predecessor,fromPos,toPos,position2id,acumPath,predEdge){for(;;){if(acumPath.push(cy.getElementById(position2id[toPos])),acumPath.push(predEdge[toPos]),fromPos===toPos)return acumPath;var predPos=predecessor[toPos];if("undefined"==typeof predPos)return;toPos=predPos}};if(is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();var path=[],res=reconstructPathAux(predecessor,id2position[source.id()],id2position[toId],position2id,path,predEdge);return null!=res&&res.reverse(),eles.spawn(res)},hasNegativeWeightCycle:!1};return res}}};module.exports=elesfn},{"../../is":83,"../../util":100}],5:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),Heap=_dereq_("../../heap"),elesfn={betweennessCentrality:function(options){options=options||{};var weighted,weightFn;is.fn(options.weight)?(weightFn=options.weight,weighted=!0):weighted=!1;for(var directed=null!=options.directed&&options.directed,cy=this._private.cy,V=this.nodes(),A={},_C={},max=0,C={set:function(key,val){_C[key]=val,val>max&&(max=val)},get:function(key){return _C[key]}},i=0;i<V.length;i++){var v=V[i],vid=v.id();directed?A[vid]=v.outgoers().nodes():A[vid]=v.openNeighborhood().nodes(),C.set(vid,0)}for(var s=0;s<V.length;s++){for(var sid=V[s].id(),S=[],P={},g={},d={},Q=new Heap(function(a,b){return d[a]-d[b]}),i=0;i<V.length;i++){var vid=V[i].id();P[vid]=[],g[vid]=0,d[vid]=1/0}for(g[sid]=1,d[sid]=0,Q.push(sid);!Q.empty();){var v=Q.pop();if(S.push(v),weighted)for(var j=0;j<A[v].length;j++){var w=A[v][j],vEle=cy.getElementById(v),edge;edge=vEle.edgesTo(w).length>0?vEle.edgesTo(w)[0]:w.edgesTo(vEle)[0];var edgeWeight=weightFn.apply(edge,[edge]);w=w.id(),d[w]>d[v]+edgeWeight&&(d[w]=d[v]+edgeWeight,Q.nodes.indexOf(w)<0?Q.push(w):Q.updateItem(w),g[w]=0,P[w]=[]),d[w]==d[v]+edgeWeight&&(g[w]=g[w]+g[v],P[w].push(v))}else for(var j=0;j<A[v].length;j++){var w=A[v][j].id();d[w]==1/0&&(Q.push(w),d[w]=d[v]+1),d[w]==d[v]+1&&(g[w]=g[w]+g[v],P[w].push(v))}}for(var e={},i=0;i<V.length;i++)e[V[i].id()]=0;for(;S.length>0;)for(var w=S.pop(),j=0;j<P[w].length;j++){var v=P[w][j];e[v]=e[v]+g[v]/g[w]*(1+e[w]),w!=V[s].id()&&C.set(w,C.get(w)+e[w])}}var ret={betweenness:function(node){if(is.string(node))var node=cy.filter(node).id();else var node=node.id();return C.get(node)},betweennessNormalized:function(node){if(0==max)return 0;if(is.string(node))var node=cy.filter(node).id();else var node=node.id();return C.get(node)/max}};return ret.betweennessNormalised=ret.betweennessNormalized,ret}};elesfn.bc=elesfn.betweennessCentrality,module.exports=elesfn},{"../../heap":81,"../../is":83}],6:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),defineSearch=function(params){return params={bfs:params.bfs||!params.dfs,dfs:params.dfs||!params.bfs},function searchFn(roots,fn,directed){var options,std,thisArg;is.plainObject(roots)&&!is.elementOrCollection(roots)&&(options=roots,roots=options.roots||options.root,fn=options.visit,directed=options.directed,std=options.std,thisArg=options.thisArg),directed=2!==arguments.length||is.fn(fn)?directed:fn,fn=is.fn(fn)?fn:function(){};for(var cy=this._private.cy,v=roots=is.string(roots)?this.filter(roots):roots,Q=[],connectedNodes=[],connectedBy={},id2depth={},V={},j=0,found,nodes=this.nodes(),edges=this.edges(),i=0;i<v.length;i++)v[i].isNode()&&(Q.unshift(v[i]),params.bfs&&(V[v[i].id()]=!0,connectedNodes.push(v[i])),id2depth[v[i].id()]=0);for(;0!==Q.length;){var v=params.bfs?Q.shift():Q.pop();if(params.dfs){if(V[v.id()])continue;V[v.id()]=!0,connectedNodes.push(v)}var depth=id2depth[v.id()],prevEdge=connectedBy[v.id()],prevNode=null==prevEdge?void 0:prevEdge.connectedNodes().not(v)[0],ret;if(ret=std?fn.call(thisArg,v,prevEdge,prevNode,j++,depth):fn.call(v,j++,depth,v,prevEdge,prevNode),ret===!0){found=v;break}if(ret===!1)break;for(var vwEdges=v.connectedEdges(directed?function(){return this.data("source")===v.id()}:void 0).intersect(edges),i=0;i<vwEdges.length;i++){var e=vwEdges[i],w=e.connectedNodes(function(){return this.id()!==v.id()}).intersect(nodes);0===w.length||V[w.id()]||(w=w[0],Q.push(w),params.bfs&&(V[w.id()]=!0,connectedNodes.push(w)),connectedBy[w.id()]=e,id2depth[w.id()]=id2depth[v.id()]+1)}}for(var connectedEles=[],i=0;i<connectedNodes.length;i++){var node=connectedNodes[i],edge=connectedBy[node.id()];edge&&connectedEles.push(edge),connectedEles.push(node)}return{path:cy.collection(connectedEles,{unique:!0}),found:cy.collection(found)}}},elesfn={breadthFirstSearch:defineSearch({bfs:!0}),depthFirstSearch:defineSearch({dfs:!0})};elesfn.bfs=elesfn.breadthFirstSearch,elesfn.dfs=elesfn.depthFirstSearch,module.exports=elesfn},{"../../is":83}],7:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),elesfn={closenessCentralityNormalized:function(options){options=options||{};var cy=this.cy(),harmonic=options.harmonic;void 0===harmonic&&(harmonic=!0);for(var closenesses={},maxCloseness=0,nodes=this.nodes(),fw=this.floydWarshall({weight:options.weight,directed:options.directed}),i=0;i<nodes.length;i++){for(var currCloseness=0,j=0;j<nodes.length;j++)if(i!=j){var d=fw.distance(nodes[i],nodes[j]);currCloseness+=harmonic?1/d:d}harmonic||(currCloseness=1/currCloseness),maxCloseness<currCloseness&&(maxCloseness=currCloseness),closenesses[nodes[i].id()]=currCloseness}return{closeness:function(node){if(0==maxCloseness)return 0;if(is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return closenesses[node]/maxCloseness}}},closenessCentrality:function(options){if(options=options||{},null!=options.root){if(is.string(options.root))var root=this.filter(options.root)[0];else var root=options.root[0];if(null!=options.weight&&is.fn(options.weight))var weight=options.weight;else var weight=function(){return 1};if(null!=options.directed&&is.bool(options.directed))var directed=options.directed;else var directed=!1;var harmonic=options.harmonic;void 0===harmonic&&(harmonic=!0);for(var dijkstra=this.dijkstra({root:root,weight:weight,directed:directed}),totalDistance=0,nodes=this.nodes(),i=0;i<nodes.length;i++)if(nodes[i].id()!=root.id()){var d=dijkstra.distanceTo(nodes[i]);totalDistance+=harmonic?1/d:d}return harmonic?totalDistance:1/totalDistance}}};elesfn.cc=elesfn.closenessCentrality,elesfn.ccn=elesfn.closenessCentralityNormalised=elesfn.closenessCentralityNormalized,module.exports=elesfn},{"../../is":83}],8:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),util=_dereq_("../../util"),elesfn={degreeCentralityNormalized:function(options){options=options||{};var cy=this.cy();if(null!=options.directed)var directed=options.directed;else var directed=!1;var nodes=this.nodes(),numNodes=nodes.length;if(directed){for(var indegrees={},outdegrees={},maxIndegree=0,maxOutdegree=0,i=0;i<numNodes;i++){var node=nodes[i],currDegree=this.degreeCentrality(util.extend({},options,{root:node}));maxIndegree<currDegree.indegree&&(maxIndegree=currDegree.indegree),maxOutdegree<currDegree.outdegree&&(maxOutdegree=currDegree.outdegree),indegrees[node.id()]=currDegree.indegree,outdegrees[node.id()]=currDegree.outdegree}return{indegree:function(node){if(0==maxIndegree)return 0;if(is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return indegrees[node]/maxIndegree},outdegree:function(node){if(0==maxOutdegree)return 0;if(is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return outdegrees[node]/maxOutdegree}}}for(var degrees={},maxDegree=0,i=0;i<numNodes;i++){var node=nodes[i],currDegree=this.degreeCentrality(util.extend({},options,{root:node}));maxDegree<currDegree.degree&&(maxDegree=currDegree.degree),degrees[node.id()]=currDegree.degree}return{degree:function(node){if(0==maxDegree)return 0;if(is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return degrees[node]/maxDegree}}},degreeCentrality:function(options){options=options||{};var callingEles=this;if(null!=options&&null!=options.root){var root=is.string(options.root)?this.filter(options.root)[0]:options.root[0];if(null!=options.weight&&is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;if(null!=options.alpha&&is.number(options.alpha))var alpha=options.alpha;else alpha=0;if(directed){for(var incoming=root.connectedEdges('edge[target = "'+root.id()+'"]').intersection(callingEles),outgoing=root.connectedEdges('edge[source = "'+root.id()+'"]').intersection(callingEles),k_in=incoming.length,k_out=outgoing.length,s_in=0,s_out=0,i=0;i<incoming.length;i++){var edge=incoming[i];s_in+=weightFn.apply(edge,[edge])}for(var i=0;i<outgoing.length;i++){var edge=outgoing[i];s_out+=weightFn.apply(edge,[edge])}return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}for(var connEdges=root.connectedEdges().intersection(callingEles),k=connEdges.length,s=0,i=0;i<connEdges.length;i++){var edge=connEdges[i];s+=weightFn.apply(edge,[edge])}return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}}}};elesfn.dc=elesfn.degreeCentrality,elesfn.dcn=elesfn.degreeCentralityNormalised=elesfn.degreeCentralityNormalized,module.exports=elesfn},{"../../is":83,"../../util":100}],9:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),Heap=_dereq_("../../heap"),elesfn={dijkstra:function(root,weightFn,directed){var options;is.plainObject(root)&&!is.elementOrCollection(root)&&(options=root,root=options.root,weightFn=options.weight,directed=options.directed);var cy=this._private.cy;weightFn=is.fn(weightFn)?weightFn:function(){return 1};for(var source=is.string(root)?this.filter(root)[0]:root[0],dist={},prev={},knownDist={},edges=this.edges().filter(function(){return!this.isLoop()}),nodes=this.nodes(),getDist=function(node){return dist[node.id()]},setDist=function(node,d){dist[node.id()]=d,Q.updateItem(node)},Q=new Heap(function(a,b){return getDist(a)-getDist(b)}),i=0;i<nodes.length;i++){var node=nodes[i];dist[node.id()]=node.same(source)?0:1/0,Q.push(node)}for(var distBetween=function(u,v){for(var uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges),smallestDistance=1/0,smallestEdge,i=0;i<uvs.length;i++){var edge=uvs[i],weight=weightFn.apply(edge,[edge]);(weight<smallestDistance||!smallestEdge)&&(smallestDistance=weight,smallestEdge=edge)}return{edge:smallestEdge,dist:smallestDistance}};Q.size()>0;){var u=Q.pop(),smalletsDist=getDist(u),uid=u.id();if(knownDist[uid]=smalletsDist,smalletsDist===Math.Infinite)break;for(var neighbors=u.neighborhood().intersect(nodes),i=0;i<neighbors.length;i++){var v=neighbors[i],vid=v.id(),vDist=distBetween(u,v),alt=smalletsDist+vDist.dist;alt<getDist(v)&&(setDist(v,alt),prev[vid]={node:u,edge:vDist.edge})}}return{distanceTo:function(node){var target=is.string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function(node){var target=is.string(node)?nodes.filter(node)[0]:node[0],S=[],u=target;if(target.length>0)for(S.unshift(target);prev[u.id()];){var p=prev[u.id()];S.unshift(p.edge),S.unshift(p.node),u=p.node}return cy.collection(S)}}}};module.exports=elesfn},{"../../heap":81,"../../is":83}],10:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),elesfn={floydWarshall:function(options){options=options||{};var cy=this.cy();if(null!=options.weight&&is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;for(var edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,id2position={},i=0;i<numNodes;i++)id2position[nodes[i].id()]=i;for(var dist=[],i=0;i<numNodes;i++){for(var newRow=new Array(numNodes),j=0;j<numNodes;j++)i==j?newRow[j]=0:newRow[j]=1/0;dist.push(newRow)}var next=[],edgeNext=[],initMatrix=function(next){for(var i=0;i<numNodes;i++){for(var newRow=new Array(numNodes),j=0;j<numNodes;j++)newRow[j]=void 0;next.push(newRow)}};initMatrix(next),initMatrix(edgeNext);for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].source().id()],targetIndex=id2position[edges[i].target().id()],weight=weightFn.apply(edges[i],[edges[i]]);dist[sourceIndex][targetIndex]>weight&&(dist[sourceIndex][targetIndex]=weight,next[sourceIndex][targetIndex]=targetIndex,edgeNext[sourceIndex][targetIndex]=edges[i])}if(!directed)for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].target().id()],targetIndex=id2position[edges[i].source().id()],weight=weightFn.apply(edges[i],[edges[i]]);dist[sourceIndex][targetIndex]>weight&&(dist[sourceIndex][targetIndex]=weight,next[sourceIndex][targetIndex]=targetIndex,edgeNext[sourceIndex][targetIndex]=edges[i])}for(var k=0;k<numNodes;k++)for(var i=0;i<numNodes;i++)for(var j=0;j<numNodes;j++)dist[i][k]+dist[k][j]<dist[i][j]&&(dist[i][j]=dist[i][k]+dist[k][j],next[i][j]=next[i][k]);for(var position2id=[],i=0;i<numNodes;i++)position2id.push(nodes[i].id());var res={distance:function(from,to){if(is.string(from))var fromId=cy.filter(from)[0].id();else var fromId=from.id();if(is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();return dist[id2position[fromId]][id2position[toId]]},path:function(from,to){var reconstructPathAux=function(from,to,next,position2id,edgeNext){if(from===to)return cy.getElementById(position2id[from]);if(void 0!==next[from][to]){for(var path=[cy.getElementById(position2id[from])],prev=from;from!==to;){prev=from,from=next[from][to];var edge=edgeNext[prev][from];path.push(edge),path.push(cy.getElementById(position2id[from]))}return path}};if(is.string(from))var fromId=cy.filter(from)[0].id();else var fromId=from.id();if(is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();var pathArr=reconstructPathAux(id2position[fromId],id2position[toId],next,position2id,edgeNext);return cy.collection(pathArr)}};return res}};module.exports=elesfn},{"../../is":83}],11:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../../util"),elesfn={};[_dereq_("./bfs-dfs"),_dereq_("./dijkstra"),_dereq_("./kruskal"),_dereq_("./a-star"),_dereq_("./floyd-warshall"),_dereq_("./bellman-ford"),_dereq_("./kerger-stein"),_dereq_("./page-rank"),_dereq_("./degree-centrality"),_dereq_("./closeness-centrality"),_dereq_("./betweenness-centrality")].forEach(function(props){util.extend(elesfn,props)}),module.exports=elesfn},{"../../util":100,"./a-star":3,"./bellman-ford":4,"./betweenness-centrality":5,"./bfs-dfs":6,"./closeness-centrality":7,"./degree-centrality":8,"./dijkstra":9,"./floyd-warshall":10,"./kerger-stein":12,"./kruskal":13,"./page-rank":14}],12:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../../util"),elesfn={kargerStein:function(options){var eles=this;options=options||{};var colapse=function(edgeIndex,nodeMap,remainingEdges){for(var edgeInfo=remainingEdges[edgeIndex],sourceIn=edgeInfo[1],targetIn=edgeInfo[2],partition1=nodeMap[sourceIn],partition2=nodeMap[targetIn],newEdges=remainingEdges.filter(function(edge){return(nodeMap[edge[1]]!==partition1||nodeMap[edge[2]]!==partition2)&&(nodeMap[edge[1]]!==partition2||nodeMap[edge[2]]!==partition1)}),i=0;i<newEdges.length;i++){var edge=newEdges[i];edge[1]===partition2?(newEdges[i]=edge.slice(0),newEdges[i][1]=partition1):edge[2]===partition2&&(newEdges[i]=edge.slice(0),newEdges[i][2]=partition1)}for(var i=0;i<nodeMap.length;i++)nodeMap[i]===partition2&&(nodeMap[i]=partition1);return newEdges},contractUntil=function(metaNodeMap,remainingEdges,size,sizeLimit){if(size<=sizeLimit)return remainingEdges;var edgeIndex=Math.floor(Math.random()*remainingEdges.length),newEdges=colapse(edgeIndex,metaNodeMap,remainingEdges);return contractUntil(metaNodeMap,newEdges,size-1,sizeLimit)},cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,numEdges=edges.length,numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2)),stopSize=Math.floor(numNodes/Math.sqrt(2));if(numNodes<2)return void util.error("At least 2 nodes are required for Karger-Stein algorithm");for(var id2position={},i=0;i<numNodes;i++)id2position[nodes[i].id()]=i;for(var edgeIndexes=[],i=0;i<numEdges;i++){var e=edges[i];edgeIndexes.push([i,id2position[e.source().id()],id2position[e.target().id()]])}for(var minCutSize=1/0,minCut,originalMetaNode=[],i=0;i<numNodes;i++)originalMetaNode.push(i);for(var iter=0;iter<=numIter;iter++){var metaNodeMap=originalMetaNode.slice(0),edgesState=contractUntil(metaNodeMap,edgeIndexes,numNodes,stopSize),metaNodeMap2=metaNodeMap.slice(0),res1=contractUntil(metaNodeMap,edgesState,stopSize,2),res2=contractUntil(metaNodeMap2,edgesState,stopSize,2);res1.length<=res2.length&&res1.length<minCutSize?(minCutSize=res1.length,minCut=[res1,metaNodeMap]):res2.length<=res1.length&&res2.length<minCutSize&&(minCutSize=res2.length,minCut=[res2,metaNodeMap2])}for(var resEdges=minCut[0].map(function(e){return edges[e[0]]}),partition1=[],partition2=[],witnessNodePartition=minCut[1][0],i=0;i<minCut[1].length;i++){var partitionId=minCut[1][i];partitionId===witnessNodePartition?partition1.push(nodes[i]):partition2.push(nodes[i])}var ret={cut:eles.spawn(cy,resEdges),partition1:eles.spawn(partition1),partition2:eles.spawn(partition2)};return ret}};module.exports=elesfn},{"../../util":100}],13:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),elesfn={kruskal:function(weightFn){function findSet(ele){for(var i=0;i<forest.length;i++){var eles=forest[i];if(eles.anySame(ele))return{eles:eles,index:i}}}var cy=this.cy();weightFn=is.fn(weightFn)?weightFn:function(){return 1};for(var A=cy.collection(cy,[]),forest=[],nodes=this.nodes(),i=0;i<nodes.length;i++)forest.push(nodes[i].collection());for(var edges=this.edges(),S=edges.toArray().sort(function(a,b){var weightA=weightFn.call(a,a),weightB=weightFn.call(b,b);return weightA-weightB}),i=0;i<S.length;i++){var edge=S[i],u=edge.source()[0],v=edge.target()[0],setU=findSet(u),setV=findSet(v);setU.index!==setV.index&&(A=A.add(edge),forest[setU.index]=setU.eles.add(setV.eles),forest.splice(setV.index,1))}return nodes.add(A)}};module.exports=elesfn},{"../../is":83}],14:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../is"),elesfn={pageRank:function(options){options=options||{};var normalizeVector=function(vector){for(var length=vector.length,total=0,i=0;i<length;i++)total+=vector[i];for(var i=0;i<length;i++)vector[i]=vector[i]/total};if(null!=options&&null!=options.dampingFactor)var dampingFactor=options.dampingFactor;else var dampingFactor=.8;if(null!=options&&null!=options.precision)var epsilon=options.precision;else var epsilon=1e-6;if(null!=options&&null!=options.iterations)var numIter=options.iterations;else var numIter=200;if(null!=options&&null!=options.weight&&is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};for(var cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,numEdges=edges.length,id2position={},i=0;i<numNodes;i++)id2position[nodes[i].id()]=i;for(var matrix=[],columnSum=[],additionalProb=(1-dampingFactor)/numNodes,i=0;i<numNodes;i++){for(var newRow=[],j=0;j<numNodes;j++)newRow.push(0);matrix.push(newRow),columnSum.push(0)}for(var i=0;i<numEdges;i++){var edge=edges[i],s=id2position[edge.source().id()],t=id2position[edge.target().id()],w=weightFn.apply(edge,[edge]);matrix[t][s]+=w,columnSum[s]+=w}for(var p=1/numNodes+additionalProb,j=0;j<numNodes;j++)if(0===columnSum[j])for(var i=0;i<numNodes;i++)matrix[i][j]=p;else for(var i=0;i<numNodes;i++)matrix[i][j]=matrix[i][j]/columnSum[j]+additionalProb;for(var eigenvector=[],nullVector=[],previous,i=0;i<numNodes;i++)eigenvector.push(1),nullVector.push(0);for(var iter=0;iter<numIter;iter++){for(var temp=nullVector.slice(0),i=0;i<numNodes;i++)for(var j=0;j<numNodes;j++)temp[i]+=matrix[i][j]*eigenvector[j];normalizeVector(temp),previous=eigenvector,eigenvector=temp;for(var diff=0,i=0;i<numNodes;i++)diff+=Math.pow(previous[i]-eigenvector[i],2);if(diff<epsilon)break}var res={rank:function(node){if(is.string(node))var nodeId=cy.filter(node)[0].id();else var nodeId=node.id();return eigenvector[id2position[nodeId]]}};return res}};module.exports=elesfn},{"../../is":83}],15:[function(_dereq_,module,exports){"use strict";var define=_dereq_("../define"),elesfn={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop()};module.exports=elesfn},{"../define":44}],16:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),elesfn={classes:function(classes){classes=(classes||"").match(/\S+/g)||[];for(var self=this,changed=[],classesMap={},i=0;i<classes.length;i++){var cls=classes[i];classesMap[cls]=!0}for(var j=0;j<self.length;j++){for(var ele=self[j],_p=ele._private,eleClasses=_p.classes,changedEle=!1,i=0;i<classes.length;i++){var cls=classes[i],eleHasClass=eleClasses[cls];if(!eleHasClass){changedEle=!0;break}}if(!changedEle)for(var classes=Object.keys(eleClasses),i=0;i<classes.length;i++){var eleCls=classes[i],eleHasClass=eleClasses[eleCls],specdClass=classesMap[eleCls];if(eleHasClass&&!specdClass){changedEle=!0;break}}changedEle&&(_p.classes=util.copy(classesMap),changed.push(ele))}return changed.length>0&&this.spawn(changed).updateStyle().trigger("class"),self},addClass:function(classes){return this.toggleClass(classes,!0)},hasClass:function(className){var ele=this[0];return!(null==ele||!ele._private.classes[className])},toggleClass:function(classesStr,toggle){for(var classes=classesStr.match(/\S+/g)||[],self=this,changed=[],i=0,il=self.length;i<il;i++)for(var ele=self[i],changedEle=!1,j=0;j<classes.length;j++){var cls=classes[j],eleClasses=ele._private.classes,hasClass=eleClasses[cls],shouldAdd=toggle||void 0===toggle&&!hasClass;shouldAdd?(eleClasses[cls]=!0,hasClass||changedEle||(changed.push(ele),changedEle=!0)):(eleClasses[cls]=!1,hasClass&&!changedEle&&(changed.push(ele),changedEle=!0))}return changed.length>0&&this.spawn(changed).updateStyle().trigger("class"),self},removeClass:function(classes){return this.toggleClass(classes,!1)},flashClass:function(classes,duration){var self=this;if(null==duration)duration=250;else if(0===duration)return self;return self.addClass(classes),setTimeout(function(){self.removeClass(classes)},duration),self}};module.exports=elesfn},{"../util":100}],17:[function(_dereq_,module,exports){"use strict";var elesfn={allAre:function(selector){return this.filter(selector).length===this.length},is:function(selector){return this.filter(selector).length>0},some:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this);if(ret)return!0}return!1},every:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this);if(!ret)return!1}return!0},same:function(collection){return collection=this.cy().collection(collection),this.length===collection.length&&this.intersect(collection).length===this.length},anySame:function(collection){return collection=this.cy().collection(collection),this.intersect(collection).length>0},allAreNeighbors:function(collection){return collection=this.cy().collection(collection),this.neighborhood().intersect(collection).length===collection.length}};elesfn.allAreNeighbours=elesfn.allAreNeighbors,module.exports=elesfn},{}],18:[function(_dereq_,module,exports){"use strict";var elesfn={parent:function(selector){for(var parents=[],cy=this._private.cy,i=0;i<this.length;i++){var ele=this[i],parent=cy.getElementById(ele._private.data.parent);parent.size()>0&&parents.push(parent)}return this.spawn(parents,{unique:!0}).filter(selector)},parents:function(selector){for(var parents=[],eles=this.parent();eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent();
}return this.spawn(parents,{unique:!0}).filter(selector)},commonAncestors:function(selector){for(var ancestors,i=0;i<this.length;i++){var ele=this[i],parents=ele.parents();ancestors=ancestors||parents,ancestors=ancestors.intersect(parents)}return ancestors.filter(selector)},orphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().empty()}).filter(selector)},nonorphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().nonempty()}).filter(selector)},children:function(selector){for(var children=[],i=0;i<this.length;i++){var ele=this[i];children=children.concat(ele._private.children)}return this.spawn(children,{unique:!0}).filter(selector)},siblings:function(selector){return this.parent().children().not(this).filter(selector)},isParent:function(){var ele=this[0];if(ele)return 0!==ele._private.children.length},isChild:function(){var ele=this[0];if(ele)return void 0!==ele._private.data.parent&&0!==ele.parent().length},descendants:function(selector){function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele),ele.children().nonempty()&&add(ele.children())}}var elements=[];return add(this.children()),this.spawn(elements,{unique:!0}).filter(selector)}};elesfn.ancestors=elesfn.parents,module.exports=elesfn},{}],19:[function(_dereq_,module,exports){"use strict";var define=_dereq_("../define"),fn,elesfn;fn=elesfn={data:define.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:define.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:define.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var ele=this[0];if(ele)return ele._private.data.id}},fn.attr=fn.data,fn.removeAttr=fn.removeData,module.exports=elesfn},{"../define":44}],20:[function(_dereq_,module,exports){"use strict";function defineDegreeFunction(callback){return function(includeLoops){var self=this;if(void 0===includeLoops&&(includeLoops=!0),0!==self.length&&self.isNode()&&!self.removed()){for(var degree=0,node=self[0],connectedEdges=node._private.edges,i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];!includeLoops&&edge.isLoop()||(degree+=callback(node,edge))}return degree}}}function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){for(var ret,nodes=this.nodes(),i=0;i<nodes.length;i++){var ele=nodes[i],degree=ele[degreeFn](includeLoops);void 0===degree||void 0!==ret&&!callback(degree,ret)||(ret=degree)}return ret}}var util=_dereq_("../util"),elesfn={};util.extend(elesfn,{degree:defineDegreeFunction(function(node,edge){return edge.source().same(edge.target())?2:1}),indegree:defineDegreeFunction(function(node,edge){return edge.target().same(node)?1:0}),outdegree:defineDegreeFunction(function(node,edge){return edge.source().same(node)?1:0})}),util.extend(elesfn,{minDegree:defineDegreeBoundsFunction("degree",function(degree,min){return degree<min}),maxDegree:defineDegreeBoundsFunction("degree",function(degree,max){return degree>max}),minIndegree:defineDegreeBoundsFunction("indegree",function(degree,min){return degree<min}),maxIndegree:defineDegreeBoundsFunction("indegree",function(degree,max){return degree>max}),minOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,min){return degree<min}),maxOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,max){return degree>max})}),util.extend(elesfn,{totalDegree:function(includeLoops){for(var total=0,nodes=this.nodes(),i=0;i<nodes.length;i++)total+=nodes[i].degree(includeLoops);return total}}),module.exports=elesfn},{"../util":100}],21:[function(_dereq_,module,exports){"use strict";function filledBbOpts(options){return{includeNodes:util.default(options.includeNodes,defBbOpts.includeNodes),includeEdges:util.default(options.includeEdges,defBbOpts.includeEdges),includeLabels:util.default(options.includeLabels,defBbOpts.includeLabels),includeShadows:util.default(options.includeShadows,defBbOpts.includeShadows),includeOverlays:util.default(options.includeOverlays,defBbOpts.includeOverlays),useCache:util.default(options.useCache,defBbOpts.useCache)}}var define=_dereq_("../define"),is=_dereq_("../is"),util=_dereq_("../util"),math=_dereq_("../math"),fn,elesfn;fn=elesfn={position:define.data({field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"rtrigger",allowGetting:!0,validKeys:["x","y"],onSet:function(eles){var updatedEles=eles.updateCompoundBounds();updatedEles.rtrigger("position")},canSet:function(ele){return!ele.locked()&&!ele.isParent()}}),silentPosition:define.data({field:"position",bindingEvent:"position",allowBinding:!1,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!1,triggerFnName:"trigger",allowGetting:!0,validKeys:["x","y"],onSet:function(eles){eles.updateCompoundBounds()},canSet:function(ele){return!ele.locked()&&!ele.isParent()}}),positions:function(pos,silent){if(is.plainObject(pos))this.position(pos);else if(is.fn(pos)){for(var fn=pos,i=0;i<this.length;i++){var ele=this[i],pos=fn.apply(ele,[i,ele]);if(pos&&!ele.locked()&&!ele.isParent()){var elePos=ele._private.position;elePos.x=pos.x,elePos.y=pos.y}}var updatedEles=this.updateCompoundBounds(),toTrigger=updatedEles.length>0?this.add(updatedEles):this;silent?toTrigger.trigger("position"):toTrigger.rtrigger("position")}return this},silentPositions:function(pos){return this.positions(pos,!0)},renderedPosition:function(dim,val){var ele=this[0],cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),rpos=is.plainObject(dim)?dim:void 0,setting=void 0!==rpos||void 0!==val&&is.string(dim);if(ele&&ele.isNode()){if(!setting){var pos=ele._private.position;return rpos={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y},void 0===dim?rpos:rpos[dim]}for(var i=0;i<this.length;i++){var ele=this[i];void 0!==val?ele._private.position[dim]=(val-pan[dim])/zoom:void 0!==rpos&&(ele._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom})}this.rtrigger("position")}else if(!setting)return;return this},relativePosition:function(dim,val){var ele=this[0],cy=this.cy(),ppos=is.plainObject(dim)?dim:void 0,setting=void 0!==ppos||void 0!==val&&is.string(dim),hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(!setting){var pos=ele._private.position,parent=hasCompoundNodes?ele.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent._private.position:{x:0,y:0};return ppos={x:pos.x-origin.x,y:pos.y-origin.y},void 0===dim?ppos:ppos[dim]}for(var i=0;i<this.length;i++){var ele=this[i],parent=hasCompoundNodes?ele.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent._private.position:{x:0,y:0};void 0!==val?ele._private.position[dim]=val+origin[dim]:void 0!==ppos&&(ele._private.position={x:ppos.x+origin.x,y:ppos.y+origin.y})}this.rtrigger("position")}else if(!setting)return;return this},renderedBoundingBox:function(options){var bb=this.boundingBox(options),cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),x1=bb.x1*zoom+pan.x,x2=bb.x2*zoom+pan.x,y1=bb.y1*zoom+pan.y,y2=bb.y2*zoom+pan.y;return{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}},updateCompoundBounds:function(){function update(parent){if(parent.isParent()){var _p=parent._private,children=parent.children(),includeLabels="include"===parent.pstyle("compound-sizing-wrt-labels").value,bb=children.boundingBox({includeLabels:includeLabels,includeShadows:!1,includeOverlays:!1,useCache:!1}),pos=_p.position;_p.autoWidth=bb.w,pos.x=(bb.x1+bb.x2)/2,_p.autoHeight=bb.h,pos.y=(bb.y1+bb.y2)/2,updated.push(parent)}}var cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes())return cy.collection();for(var updated=[],eles=this;eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];update(ele)}eles=eles.parent()}return this.spawn(updated)}};var noninf=function(x){return x===1/0||x===-(1/0)?0:x},updateBounds=function(b,x1,y1,x2,y2){x2-x1!==0&&y2-y1!==0&&(b.x1=x1<b.x1?x1:b.x1,b.x2=x2>b.x2?x2:b.x2,b.y1=y1<b.y1?y1:b.y1,b.y2=y2>b.y2?y2:b.y2)},updateBoundsFromBox=function(b,b2){return updateBounds(b,b2.x1,b2.y1,b2.x2,b2.y2)},prefixedProperty=function(obj,field,prefix){return util.getPrefixedProperty(obj,field,prefix)},updateBoundsFromArrow=function(bounds,ele,prefix,options){var _p=ele._private,rstyle=_p.rstyle,halfArW=rstyle.arrowWidth/2,arrowType=ele.pstyle(prefix+"-arrow-shape").value,x,y;"none"!==arrowType&&("source"===prefix?(x=rstyle.srcX,y=rstyle.srcY):"target"===prefix?(x=rstyle.tgtX,y=rstyle.tgtY):(x=rstyle.midX,y=rstyle.midY),updateBounds(bounds,x-halfArW,y-halfArW,x+halfArW,y+halfArW))},updateBoundsFromLabel=function(bounds,ele,prefix,options){var prefixDash;prefixDash=prefix?prefix+"-":"";var _p=ele._private,rstyle=_p.rstyle,label=ele.pstyle(prefixDash+"label").strValue;if(label){var halign=ele.pstyle("text-halign"),valign=ele.pstyle("text-valign"),labelWidth=prefixedProperty(rstyle,"labelWidth",prefix),labelHeight=prefixedProperty(rstyle,"labelHeight",prefix),labelX=prefixedProperty(rstyle,"labelX",prefix),labelY=prefixedProperty(rstyle,"labelY",prefix),marginX=ele.pstyle(prefixDash+"text-margin-x").pfValue,marginY=ele.pstyle(prefixDash+"text-margin-y").pfValue,isEdge=ele.isEdge(),rotation=ele.pstyle(prefixDash+"text-rotation"),shadowR=ele.pstyle("text-shadow-blur").pfValue/2,shadowX=ele.pstyle("text-shadow-offset-x").pfValue,shadowY=ele.pstyle("text-shadow-offset-y").pfValue,shadowOpacity=ele.pstyle("text-shadow-opacity").value,outlineWidth=ele.pstyle("text-outline-width").pfValue,borderWidth=ele.pstyle("text-border-width").pfValue,halfBorderWidth=borderWidth/2,lh=labelHeight,lw=labelWidth,lw_2=lw/2,lh_2=lh/2,lx1,lx2,ly1,ly2;if(isEdge)lx1=labelX-lw_2,lx2=labelX+lw_2,ly1=labelY-lh_2,ly2=labelY+lh_2;else{switch(halign.value){case"left":lx1=labelX-lw,lx2=labelX;break;case"center":lx1=labelX-lw_2,lx2=labelX+lw_2;break;case"right":lx1=labelX,lx2=labelX+lw}switch(valign.value){case"top":ly1=labelY-lh,ly2=labelY;break;case"center":ly1=labelY-lh_2,ly2=labelY+lh_2;break;case"bottom":ly1=labelY,ly2=labelY+lh}}var isAutorotate=isEdge&&"autorotate"===rotation.strValue,isPfValue=null!=rotation.pfValue&&0!==rotation.pfValue;if(isAutorotate||isPfValue){var theta=isAutorotate?prefixedProperty(_p.rstyle,"labelAngle",prefix):rotation.pfValue,cos=Math.cos(theta),sin=Math.sin(theta),rotate=function(x,y){return x-=labelX,y-=labelY,{x:x*cos-y*sin+labelX,y:x*sin+y*cos+labelY}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2);lx1=Math.min(px1y1.x,px1y2.x,px2y1.x,px2y2.x),lx2=Math.max(px1y1.x,px1y2.x,px2y1.x,px2y2.x),ly1=Math.min(px1y1.y,px1y2.y,px2y1.y,px2y2.y),ly2=Math.max(px1y1.y,px1y2.y,px2y1.y,px2y2.y)}lx1+=marginX-Math.max(outlineWidth,halfBorderWidth),lx2+=marginX+Math.max(outlineWidth,halfBorderWidth),ly1+=marginY-Math.max(outlineWidth,halfBorderWidth),ly2+=marginY+Math.max(outlineWidth,halfBorderWidth),updateBounds(bounds,lx1,ly1,lx2,ly2),options.includeShadows&&shadowOpacity>0&&(lx1+=-shadowR+shadowX,lx2+=+shadowR+shadowX,ly1+=-shadowR+shadowY,ly2+=+shadowR+shadowY,updateBounds(bounds,lx1,ly1,lx2,ly2))}return bounds},boundingBoxImpl=function(ele,options){var cy=ele._private.cy,cy_p=cy._private,styleEnabled=cy_p.styleEnabled,bounds={x1:1/0,y1:1/0,x2:-(1/0),y2:-(1/0)},_p=ele._private,display=styleEnabled?ele.pstyle("display").value:"element",isNode=ele.isNode(),isEdge=ele.isEdge(),ex1,ex2,ey1,ey2,x,y,displayed="none"!==display;if(displayed){var overlayOpacity=0,overlayPadding=0;styleEnabled&&options.includeOverlays&&(overlayOpacity=ele.pstyle("overlay-opacity").value,0!==overlayOpacity&&(overlayPadding=ele.pstyle("overlay-padding").value));var w=0,wHalf=0;if(styleEnabled&&(w=ele.pstyle("width").pfValue,wHalf=w/2),isNode&&options.includeNodes){var pos=_p.position;x=pos.x,y=pos.y;var w=ele.outerWidth(),halfW=w/2,h=ele.outerHeight(),halfH=h/2;ex1=x-halfW-overlayPadding,ex2=x+halfW+overlayPadding,ey1=y-halfH-overlayPadding,ey2=y+halfH+overlayPadding,updateBounds(bounds,ex1,ey1,ex2,ey2)}else if(isEdge&&options.includeEdges){var rstyle=_p.rstyle||{};if(styleEnabled&&(ex1=Math.min(rstyle.srcX,rstyle.midX,rstyle.tgtX),ex2=Math.max(rstyle.srcX,rstyle.midX,rstyle.tgtX),ey1=Math.min(rstyle.srcY,rstyle.midY,rstyle.tgtY),ey2=Math.max(rstyle.srcY,rstyle.midY,rstyle.tgtY),ex1-=wHalf,ex2+=wHalf,ey1-=wHalf,ey2+=wHalf,updateBounds(bounds,ex1,ey1,ex2,ey2)),styleEnabled&&"haystack"===ele.pstyle("curve-style").strValue){var hpts=rstyle.haystackPts;if(ex1=hpts[0].x,ey1=hpts[0].y,ex2=hpts[1].x,ey2=hpts[1].y,ex1>ex2){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2,ey2=temp}updateBounds(bounds,ex1-wHalf,ey1-wHalf,ex2+wHalf,ey2+wHalf)}else{for(var pts=rstyle.bezierPts||rstyle.linePts||[],j=0;j<pts.length;j++){var pt=pts[j];ex1=pt.x-wHalf,ex2=pt.x+wHalf,ey1=pt.y-wHalf,ey2=pt.y+wHalf,updateBounds(bounds,ex1,ey1,ex2,ey2)}if(0===pts.length){var n1=_p.source,n1_p=n1._private,n1pos=n1_p.position,n2=_p.target,n2_p=n2._private,n2pos=n2_p.position;if(ex1=n1pos.x,ex2=n2pos.x,ey1=n1pos.y,ey2=n2pos.y,ex1>ex2){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2,ey2=temp}ex1-=wHalf,ex2+=wHalf,ey1-=wHalf,ey2+=wHalf,updateBounds(bounds,ex1,ey1,ex2,ey2)}}}if(styleEnabled){if(ex1=bounds.x1,ex2=bounds.x2,ey1=bounds.y1,ey2=bounds.y2,options.includeShadows&&ele.pstyle("shadow-opacity").value>0){var r=ele.pstyle("shadow-blur").pfValue/2,ox=ele.pstyle("shadow-offset-x").pfValue,oy=ele.pstyle("shadow-offset-y").pfValue;updateBounds(bounds,ex1-r+ox,ey1-r+oy,ex2+r+ox,ey2+r+oy)}updateBounds(bounds,ex1-overlayPadding,ey1-overlayPadding,ex2+overlayPadding,ey2+overlayPadding)}styleEnabled&&options.includeEdges&&isEdge&&(updateBoundsFromArrow(bounds,ele,"mid-source",options),updateBoundsFromArrow(bounds,ele,"mid-target",options),updateBoundsFromArrow(bounds,ele,"source",options),updateBoundsFromArrow(bounds,ele,"target",options)),styleEnabled&&options.includeLabels&&(updateBoundsFromLabel(bounds,ele,null,options),isEdge&&(updateBoundsFromLabel(bounds,ele,"source",options),updateBoundsFromLabel(bounds,ele,"target",options)))}return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds.w>0&&bounds.h>0&&displayed&&math.expandBoundingBox(bounds,1),bounds},tf=function(val){return val?"t":"f"},getKey=function(opts){var key="";return key+=tf(opts.incudeNodes),key+=tf(opts.includeEdges),key+=tf(opts.includeLabels),key+=tf(opts.includeShadows),key+=tf(opts.includeOverlays)},cachedBoundingBoxImpl=function(ele,opts){var _p=ele._private,bb,headless=ele.cy().headless(),key=opts===defBbOpts?defBbOptsKey:getKey(opts);return opts.useCache&&!headless&&_p.bbCache&&_p.bbCache[key]?bb=_p.bbCache[key]:(bb=boundingBoxImpl(ele,opts),headless||(_p.bbCache=_p.bbCache||{},_p.bbCache[key]=bb)),bb},defBbOpts={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeShadows:!0,includeOverlays:!0,useCache:!0},defBbOptsKey=getKey(defBbOpts);elesfn.recalculateRenderedStyle=function(useCache){var cy=this.cy(),renderer=cy.renderer(),styleEnabled=cy.styleEnabled();return renderer&&styleEnabled&&renderer.recalculateRenderedStyle(this,useCache),this},elesfn.boundingBox=function(options){if(1===this.length&&this[0]._private.bbCache&&(void 0===options||void 0===options.useCache||options.useCache===!0))return options=void 0===options?defBbOpts:filledBbOpts(options),cachedBoundingBoxImpl(this[0],options);var bounds={x1:1/0,y1:1/0,x2:-(1/0),y2:-(1/0)};options=options||util.staticEmptyObject();var opts=filledBbOpts(options),eles=this,cy=eles.cy(),styleEnabled=cy.styleEnabled();styleEnabled&&this.recalculateRenderedStyle(opts.useCache);for(var i=0;i<eles.length;i++){var ele=eles[i];styleEnabled&&ele.isEdge()&&"bezier"===ele.pstyle("curve-style").strValue&&ele.parallelEdges().recalculateRenderedStyle(opts.useCache),updateBoundsFromBox(bounds,cachedBoundingBoxImpl(ele,opts))}return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds};var defineDimFns=function(opts){opts.uppercaseName=util.capitalize(opts.name),opts.autoName="auto"+opts.uppercaseName,opts.labelName="label"+opts.uppercaseName,opts.outerName="outer"+opts.uppercaseName,opts.uppercaseOuterName=util.capitalize(opts.outerName),fn[opts.name]=function dimImpl(){var ele=this[0],_p=ele._private,cy=_p.cy,styleEnabled=cy._private.styleEnabled;if(ele){if(!styleEnabled)return 1;if(ele.isParent())return _p[opts.autoName]||0;var d=ele.pstyle(opts.name);switch(d.strValue){case"label":return _p.rstyle[opts.labelName]||0;default:return d.pfValue}}},fn["outer"+opts.uppercaseName]=function outerDimImpl(){var ele=this[0],_p=ele._private,cy=_p.cy,styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){var dim=ele[opts.name](),border=ele.pstyle("border-width").pfValue,padding=2*ele.pstyle("padding").pfValue;return dim+border+padding}return 1}},fn["rendered"+opts.uppercaseName]=function renderedDimImpl(){var ele=this[0];if(ele){var d=ele[opts.name]();return d*this.cy().zoom()}},fn["rendered"+opts.uppercaseOuterName]=function renderedOuterDimImpl(){var ele=this[0];if(ele){var od=ele[opts.outerName]();return od*this.cy().zoom()}}};defineDimFns({name:"width"}),defineDimFns({name:"height"}),fn.modelPosition=fn.point=fn.position,fn.modelPositions=fn.points=fn.positions,fn.renderedPoint=fn.renderedPosition,fn.relativePoint=fn.relativePosition,fn.boundingbox=fn.boundingBox,fn.renderedBoundingbox=fn.renderedBoundingBox,module.exports=elesfn},{"../define":44,"../is":83,"../math":85,"../util":100}],22:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),Element=function(cy,params,restore){var self=this;if(restore=!(void 0!==restore&&!restore),void 0===cy||void 0===params||!is.core(cy))return void util.error("An element must have a core reference and parameters set");var group=params.group;if(null==group&&(group=params.data&&null!=params.data.source&&null!=params.data.target?"edges":"nodes"),"nodes"!==group&&"edges"!==group)return void util.error("An element must be of type `nodes` or `edges`; you specified `"+group+"`");if(this.length=1,this[0]=this,this._private={cy:cy,single:!0,data:params.data||{},position:params.position||{},autoWidth:void 0,autoHeight:void 0,listeners:[],group:group,style:{},rstyle:{},styleCxts:[],removed:!0,selected:!!params.selected,selectable:void 0===params.selectable||!!params.selectable,locked:!!params.locked,grabbed:!1,grabbable:void 0===params.grabbable||!!params.grabbable,active:!1,classes:{},animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[],traversalCache:{}},params.renderedPosition){var rpos=params.renderedPosition,pan=cy.pan(),zoom=cy.zoom();this._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if(is.string(params.classes))for(var classes=params.classes.split(/\s+/),i=0,l=classes.length;i<l;i++){var cls=classes[i];cls&&""!==cls&&(self._private.classes[cls]=!0)}(params.style||params.css)&&cy.style().applyBypass(this,params.style||params.css),(void 0===restore||restore)&&this.restore()};module.exports=Element},{"../is":83,"../util":100}],23:[function(_dereq_,module,exports){"use strict";var define=_dereq_("../define"),elesfn={on:define.on(),one:define.on({unbindSelfOnTrigger:!0}),once:define.on({unbindAllBindersOnTrigger:!0}),off:define.off(),trigger:define.trigger(),rtrigger:function(event,extraParams){if(0!==this.length)return this.cy().notify({type:event,eles:this}),this.trigger(event,extraParams),this}};define.eventAliasesOn(elesfn),module.exports=elesfn},{"../define":44}],24:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),Selector=_dereq_("../selector"),elesfn={nodes:function(selector){return this.filter(function(i,element){return element.isNode()}).filter(selector)},edges:function(selector){return this.filter(function(i,element){return element.isEdge()}).filter(selector)},filter:function(filter){if(void 0===filter)return this;if(is.string(filter)||is.elementOrCollection(filter))return Selector(filter).filter(this);if(is.fn(filter)){for(var elements=[],i=0;i<this.length;i++){var ele=this[i];filter.apply(ele,[i,ele])&&elements.push(ele)}return this.spawn(elements)}return this.spawn()},not:function(toRemove){if(toRemove){is.string(toRemove)&&(toRemove=this.filter(toRemove));for(var elements=[],i=0;i<this.length;i++){var element=this[i],remove=toRemove._private.ids[element.id()];remove||elements.push(element)}return this.spawn(elements)}return this},absoluteComplement:function(){var cy=this._private.cy;return cy.mutableElements().not(this)},intersect:function(other){if(is.string(other)){var selector=other;return this.filter(selector)}for(var elements=[],col1=this,col2=other,col1Smaller=this.length<other.length,ids2=col1Smaller?col2._private.ids:col1._private.ids,col=col1Smaller?col1:col2,i=0;i<col.length;i++){var id=col[i]._private.data.id,ele=ids2[id];ele&&elements.push(ele)}return this.spawn(elements)},xor:function(other){var cy=this._private.cy;is.string(other)&&(other=cy.$(other));var elements=[],col1=this,col2=other,add=function(col,other){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id,inOther=other._private.ids[id];inOther||elements.push(ele)}};return add(col1,col2),add(col2,col1),this.spawn(elements)},diff:function(other){var cy=this._private.cy;is.string(other)&&(other=cy.$(other));var left=[],right=[],both=[],col1=this,col2=other,add=function(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id,inOther=other._private.ids[id];inOther?both.push(ele):retEles.push(ele)}};return add(col1,col2,left),add(col2,col1,right),{left:this.spawn(left,{unique:!0}),right:this.spawn(right,{unique:!0}),both:this.spawn(both,{unique:!0})}},add:function(toAdd){var cy=this._private.cy;if(!toAdd)return this;if(is.string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var elements=[],i=0;i<this.length;i++)elements.push(this[i]);for(var i=0;i<toAdd.length;i++){var add=!this._private.ids[toAdd[i].id()];add&&elements.push(toAdd[i])}return this.spawn(elements)},merge:function(toAdd){var _p=this._private,cy=_p.cy;if(!toAdd)return this;if(toAdd&&is.string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var i=0;i<toAdd.length;i++){var toAddEle=toAdd[i],id=toAddEle._private.data.id,add=!_p.ids[id];if(add){var index=this.length++;this[index]=toAddEle,_p.ids[id]=toAddEle,_p.indexes[id]=index}else{var index=_p.indexes[id];this[index]=toAddEle,_p.ids[id]=toAddEle}}return this},unmergeOne:function(ele){ele=ele[0];var _p=this._private,id=ele._private.data.id,i=_p.indexes[id];if(null==i)return this;this[i]=void 0,_p.ids[id]=void 0,_p.indexes[id]=void 0;var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1,lastEle=this[lastEleI],lastEleId=lastEle._private.data.id;this[lastEleI]=void 0,this[i]=lastEle,_p.indexes[lastEleId]=i}return this.length--,this},unmerge:function(toRemove){var cy=this._private.cy;if(!toRemove)return this;if(toRemove&&is.string(toRemove)){var selector=toRemove;toRemove=cy.mutableElements().filter(selector)}for(var i=0;i<toRemove.length;i++)this.unmergeOne(toRemove[i]);return this},map:function(mapFn,thisArg){for(var arr=[],eles=this,i=0;i<eles.length;i++){var ele=eles[i],ret=thisArg?mapFn.apply(thisArg,[ele,i,eles]):mapFn(ele,i,eles);arr.push(ret)}return arr},stdFilter:function(fn,thisArg){for(var filterEles=[],eles=this,i=0;i<eles.length;i++){var ele=eles[i],include=thisArg?fn.apply(thisArg,[ele,i,eles]):fn(ele,i,eles);include&&filterEles.push(ele)}return this.spawn(filterEles)},max:function(valFn,thisArg){for(var max=-(1/0),maxEle,eles=this,i=0;i<eles.length;i++){var ele=eles[i],val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);val>max&&(max=val,maxEle=ele)}return{value:max,ele:maxEle}},min:function(valFn,thisArg){for(var min=1/0,minEle,eles=this,i=0;i<eles.length;i++){var ele=eles[i],val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);val<min&&(min=val,minEle=ele)}return{value:min,ele:minEle}}},fn=elesfn;fn.u=fn["|"]=fn["+"]=fn.union=fn.or=fn.add,fn["\\"]=fn["!"]=fn["-"]=fn.difference=fn.relativeComplement=fn.subtract=fn.not,fn.n=fn["&"]=fn["."]=fn.and=fn.intersection=fn.intersect,fn["^"]=fn["(+)"]=fn["(-)"]=fn.symmetricDifference=fn.symdiff=fn.xor,fn.fnFilter=fn.filterFn=fn.stdFilter,fn.complement=fn.abscomp=fn.absoluteComplement,module.exports=elesfn},{"../is":83,"../selector":87}],25:[function(_dereq_,module,exports){"use strict";var elesfn={isNode:function(){return"nodes"===this.group()},isEdge:function(){return"edges"===this.group()},isLoop:function(){return this.isEdge()&&this.source().id()===this.target().id()},isSimple:function(){return this.isEdge()&&this.source().id()!==this.target().id()},group:function(){var ele=this[0];if(ele)return ele._private.group}};module.exports=elesfn},{}],26:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),Element=_dereq_("./element"),idFactory={generate:function(cy,element,tryThisId){for(var id=null!=tryThisId?tryThisId:util.uuid();cy.hasElementWithId(id);)id=util.uuid();return id}},Collection=function(cy,elements,options){if(void 0===cy||!is.core(cy))return void util.error("A collection must have a reference to the core");var ids={},indexes={},createdElements=!1;if(elements){if(elements.length>0&&is.plainObject(elements[0])&&!is.element(elements[0])){createdElements=!0;for(var eles=[],elesIds={},i=0,l=elements.length;i<l;i++){var json=elements[i];null==json.data&&(json.data={});var data=json.data;if(null==data.id)data.id=idFactory.generate(cy,json);else if(cy.hasElementWithId(data.id)||elesIds[data.id])continue;var ele=new Element(cy,json,!1);eles.push(ele),elesIds[data.id]=!0}elements=eles}}else elements=[];this.length=0;for(var i=0,l=elements.length;i<l;i++){var element=elements[i];if(element){var id=element._private.data.id;(!options||options.unique&&!ids[id])&&(ids[id]=element,indexes[id]=this.length,this[this.length]=element,this.length++)}}this._private={cy:cy,ids:ids,indexes:indexes},createdElements&&this.restore()},elesfn=Element.prototype=Collection.prototype;elesfn.instanceString=function(){return"collection"},elesfn.spawn=function(cy,eles,opts){return is.core(cy)||(opts=eles,eles=cy,cy=this.cy()),new Collection(cy,eles,opts)},elesfn.spawnSelf=function(){return this.spawn(this)},elesfn.cy=function(){return this._private.cy},elesfn.element=function(){return this[0]},elesfn.collection=function(){return is.collection(this)?this:new Collection(this._private.cy,[this])},elesfn.unique=function(){return new Collection(this._private.cy,this,{unique:!0})},elesfn.hasElementWithId=function(id){return!!this._private.ids[id]},elesfn.getElementById=function(id){var cy=this._private.cy,ele=this._private.ids[id];return ele?ele:new Collection(cy)},elesfn.poolIndex=function(){var cy=this._private.cy,eles=cy._private.elements,id=this._private.data.id;return eles._private.indexes[id]},elesfn.json=function(obj){var ele=this.element(),cy=this.cy();if(null==ele&&obj)return this;if(null!=ele){var p=ele._private;if(is.plainObject(obj)){cy.startBatch(),obj.data&&ele.data(obj.data),obj.position&&ele.position(obj.position);var checkSwitch=function(k,trueFnName,falseFnName){var obj_k=obj[k];null!=obj_k&&obj_k!==p[k]&&(obj_k?ele[trueFnName]():ele[falseFnName]())};return checkSwitch("removed","remove","restore"),checkSwitch("selected","select","unselect"),checkSwitch("selectable","selectify","unselectify"),checkSwitch("locked","lock","unlock"),checkSwitch("grabbable","grabify","ungrabify"),null!=obj.classes&&ele.classes(obj.classes),cy.endBatch(),this}if(void 0===obj){var json={data:util.copy(p.data),position:util.copy(p.position),group:p.group,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbable:p.grabbable,classes:null};return json.classes=Object.keys(p.classes).filter(function(cls){return p.classes[cls]}).join(" "),json}}},elesfn.jsons=function(){for(var jsons=[],i=0;i<this.length;i++){var ele=this[i],json=ele.json();jsons.push(json)}return jsons},elesfn.clone=function(){for(var cy=this.cy(),elesArr=[],i=0;i<this.length;i++){var ele=this[i],json=ele.json(),clone=new Element(cy,json,!1);elesArr.push(clone)}return new Collection(cy,elesArr)},elesfn.copy=elesfn.clone,elesfn.restore=function(notifyRenderer){var self=this,cy=self.cy(),cy_p=cy._private;void 0===notifyRenderer&&(notifyRenderer=!0);for(var nodes=[],edges=[],elements,i=0,l=self.length;i<l;i++){var ele=self[i];ele.removed()&&(ele.isNode()?nodes.push(ele):edges.push(ele))}elements=nodes.concat(edges);var i,removeFromElements=function(){elements.splice(i,1),i--};for(i=0;i<elements.length;i++){var ele=elements[i],_private=ele._private,data=_private.data;if(_private.traversalCache=null,void 0===data.id)data.id=idFactory.generate(cy,ele);else if(is.number(data.id))data.id=""+data.id;else{if(is.emptyString(data.id)||!is.string(data.id)){util.error("Can not create element with invalid string ID `"+data.id+"`"),removeFromElements();continue}if(cy.hasElementWithId(data.id)){util.error("Can not create second element with ID `"+data.id+"`"),removeFromElements();continue}}var id=data.id;if(ele.isNode()){var node=ele,pos=_private.position;null==pos.x&&(pos.x=0),null==pos.y&&(pos.y=0)}if(ele.isEdge()){for(var edge=ele,fields=["source","target"],fieldsLength=fields.length,badSourceOrTarget=!1,j=0;j<fieldsLength;j++){var field=fields[j],val=data[field];is.number(val)&&(val=data[field]=""+data[field]),null==val||""===val?(util.error("Can not create edge `"+id+"` with unspecified "+field),badSourceOrTarget=!0):cy.hasElementWithId(val)||(util.error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`"),badSourceOrTarget=!0)}if(badSourceOrTarget){removeFromElements();continue}var src=cy.getElementById(data.source),tgt=cy.getElementById(data.target);src._private.edges.push(edge),tgt._private.edges.push(edge),edge._private.source=src,edge._private.target=tgt}_private.ids={},_private.ids[id]=ele,_private.indexes={},_private.indexes[id]=ele,_private.removed=!1,cy.addToPool(ele)}for(var i=0;i<nodes.length;i++){var node=nodes[i],data=node._private.data;is.number(data.parent)&&(data.parent=""+data.parent);var parentId=data.parent,specifiedParent=null!=parentId;if(specifiedParent){var parent=cy.getElementById(parentId);if(parent.empty())data.parent=void 0;else{for(var selfAsParent=!1,ancestor=parent;!ancestor.empty();){if(node.same(ancestor)){selfAsParent=!0,data.parent=void 0;break}ancestor=ancestor.parent()}selfAsParent||(parent[0]._private.children.push(node),node._private.parent=parent[0],cy_p.hasCompoundNodes=!0)}}}if(elements.length>0){for(var restored=new Collection(cy,elements),i=0;i<restored.length;i++){var ele=restored[i];if(!ele.isNode()){for(var pedges=ele.parallelEdges(),j=0;j<pedges.length;j++)pedges[j]._private.traversalCache=null;ele.source()[0]._private.traversalCache=null,ele.target()[0]._private.traversalCache=null}}var toUpdateStyle;toUpdateStyle=cy_p.hasCompoundNodes?restored.add(restored.connectedNodes()).add(restored.parent()):restored,toUpdateStyle.updateStyle(notifyRenderer),
notifyRenderer?restored.rtrigger("add"):restored.trigger("add")}return self},elesfn.removed=function(){var ele=this[0];return ele&&ele._private.removed},elesfn.inside=function(){var ele=this[0];return ele&&!ele._private.removed},elesfn.remove=function(notifyRenderer){function addConnectedEdges(node){for(var edges=node._private.edges,i=0;i<edges.length;i++)add(edges[i])}function addChildren(node){for(var children=node._private.children,i=0;i<children.length;i++)add(children[i])}function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];alreadyAdded||(elesToRemoveIds[ele.id()]=!0,ele.isNode()?(elesToRemove.push(ele),addConnectedEdges(ele),addChildren(ele)):elesToRemove.unshift(ele))}function removeEdgeRef(node,edge){var connectedEdges=node._private.edges;util.removeFromArray(connectedEdges,edge),node._private.traversalCache=null}function removeParallelRefs(edge){for(var pedges=edge.parallelEdges(),j=0;j<pedges.length;j++)pedges[j]._private.traversalCache=null}function removeChildRef(parent,ele){ele=ele[0],parent=parent[0];var children=parent._private.children,pid=parent.id();util.removeFromArray(children,ele),alteredParents.ids[pid]||(alteredParents.ids[pid]=!0,alteredParents.push(parent))}var self=this,removed=[],elesToRemove=[],elesToRemoveIds={},cy=self._private.cy;void 0===notifyRenderer&&(notifyRenderer=!0);for(var i=0,l=self.length;i<l;i++){var ele=self[i];add(ele)}var alteredParents=[];alteredParents.ids={},cy.removeFromPool(elesToRemove);for(var i=0;i<elesToRemove.length;i++){var ele=elesToRemove[i];if(ele._private.removed=!0,removed.push(ele),ele.isEdge()){var src=ele.source()[0],tgt=ele.target()[0];removeEdgeRef(src,ele),removeEdgeRef(tgt,ele),removeParallelRefs(ele)}else{var parent=ele.parent();0!==parent.length&&removeChildRef(parent,ele)}}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=!1;for(var i=0;i<elesStillInside.length;i++){var ele=elesStillInside[i];if(ele.isParent()){cy._private.hasCompoundNodes=!0;break}}var removedElements=new Collection(this.cy(),removed);removedElements.size()>0&&(notifyRenderer&&this.cy().notify({type:"remove",eles:removedElements}),removedElements.trigger("remove"));for(var i=0;i<alteredParents.length;i++){var ele=alteredParents[i];ele.removed()||ele.updateStyle()}return new Collection(cy,removed)},elesfn.move=function(struct){var cy=this._private.cy;if(void 0!==struct.source||void 0!==struct.target){var srcId=struct.source,tgtId=struct.target,srcExists=cy.hasElementWithId(srcId),tgtExists=cy.hasElementWithId(tgtId);if(srcExists||tgtExists){var jsons=this.jsons();this.remove();for(var i=0;i<jsons.length;i++){var json=jsons[i],ele=this[i];"edges"===json.group&&(srcExists&&(json.data.source=srcId),tgtExists&&(json.data.target=tgtId),json.scratch=ele._private.scratch)}return cy.add(jsons)}}else if(void 0!==struct.parent){var parentId=struct.parent,parentExists=null===parentId||cy.hasElementWithId(parentId);if(parentExists){var jsons=this.jsons(),descs=this.descendants(),descsEtcJsons=descs.union(descs.union(this).connectedEdges()).jsons();this.remove();for(var i=0;i<jsons.length;i++){var json=jsons[i],ele=this[i];"nodes"===json.group&&(json.data.parent=null===parentId?void 0:parentId,json.scratch=ele._private.scratch)}return cy.add(jsons.concat(descsEtcJsons))}}return this},[_dereq_("./algorithms"),_dereq_("./animation"),_dereq_("./class"),_dereq_("./comparators"),_dereq_("./compounds"),_dereq_("./data"),_dereq_("./degree"),_dereq_("./dimensions"),_dereq_("./events"),_dereq_("./filter"),_dereq_("./group"),_dereq_("./index"),_dereq_("./iteration"),_dereq_("./layout"),_dereq_("./style"),_dereq_("./switch-functions"),_dereq_("./traversing")].forEach(function(props){util.extend(elesfn,props)}),module.exports=Collection},{"../is":83,"../util":100,"./algorithms":11,"./animation":15,"./class":16,"./comparators":17,"./compounds":18,"./data":19,"./degree":20,"./dimensions":21,"./element":22,"./events":23,"./filter":24,"./group":25,"./index":26,"./iteration":27,"./layout":28,"./style":29,"./switch-functions":30,"./traversing":31}],27:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),zIndexSort=_dereq_("./zsort"),elesfn={each:function(fn){if(is.fn(fn))for(var i=0;i<this.length;i++){var ele=this[i],ret=fn.apply(ele,[i,ele]);if(ret===!1)break}return this},forEach:function(fn,thisArg){if(is.fn(fn))for(var i=0;i<this.length;i++){var ele=this[i],ret=thisArg?fn.apply(thisArg,[ele,i,this]):fn(ele,i,this);if(ret===!1)break}return this},toArray:function(){for(var array=[],i=0;i<this.length;i++)array.push(this[i]);return array},slice:function(start,end){var array=[],thisSize=this.length;null==end&&(end=thisSize),null==start&&(start=0),start<0&&(start=thisSize+start),end<0&&(end=thisSize+end);for(var i=start;i>=0&&i<end&&i<thisSize;i++)array.push(this[i]);return this.spawn(array)},size:function(){return this.length},eq:function(i){return this[i]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return 0===this.length},nonempty:function(){return!this.empty()},sort:function(sortFn){if(!is.fn(sortFn))return this;var sorted=this.toArray().sort(sortFn);return this.spawn(sorted)},sortByZIndex:function(){return this.sort(zIndexSort)},zDepth:function(){var ele=this[0];if(ele){var _p=ele._private,group=_p.group;if("nodes"===group){var depth=_p.data.parent?ele.parents().size():0;return ele.isParent()?depth:Number.MAX_VALUE}var src=_p.source,tgt=_p.target,srcDepth=src.zDepth(),tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}};module.exports=elesfn},{"../is":83,"./zsort":32}],28:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),util=_dereq_("../util"),Promise=_dereq_("../promise"),elesfn={layoutPositions:function(layout,options,fn){var nodes=this.nodes(),cy=this.cy();if(layout.trigger({type:"layoutstart",layout:layout}),layout.animations=[],options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i],newPos=fn.call(node,i,node),pos=node.position();is.number(pos.x)&&is.number(pos.y)||node.silentPosition({x:0,y:0});var ani=node.animation({position:newPos,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(ani),ani.play()}var onStep;cy.on("step.*",onStep=function(){options.fit&&cy.fit(options.eles,options.padding)}),layout.one("layoutstop",function(){cy.off("step.*",onStep)}),layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout}),Promise.all(layout.animations.map(function(ani){return ani.promise()})).then(function(){cy.off("step.*",onStep),null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),options.fit&&cy.fit(options.eles,options.padding),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})})}else nodes.positions(fn),options.fit&&cy.fit(options.eles,options.padding),null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout}),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout});return this},layout:function(options){var cy=this.cy();return cy.layout(util.extend({},options,{eles:this})),this},makeLayout:function(options){var cy=this.cy();return cy.makeLayout(util.extend({},options,{eles:this}))}};elesfn.createLayout=elesfn.makeLayout,module.exports=elesfn},{"../is":83,"../promise":86,"../util":100}],29:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),elesfn={updateStyle:function(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled())return this;if(cy._private.batchingStyle){var bEles=cy._private.batchStyleEles;return bEles.merge(this),this}var hasCompounds=cy.hasCompoundNodes(),style=cy.style(),updatedEles=this;if(notifyRenderer=!(!notifyRenderer&&void 0!==notifyRenderer),hasCompounds&&(updatedEles=this.spawnSelf().merge(this.descendants()).merge(this.parents())),style.apply(updatedEles),hasCompounds)var updatedCompounds=updatedEles.updateCompoundBounds();return notifyRenderer?updatedEles.rtrigger("style"):updatedEles.trigger("style"),this},updateMappers:function(notifyRenderer){var cy=this._private.cy,style=cy.style();if(notifyRenderer=!(!notifyRenderer&&void 0!==notifyRenderer),!cy.styleEnabled())return this;style.updateMappers(this);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;return notifyRenderer?toNotify.rtrigger("style"):toNotify.trigger("style"),this},parsedStyle:function(property){var ele=this[0];if(ele.cy().styleEnabled())return ele?ele._private.style[property]||ele.cy().style().getDefaultProperty(property):void 0},renderedStyle:function(property){var cy=this.cy();if(!cy.styleEnabled())return this;var ele=this[0];if(ele){var renstyle=ele.cy().style().getRenderedStyle(ele);return void 0===property?renstyle:renstyle[property]}},style:function(name,value){var cy=this.cy();if(!cy.styleEnabled())return this;var updateTransitions=!1,style=cy.style();if(is.plainObject(name)){var props=name;style.applyBypass(this,props,updateTransitions);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}else if(is.string(name)){if(void 0===value){var ele=this[0];return ele?style.getStylePropertyValue(ele,name):void 0}style.applyBypass(this,name,value,updateTransitions);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}else if(void 0===name){var ele=this[0];return ele?style.getRawStyle(ele):void 0}return this},removeStyle:function(names){var cy=this.cy();if(!cy.styleEnabled())return this;var updateTransitions=!1,style=cy.style(),eles=this;if(void 0===names)for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeAllBypasses(ele,updateTransitions)}else{names=names.split(/\s+/);for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeBypasses(ele,names,updateTransitions)}}var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;return toNotify.rtrigger("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},visible:function(){var cy=this.cy();if(!cy.styleEnabled())return!0;var ele=this[0],hasCompoundNodes=cy.hasCompoundNodes();if(ele){if("visible"!==ele.pstyle("visibility").value||"element"!==ele.pstyle("display").value||0===ele.pstyle("width").pfValue)return!1;if("nodes"===ele._private.group){if(0===ele.pstyle("height").pfValue)return!1;if(!hasCompoundNodes)return!0;var parents=ele._private.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){var parent=parents[i],pVis=parent.pstyle("visibility").value,pDis=parent.pstyle("display").value;if("visible"!==pVis||"element"!==pDis)return!1}return!0}var src=ele._private.source,tgt=ele._private.target;return src.visible()&&tgt.visible()}},hidden:function(){var ele=this[0];if(ele)return!ele.visible()},effectiveOpacity:function(){var cy=this.cy();if(!cy.styleEnabled())return 1;var hasCompoundNodes=cy.hasCompoundNodes(),ele=this[0];if(ele){var _p=ele._private,parentOpacity=ele.pstyle("opacity").value;if(!hasCompoundNodes)return parentOpacity;var parents=_p.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){var parent=parents[i],opacity=parent.pstyle("opacity").value;parentOpacity*=opacity}return parentOpacity}},transparent:function(){var cy=this.cy();if(!cy.styleEnabled())return!1;var ele=this[0],hasCompoundNodes=ele.cy().hasCompoundNodes();return ele?hasCompoundNodes?0===ele.effectiveOpacity():0===ele.pstyle("opacity").value:void 0},backgrounding:function(){var cy=this.cy();if(!cy.styleEnabled())return!1;var ele=this[0];return!!ele._private.backgrounding}};elesfn.bypass=elesfn.css=elesfn.style,elesfn.renderedCss=elesfn.renderedStyle,elesfn.removeBypass=elesfn.removeCss=elesfn.removeStyle,elesfn.pstyle=elesfn.parsedStyle,module.exports=elesfn},{"../is":83}],30:[function(_dereq_,module,exports){"use strict";function defineSwitchFunction(params){return function(){var args=arguments,changedEles=[];if(2===args.length){var data=args[0],handler=args[1];this.on(params.event,data,handler)}else if(1===args.length){var handler=args[0];this.on(params.event,handler)}else if(0===args.length){for(var i=0;i<this.length;i++){var ele=this[i],able=!params.ableField||ele._private[params.ableField],changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(void 0!==overrideAble&&(able=overrideAble,!overrideAble))return this}able&&(ele._private[params.field]=params.value,changed&&changedEles.push(ele))}var changedColl=this.spawn(changedEles);changedColl.updateStyle(),changedColl.trigger(params.event)}return this}}function defineSwitchSet(params){elesfn[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(void 0!==val)return val}return ele._private[params.field]}},elesfn[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!0}),elesfn[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!1})}var elesfn={};defineSwitchSet({field:"locked",overrideField:function(ele){return!!ele.cy().autolock()||void 0},on:"lock",off:"unlock"}),defineSwitchSet({field:"grabbable",overrideField:function(ele){return!ele.cy().autoungrabify()&&void 0},on:"grabify",off:"ungrabify"}),defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function(ele){return!ele.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),defineSwitchSet({field:"selectable",overrideField:function(ele){return!ele.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),elesfn.deselect=elesfn.unselect,elesfn.grabbed=function(){var ele=this[0];if(ele)return ele._private.grabbed},defineSwitchSet({field:"active",on:"activate",off:"unactivate"}),elesfn.inactive=function(){var ele=this[0];if(ele)return!ele._private.active},module.exports=elesfn},{}],31:[function(_dereq_,module,exports){"use strict";function defineSourceFunction(params){return function sourceImpl(selector){for(var sources=[],i=0;i<this.length;i++){var ele=this[i],src=ele._private[params.attr];src&&sources.push(src)}return this.spawn(sources,{unique:!0}).filter(selector)}}function defineEdgesWithFunction(params){return function edgesWithImpl(otherNodes){var elements=[],cy=this._private.cy,p=params||{};is.string(otherNodes)&&(otherNodes=cy.$(otherNodes));for(var thisIds=this._private.ids,otherIds=otherNodes._private.ids,h=0;h<otherNodes.length;h++)for(var edges=otherNodes[h]._private.edges,i=0;i<edges.length;i++){var edge=edges[i],edgeData=edge._private.data,thisToOther=thisIds[edgeData.source]&&otherIds[edgeData.target],otherToThis=otherIds[edgeData.source]&&thisIds[edgeData.target],edgeConnectsThisAndOther=thisToOther||otherToThis;if(edgeConnectsThisAndOther){if(p.thisIsSrc||p.thisIsTgt){if(p.thisIsSrc&&!thisToOther)continue;if(p.thisIsTgt&&!otherToThis)continue}elements.push(edge)}}return this.spawn(elements,{unique:!0})}}function defineParallelEdgesFunction(params){var defaults={codirected:!1};return params=util.extend({},defaults,params),function parallelEdgesImpl(selector){for(var elements=[],edges=this.edges(),p=params,i=0;i<edges.length;i++)for(var edge1=edges[i],edge1_p=edge1._private,src1=edge1_p.source,srcid1=src1._private.data.id,tgtid1=edge1_p.data.target,srcEdges1=src1._private.edges,j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j],edge2data=edge2._private.data,tgtid2=edge2data.target,srcid2=edge2data.source,codirected=tgtid2===tgtid1&&srcid2===srcid1,oppdirected=srcid1===tgtid2&&tgtid1===srcid2;(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected))&&elements.push(edge2)}return this.spawn(elements,{unique:!0}).filter(selector)}}var util=_dereq_("../util"),is=_dereq_("../is"),elesfn={},cache=function(fn,name){return function traversalCache(arg1,arg2,arg3,arg4){var selectorOrEles=arg1,eles=this,key;if(null==selectorOrEles?key="null":is.elementOrCollection(selectorOrEles)&&1===selectorOrEles.length&&(key="#"+selectorOrEles.id()),1===eles.length&&key){var _p=eles[0]._private,tch=_p.traversalCache=_p.traversalCache||{},ch=tch[name]=tch[name]||{},cacheHit=ch[key];return cacheHit?cacheHit:ch[key]=fn.call(eles,arg1,arg2,arg3,arg4)}return fn.call(eles,arg1,arg2,arg3,arg4)}},defineDagExtremity=function(params){return function dagExtremityImpl(selector){for(var eles=this,ret=[],i=0;i<eles.length;i++){var ele=eles[i];if(ele.isNode()){for(var disqualified=!1,edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();if(params.noIncomingEdges&&tgt===ele&&src!==ele||params.noOutgoingEdges&&src===ele&&tgt!==ele){disqualified=!0;break}}disqualified||ret.push(ele)}}return this.spawn(ret,{unique:!0}).filter(selector)}},defineDagOneHop=function(params){return function(selector){for(var eles=this,oEles=[],i=0;i<eles.length;i++){var ele=eles[i];if(ele.isNode())for(var edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();params.outgoing&&src===ele?(oEles.push(edge),oEles.push(tgt)):params.incoming&&tgt===ele&&(oEles.push(edge),oEles.push(src))}}return this.spawn(oEles,{unique:!0}).filter(selector)}},defineDagAllHops=function(params){return function(selector){for(var eles=this,sEles=[],sElesIds={};;){var next=params.outgoing?eles.outgoers():eles.incomers();if(0===next.length)break;for(var newNext=!1,i=0;i<next.length;i++){var n=next[i],nid=n.id();sElesIds[nid]||(sElesIds[nid]=!0,sEles.push(n),newNext=!0)}if(!newNext)break;eles=next}return this.spawn(sEles,{unique:!0}).filter(selector)}};util.extend(elesfn,{roots:defineDagExtremity({noIncomingEdges:!0}),leaves:defineDagExtremity({noOutgoingEdges:!0}),outgoers:cache(defineDagOneHop({outgoing:!0}),"outgoers"),successors:defineDagAllHops({outgoing:!0}),incomers:cache(defineDagOneHop({incoming:!0}),"incomers"),predecessors:defineDagAllHops({incoming:!0})}),util.extend(elesfn,{neighborhood:cache(function(selector){for(var elements=[],nodes=this.nodes(),i=0;i<nodes.length;i++)for(var node=nodes[i],connectedEdges=node.connectedEdges(),j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j],src=edge.source(),tgt=edge.target(),otherNode=node===src?tgt:src;otherNode.length>0&&elements.push(otherNode[0]),elements.push(edge[0])}return this.spawn(elements,{unique:!0}).filter(selector)},"neighborhood"),closedNeighborhood:function(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function(selector){return this.neighborhood(selector)}}),elesfn.neighbourhood=elesfn.neighborhood,elesfn.closedNeighbourhood=elesfn.closedNeighborhood,elesfn.openNeighbourhood=elesfn.openNeighborhood,util.extend(elesfn,{source:cache(function sourceImpl(selector){var ele=this[0],src;return ele&&(src=ele._private.source||ele.cy().collection()),src&&selector?src.filter(selector):src},"source"),target:cache(function targetImpl(selector){var ele=this[0],tgt;return ele&&(tgt=ele._private.target||ele.cy().collection()),tgt&&selector?tgt.filter(selector):tgt},"target"),sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})}),util.extend(elesfn,{edgesWith:cache(defineEdgesWithFunction(),"edgesWith",!0),edgesTo:cache(defineEdgesWithFunction({thisIsSrc:!0}),"edgesTo",!0)}),util.extend(elesfn,{connectedEdges:cache(function(selector){for(var retEles=[],eles=this,i=0;i<eles.length;i++){var node=eles[i];if(node.isNode())for(var edges=node._private.edges,j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return this.spawn(retEles,{unique:!0}).filter(selector)},"connectedEdges"),connectedNodes:cache(function(selector){for(var retEles=[],eles=this,i=0;i<eles.length;i++){var edge=eles[i];edge.isEdge()&&(retEles.push(edge.source()[0]),retEles.push(edge.target()[0]))}return this.spawn(retEles,{unique:!0}).filter(selector)},"connectedNodes"),parallelEdges:cache(defineParallelEdgesFunction(),"parallelEdges"),codirectedEdges:cache(defineParallelEdgesFunction({codirected:!0}),"codirectedEdges")}),util.extend(elesfn,{components:function(){var self=this,cy=self.cy(),visited=self.spawn(),unvisited=self.nodes().spawnSelf(),components=[],visitInComponent=function(node,component){visited.merge(node),unvisited.unmerge(node),component.merge(node)};if(unvisited.empty())return self.spawn();do{var component=cy.collection();components.push(component);var root=unvisited[0];visitInComponent(root,component),self.bfs({directed:!1,roots:root,visit:function(i,depth,v,e,u){visitInComponent(v,component)}})}while(unvisited.length>0);return components.map(function(component){var connectedEdges=component.connectedEdges().stdFilter(function(edge){return component.anySame(edge.source())&&component.anySame(edge.target())});return component.union(connectedEdges)})}}),module.exports=elesfn},{"../is":83,"../util":100}],32:[function(_dereq_,module,exports){"use strict";var zIndexSort=function(a,b){var cy=a.cy(),zDiff=a.pstyle("z-index").value-b.pstyle("z-index").value,depthA=0,depthB=0,hasCompoundNodes=cy.hasCompoundNodes(),aIsNode=a.isNode(),aIsEdge=!aIsNode,bIsNode=b.isNode(),bIsEdge=!bIsNode;hasCompoundNodes&&(depthA=a.zDepth(),depthB=b.zDepth());var depthDiff=depthA-depthB,sameDepth=0===depthDiff;return sameDepth?aIsNode&&bIsEdge?1:aIsEdge&&bIsNode?-1:0===zDiff?a.poolIndex()-b.poolIndex():zDiff:depthDiff};module.exports=zIndexSort},{}],33:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),util=_dereq_("../util"),Collection=_dereq_("../collection"),Element=_dereq_("../collection/element"),corefn={add:function(opts){var elements,cy=this;if(is.elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy)elements=eles.restore();else{for(var jsons=[],i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new Collection(cy,jsons)}}else if(is.array(opts)){var jsons=opts;elements=new Collection(cy,jsons)}else if(is.plainObject(opts)&&(is.array(opts.nodes)||is.array(opts.edges))){for(var elesByGroup=opts,jsons=[],grs=["nodes","edges"],i=0,il=grs.length;i<il;i++){var group=grs[i],elesArray=elesByGroup[group];if(is.array(elesArray))for(var j=0,jl=elesArray.length;j<jl;j++){var json=util.extend({group:group},elesArray[j]);jsons.push(json)}}elements=new Collection(cy,jsons)}else{var json=opts;elements=new Element(cy,json).collection()}return elements},remove:function(collection){if(is.elementOrCollection(collection));else if(is.string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()},load:function(elements,onload,ondone){var cy=this;cy.notifications(!1);var oldEles=cy.mutableElements();oldEles.length>0&&oldEles.remove(),null!=elements&&(is.plainObject(elements)||is.array(elements))&&cy.add(elements),cy.one("layoutready",function(e){cy.notifications(!0),cy.trigger(e),cy.notify({type:"load",eles:cy.mutableElements()}),cy.one("load",onload),cy.trigger("load")}).one("layoutstop",function(){cy.one("done",ondone),cy.trigger("done")});var layoutOpts=util.extend({},cy._private.options.layout);return layoutOpts.eles=cy.elements(),cy.layout(layoutOpts),this}};module.exports=corefn},{"../collection":26,"../collection/element":22,"../is":83,"../util":100}],34:[function(_dereq_,module,exports){"use strict";var define=_dereq_("../define"),util=_dereq_("../util"),is=_dereq_("../is"),corefn={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop(),addToAnimationPool:function(eles){var cy=this;cy.styleEnabled()&&cy._private.aniEles.merge(eles)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){function globalAnimationStep(){cy._private.animationsRunning&&util.requestAnimationFrame(function animationStep(now){handleElements(now),globalAnimationStep()})}function handleElements(now){function handleElement(ele,isCore){var _p=ele._private,current=_p.animation.current,queue=_p.animation.queue,ranAnis=!1;if(0===current.length){var next=queue.shift();next&&current.push(next)}for(var callbacks=function(callbacks){for(var j=callbacks.length-1;j>=0;j--){var cb=callbacks[j];cb()}callbacks.splice(0,callbacks.length)},i=current.length-1;i>=0;i--){var ani=current[i],ani_p=ani._private;ani_p.stopped?(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.frames)):(ani_p.playing||ani_p.applying)&&(ani_p.playing&&ani_p.applying&&(ani_p.applying=!1),ani_p.started||startAnimation(ele,ani,now),step(ele,ani,now,isCore),is.fn(ani_p.step)&&ani_p.step.call(ele,now),ani_p.applying&&(ani_p.applying=!1),callbacks(ani_p.frames),ani.completed()&&(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.completes)),ranAnis=!0)}return isCore||0!==current.length||0!==queue.length||doneEles.push(ele),ranAnis}for(var eles=cy._private.aniEles,doneEles=[],ranEleAni=!1,e=0;e<eles.length;e++){var ele=eles[e],handledThisEle=handleElement(ele);ranEleAni=ranEleAni||handledThisEle}var ranCoreAni=handleElement(cy,!0);if(ranEleAni||ranCoreAni)if(eles.length>0){var updatedEles=eles.updateCompoundBounds().spawnSelf().merge(eles);cy.notify({type:"draw",eles:updatedEles})}else cy.notify({type:"draw"});eles.unmerge(doneEles),cy.trigger("step")}function startAnimation(self,ani,now){var isCore=is.core(self),isEles=!isCore,ele=self,style=cy._private.style,ani_p=ani._private;if(isEles){var pos=ele._private.position;ani_p.startPosition=ani_p.startPosition||{x:pos.x,y:pos.y},ani_p.startStyle=ani_p.startStyle||style.getAnimationStartStyle(ele,ani_p.style)}if(isCore){var pan=cy._private.pan;ani_p.startPan=ani_p.startPan||{x:pan.x,y:pan.y},ani_p.startZoom=null!=ani_p.startZoom?ani_p.startZoom:cy._private.zoom}ani_p.started=!0,ani_p.startTime=now-ani_p.progress*ani_p.duration}function step(self,ani,now,isCore){var style=cy._private.style,isEles=!isCore,_p=self._private,ani_p=ani._private,pEasing=ani_p.easing,startTime=ani_p.startTime;if(!ani_p.easingImpl)if(null==pEasing)ani_p.easingImpl=easings.linear;else{var easingVals;if(is.string(pEasing)){var easingProp=style.parse("transition-timing-function",pEasing);easingVals=easingProp.value}else easingVals=pEasing;var name,args;is.string(easingVals)?(name=easingVals,args=[]):(name=easingVals[1],args=easingVals.slice(2).map(function(n){return+n})),args.length>0?("spring"===name&&args.push(ani_p.duration),ani_p.easingImpl=easings[name].apply(null,args)):ani_p.easingImpl=easings[name]}var easing=ani_p.easingImpl,percent;if(percent=0===ani_p.duration?1:(now-startTime)/ani_p.duration,ani_p.applying&&(percent=ani_p.progress),percent<0?percent=0:percent>1&&(percent=1),null==ani_p.delay){var startPos=ani_p.startPosition,endPos=ani_p.position,pos=_p.position;endPos&&isEles&&(valid(startPos.x,endPos.x)&&(pos.x=ease(startPos.x,endPos.x,percent,easing)),valid(startPos.y,endPos.y)&&(pos.y=ease(startPos.y,endPos.y,percent,easing)),self.trigger("position"));var startPan=ani_p.startPan,endPan=ani_p.pan,pan=_p.pan,animatingPan=null!=endPan&&isCore;animatingPan&&(valid(startPan.x,endPan.x)&&(pan.x=ease(startPan.x,endPan.x,percent,easing)),valid(startPan.y,endPan.y)&&(pan.y=ease(startPan.y,endPan.y,percent,easing)),self.trigger("pan"));var startZoom=ani_p.startZoom,endZoom=ani_p.zoom,animatingZoom=null!=endZoom&&isCore;animatingZoom&&(valid(startZoom,endZoom)&&(_p.zoom=ease(startZoom,endZoom,percent,easing)),self.trigger("zoom")),(animatingPan||animatingZoom)&&self.trigger("viewport");var props=ani_p.style;if(props&&props.length>0&&isEles){for(var i=0;i<props.length;i++){var prop=props[i],name=prop.name,end=prop,start=ani_p.startStyle[name],easedVal=ease(start,end,percent,easing);style.overrideBypass(self,name,easedVal)}self.trigger("style")}}return ani_p.progress=percent,percent}function valid(start,end){return null!=start&&null!=end&&(!(!is.number(start)||!is.number(end))||!(!start||!end))}function evalCubicBezier(p1,p2,t){var one_t=1-t,tsq=t*t;return 3*one_t*one_t*t*p1+3*one_t*tsq*p2+tsq*t}function cubicBezier(p1,p2){return function(start,end,percent){return start+(end-start)*evalCubicBezier(p1,p2,percent)}}function ease(startProp,endProp,percent,easingFn){percent<0?percent=0:percent>1&&(percent=1);var start,end;if(start=null!=startProp.pfValue||null!=startProp.value?null!=startProp.pfValue?startProp.pfValue:startProp.value:startProp,end=null!=endProp.pfValue||null!=endProp.value?null!=endProp.pfValue?endProp.pfValue:endProp.value:endProp,is.number(start)&&is.number(end))return easingFn(start,end,percent);if(is.array(start)&&is.array(end)){for(var easedArr=[],i=0;i<end.length;i++){var si=start[i],ei=end[i];if(null!=si&&null!=ei){var val=easingFn(si,ei,percent);startProp.roundValue&&(val=Math.round(val)),easedArr.push(val)}else easedArr.push(ei)}return easedArr}}var cy=this;if(cy._private.animationsRunning=!0,cy.styleEnabled()){var renderer=cy.renderer();renderer&&renderer.beforeRender?renderer.beforeRender(function rendererAnimationStep(willDraw,now){handleElements(now)},renderer.beforeRenderPriorities.animations):globalAnimationStep();var generateSpringRK4=function(){function springAccelerationForState(state){return-state.tension*state.x-state.friction*state.v}function springEvaluateStateWithDerivative(initialState,dt,derivative){var state={x:initialState.x+derivative.dx*dt,v:initialState.v+derivative.dv*dt,tension:initialState.tension,friction:initialState.friction};return{dx:state.v,dv:springAccelerationForState(state)}}function springIntegrateState(state,dt){var a={dx:state.v,dv:springAccelerationForState(state)},b=springEvaluateStateWithDerivative(state,.5*dt,a),c=springEvaluateStateWithDerivative(state,.5*dt,b),d=springEvaluateStateWithDerivative(state,dt,c),dxdt=1/6*(a.dx+2*(b.dx+c.dx)+d.dx),dvdt=1/6*(a.dv+2*(b.dv+c.dv)+d.dv);return state.x=state.x+dxdt*dt,state.v=state.v+dvdt*dt,state}return function springRK4Factory(tension,friction,duration){var initState={x:-1,v:0,tension:null,friction:null},path=[0],time_lapsed=0,tolerance=1e-4,DT=.016,have_duration,dt,last_state;for(tension=parseFloat(tension)||500,friction=parseFloat(friction)||20,duration=duration||null,initState.tension=tension,initState.friction=friction,have_duration=null!==duration,have_duration?(time_lapsed=springRK4Factory(tension,friction),dt=time_lapsed/duration*DT):dt=DT;;)if(last_state=springIntegrateState(last_state||initState,dt),path.push(1+last_state.x),time_lapsed+=16,!(Math.abs(last_state.x)>tolerance&&Math.abs(last_state.v)>tolerance))break;return have_duration?function(percentComplete){return path[percentComplete*(path.length-1)|0]}:time_lapsed}}(),easings={linear:function(start,end,percent){return start+(end-start)*percent},ease:cubicBezier(.25,.1,.25,1),"ease-in":cubicBezier(.42,0,1,1),"ease-out":cubicBezier(0,0,.58,1),"ease-in-out":cubicBezier(.42,0,.58,1),"ease-in-sine":cubicBezier(.47,0,.745,.715),"ease-out-sine":cubicBezier(.39,.575,.565,1),"ease-in-out-sine":cubicBezier(.445,.05,.55,.95),"ease-in-quad":cubicBezier(.55,.085,.68,.53),"ease-out-quad":cubicBezier(.25,.46,.45,.94),"ease-in-out-quad":cubicBezier(.455,.03,.515,.955),"ease-in-cubic":cubicBezier(.55,.055,.675,.19),"ease-out-cubic":cubicBezier(.215,.61,.355,1),"ease-in-out-cubic":cubicBezier(.645,.045,.355,1),"ease-in-quart":cubicBezier(.895,.03,.685,.22),"ease-out-quart":cubicBezier(.165,.84,.44,1),"ease-in-out-quart":cubicBezier(.77,0,.175,1),"ease-in-quint":cubicBezier(.755,.05,.855,.06),"ease-out-quint":cubicBezier(.23,1,.32,1),"ease-in-out-quint":cubicBezier(.86,0,.07,1),"ease-in-expo":cubicBezier(.95,.05,.795,.035),"ease-out-expo":cubicBezier(.19,1,.22,1),"ease-in-out-expo":cubicBezier(1,0,0,1),"ease-in-circ":cubicBezier(.6,.04,.98,.335),
"ease-out-circ":cubicBezier(.075,.82,.165,1),"ease-in-out-circ":cubicBezier(.785,.135,.15,.86),spring:function(tension,friction,duration){if(0===duration)return easings.linear;var spring=generateSpringRK4(tension,friction,duration);return function(start,end,percent){return start+(end-start)*spring(percent)}},"cubic-bezier":function(x1,y1,x2,y2){return cubicBezier(x1,y1,x2,y2)}}}}};module.exports=corefn},{"../define":44,"../is":83,"../util":100}],35:[function(_dereq_,module,exports){"use strict";var define=_dereq_("../define"),corefn={on:define.on(),one:define.on({unbindSelfOnTrigger:!0}),once:define.on({unbindAllBindersOnTrigger:!0}),off:define.off(),trigger:define.trigger()};define.eventAliasesOn(corefn),module.exports=corefn},{"../define":44}],36:[function(_dereq_,module,exports){"use strict";var corefn={png:function(options){var renderer=this._private.renderer;return options=options||{},renderer.png(options)},jpg:function(options){var renderer=this._private.renderer;return options=options||{},options.bg=options.bg||"#fff",renderer.jpg(options)}};corefn.jpeg=corefn.jpg,module.exports=corefn},{}],37:[function(_dereq_,module,exports){"use strict";var window=_dereq_("../window"),util=_dereq_("../util"),Collection=_dereq_("../collection"),is=_dereq_("../is"),Promise=_dereq_("../promise"),define=_dereq_("../define"),Core=function(opts){var cy=this;opts=util.extend({},opts);var container=opts.container;container&&!is.htmlElement(container)&&is.htmlElement(container[0])&&(container=container[0]);var reg=container?container._cyreg:null;reg=reg||{},reg&&reg.cy&&(reg.cy.destroy(),reg={});var readies=reg.readies=reg.readies||[];container&&(container._cyreg=reg),reg.cy=cy;var head=void 0!==window&&void 0!==container&&!opts.headless,options=opts;options.layout=util.extend({name:head?"grid":"null"},options.layout),options.renderer=util.extend({name:head?"canvas":"null"},options.renderer);var defVal=function(def,val,altVal){return void 0!==val?val:void 0!==altVal?altVal:def},_p=this._private={container:container,ready:!1,initrender:!1,options:options,elements:new Collection(this),listeners:[],aniEles:new Collection(this),scratch:{},layout:null,renderer:null,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(!0,options.zoomingEnabled),userZoomingEnabled:defVal(!0,options.userZoomingEnabled),panningEnabled:defVal(!0,options.panningEnabled),userPanningEnabled:defVal(!0,options.userPanningEnabled),boxSelectionEnabled:defVal(!0,options.boxSelectionEnabled),autolock:defVal(!1,options.autolock,options.autolockNodes),autoungrabify:defVal(!1,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(!1,options.autounselectify),styleEnabled:void 0===options.styleEnabled?head:options.styleEnabled,zoom:is.number(options.zoom)?options.zoom:1,pan:{x:is.plainObject(options.pan)&&is.number(options.pan.x)?options.pan.x:0,y:is.plainObject(options.pan)&&is.number(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1},selType=options.selectionType;void 0===selType||"additive"!==selType&&"single"!==selType?_p.selectionType="single":_p.selectionType=selType,is.number(options.minZoom)&&is.number(options.maxZoom)&&options.minZoom<options.maxZoom?(_p.minZoom=options.minZoom,_p.maxZoom=options.maxZoom):is.number(options.minZoom)&&void 0===options.maxZoom?_p.minZoom=options.minZoom:is.number(options.maxZoom)&&void 0===options.minZoom&&(_p.maxZoom=options.maxZoom);var loadExtData=function(extData,next){var anyIsPromise=extData.some(is.promise);return anyIsPromise?Promise.all(extData).then(next):void next(extData)};cy.initRenderer(util.extend({hideEdgesOnViewport:options.hideEdgesOnViewport,textureOnViewport:options.textureOnViewport,wheelSensitivity:is.number(options.wheelSensitivity)&&options.wheelSensitivity>0?options.wheelSensitivity:1,motionBlur:void 0!==options.motionBlur&&options.motionBlur,motionBlurOpacity:void 0===options.motionBlurOpacity?.05:options.motionBlurOpacity,pixelRatio:is.number(options.pixelRatio)&&options.pixelRatio>0?options.pixelRatio:void 0,desktopTapThreshold:void 0===options.desktopTapThreshold?4:options.desktopTapThreshold,touchTapThreshold:void 0===options.touchTapThreshold?8:options.touchTapThreshold},options.renderer)),loadExtData([options.style,options.elements],function(thens){var initStyle=thens[0],initEles=thens[1];_p.styleEnabled&&cy.setStyle(initStyle),options.initrender&&(cy.on("initrender",options.initrender),cy.on("initrender",function(){_p.initrender=!0})),cy.load(initEles,function(){cy.startAnimationLoop(),_p.ready=!0,is.fn(options.ready)&&cy.on("ready",options.ready);for(var i=0;i<readies.length;i++){var fn=readies[i];cy.on("ready",fn)}reg&&(reg.readies=[]),cy.trigger("ready")},options.done)})},corefn=Core.prototype;util.extend(corefn,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},ready:function(fn){return this.isReady()?this.trigger("ready",[],fn):this.on("ready",fn),this},initrender:function(){return this._private.initrender},destroy:function(){var cy=this;return cy.stopAnimationLoop(),cy.destroyRenderer(),cy},hasElementWithId:function(id){return this._private.elements.hasElementWithId(id)},getElementById:function(id){return this._private.elements.getElementById(id)},selectionType:function(){return this._private.selectionType},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return"null"===this._private.options.renderer.name},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(eles){return this._private.elements.merge(eles),this},removeFromPool:function(eles){return this._private.elements.unmerge(eles),this},container:function(){return this._private.container},options:function(){return util.copy(this._private.options)},json:function(obj){var cy=this,_p=cy._private,eles=cy.mutableElements();if(is.plainObject(obj)){if(cy.startBatch(),obj.elements){var idInJson={},updateEles=function(jsons,gr){for(var i=0;i<jsons.length;i++){var json=jsons[i],id=json.data.id,ele=cy.getElementById(id);idInJson[id]=!0,0!==ele.length?ele.json(json):gr?cy.add(util.extend({group:gr},json)):cy.add(json)}};if(is.array(obj.elements))updateEles(obj.elements);else for(var grs=["nodes","edges"],i=0;i<grs.length;i++){var gr=grs[i],elements=obj.elements[gr];is.array(elements)&&updateEles(elements,gr)}eles.stdFilter(function(ele){return!idInJson[ele.id()]}).remove()}obj.style&&cy.style(obj.style),null!=obj.zoom&&obj.zoom!==_p.zoom&&cy.zoom(obj.zoom),obj.pan&&(obj.pan.x===_p.pan.x&&obj.pan.y===_p.pan.y||cy.pan(obj.pan));for(var fields=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify"],i=0;i<fields.length;i++){var f=fields[i];null!=obj[f]&&cy[f](obj[f])}return cy.endBatch(),this}if(void 0===obj){var json={};return json.elements={},eles.forEach(function(ele){var group=ele.group();json.elements[group]||(json.elements[group]=[]),json.elements[group].push(ele.json())}),this._private.styleEnabled&&(json.style=cy.style().json()),json.zoomingEnabled=cy._private.zoomingEnabled,json.userZoomingEnabled=cy._private.userZoomingEnabled,json.zoom=cy._private.zoom,json.minZoom=cy._private.minZoom,json.maxZoom=cy._private.maxZoom,json.panningEnabled=cy._private.panningEnabled,json.userPanningEnabled=cy._private.userPanningEnabled,json.pan=util.copy(cy._private.pan),json.boxSelectionEnabled=cy._private.boxSelectionEnabled,json.renderer=util.copy(cy._private.options.renderer),json.hideEdgesOnViewport=cy._private.options.hideEdgesOnViewport,json.textureOnViewport=cy._private.options.textureOnViewport,json.wheelSensitivity=cy._private.options.wheelSensitivity,json.motionBlur=cy._private.options.motionBlur,json}},scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0})}),[_dereq_("./add-remove"),_dereq_("./animation"),_dereq_("./events"),_dereq_("./export"),_dereq_("./layout"),_dereq_("./notification"),_dereq_("./renderer"),_dereq_("./search"),_dereq_("./style"),_dereq_("./viewport")].forEach(function(props){util.extend(corefn,props)}),module.exports=Core},{"../collection":26,"../define":44,"../is":83,"../promise":86,"../util":100,"../window":107,"./add-remove":33,"./animation":34,"./events":35,"./export":36,"./layout":38,"./notification":39,"./renderer":40,"./search":41,"./style":42,"./viewport":43}],38:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),corefn={layout:function(params){var layout=this._private.prevLayout=null==params?this._private.prevLayout:this.makeLayout(params);return layout.run(),this},makeLayout:function(options){var cy=this;if(null==options)return void util.error("Layout options must be specified to make a layout");if(null==options.name)return void util.error("A `name` must be specified to make a layout");var name=options.name,Layout=cy.extension("layout",name);if(null==Layout)return void util.error("Can not apply layout: No such layout `"+name+"` found; did you include its JS file?");var eles;eles=is.string(options.eles)?cy.$(options.eles):null!=options.eles?options.eles:cy.$();var layout=new Layout(util.extend({},options,{cy:cy,eles:eles}));return layout}};corefn.createLayout=corefn.makeLayout,module.exports=corefn},{"../is":83,"../util":100}],39:[function(_dereq_,module,exports){"use strict";var corefn={notify:function(params){var _p=this._private;if(_p.batchingNotify){var bEles=_p.batchNotifyEles,bTypes=_p.batchNotifyTypes;return params.eles&&bEles.merge(params.eles),void(bTypes.ids[params.type]||(bTypes.push(params.type),bTypes.ids[params.type]=!0))}if(_p.notificationsEnabled){var renderer=this.renderer();renderer&&renderer.notify(params)}},notifications:function(bool){var p=this._private;return void 0===bool?p.notificationsEnabled:void(p.notificationsEnabled=!!bool)},noNotifications:function(callback){this.notifications(!1),callback(),this.notifications(!0)},startBatch:function(){var _p=this._private;return null==_p.batchCount&&(_p.batchCount=0),0===_p.batchCount&&(_p.batchingStyle=_p.batchingNotify=!0,_p.batchStyleEles=this.collection(),_p.batchNotifyEles=this.collection(),_p.batchNotifyTypes=[],_p.batchNotifyTypes.ids={}),_p.batchCount++,this},endBatch:function(){var _p=this._private;return _p.batchCount--,0===_p.batchCount&&(_p.batchingStyle=!1,_p.batchStyleEles.updateStyle(),_p.batchingNotify=!1,this.notify({type:_p.batchNotifyTypes,eles:_p.batchNotifyEles})),this},batch:function(callback){return this.startBatch(),callback(),this.endBatch(),this},batchData:function(map){var cy=this;return this.batch(function(){for(var ids=Object.keys(map),i=0;i<ids.length;i++){var id=ids[i],data=map[id],ele=cy.getElementById(id);ele.data(data)}})}};module.exports=corefn},{}],40:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),corefn={renderTo:function(context,zoom,pan,pxRatio){var r=this._private.renderer;return r.renderTo(context,zoom,pan,pxRatio),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify({type:"draw"}),this},resize:function(){return this.invalidateSize(),this.notify({type:"resize"}),this.trigger("resize"),this},initRenderer:function(options){var cy=this,RendererProto=cy.extension("renderer",options.name);if(null==RendererProto)return void util.error("Can not initialise: No such renderer `%s` found; did you include its JS file?",options.name);var rOpts=util.extend({},options,{cy:cy});cy._private.renderer=new RendererProto(rOpts)},destroyRenderer:function(){var cy=this;cy.notify({type:"destroy"});var domEle=cy.container();if(domEle)for(domEle._cyreg=null;domEle.childNodes.length>0;)domEle.removeChild(domEle.childNodes[0]);cy._private.renderer=null},onRender:function(fn){return this.on("render",fn)},offRender:function(fn){return this.off("render",fn)}};corefn.invalidateDimensions=corefn.resize,module.exports=corefn},{"../util":100}],41:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),Collection=_dereq_("../collection"),corefn={collection:function(eles,opts){return is.string(eles)?this.$(eles):is.elementOrCollection(eles)?eles.collection():is.array(eles)?new Collection(this,eles,opts):new Collection(this)},nodes:function(selector){var nodes=this.$(function(){return this.isNode()});return selector?nodes.filter(selector):nodes},edges:function(selector){var edges=this.$(function(){return this.isEdge()});return selector?edges.filter(selector):edges},$:function(selector){var eles=this._private.elements;return selector?eles.filter(selector):eles.spawnSelf()},mutableElements:function(){return this._private.elements}};corefn.elements=corefn.filter=corefn.$,module.exports=corefn},{"../collection":26,"../is":83}],42:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),Style=_dereq_("../style"),corefn={style:function(newStyle){if(newStyle){var s=this.setStyle(newStyle);s.update()}return this._private.style},setStyle:function(style){var _p=this._private;return is.stylesheet(style)?_p.style=style.generateStyle(this):is.array(style)?_p.style=Style.fromJson(this,style):is.string(style)?_p.style=Style.fromString(this,style):_p.style=Style(this),_p.style}};module.exports=corefn},{"../is":83,"../style":92}],43:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),window=_dereq_("../window"),corefn={autolock:function(bool){return void 0===bool?this._private.autolock:(this._private.autolock=!!bool,this)},autoungrabify:function(bool){return void 0===bool?this._private.autoungrabify:(this._private.autoungrabify=!!bool,this)},autounselectify:function(bool){return void 0===bool?this._private.autounselectify:(this._private.autounselectify=!!bool,this)},panningEnabled:function(bool){return void 0===bool?this._private.panningEnabled:(this._private.panningEnabled=!!bool,this)},userPanningEnabled:function(bool){return void 0===bool?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!bool,this)},zoomingEnabled:function(bool){return void 0===bool?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!bool,this)},userZoomingEnabled:function(bool){return void 0===bool?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!bool,this)},boxSelectionEnabled:function(bool){return void 0===bool?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!bool,this)},pan:function(){var args=arguments,pan=this._private.pan,dim,val,dims,x,y;switch(args.length){case 0:return pan;case 1:if(is.string(args[0]))return dim=args[0],pan[dim];if(is.plainObject(args[0])){if(!this._private.panningEnabled)return this;dims=args[0],x=dims.x,y=dims.y,is.number(x)&&(pan.x=x),is.number(y)&&(pan.y=y),this.trigger("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;dim=args[0],val=args[1],"x"!==dim&&"y"!==dim||!is.number(val)||(pan[dim]=val),this.trigger("pan viewport")}return this.notify({type:"viewport"}),this},panBy:function(params){var args=arguments,pan=this._private.pan,dim,val,dims,x,y;if(!this._private.panningEnabled)return this;switch(args.length){case 1:is.plainObject(args[0])&&(dims=args[0],x=dims.x,y=dims.y,is.number(x)&&(pan.x+=x),is.number(y)&&(pan.y+=y),this.trigger("pan viewport"));break;case 2:dim=args[0],val=args[1],"x"!==dim&&"y"!==dim||!is.number(val)||(pan[dim]+=val),this.trigger("pan viewport")}return this.notify({type:"viewport"}),this},fit:function(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom,_p.pan=viewportState.pan,this.trigger("pan zoom viewport"),this.notify({type:"viewport"})}return this},getFitViewport:function(elements,padding){if(is.number(elements)&&void 0===padding&&(padding=elements,elements=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){var bb;if(is.string(elements)){var sel=elements;elements=this.$(sel)}else if(is.boundingBox(elements)){var bbe=elements;bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2},bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}else is.elementOrCollection(elements)||(elements=this.mutableElements());bb=bb||elements.boundingBox();var w=this.width(),h=this.height(),zoom;if(padding=is.number(padding)?padding:0,!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0){zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h),zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom,zoom=zoom<this._private.minZoom?this._private.minZoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return{zoom:zoom,pan:pan}}}},minZoom:function(zoom){return void 0===zoom?this._private.minZoom:(is.number(zoom)&&(this._private.minZoom=zoom),this)},maxZoom:function(zoom){return void 0===zoom?this._private.maxZoom:(is.number(zoom)&&(this._private.maxZoom=zoom),this)},zoom:function(params){var pos,zoom;if(void 0===params)return this._private.zoom;if(is.number(params))zoom=params;else if(is.plainObject(params)){if(zoom=params.level,params.position){var p=params.position,pan=this._private.pan,z=this._private.zoom;pos={x:p.x*z+pan.x,y:p.y*z+pan.y}}else params.renderedPosition&&(pos=params.renderedPosition);if(pos&&!this._private.panningEnabled)return this}if(!this._private.zoomingEnabled)return this;if(!is.number(zoom)||pos&&(!is.number(pos.x)||!is.number(pos.y)))return this;if(zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom,zoom=zoom<this._private.minZoom?this._private.minZoom:zoom,pos){var pan1=this._private.pan,zoom1=this._private.zoom,zoom2=zoom,pan2={x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y};this._private.zoom=zoom,this._private.pan=pan2;var posChanged=pan1.x!==pan2.x||pan1.y!==pan2.y;this.trigger(" zoom "+(posChanged?" pan ":"")+" viewport ")}else this._private.zoom=zoom,this.trigger("zoom viewport");return this.notify({type:"viewport"}),this},viewport:function(opts){var _p=this._private,zoomDefd=!0,panDefd=!0,events=[],zoomFailed=!1,panFailed=!1;if(!opts)return this;if(is.number(opts.zoom)||(zoomDefd=!1),is.plainObject(opts.pan)||(panDefd=!1),!zoomDefd&&!panDefd)return this;if(zoomDefd){var z=opts.zoom;z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled?zoomFailed=!0:(_p.zoom=z,events.push("zoom"))}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;is.number(p.x)&&(_p.pan.x=p.x,panFailed=!1),is.number(p.y)&&(_p.pan.y=p.y,panFailed=!1),panFailed||events.push("pan")}return events.length>0&&(events.push("viewport"),this.trigger(events.join(" ")),this.notify({type:"viewport"})),this},center:function(elements){var pan=this.getCenterPan(elements);return pan&&(this._private.pan=pan,this.trigger("pan viewport"),this.notify({type:"viewport"})),this},getCenterPan:function(elements,zoom){if(this._private.panningEnabled){if(is.string(elements)){var selector=elements;elements=this.mutableElements().filter(selector)}else is.elementOrCollection(elements)||(elements=this.mutableElements());var bb=elements.boundingBox(),w=this.width(),h=this.height();zoom=void 0===zoom?this._private.zoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return pan}},reset:function(){return this._private.panningEnabled&&this._private.zoomingEnabled?(this.viewport({pan:{x:0,y:0},zoom:1}),this):this},invalidateSize:function(){this._private.sizeCache=null},size:function(){var _p=this._private,container=_p.container;return _p.sizeCache=_p.sizeCache||(container?function(){var rect=container.getBoundingClientRect(),style=window.getComputedStyle(container),val=function(name){return parseFloat(style.getPropertyValue(name))};return{width:rect.width-val("padding-left")-val("padding-right")-val("border-left-width")-val("border-right-width"),height:rect.height-val("padding-top")-val("padding-bottom")-val("border-top-width")-val("border-bottom-width")}}():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var pan=this._private.pan,zoom=this._private.zoom,rb=this.renderedExtent(),b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};return b.w=b.x2-b.x1,b.h=b.y2-b.y1,b},renderedExtent:function(){var width=this.width(),height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}}};corefn.centre=corefn.center,corefn.autolockNodes=corefn.autolock,corefn.autoungrabifyNodes=corefn.autoungrabify,module.exports=corefn},{"../is":83,"../window":107}],44:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util"),is=_dereq_("./is"),Selector=_dereq_("./selector"),Promise=_dereq_("./promise"),Event=_dereq_("./event"),Animation=_dereq_("./animation"),define={data:function(params){var defaults={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,onSet:function(self){},canSet:function(self){return!0}};return params=util.extend({},defaults,params),function dataImpl(name,value){var p=params,self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],single=selfIsArrayLike?self[0]:self;if(is.string(name)){if(p.allowGetting&&void 0===value){var ret;return single&&(ret=single._private[p.field][name]),ret}if(p.allowSetting&&void 0!==value){var valid=!p.immutableKeys[name];if(valid){for(var i=0,l=all.length;i<l;i++)p.canSet(all[i])&&(all[i]._private[p.field][name]=value);p.updateStyle&&self.updateStyle(),p.onSet(self),p.settingTriggersEvent&&self[p.triggerFnName](p.settingEvent)}}}else if(p.allowSetting&&is.plainObject(name)){for(var obj=name,k,v,keys=Object.keys(obj),i=0;i<keys.length;i++){k=keys[i],v=obj[k];var valid=!p.immutableKeys[k];if(valid)for(var j=0;j<all.length;j++){var ele=all[j];p.canSet(ele)&&(ele._private[p.field][k]=v)}}p.updateStyle&&self.updateStyle(),p.onSet(self),p.settingTriggersEvent&&self[p.triggerFnName](p.settingEvent)}else if(p.allowBinding&&is.fn(name)){var fn=name;self.on(p.bindingEvent,fn)}else if(p.allowGetting&&void 0===name){var ret;return single&&(ret=single._private[p.field]),ret}return self}},removeData:function(params){var defaults={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return params=util.extend({},defaults,params),function removeDataImpl(names){var p=params,self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self];if(is.string(names)){for(var keys=names.split(/\s+/),l=keys.length,i=0;i<l;i++){var key=keys[i];if(!is.emptyString(key)){var valid=!p.immutableKeys[key];if(valid)for(var i_a=0,l_a=all.length;i_a<l_a;i_a++)all[i_a]._private[p.field][key]=void 0}}p.triggerEvent&&self[p.triggerFnName](p.event)}else if(void 0===names){for(var i_a=0,l_a=all.length;i_a<l_a;i_a++)for(var _privateFields=all[i_a]._private[p.field],keys=Object.keys(_privateFields),i=0;i<keys.length;i++){var key=keys[i],validKeyToDelete=!p.immutableKeys[key];validKeyToDelete&&(_privateFields[key]=void 0)}p.triggerEvent&&self[p.triggerFnName](p.event)}return self}},event:{regex:/(\w+)(\.(?:\w+|\*))?/,universalNamespace:".*",optionalTypeRegex:/(\w+)?(\.(?:\w+|\*))?/,falseCallback:function(){return!1}},on:function(params){var defaults={unbindSelfOnTrigger:!1,unbindAllBindersOnTrigger:!1};return params=util.extend({},defaults,params),function onImpl(events,selector,data,callback){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=is.string(events),p=params;if(is.plainObject(selector)?(callback=data,data=selector,selector=void 0):(is.fn(selector)||selector===!1)&&(callback=selector,data=void 0,selector=void 0),(is.fn(data)||data===!1)&&(callback=data,data=void 0),!is.fn(callback)&&callback!==!1&&eventsIsString)return self;if(eventsIsString){var map={};map[events]=callback,events=map}for(var keys=Object.keys(events),k=0;k<keys.length;k++){var evts=keys[k];if(callback=events[evts],callback===!1&&(callback=define.event.falseCallback),is.fn(callback)){evts=evts.split(/\s+/);for(var i=0;i<evts.length;i++){var evt=evts[i];if(!is.emptyString(evt)){var match=evt.match(define.event.regex);if(match)for(var type=match[1],namespace=match[2]?match[2]:void 0,listener={callback:callback,data:data,delegated:!!selector,selector:selector,selObj:new Selector(selector),type:type,namespace:namespace,unbindSelfOnTrigger:p.unbindSelfOnTrigger,unbindAllBindersOnTrigger:p.unbindAllBindersOnTrigger,binders:all},j=0;j<all.length;j++){var _p=all[j]._private=all[j]._private||{};_p.listeners=_p.listeners||[],_p.listeners.push(listener)}}}}}return self}},eventAliasesOn:function(proto){var p=proto;p.addListener=p.listen=p.bind=p.on,p.removeListener=p.unlisten=p.unbind=p.off,p.emit=p.trigger,p.pon=p.promiseOn=function(events,selector){var self=this,args=Array.prototype.slice.call(arguments,0);return new Promise(function(resolve,reject){var callback=function(e){self.off.apply(self,offArgs),resolve(e)},onArgs=args.concat([callback]),offArgs=onArgs.concat([]);self.on.apply(self,onArgs)})}},off:function offImpl(params){var defaults={};return params=util.extend({},defaults,params),function(events,selector,callback){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=is.string(events);if(0===arguments.length){for(var i=0;i<all.length;i++)all[i]._private=all[i]._private||{},_p.listeners=[];return self}if((is.fn(selector)||selector===!1)&&(callback=selector,selector=void 0),eventsIsString){var map={};map[events]=callback,events=map}for(var keys=Object.keys(events),k=0;k<keys.length;k++){var evts=keys[k];callback=events[evts],callback===!1&&(callback=define.event.falseCallback),evts=evts.split(/\s+/);for(var h=0;h<evts.length;h++){var evt=evts[h];if(!is.emptyString(evt)){var match=evt.match(define.event.optionalTypeRegex);if(match)for(var type=match[1]?match[1]:void 0,namespace=match[2]?match[2]:void 0,i=0;i<all.length;i++)for(var _p=all[i]._private=all[i]._private||{},listeners=_p.listeners=_p.listeners||[],j=0;j<listeners.length;j++){var listener=listeners[j],nsMatches=!namespace||namespace===listener.namespace,typeMatches=!type||listener.type===type,cbMatches=!callback||callback===listener.callback,listenerMatches=nsMatches&&typeMatches&&cbMatches;listenerMatches&&(listeners.splice(j,1),j--)}}}}return self}},trigger:function(params){var defaults={};return params=util.extend({},defaults,params),function triggerImpl(events,extraParams,fnToTrigger){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=is.string(events),eventsIsObject=is.plainObject(events),eventsIsEvent=is.event(events),_p=this._private=this._private||{},cy=_p.cy||(is.core(this)?this:null),hasCompounds=!!cy&&cy.hasCompoundNodes();if(eventsIsString){var evts=events.split(/\s+/);events=[];for(var i=0;i<evts.length;i++){var evt=evts[i];if(!is.emptyString(evt)){var match=evt.match(define.event.regex),type=match[1],namespace=match[2]?match[2]:void 0;events.push({type:type,namespace:namespace})}}}else if(eventsIsObject){var eventArgObj=events;events=[eventArgObj]}extraParams?is.array(extraParams)||(extraParams=[extraParams]):extraParams=[];for(var i=0;i<events.length;i++)for(var evtObj=events[i],j=0;j<all.length;j++){var triggerer=all[j],_p=triggerer._private=triggerer._private||{},listeners=_p.listeners=_p.listeners||[],triggererIsElement=is.element(triggerer),bubbleUp=triggererIsElement||params.layout,evt;if(eventsIsEvent?(evt=evtObj,evt.cyTarget=evt.cyTarget||triggerer,evt.cy=evt.cy||cy):evt=new Event(evtObj,{cyTarget:triggerer,cy:cy,namespace:evtObj.namespace}),evtObj.layout&&(evt.layout=evtObj.layout),params.layout&&(evt.layout=triggerer),evt.cyPosition){var pos=evt.cyPosition,zoom=cy.zoom(),pan=cy.pan();evt.cyRenderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}fnToTrigger&&(listeners=[{namespace:evt.namespace,type:evt.type,callback:fnToTrigger}]);for(var k=0;k<listeners.length;k++){var lis=listeners[k],nsMatches=!lis.namespace||lis.namespace===evt.namespace||lis.namespace===define.event.universalNamespace,typeMatches=lis.type===evt.type,targetMatches=!lis.delegated||triggerer!==evt.cyTarget&&is.element(evt.cyTarget)&&lis.selObj.matches(evt.cyTarget),listenerMatches=nsMatches&&typeMatches&&targetMatches;if(listenerMatches){var args=[evt];if(args=args.concat(extraParams),lis.data?evt.data=lis.data:evt.data=void 0,(lis.unbindSelfOnTrigger||lis.unbindAllBindersOnTrigger)&&(listeners.splice(k,1),k--),lis.unbindAllBindersOnTrigger)for(var binders=lis.binders,l=0;l<binders.length;l++){var binder=binders[l];if(binder&&binder!==triggerer)for(var binderListeners=binder._private.listeners,m=0;m<binderListeners.length;m++){var binderListener=binderListeners[m];binderListener===lis&&(binderListeners.splice(m,1),m--)}}var context=lis.delegated?evt.cyTarget:triggerer,ret=lis.callback.apply(context,args);(ret===!1||evt.isPropagationStopped())&&(bubbleUp=!1,ret===!1&&(evt.stopPropagation(),evt.preventDefault()))}}if(bubbleUp){var parent=hasCompounds?triggerer._private.parent:null,hasParent=null!=parent&&0!==parent.length;hasParent?(parent=parent[0],parent.trigger(evt)):cy.trigger(evt)}}return self}},animated:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function animatedImpl(){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return!1;var ele=all[0];return ele?ele._private.animation.current.length>0:void 0}},clearQueue:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function clearQueueImpl(){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){var ele=all[i];ele._private.animation.queue=[]}return this}},delay:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function delayImpl(time,complete){var cy=this._private.cy||this;return cy.styleEnabled()?this.animate({delay:time,duration:time,complete:complete}):this}},delayAnimation:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function delayAnimationImpl(time,complete){var cy=this._private.cy||this;return cy.styleEnabled()?this.animation({delay:time,duration:time,complete:complete}):this}},animation:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function animationImpl(properties,params){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this,isCore=!selfIsArrayLike,isEles=!isCore;if(!cy.styleEnabled())return this;var style=cy.style();switch(properties=util.extend({},properties,params),void 0===properties.duration&&(properties.duration=400),properties.duration){case"slow":properties.duration=600;break;case"fast":properties.duration=200}var propertiesEmpty=0===Object.keys(properties).length;if(propertiesEmpty)return new Animation(all[0],properties);if(isEles&&(properties.style=style.getPropsList(properties.style||properties.css),properties.css=void 0),properties.renderedPosition&&isEles){var rpos=properties.renderedPosition,pan=cy.pan(),zoom=cy.zoom();properties.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if(properties.panBy&&isCore){var panBy=properties.panBy,cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(center&&isCore){var centerPan=cy.getCenterPan(center.eles,properties.zoom);centerPan&&(properties.pan=centerPan)}if(properties.fit&&isCore){var fit=properties.fit,fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);fitVp&&(properties.pan=fitVp.pan,properties.zoom=fitVp.zoom)}return new Animation(all[0],properties)}},animate:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),
function animateImpl(properties,params){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return this;params&&(properties=util.extend({},properties,params));for(var i=0;i<all.length;i++){var ele=all[i],queue=ele.animated()&&(void 0===properties.queue||properties.queue),ani=ele.animation(properties,queue?{queue:!0}:void 0);ani.play()}return this}},stop:function(fnParams){var defaults={};return fnParams=util.extend({},defaults,fnParams),function stopImpl(clearQueue,jumpToEnd){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){for(var ele=all[i],_p=ele._private,anis=_p.animation.current,j=0;j<anis.length;j++){var ani=anis[j],ani_p=ani._private;jumpToEnd&&(ani_p.duration=0)}clearQueue&&(_p.animation.queue=[]),jumpToEnd||(_p.animation.current=[])}return cy.notify({eles:this,type:"draw"}),this}}};module.exports=define},{"./animation":2,"./event":45,"./is":83,"./promise":86,"./selector":87,"./util":100}],45:[function(_dereq_,module,exports){"use strict";function returnFalse(){return!1}function returnTrue(){return!0}var Event=function(src,props){return this instanceof Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse):this.type=src,props&&(this.type=void 0!==props.type?props.type:this.type,this.cy=props.cy,this.cyTarget=props.cyTarget,this.cyPosition=props.cyPosition,this.cyRenderedPosition=props.cyRenderedPosition,this.namespace=props.namespace,this.layout=props.layout,this.data=props.data,this.message=props.message),void(this.timeStamp=src&&src.timeStamp||Date.now())):new Event(src,props)};Event.prototype={instanceString:function(){return"event"},preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse},module.exports=Event},{}],46:[function(_dereq_,module,exports){"use strict";function setExtension(type,name,registrant){var ext=registrant,overrideErr=function(field){util.error("Can not register `"+name+"` for `"+type+"` since `"+field+"` already exists in the prototype and can not be overridden")};if("core"===type){if(Core.prototype[name])return overrideErr(name);Core.prototype[name]=registrant}else if("collection"===type){if(Collection.prototype[name])return overrideErr(name);Collection.prototype[name]=registrant}else if("layout"===type){for(var Layout=function(options){this.options=options,registrant.call(this,options),is.plainObject(this._private)||(this._private={}),this._private.cy=options.cy,this._private.listeners=[]},layoutProto=Layout.prototype=Object.create(registrant.prototype),optLayoutFns=[],i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}layoutProto.start&&!layoutProto.run?layoutProto.run=function(){return this.start(),this}:!layoutProto.start&&layoutProto.run&&(layoutProto.start=function(){return this.run(),this});var regStop=registrant.prototype.stop;layoutProto.stop=function(){var opts=this.options;if(opts&&opts.animate){var anis=this.animations;if(anis)for(var i=0;i<anis.length;i++)anis[i].stop()}return regStop?regStop.call(this):this.trigger("layoutstop"),this},layoutProto.destroy||(layoutProto.destroy=function(){return this}),layoutProto.on=define.on({layout:!0}),layoutProto.one=define.on({layout:!0,unbindSelfOnTrigger:!0}),layoutProto.once=define.on({layout:!0,unbindAllBindersOnTrigger:!0}),layoutProto.off=define.off({layout:!0}),layoutProto.trigger=define.trigger({layout:!0}),define.eventAliasesOn(layoutProto),ext=Layout}else if("renderer"===type&&"null"!==name&&"base"!==name){var BaseRenderer=getExtension("renderer","base"),bProto=BaseRenderer.prototype,RegistrantRenderer=registrant,rProto=registrant.prototype,Renderer=function(){BaseRenderer.apply(this,arguments),RegistrantRenderer.apply(this,arguments)},proto=Renderer.prototype;for(var pName in bProto){var pVal=bProto[pName],existsInR=null!=rProto[pName];if(existsInR)return overrideErr(pName);proto[pName]=pVal}for(var pName in rProto)proto[pName]=rProto[pName];bProto.clientFunctions.forEach(function(name){proto[name]=proto[name]||function(){util.error("Renderer does not implement `renderer."+name+"()` on its prototype")}}),ext=Renderer}return util.setMap({map:extensions,keys:[type,name],value:ext})}function getExtension(type,name){return util.getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return util.setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return util.getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var util=_dereq_("./util"),define=_dereq_("./define"),Collection=_dereq_("./collection"),Core=_dereq_("./core"),incExts=_dereq_("./extensions"),is=_dereq_("./is"),extensions={},modules={},extension=function(){return 2===arguments.length?getExtension.apply(null,arguments):3===arguments.length?setExtension.apply(null,arguments):4===arguments.length?getModule.apply(null,arguments):5===arguments.length?setModule.apply(null,arguments):void util.error("Invalid extension access syntax")};Core.prototype.extension=extension,incExts.forEach(function(group){group.extensions.forEach(function(ext){setExtension(group.type,ext.name,ext.impl)})}),module.exports=extension},{"./collection":26,"./core":37,"./define":44,"./extensions":47,"./is":83,"./util":100}],47:[function(_dereq_,module,exports){"use strict";module.exports=[{type:"layout",extensions:_dereq_("./layout")},{type:"renderer",extensions:_dereq_("./renderer")}]},{"./layout":53,"./renderer":78}],48:[function(_dereq_,module,exports){"use strict";function BreadthFirstLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),math=_dereq_("../../math"),is=_dereq_("../../is"),defaults={fit:!0,directed:!1,padding:30,circle:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,roots:void 0,maximalAdjustments:0,animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};BreadthFirstLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),graph=eles,bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),roots;if(is.elementOrCollection(options.roots))roots=options.roots;else if(is.array(options.roots)){for(var rootsArray=[],i=0;i<options.roots.length;i++){var id=options.roots[i],ele=cy.getElementById(id);rootsArray.push(ele)}roots=cy.collection(rootsArray)}else if(is.string(options.roots))roots=cy.$(options.roots);else if(options.directed)roots=nodes.roots();else{for(var components=[],unhandledNodes=nodes;unhandledNodes.length>0;){var currComp=cy.collection();eles.bfs({roots:unhandledNodes[0],visit:function(i,depth,node,edge,pNode){currComp=currComp.add(node)},directed:!1}),unhandledNodes=unhandledNodes.not(currComp),components.push(currComp)}roots=cy.collection();for(var i=0;i<components.length;i++){var comp=components[i],maxDegree=comp.maxDegree(!1),compRoots=comp.filter(function(){return this.degree(!1)===maxDegree});roots=roots.add(compRoots)}}var depths=[],foundByBfs={},id2depth={},prevNode={},prevEdge={},successors={};graph.bfs({roots:roots,directed:options.directed,visit:function(i,depth,node,edge,pNode){var ele=this[0],id=ele.id();if(depths[depth]||(depths[depth]=[]),depths[depth].push(ele),foundByBfs[id]=!0,id2depth[id]=depth,prevNode[id]=pNode,prevEdge[id]=edge,pNode){var prevId=pNode.id(),succ=successors[prevId]=successors[prevId]||[];succ.push(node)}}});for(var orphanNodes=[],i=0;i<nodes.length;i++){var ele=nodes[i];foundByBfs[ele.id()]||orphanNodes.push(ele)}for(var maxChecks=3*orphanNodes.length,checks=0;0!==orphanNodes.length&&checks<maxChecks;){for(var node=orphanNodes.shift(),neighbors=node.neighborhood().nodes(),assignedDepth=!1,i=0;i<neighbors.length;i++){var depth=id2depth[neighbors[i].id()];if(void 0!==depth){depths[depth].push(node),assignedDepth=!0;break}}assignedDepth||orphanNodes.push(node),checks++}for(;0!==orphanNodes.length;){var node=orphanNodes.shift(),assignedDepth=!1;assignedDepth||(0===depths.length&&depths.push([]),depths[0].push(node))}var assignDepthsToEles=function(){for(var i=0;i<depths.length;i++)for(var eles=depths[i],j=0;j<eles.length;j++){var ele=eles[j];ele._private.scratch.breadthfirst={depth:i,index:j}}};assignDepthsToEles();for(var intersectsDepth=function(node){for(var edges=node.connectedEdges(function(){return this.data("target")===node.id()}),thisInfo=node._private.scratch.breadthfirst,highestDepthOfOther=0,highestOther,i=0;i<edges.length;i++){var edge=edges[i],otherNode=edge.source()[0],otherInfo=otherNode._private.scratch.breadthfirst;thisInfo.depth<=otherInfo.depth&&highestDepthOfOther<otherInfo.depth&&(highestDepthOfOther=otherInfo.depth,highestOther=otherNode)}return highestOther},adj=0;adj<options.maximalAdjustments;adj++){for(var nDepths=depths.length,elesToMove=[],i=0;i<nDepths;i++)for(var depth=depths[i],nDepth=depth.length,j=0;j<nDepth;j++){var ele=depth[j],info=ele._private.scratch.breadthfirst,intEle=intersectsDepth(ele);intEle&&(info.intEle=intEle,elesToMove.push(ele))}for(var i=0;i<elesToMove.length;i++){var ele=elesToMove[i],info=ele._private.scratch.breadthfirst,intEle=info.intEle,intInfo=intEle._private.scratch.breadthfirst;depths[info.depth].splice(info.index,1);for(var newDepth=intInfo.depth+1;newDepth>depths.length-1;)depths.push([]);depths[newDepth].push(ele),info.depth=newDepth,info.index=depths[newDepth].length-1}assignDepthsToEles()}var minDistance=0;if(options.avoidOverlap){for(var i=0;i<nodes.length;i++){var n=nodes[i],nbb=n.boundingBox(),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}minDistance*=options.spacingFactor}for(var cachedWeightedPercent={},getWeightedPercent=function(ele){if(cachedWeightedPercent[ele.id()])return cachedWeightedPercent[ele.id()];for(var eleDepth=ele._private.scratch.breadthfirst.depth,neighbors=ele.neighborhood().nodes().not(":parent").intersection(nodes),percent=0,samples=0,i=0;i<neighbors.length;i++){var neighbor=neighbors[i],bf=neighbor._private.scratch.breadthfirst,index=bf.index,depth=bf.depth,nDepth=depths[depth].length;(eleDepth>depth||0===eleDepth)&&(percent+=index/nDepth,samples++)}return samples=Math.max(1,samples),percent/=samples,0===samples&&(percent=void 0),cachedWeightedPercent[ele.id()]=percent,percent},sortFn=function(a,b){var apct=getWeightedPercent(a),bpct=getWeightedPercent(b);return apct-bpct},times=0;times<3;times++){for(var i=0;i<depths.length;i++)depths[i]=depths[i].sort(sortFn);assignDepthsToEles()}for(var biggestDepthSize=0,i=0;i<depths.length;i++)biggestDepthSize=Math.max(depths[i].length,biggestDepthSize);for(var center={x:bb.x1+bb.w/2,y:bb.x1+bb.h/2},getPosition=function(ele,isBottomDepth){var info=ele._private.scratch.breadthfirst,depth=info.depth,index=info.index,depthSize=depths[depth].length,distanceX=Math.max(bb.w/(depthSize+1),minDistance),distanceY=Math.max(bb.h/(depths.length+1),minDistance),radiusStepSize=Math.min(bb.w/2/depths.length,bb.h/2/depths.length);if(radiusStepSize=Math.max(radiusStepSize,minDistance),options.circle){if(options.circle){var radius=radiusStepSize*depth+radiusStepSize-(depths.length>0&&depths[0].length<=3?radiusStepSize/2:0),theta=2*Math.PI/depths[depth].length*index;return 0===depth&&1===depths[0].length&&(radius=1),{x:center.x+radius*Math.cos(theta),y:center.y+radius*Math.sin(theta)}}return{x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY}}var epos={x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY};return isBottomDepth?epos:epos},pos={},i=depths.length-1;i>=0;i--)for(var depth=depths[i],j=0;j<depth.length;j++){var node=depth[j];pos[node.id()]=getPosition(node,i===depths.length-1)}return nodes.layoutPositions(this,options,function(){return pos[this.id()]}),this},module.exports=BreadthFirstLayout},{"../../is":83,"../../math":85,"../../util":100}],49:[function(_dereq_,module,exports){"use strict";function CircleLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),math=_dereq_("../../math"),is=_dereq_("../../is"),defaults={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};CircleLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));for(var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2},sweep=void 0===options.sweep?2*Math.PI-2*Math.PI/nodes.length:options.sweep,dTheta=sweep/Math.max(1,nodes.length-1),r,minDistance=0,i=0;i<nodes.length;i++){var n=nodes[i],nbb=n.boundingBox(),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}if(r=is.number(options.radius)?options.radius:nodes.length<=1?0:Math.min(bb.h,bb.w)/2-minDistance,nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}var getPos=function(i,ele){var theta=options.startAngle+i*dTheta*(clockwise?1:-1),rx=r*Math.cos(theta),ry=r*Math.sin(theta),pos={x:center.x+rx,y:center.y+ry};return pos};return nodes.layoutPositions(this,options,getPos),this},module.exports=CircleLayout},{"../../is":83,"../../math":85,"../../util":100}],50:[function(_dereq_,module,exports){"use strict";function ConcentricLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),math=_dereq_("../../math"),defaults={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,height:void 0,width:void 0,concentric:function(node){return node.degree()},levelWidth:function(nodes){return nodes.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};ConcentricLayout.prototype.run=function(){for(var params=this.options,options=params,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2},nodeValues=[],theta=options.startAngle,maxNodeSize=0,i=0;i<nodes.length;i++){var node=nodes[i],value;value=options.concentric.apply(node,[node]),nodeValues.push({value:value,node:node}),node._private.scratch.concentric=value}nodes.updateStyle();for(var i=0;i<nodes.length;i++){var node=nodes[i],nbb=node.boundingBox();maxNodeSize=Math.max(maxNodeSize,nbb.w,nbb.h)}nodeValues.sort(function(a,b){return b.value-a.value});for(var levelWidth=options.levelWidth(nodes),levels=[[]],currentLevel=levels[0],i=0;i<nodeValues.length;i++){var val=nodeValues[i];if(currentLevel.length>0){var diff=Math.abs(currentLevel[0].value-val.value);diff>=levelWidth&&(currentLevel=[],levels.push(currentLevel))}currentLevel.push(val)}var minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1,maxR=Math.min(bb.w,bb.h)/2-minDist,rStep=maxR/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}for(var r=0,i=0;i<levels.length;i++){var level=levels[i],sweep=void 0===options.sweep?2*Math.PI-2*Math.PI/level.length:options.sweep,dTheta=level.dTheta=sweep/Math.max(1,level.length-1);if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}level.r=r,r+=minDist}if(options.equidistant){for(var rDeltaMax=0,r=0,i=0;i<levels.length;i++){var level=levels[i],rDelta=level.r-r;rDeltaMax=Math.max(rDeltaMax,rDelta)}r=0;for(var i=0;i<levels.length;i++){var level=levels[i];0===i&&(r=level.r),level.r=r,r+=rDeltaMax}}for(var pos={},i=0;i<levels.length;i++)for(var level=levels[i],dTheta=level.dTheta,r=level.r,j=0;j<level.length;j++){var val=level[j],theta=options.startAngle+(clockwise?1:-1)*dTheta*j,p={x:center.x+r*Math.cos(theta),y:center.y+r*Math.sin(theta)};pos[val.node.id()]=p}return nodes.layoutPositions(this,options,function(){var id=this.id();return pos[id]}),this},module.exports=ConcentricLayout},{"../../math":85,"../../util":100}],51:[function(_dereq_,module,exports){"use strict";function CoseLayout(options){this.options=util.extend({},defaults,options),this.options.layout=this}var util=_dereq_("../../util"),math=_dereq_("../../math"),Thread=_dereq_("../../thread"),is=_dereq_("../../is"),DEBUG,defaults={ready:function(){},stop:function(){},animate:!0,animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,randomize:!1,componentSpacing:100,nodeRepulsion:function(node){return 4e5},nodeOverlap:10,idealEdgeLength:function(edge){return 10},edgeElasticity:function(edge){return 100},nestingFactor:5,gravity:80,numIter:1e3,initialTemp:200,coolingFactor:.95,minTemp:1,useMultitasking:!0};CoseLayout.prototype.run=function(){var options=this.options,cy=options.cy,layout=this,thread=this.thread;thread&&!thread.stopped()||(thread=this.thread=Thread({disabled:!options.useMultitasking})),layout.stopped=!1,layout.trigger({type:"layoutstart",layout:layout}),DEBUG=!0===options.debug;var layoutInfo=createLayoutInfo(cy,layout,options);DEBUG&&printLayoutInfo(layoutInfo),options.randomize&&randomizePositions(layoutInfo,cy);var startTime=Date.now(),refreshRequested=!1,refresh=function(rOpts){rOpts=rOpts||{},refreshRequested&&!rOpts.next||!rOpts.force&&Date.now()-startTime<options.animationThreshold||(refreshRequested=!0,util.requestAnimationFrame(function(){refreshPositions(layoutInfo,cy,options),!0===options.fit&&cy.fit(options.padding),refreshRequested=!1,rOpts.next&&rOpts.next()}))};thread.on("message",function(e){var layoutNodes=e.message;layoutInfo.layoutNodes=layoutNodes,refresh()}),thread.pass({layoutInfo:layoutInfo,options:{animate:options.animate,refresh:options.refresh,componentSpacing:options.componentSpacing,nodeOverlap:options.nodeOverlap,nestingFactor:options.nestingFactor,gravity:options.gravity,numIter:options.numIter,initialTemp:options.initialTemp,coolingFactor:options.coolingFactor,minTemp:options.minTemp}}).run(function(pass){var layoutInfo=pass.layoutInfo,options=pass.options,stopped=!1,step=function(layoutInfo,options,step){calculateNodeForces(layoutInfo,options),calculateEdgeForces(layoutInfo,options),calculateGravityForces(layoutInfo,options),propagateForces(layoutInfo,options),updatePositions(layoutInfo,options)},calculateNodeForces=function(layoutInfo,options){for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],numNodes=graph.length,j=0;j<numNodes;j++)for(var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]],k=j+1;k<numNodes;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,options)}},nodeRepulsion=function(node1,node2,layoutInfo,options){var cmptId1=node1.cmptId,cmptId2=node2.cmptId;if(cmptId1===cmptId2||layoutInfo.isCompound){var directionX=node2.positionX-node1.positionX,directionY=node2.positionY-node1.positionY;if(0!==directionX||0!==directionY){var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0)var force=options.nodeOverlap*overlap,distance=Math.sqrt(directionX*directionX+directionY*directionY),forceX=force*directionX/distance,forceY=force*directionY/distance;else var point1=findClippingPoint(node1,directionX,directionY),point2=findClippingPoint(node2,-1*directionX,-1*directionY),distanceX=point2.x-point1.x,distanceY=point2.y-point1.y,distanceSqr=distanceX*distanceX+distanceY*distanceY,distance=Math.sqrt(distanceSqr),force=(node1.nodeRepulsion+node2.nodeRepulsion)/distanceSqr,forceX=force*distanceX/distance,forceY=force*distanceY/distance;node1.isLocked||(node1.offsetX-=forceX,node1.offsetY-=forceY),node2.isLocked||(node2.offsetX+=forceX,node2.offsetY+=forceY)}}},nodesOverlap=function(node1,node2,dX,dY){if(dX>0)var overlapX=node1.maxX-node2.minX;else var overlapX=node2.maxX-node1.minX;if(dY>0)var overlapY=node1.maxY-node2.minY;else var overlapY=node2.maxY-node1.minY;return overlapX>=0&&overlapY>=0?Math.sqrt(overlapX*overlapX+overlapY*overlapY):0},findClippingPoint=function(node,dX,dY){var X=node.positionX,Y=node.positionY,H=node.height||1,W=node.width||1,dirSlope=dY/dX,nodeSlope=H/W,res={};return 0===dX&&0<dY?(res.x=X,res.y=Y+H/2,res):0===dX&&0>dY?(res.x=X,res.y=Y+H/2,res):0<dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X+W/2,res.y=Y+W*dY/2/dX,res):0>dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X-W/2,res.y=Y-W*dY/2/dX,res):0<dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X+H*dX/2/dY,res.y=Y+H/2,res):0>dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X-H*dX/2/dY,res.y=Y-H/2,res):res},calculateEdgeForces=function(layoutInfo,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i],sourceIx=layoutInfo.idToIndex[edge.sourceId],source=layoutInfo.layoutNodes[sourceIx],targetIx=layoutInfo.idToIndex[edge.targetId],target=layoutInfo.layoutNodes[targetIx],directionX=target.positionX-source.positionX,directionY=target.positionY-source.positionY;if(0===directionX&&0===directionY)return;var point1=findClippingPoint(source,directionX,directionY),point2=findClippingPoint(target,-1*directionX,-1*directionY),lx=point2.x-point1.x,ly=point2.y-point1.y,l=Math.sqrt(lx*lx+ly*ly),force=Math.pow(edge.idealLength-l,2)/edge.elasticity;if(0!==l)var forceX=force*lx/l,forceY=force*ly/l;else var forceX=0,forceY=0;source.isLocked||(source.offsetX+=forceX,source.offsetY+=forceY),target.isLocked||(target.offsetX-=forceX,target.offsetY-=forceY)}},calculateGravityForces=function(layoutInfo,options){for(var distThreshold=1,i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i],numNodes=graph.length;if(0===i)var centerX=layoutInfo.clientHeight/2,centerY=layoutInfo.clientWidth/2;else var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]],parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]],centerX=parent.positionX,centerY=parent.positionY;for(var j=0;j<numNodes;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];if(!node.isLocked){var dx=centerX-node.positionX,dy=centerY-node.positionY,d=Math.sqrt(dx*dx+dy*dy);if(d>distThreshold){var fx=options.gravity*dx/d,fy=options.gravity*dy/d;node.offsetX+=fx,node.offsetY+=fy}}}}},propagateForces=function(layoutInfo,options){var queue=[],start=0,end=-1;for(queue.push.apply(queue,layoutInfo.graphSet[0]),end+=layoutInfo.graphSet[0].length;start<=end;){var nodeId=queue[start++],nodeIndex=layoutInfo.idToIndex[nodeId],node=layoutInfo.layoutNodes[nodeIndex],children=node.children;if(0<children.length&&!node.isLocked){for(var offX=node.offsetX,offY=node.offsetY,i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX,childNode.offsetY+=offY,queue[++end]=children[i]}node.offsetX=0,node.offsetY=0}}},updatePositions=function(layoutInfo,options){for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0<n.children.length&&(n.maxX=void 0,n.minX=void 0,n.maxY=void 0,n.minY=void 0)}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(!(0<n.children.length||n.isLocked)){var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x,n.positionY+=tempForce.y,n.offsetX=0,n.offsetY=0,n.minX=n.positionX-n.width,n.maxX=n.positionX+n.width,n.minY=n.positionY-n.height,n.maxY=n.positionY+n.height,updateAncestryBoundaries(n,layoutInfo)}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0<n.children.length&&!n.isLocked&&(n.positionX=(n.maxX+n.minX)/2,n.positionY=(n.maxY+n.minY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY)}},limitForce=function(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max)var res={x:max*forceX/force,y:max*forceY/force};else var res={x:forceX,y:forceY};return res},updateAncestryBoundaries=function(node,layoutInfo){var parentId=node.parentId;if(null!=parentId){var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]],flag=!1;return(null==p.maxX||node.maxX+p.padRight>p.maxX)&&(p.maxX=node.maxX+p.padRight,flag=!0),(null==p.minX||node.minX-p.padLeft<p.minX)&&(p.minX=node.minX-p.padLeft,flag=!0),(null==p.maxY||node.maxY+p.padBottom>p.maxY)&&(p.maxY=node.maxY+p.padBottom,flag=!0),(null==p.minY||node.minY-p.padTop<p.minY)&&(p.minY=node.minY-p.padTop,flag=!0),flag?updateAncestryBoundaries(p,layoutInfo):void 0}},separateComponents=function(layutInfo,options){for(var nodes=layoutInfo.layoutNodes,components=[],i=0;i<nodes.length;i++){var node=nodes[i],cid=node.cmptId,component=components[cid]=components[cid]||[];component.push(node)}for(var totalA=0,i=0;i<components.length;i++){var c=components[i];if(c){c.x1=1/0,c.x2=-(1/0),c.y1=1/0,c.y2=-(1/0);for(var j=0;j<c.length;j++){var n=c[j];c.x1=Math.min(c.x1,n.positionX-n.width/2),c.x2=Math.max(c.x2,n.positionX+n.width/2),c.y1=Math.min(c.y1,n.positionY-n.height/2),c.y2=Math.max(c.y2,n.positionY+n.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,totalA+=c.w*c.h}}components.sort(function(c1,c2){return c2.w*c2.h-c1.w*c1.h});for(var x=0,y=0,usedW=0,rowH=0,maxRowW=Math.sqrt(totalA)*layoutInfo.clientWidth/layoutInfo.clientHeight,i=0;i<components.length;i++){var c=components[i];if(c){for(var j=0;j<c.length;j++){var n=c[j];n.isLocked||(n.positionX+=x,n.positionY+=y)}x+=c.w+options.componentSpacing,usedW+=c.w+options.componentSpacing,rowH=Math.max(rowH,c.h),usedW>maxRowW&&(y+=rowH+options.componentSpacing,x=0,usedW=0,rowH=0)}}},mainLoop=function(i){return!stopped&&(step(layoutInfo,options,i),layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor,!(layoutInfo.temperature<options.minTemp))},i=0,loopRet;do{for(var f=0;f<options.refresh&&i<options.numIter;){var loopRet=mainLoop(i);if(!loopRet)break;f++,i++}options.animate&&broadcast(layoutInfo.layoutNodes)}while(loopRet&&i+1<options.numIter);return separateComponents(layoutInfo,options),layoutInfo}).then(function(layoutInfoUpdated){layoutInfo.layoutNodes=layoutInfoUpdated.layoutNodes,thread.stop(),done()});var done=function(){refresh({force:!0,next:function(){layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})}})};return this},CoseLayout.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.trigger("layoutstop"),this},CoseLayout.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var createLayoutInfo=function(cy,layout,options){for(var edges=options.eles.edges(),nodes=options.eles.nodes(),layoutInfo={isCompound:cy.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:cy.width(),clientHeight:cy.width(),boundingBox:math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()})},components=options.eles.components(),id2cmptId={},i=0;i<components.length;i++)for(var component=components[i],j=0;j<component.length;j++){var node=component[j];id2cmptId[node.id()]=i}for(var i=0;i<layoutInfo.nodeSize;i++){var n=nodes[i],nbb=n.boundingBox(),tempNode={};tempNode.isLocked=n.locked(),tempNode.id=n.data("id"),tempNode.parentId=n.data("parent"),tempNode.cmptId=id2cmptId[n.id()],tempNode.children=[],tempNode.positionX=n.position("x"),tempNode.positionY=n.position("y"),tempNode.offsetX=0,tempNode.offsetY=0,tempNode.height=nbb.w,tempNode.width=nbb.h,tempNode.maxX=tempNode.positionX+tempNode.width/2,tempNode.minX=tempNode.positionX-tempNode.width/2,tempNode.maxY=tempNode.positionY+tempNode.height/2,tempNode.minY=tempNode.positionY-tempNode.height/2,tempNode.padLeft=parseFloat(n.style("padding")),tempNode.padRight=parseFloat(n.style("padding")),tempNode.padTop=parseFloat(n.style("padding")),tempNode.padBottom=parseFloat(n.style("padding")),tempNode.nodeRepulsion=is.fn(options.nodeRepulsion)?options.nodeRepulsion.call(n,n):options.nodeRepulsion,layoutInfo.layoutNodes.push(tempNode),layoutInfo.idToIndex[tempNode.id]=i}for(var queue=[],start=0,end=-1,tempGraph=[],i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i],p_id=n.parentId;null!=p_id?layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id):(queue[++end]=n.id,tempGraph.push(n.id))}for(layoutInfo.graphSet.push(tempGraph);start<=end;){var node_id=queue[start++],node_ix=layoutInfo.idToIndex[node_id],node=layoutInfo.layoutNodes[node_ix],children=node.children;if(children.length>0){layoutInfo.graphSet.push(children);for(var i=0;i<children.length;i++)queue[++end]=children[i]}}for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}for(var i=0;i<layoutInfo.edgeSize;i++){var e=edges[i],tempEdge={};tempEdge.id=e.data("id"),tempEdge.sourceId=e.data("source"),tempEdge.targetId=e.data("target");var idealLength=is.fn(options.idealEdgeLength)?options.idealEdgeLength.call(e,e):options.idealEdgeLength,elasticity=is.fn(options.edgeElasticity)?options.edgeElasticity.call(e,e):options.edgeElasticity,sourceIx=layoutInfo.idToIndex[tempEdge.sourceId],targetIx=layoutInfo.idToIndex[tempEdge.targetId],sourceGraph=layoutInfo.indexToGraph[sourceIx],targetGraph=layoutInfo.indexToGraph[targetIx];if(sourceGraph!=targetGraph){for(var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo),lcaGraph=layoutInfo.graphSet[lca],depth=0,tempNode=layoutInfo.layoutNodes[sourceIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;for(tempNode=layoutInfo.layoutNodes[targetIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength,tempEdge.elasticity=elasticity,layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo},findLCA=function(node1,node2,layoutInfo){var res=findLCA_aux(node1,node2,0,layoutInfo);return 2>res.count?0:res.graph},findLCA_aux=function(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<graph.indexOf(node1)&&-1<graph.indexOf(node2))return{count:2,graph:graphIx};for(var c=0,i=0;i<graph.length;i++){var nodeId=graph[i],nodeIx=layoutInfo.idToIndex[nodeId],children=layoutInfo.layoutNodes[nodeIx].children;if(0!==children.length){var childGraphIx=layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]],result=findLCA_aux(node1,node2,childGraphIx,layoutInfo);if(0!==result.count){if(1!==result.count)return result;if(c++,2===c)break}}}return{count:c,graph:graphIx}},printLayoutInfo=function(layoutInfo){if(DEBUG){console.debug("layoutNodes:");for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i],s="\nindex: "+i+"\nId: "+n.id+"\nChildren: "+n.children.toString()+"\nparentId: "+n.parentId+"\npositionX: "+n.positionX+"\npositionY: "+n.positionY+"\nOffsetX: "+n.offsetX+"\nOffsetY: "+n.offsetY+"\npadLeft: "+n.padLeft+"\npadRight: "+n.padRight+"\npadTop: "+n.padTop+"\npadBottom: "+n.padBottom;
console.debug(s)}console.debug("idToIndex");for(var i in layoutInfo.idToIndex)console.debug("Id: "+i+"\nIndex: "+layoutInfo.idToIndex[i]);console.debug("Graph Set");for(var set=layoutInfo.graphSet,i=0;i<set.length;i++)console.debug("Set : "+i+": "+set[i].toString());for(var s="IndexToGraph",i=0;i<layoutInfo.indexToGraph.length;i++)s+="\nIndex : "+i+" Graph: "+layoutInfo.indexToGraph[i];console.debug(s),s="Layout Edges";for(var i=0;i<layoutInfo.layoutEdges.length;i++){var e=layoutInfo.layoutEdges[i];s+="\nEdge Index: "+i+" ID: "+e.id+" SouceID: "+e.sourceId+" TargetId: "+e.targetId+" Ideal Length: "+e.idealLength}console.debug(s),s="nodeSize: "+layoutInfo.nodeSize,s+="\nedgeSize: "+layoutInfo.edgeSize,s+="\ntemperature: "+layoutInfo.temperature,console.debug(s)}},randomizePositions=function(layoutInfo,cy){for(var width=layoutInfo.clientWidth,height=layoutInfo.clientHeight,i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0!==n.children.length||n.isLocked||(n.positionX=Math.random()*width,n.positionY=Math.random()*height)}},refreshPositions=function(layoutInfo,cy,options){var layout=options.layout,nodes=options.eles.nodes(),bb=layoutInfo.boundingBox,coseBB={x1:1/0,x2:-(1/0),y1:1/0,y2:-(1/0)};options.boundingBox&&(nodes.forEach(function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX),coseBB.x2=Math.max(coseBB.x2,lnode.positionX),coseBB.y1=Math.min(coseBB.y1,lnode.positionY),coseBB.y2=Math.max(coseBB.y2,lnode.positionY)}),coseBB.w=coseBB.x2-coseBB.x1,coseBB.h=coseBB.y2-coseBB.y1),nodes.positions(function(i,ele){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=(lnode.positionX-coseBB.x1)/coseBB.w,pctY=(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}return{x:lnode.positionX,y:lnode.positionY}}),!0!==layoutInfo.ready&&(layoutInfo.ready=!0,layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:this}))};module.exports=CoseLayout},{"../../is":83,"../../math":85,"../../thread":98,"../../util":100}],52:[function(_dereq_,module,exports){"use strict";function GridLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),math=_dereq_("../../math"),defaults={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:function(node){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};GridLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(0===bb.h||0===bb.w)nodes.layoutPositions(this,options,function(){return{x:bb.x1,y:bb.y1}});else{var cells=nodes.size(),splits=Math.sqrt(cells*bb.h/bb.w),rows=Math.round(splits),cols=Math.round(bb.w/bb.h*splits),small=function(val){if(null==val)return Math.min(rows,cols);var min=Math.min(rows,cols);min==rows?rows=val:cols=val},large=function(val){if(null==val)return Math.max(rows,cols);var max=Math.max(rows,cols);max==rows?rows=val:cols=val},oRows=options.rows,oCols=null!=options.cols?options.cols:options.columns;if(null!=oRows&&null!=oCols)rows=oRows,cols=oCols;else if(null!=oRows&&null==oCols)rows=oRows,cols=Math.ceil(cells/rows);else if(null==oRows&&null!=oCols)cols=oCols,rows=Math.ceil(cells/cols);else if(cols*rows>cells){var sm=small(),lg=large();(sm-1)*lg>=cells?small(sm-1):(lg-1)*sm>=cells&&large(lg-1)}else for(;cols*rows<cells;){var sm=small(),lg=large();(lg+1)*sm>=cells?large(lg+1):small(sm+1)}var cellWidth=bb.w/cols,cellHeight=bb.h/rows;if(options.condense&&(cellWidth=0,cellHeight=0),options.avoidOverlap)for(var i=0;i<nodes.length;i++){var node=nodes[i],pos=node._private.position;null!=pos.x&&null!=pos.y||(pos.x=0,pos.y=0);var nbb=node.boundingBox(),p=options.avoidOverlapPadding,w=nbb.w+p,h=nbb.h+p;cellWidth=Math.max(cellWidth,w),cellHeight=Math.max(cellHeight,h)}for(var cellUsed={},used=function(row,col){return!!cellUsed["c-"+row+"-"+col]},use=function(row,col){cellUsed["c-"+row+"-"+col]=!0},row=0,col=0,moveToNextCell=function(){col++,col>=cols&&(col=0,row++)},id2manPos={},i=0;i<nodes.length;i++){var node=nodes[i],rcPos=options.position(node);if(rcPos&&(void 0!==rcPos.row||void 0!==rcPos.col)){var pos={row:rcPos.row,col:rcPos.col};if(void 0===pos.col)for(pos.col=0;used(pos.row,pos.col);)pos.col++;else if(void 0===pos.row)for(pos.row=0;used(pos.row,pos.col);)pos.row++;id2manPos[node.id()]=pos,use(pos.row,pos.col)}}var getPos=function(i,element){var x,y;if(element.locked()||element.isParent())return!1;var rcPos=id2manPos[element.id()];if(rcPos)x=rcPos.col*cellWidth+cellWidth/2+bb.x1,y=rcPos.row*cellHeight+cellHeight/2+bb.y1;else{for(;used(row,col);)moveToNextCell();x=col*cellWidth+cellWidth/2+bb.x1,y=row*cellHeight+cellHeight/2+bb.y1,use(row,col),moveToNextCell()}return{x:x,y:y}};nodes.layoutPositions(this,options,getPos)}return this},module.exports=GridLayout},{"../../math":85,"../../util":100}],53:[function(_dereq_,module,exports){"use strict";module.exports=[{name:"breadthfirst",impl:_dereq_("./breadthfirst")},{name:"circle",impl:_dereq_("./circle")},{name:"concentric",impl:_dereq_("./concentric")},{name:"cose",impl:_dereq_("./cose")},{name:"grid",impl:_dereq_("./grid")},{name:"null",impl:_dereq_("./null")},{name:"preset",impl:_dereq_("./preset")},{name:"random",impl:_dereq_("./random")}]},{"./breadthfirst":48,"./circle":49,"./concentric":50,"./cose":51,"./grid":52,"./null":54,"./preset":55,"./random":56}],54:[function(_dereq_,module,exports){"use strict";function NullLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),defaults={ready:function(){},stop:function(){}};NullLayout.prototype.run=function(){var options=this.options,eles=options.eles,layout=this,cy=options.cy;return layout.trigger("layoutstart"),eles.nodes().positions(function(){return{x:0,y:0}}),layout.one("layoutready",options.ready),layout.trigger("layoutready"),layout.one("layoutstop",options.stop),layout.trigger("layoutstop"),this},NullLayout.prototype.stop=function(){return this},module.exports=NullLayout},{"../../util":100}],55:[function(_dereq_,module,exports){"use strict";function PresetLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),is=_dereq_("../../is"),defaults={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};PresetLayout.prototype.run=function(){function getPosition(node){if(null==options.positions)return null;if(posIsFn)return options.positions.apply(node,[node]);var pos=options.positions[node._private.data.id];return null==pos?null:pos}var options=this.options,eles=options.eles,nodes=eles.nodes(),posIsFn=is.fn(options.positions);return nodes.layoutPositions(this,options,function(i,node){var position=getPosition(node);return!node.locked()&&null!=position&&position}),this},module.exports=PresetLayout},{"../../is":83,"../../util":100}],56:[function(_dereq_,module,exports){"use strict";function RandomLayout(options){this.options=util.extend({},defaults,options)}var util=_dereq_("../../util"),math=_dereq_("../../math"),defaults={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};RandomLayout.prototype.run=function(){var options=this.options,cy=options.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),getPos=function(i,node){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}};return nodes.layoutPositions(this,options,getPos),this},module.exports=RandomLayout},{"../../math":85,"../../util":100}],57:[function(_dereq_,module,exports){"use strict";var math=_dereq_("../../../math"),is=_dereq_("../../../is"),util=_dereq_("../../../util"),BRp={};BRp.arrowShapeWidth=.3,BRp.registerArrowShapes=function(){var arrowShapes=this.arrowShapes={},renderer=this,bbCollide=function(x,y,size,angle,translation,padding){var x1=translation.x-size/2-padding,x2=translation.x+size/2+padding,y1=translation.y-size/2-padding,y2=translation.y+size/2+padding,inside=x1<=x&&x<=x2&&y1<=y&&y<=y2;return inside},transform=function(x,y,size,angle,translation){var xRotated=x*Math.cos(angle)-y*Math.sin(angle),yRotated=x*Math.sin(angle)+y*Math.cos(angle),xScaled=xRotated*size,yScaled=yRotated*size,xTranslated=xScaled+translation.x,yTranslated=yScaled+translation.y;return{x:xTranslated,y:yTranslated}},transformPoints=function(pts,size,angle,translation){for(var retPts=[],i=0;i<pts.length;i+=2){var x=pts[i],y=pts[i+1];retPts.push(transform(x,y,size,angle,translation))}return retPts},pointsToArr=function(pts){for(var ret=[],i=0;i<pts.length;i++){var p=pts[i];ret.push(p.x,p.y)}return ret},defineArrowShape=function(name,defn){is.string(defn)&&(defn=arrowShapes[defn]),arrowShapes[name]=util.extend({name:name,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(x,y,size,angle,translation,padding){var points=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),inside=math.pointInsidePolygonPoints(x,y,points);return inside},roughCollide:bbCollide,draw:function(context,size,angle,translation){var points=transformPoints(this.points,size,angle,translation);renderer.arrowShapeImpl("polygon")(context,points)},spacing:function(edge){return 0},gap:function(edge){return 2*edge.pstyle("width").pfValue}},defn)};defineArrowShape("none",{collide:util.falsify,roughCollide:util.falsify,draw:util.noop,spacing:util.zeroify,gap:util.zeroify}),defineArrowShape("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),defineArrowShape("arrow","triangle"),defineArrowShape("triangle-backcurve",{points:arrowShapes.triangle.points,controlPoint:[0,-.15],roughCollide:bbCollide,draw:function(context,size,angle,translation){var ptsTrans=transformPoints(this.points,size,angle,translation),ctrlPt=this.controlPoint,ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);renderer.arrowShapeImpl(this.name)(context,ptsTrans,ctrlPtTrans)},gap:function(edge){return edge.pstyle("width").pfValue}}),defineArrowShape("triangle-tee",{points:[-.15,-.3,0,0,.15,-.3,-.15,-.3],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(x,y,size,angle,translation,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),teePts=pointsToArr(transformPoints(this.pointsTee,size+2*padding,angle,translation)),inside=math.pointInsidePolygonPoints(x,y,triPts)||math.pointInsidePolygonPoints(x,y,teePts);return inside},draw:function(context,size,angle,translation){var triPts=transformPoints(this.points,size,angle,translation),teePts=transformPoints(this.pointsTee,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,teePts)}}),defineArrowShape("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(edge){return edge.pstyle("width").pfValue}}),defineArrowShape("circle",{radius:.15,collide:function(x,y,size,angle,translation,padding){var t=translation,inside=Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2);return inside},draw:function(context,size,angle,translation){renderer.arrowShapeImpl(this.name)(context,translation.x,translation.y,this.radius*size)},spacing:function(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue)*this.radius}}),defineArrowShape("inhibitor",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(edge){return 1},gap:function(edge){return 1}}),defineArrowShape("tee","inhibitor"),defineArrowShape("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),defineArrowShape("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(edge){return edge.pstyle("width").pfValue}})},module.exports=BRp},{"../../../is":83,"../../../math":85,"../../../util":100}],58:[function(_dereq_,module,exports){"use strict";function pushBezierPts(r,edge,pts){for(var qbezierAt=function(p1,p2,p3,t){return math.qbezierAt(p1,p2,p3,t)},_p=edge._private,bpts=_p.rstyle.bezierPts,i=0;i<r.bezierProjPcts.length;i++){var p=r.bezierProjPcts[i];bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],p),y:qbezierAt(pts[1],pts[3],pts[5],p)})}}var math=_dereq_("../../../math"),is=_dereq_("../../../is"),util=_dereq_("../../../util"),zIndexSort=_dereq_("../../../collection/zsort"),window=_dereq_("../../../window"),BRp={};BRp.registerCalculationListeners=function(){var cy=this.cy,elesToUpdate=cy.collection(),r=this,enqueue=function(eles,e){elesToUpdate.merge(eles);for(var i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,rstyle=_p.rstyle;rstyle.clean=!1,_p.bbCache=null;var evts=rstyle.dirtyEvents=rstyle.dirtyEvents||{length:0};evts[e.type]||(evts[e.type]=!0,evts.length++)}};r.binder(cy).on("position.* style.* free.*","node",function onDirtyModNode(e){var node=e.cyTarget;if(enqueue(node,e),enqueue(node.connectedEdges(),e),cy.hasCompoundNodes()){var parents=node.parents();enqueue(parents,e),enqueue(parents.connectedEdges(),e)}}).on("add.* background.*","node",function onDirtyAddNode(e){var ele=e.cyTarget;enqueue(ele,e)}).on("add.* style.*","edge",function onDirtyEdge(e){var edge=e.cyTarget;enqueue(edge,e),enqueue(edge.parallelEdges(),e)}).on("remove.*","edge",function onDirtyRemoveEdge(e){for(var edge=e.cyTarget,pEdges=edge.parallelEdges(),i=0;i<pEdges.length;i++){var pEdge=pEdges[i];pEdge.removed()||enqueue(pEdge,e)}});var updateEleCalcs=function(willDraw){if(willDraw){var fns=r.onUpdateEleCalcsFns;if(fns)for(var i=0;i<fns.length;i++){var fn=fns[i];fn(willDraw,elesToUpdate)}r.recalculateRenderedStyle(elesToUpdate,!1);for(var i=0;i<elesToUpdate.length;i++)elesToUpdate[i]._private.rstyle.dirtyEvents=null;elesToUpdate=cy.collection()}};r.beforeRender(updateEleCalcs,r.beforeRenderPriorities.eleCalcs)},BRp.onUpdateEleCalcs=function(fn){var fns=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];fns.push(fn)},BRp.recalculateRenderedStyle=function(eles,useCache){var edges=[],nodes=[];if(!this.destroyed){void 0===useCache&&(useCache=!0);for(var i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,rstyle=_p.rstyle;useCache&&rstyle.clean||ele.removed()||("nodes"===_p.group?nodes.push(ele):edges.push(ele),rstyle.clean=!0)}for(var i=0;i<nodes.length;i++){var ele=nodes[i],_p=ele._private,rstyle=_p.rstyle,pos=_p.position;this.recalculateNodeLabelProjection(ele),rstyle.nodeX=pos.x,rstyle.nodeY=pos.y,rstyle.nodeW=ele.pstyle("width").pfValue,rstyle.nodeH=ele.pstyle("height").pfValue}this.recalculateEdgeProjections(edges);for(var i=0;i<edges.length;i++){var ele=edges[i],_p=ele._private,rstyle=_p.rstyle,rs=_p.rscratch;this.recalculateEdgeLabelProjections(ele),rstyle.srcX=rs.arrowStartX,rstyle.srcY=rs.arrowStartY,rstyle.tgtX=rs.arrowEndX,rstyle.tgtY=rs.arrowEndY,rstyle.midX=rs.midX,rstyle.midY=rs.midY,rstyle.labelAngle=rs.labelAngle,rstyle.sourceLabelAngle=rs.sourceLabelAngle,rstyle.targetLabelAngle=rs.targetLabelAngle}}},BRp.projectIntoViewport=function(clientX,clientY){var cy=this.cy,offsets=this.findContainerClientCoords(),offsetLeft=offsets[0],offsetTop=offsets[1],pan=cy.pan(),zoom=cy.zoom(),x=(clientX-offsetLeft-pan.x)/zoom,y=(clientY-offsetTop-pan.y)/zoom;return[x,y]},BRp.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var container=this.container,rect=container.getBoundingClientRect(),style=window.getComputedStyle(container),styleValue=function(name){return parseFloat(style.getPropertyValue(name))},extra={left:styleValue("padding-left")+styleValue("border-left-width"),right:styleValue("padding-right")+styleValue("border-right-width"),top:styleValue("padding-top")+styleValue("border-top-width"),bottom:styleValue("padding-bottom")+styleValue("border-bottom-width")};return this.containerBB=[rect.left+extra.left,rect.top+extra.top,rect.right-rect.left-extra.left-extra.right,rect.bottom-rect.top-extra.top-extra.bottom]},BRp.invalidateContainerClientCoordsCache=function(){this.containerBB=null},BRp.findNearestElement=function(x,y,visibleElementsOnly,isTouch){return this.findNearestElements(x,y,visibleElementsOnly,isTouch)[0]},BRp.findNearestElements=function(x,y,visibleElementsOnly,isTouch){function addEle(ele,sqDist){if(ele.isNode()){if(nearNode)return;nearNode=ele,near.push(ele)}if(ele.isEdge()&&(null==sqDist||sqDist<minSqDist))if(nearEdge){if(nearEdge.pstyle("z-index").value===ele.pstyle("z-index").value)for(var i=0;i<near.length;i++)if(near[i].isEdge()){near[i]=ele,nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist;break}}else near.push(ele),nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist}function checkNode(node){var _p=node._private;if("no"!==node.pstyle("events").strValue){var width=node.outerWidth()+2*nodeThreshold,height=node.outerHeight()+2*nodeThreshold,hw=width/2,hh=height/2,pos=_p.position;if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh){var visible=!visibleElementsOnly||node.visible()&&!node.transparent();if(visibleElementsOnly&&!visible)return;var shape=r.nodeShapes[self.getNodeShape(node)];if(shape.checkPoint(x,y,0,width,height,pos.x,pos.y))return addEle(node,0),!0}}}function checkEdge(edge){var _p=edge._private;if("no"!==edge.pstyle("events").strValue){var rs=_p.rscratch,styleWidth=edge.pstyle("width").pfValue,width=styleWidth/2+edgeThreshold,widthSq=width*width,width2=2*width,src=_p.source,tgt=_p.target,inEdgeBB=!1,sqDist,passedVisibilityCheck,passesVisibilityCheck=function(){if(void 0!==passedVisibilityCheck)return passedVisibilityCheck;if(!visibleElementsOnly)return passedVisibilityCheck=!0,!0;var visible=edge.visible()&&!edge.transparent();return visible?(passedVisibilityCheck=!0,!0):(passedVisibilityCheck=!1,!1)};if("segments"===rs.edgeType||"straight"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=rs.allpts,i=0;i+3<pts.length;i+=2)if((inEdgeBB=math.inLineVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],width2))&&passesVisibilityCheck()&&widthSq>(sqDist=math.sqdistToFiniteLine(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3])))return addEle(edge,sqDist),!0}else if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType)for(var pts=rs.allpts,i=0;i+5<rs.allpts.length;i+=4)if((inEdgeBB=math.inBezierVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5],width2))&&passesVisibilityCheck()&&widthSq>(sqDist=math.sqdistToQuadraticBezier(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5])))return addEle(edge,sqDist),!0;if(passesVisibilityCheck())for(var src=src||_p.source,tgt=tgt||_p.target,arSize=self.getArrowWidth(styleWidth),arrows=[{name:"source",x:rs.arrowStartX,y:rs.arrowStartY,angle:rs.srcArrowAngle},{name:"target",x:rs.arrowEndX,y:rs.arrowEndY,angle:rs.tgtArrowAngle},{name:"mid-source",x:rs.midX,y:rs.midY,angle:rs.midsrcArrowAngle},{name:"mid-target",x:rs.midX,y:rs.midY,angle:rs.midtgtArrowAngle}],i=0;i<arrows.length;i++){var ar=arrows[i],shape=r.arrowShapes[edge.pstyle(ar.name+"-arrow-shape").value];if(shape.roughCollide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeThreshold)&&shape.collide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeThreshold))return addEle(edge),!0}hasCompounds&&near.length>0&&(checkNode(src),checkNode(tgt))}}function preprop(obj,name,pre){return util.getPrefixedProperty(obj,name,pre)}function checkLabel(ele,prefix){var _p=ele._private,th=labelThreshold,prefixDash;prefixDash=prefix?prefix+"-":"";var text=ele.pstyle(prefixDash+"label").value,eventsEnabled="yes"===ele.pstyle("text-events").strValue;if(eventsEnabled&&text){var rstyle=_p.rstyle,bw=ele.pstyle("text-border-width").pfValue,lw=preprop(rstyle,"labelWidth",prefix)+bw/2+2*th,lh=preprop(rstyle,"labelHeight",prefix)+bw/2+2*th,lx=preprop(rstyle,"labelX",prefix),ly=preprop(rstyle,"labelY",prefix),theta=preprop(_p.rscratch,"labelAngle",prefix),lx1=lx-lw/2,lx2=lx+lw/2,ly1=ly-lh/2,ly2=ly+lh/2;if(theta){var cos=Math.cos(theta),sin=Math.sin(theta),rotate=function(x,y){return x-=lx,y-=ly,{x:x*cos-y*sin+lx,y:x*sin+y*cos+ly}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2),points=[px1y1.x,px1y1.y,px2y1.x,px2y1.y,px2y2.x,px2y2.y,px1y2.x,px1y2.y];if(math.pointInsidePolygonPoints(x,y,points))return addEle(ele),!0}else{var bb={w:lw,h:lh,x1:lx1,x2:lx2,y1:ly1,y2:ly2};if(math.inBoundingBox(bb,x,y))return addEle(ele),!0}}}for(var self=this,r=this,eles=r.getCachedZSortedEles(),near=[],zoom=r.cy.zoom(),hasCompounds=r.cy.hasCompoundNodes(),edgeThreshold=(isTouch?24:8)/zoom,nodeThreshold=(isTouch?8:2)/zoom,labelThreshold=(isTouch?8:2)/zoom,minSqDist=1/0,nearEdge,nearNode,i=eles.length-1;i>=0;i--){var ele=eles[i];ele.isNode()?checkNode(ele)||checkLabel(ele):checkEdge(ele)||checkLabel(ele)||checkLabel(ele,"source")||checkLabel(ele,"target")}return near},BRp.getAllInBox=function(x1,y1,x2,y2){var eles=this.getCachedZSortedEles(),nodes=eles.nodes,edges=eles.edges,box=[],x1c=Math.min(x1,x2),x2c=Math.max(x1,x2),y1c=Math.min(y1,y2),y2c=Math.max(y1,y2);x1=x1c,x2=x2c,y1=y1c,y2=y2c;for(var boxBb=math.makeBoundingBox({x1:x1,y1:y1,x2:x2,y2:y2}),i=0;i<nodes.length;i++){var node=nodes[i],nodeBb=node.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:!1,includeShadows:!1});math.boundingBoxesIntersect(boxBb,nodeBb)&&box.push(nodes[i])}for(var e=0;e<edges.length;e++){var edge=edges[e],_p=edge._private,rs=_p.rscratch;if((null==rs.startX||null==rs.startY||math.inBoundingBox(boxBb,rs.startX,rs.startY))&&(null==rs.endX||null==rs.endY||math.inBoundingBox(boxBb,rs.endX,rs.endY)))if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType||"segments"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts,allInside=!0,i=0;i<pts.length;i++)if(!math.pointInBoundingBox(boxBb,pts[i])){allInside=!1;break}allInside&&box.push(edge)}else"haystack"!==rs.edgeType&&"straight"!==rs.edgeType||box.push(edge)}return box},BRp.getNodeShape=function(node){var r=this,shape=node.pstyle("shape").value;if(node.isParent())return"rectangle"===shape||"roundrectangle"===shape?shape:"rectangle";if("polygon"===shape){var points=node.pstyle("shape-polygon-points").value;return r.nodeShapes.makePolygon(points).name}return shape},BRp.updateCachedZSortedEles=function(){this.getCachedZSortedEles(!0)},BRp.updateCachedGrabbedEles=function(){var eles=this.cachedZSortedEles;eles.drag=[],eles.nondrag=[];for(var grabTargets=[],i=0;i<eles.length;i++){var ele=eles[i],rs=ele._private.rscratch;ele.grabbed()&&!ele.isParent()?grabTargets.push(ele):rs.inDragLayer?eles.drag.push(ele):eles.nondrag.push(ele)}for(var i=0;i<grabTargets.length;i++){var ele=grabTargets[i];eles.drag.push(ele)}},BRp.getCachedZSortedEles=function(forceRecalc){if(forceRecalc||!this.cachedZSortedEles){var cyEles=this.cy.mutableElements(),eles=[];eles.nodes=[],eles.edges=[];for(var i=0;i<cyEles.length;i++){var ele=cyEles[i];(ele.animated()||ele.visible()&&!ele.transparent())&&(eles.push(ele),ele.isNode()?eles.nodes.push(ele):eles.edges.push(ele))}eles.sort(zIndexSort),this.cachedZSortedEles=eles,this.updateCachedGrabbedEles()}else eles=this.cachedZSortedEles;return eles},BRp.projectLines=function(edge){var _p=edge._private,rs=_p.rscratch,et=rs.edgeType;if(_p.rstyle.bezierPts=null,_p.rstyle.linePts=null,_p.rstyle.haystackPts=null,"multibezier"===et||"bezier"===et||"self"===et||"compound"===et)for(var bpts=_p.rstyle.bezierPts=[],i=0;i+5<rs.allpts.length;i+=4)pushBezierPts(this,edge,rs.allpts.slice(i,i+6));else if("segments"===et)for(var lpts=_p.rstyle.linePts=[],i=0;i+1<rs.allpts.length;i+=2)lpts.push({x:rs.allpts[i],y:rs.allpts[i+1]});else if("haystack"===et){var hpts=rs.haystackPts;_p.rstyle.haystackPts=[{x:hpts[0],y:hpts[1]},{x:hpts[2],y:hpts[3]}]}_p.rstyle.arrowWidth=this.getArrowWidth(edge.pstyle("width").pfValue)*this.arrowShapeWidth},BRp.projectBezier=BRp.projectLines,BRp.recalculateNodeLabelProjection=function(node){var content=node.pstyle("label").strValue;if(!is.emptyString(content)){var textX,textY,_p=node._private,nodeWidth=node.width(),nodeHeight=node.height(),padding=node.pstyle("padding").pfValue,nodePos=_p.position,textHalign=node.pstyle("text-halign").strValue,textValign=node.pstyle("text-valign").strValue,rs=_p.rscratch,rstyle=_p.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2-padding;break;case"right":textX=nodePos.x+nodeWidth/2+padding;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2-padding;break;case"bottom":textY=nodePos.y+nodeHeight/2+padding;break;default:textY=nodePos.y}rs.labelX=textX,rs.labelY=textY,rstyle.labelX=textX,rstyle.labelY=textY,this.applyLabelDimensions(node)}},BRp.recalculateEdgeLabelProjections=function(edge){var p,_p=edge._private,rs=_p.rscratch,r=this,content={mid:edge.pstyle("label").strValue,source:edge.pstyle("source-label").strValue,target:edge.pstyle("target-label").strValue};if(content.mid||content.source||content.target){p={x:rs.midX,y:rs.midY};var setRs=function(propName,prefix,value){util.setPrefixedProperty(_p.rscratch,propName,prefix,value),util.setPrefixedProperty(_p.rstyle,propName,prefix,value)};setRs("labelX",null,p.x),setRs("labelY",null,p.y);var createControlPointInfo=function(){function addSegment(cp,p0,p1,t0,t1){var length=math.dist(p0,p1),prevSegment=cp.segments[cp.segments.length-1],segment={p0:p0,p1:p1,t0:t0,t1:t1,startDist:prevSegment?prevSegment.startDist+prevSegment.length:0,length:length};cp.segments.push(segment),cp.length+=length}if(createControlPointInfo.cache)return createControlPointInfo.cache;for(var ctrlpts=[],i=0;i+5<rs.allpts.length;i+=4){var p0={x:rs.allpts[i],y:rs.allpts[i+1]},p1={x:rs.allpts[i+2],y:rs.allpts[i+3]},p2={x:rs.allpts[i+4],y:rs.allpts[i+5]};ctrlpts.push({p0:p0,p1:p1,p2:p2,startDist:0,length:0,segments:[]})}for(var bpts=_p.rstyle.bezierPts,nProjs=r.bezierProjPcts.length,i=0;i<ctrlpts.length;i++){var cp=ctrlpts[i],prevCp=ctrlpts[i-1];prevCp&&(cp.startDist=prevCp.startDist+prevCp.length),addSegment(cp,cp.p0,bpts[i*nProjs],0,r.bezierProjPcts[0]);for(var j=0;j<nProjs-1;j++)addSegment(cp,bpts[i*nProjs+j],bpts[i*nProjs+j+1],r.bezierProjPcts[j],r.bezierProjPcts[j+1]);addSegment(cp,bpts[i*nProjs+nProjs-1],cp.p2,r.bezierProjPcts[nProjs-1],1)}return createControlPointInfo.cache=ctrlpts},calculateEndProjection=function(prefix){var angle,isSrc="source"===prefix;if(content[prefix]){var offset=edge.pstyle(prefix+"-text-offset").pfValue,lineAngle=function(p0,p1){var dx=p1.x-p0.x,dy=p1.y-p0.y;return Math.atan(dy/dx)},bezierAngle=function(p0,p1,p2,t){var t0=math.bound(0,t-.001,1),t1=math.bound(0,t+.001,1),lp0=math.qbezierPtAt(p0,p1,p2,t0),lp1=math.qbezierPtAt(p0,p1,p2,t1);return lineAngle(lp0,lp1)};switch(rs.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var cps=createControlPointInfo(),selected,startDist=0,totalDist=0,i=0;i<cps.length;i++){for(var cp=cps[isSrc?i:cps.length-1-i],j=0;j<cp.segments.length;j++){var seg=cp.segments[isSrc?j:cp.segments.length-1-j],lastSeg=i===cps.length-1&&j===cp.segments.length-1;if(startDist=totalDist,totalDist+=seg.length,totalDist>=offset||lastSeg){selected={cp:cp,segment:seg};break}}if(selected)break}var cp=selected.cp,seg=selected.segment,tSegment=(offset-startDist)/seg.length,segDt=seg.t1-seg.t0,t=isSrc?seg.t0+segDt*tSegment:seg.t1-segDt*tSegment;t=math.bound(0,t,1),p=math.qbezierPtAt(cp.p0,cp.p1,cp.p2,t),angle=bezierAngle(cp.p0,cp.p1,cp.p2,t,p);break;case"straight":case"segments":case"haystack":for(var d=0,di,d0,p0,p1,l=rs.allpts.length,i=0;i+3<l&&(isSrc?(p0={x:rs.allpts[i],y:rs.allpts[i+1]},p1={x:rs.allpts[i+2],y:rs.allpts[i+3]}):(p0={x:rs.allpts[l-2-i],y:rs.allpts[l-1-i]},p1={x:rs.allpts[l-4-i],y:rs.allpts[l-3-i]}),di=math.dist(p0,p1),d0=d,d+=di,!(d>=offset));i+=2);var pD=offset-d0,t=pD/di;t=math.bound(0,t,1),p=math.lineAt(p0,p1,t),angle=lineAngle(p0,p1)}setRs("labelX",prefix,p.x),setRs("labelY",prefix,p.y),setRs("labelAutoAngle",prefix,angle)}};calculateEndProjection("source"),calculateEndProjection("target"),this.applyLabelDimensions(edge)}},BRp.applyLabelDimensions=function(ele){this.applyPrefixedLabelDimensions(ele),ele.isEdge()&&(this.applyPrefixedLabelDimensions(ele,"source"),this.applyPrefixedLabelDimensions(ele,"target"))},BRp.applyPrefixedLabelDimensions=function(ele,prefix){var _p=ele._private,text=this.getLabelText(ele,prefix),labelDims=this.calculateLabelDimensions(ele,text);util.setPrefixedProperty(_p.rstyle,"labelWidth",prefix,labelDims.width),util.setPrefixedProperty(_p.rscratch,"labelWidth",prefix,labelDims.width),util.setPrefixedProperty(_p.rstyle,"labelHeight",prefix,labelDims.height),util.setPrefixedProperty(_p.rscratch,"labelHeight",prefix,labelDims.height)},BRp.getLabelText=function(ele,prefix){var _p=ele._private,pfd=prefix?prefix+"-":"",text=ele.pstyle(pfd+"label").strValue,textTransform=ele.pstyle("text-transform").value,rscratch=function(propName,value){return value?(util.setPrefixedProperty(_p.rscratch,propName,prefix,value),value):util.getPrefixedProperty(_p.rscratch,propName,prefix)};if("none"==textTransform||("uppercase"==textTransform?text=text.toUpperCase():"lowercase"==textTransform&&(text=text.toLowerCase())),"wrap"===ele.pstyle("text-wrap").value){var labelKey=rscratch("labelKey");if(labelKey&&rscratch("labelWrapKey")===labelKey)return rscratch("labelWrapCachedText");for(var lines=text.split("\n"),maxW=ele.pstyle("text-max-width").pfValue,wrappedLines=[],l=0;l<lines.length;l++){var line=lines[l],lineDims=this.calculateLabelDimensions(ele,line,"line="+line),lineW=lineDims.width;if(lineW>maxW){for(var words=line.split(/\s+/),subline="",w=0;w<words.length;w++){var word=words[w],testLine=0===subline.length?word:subline+" "+word,testDims=this.calculateLabelDimensions(ele,testLine,"testLine="+testLine),testW=testDims.width;testW<=maxW?subline+=word+" ":(wrappedLines.push(subline),subline=word+" ")}subline.match(/^\s+$/)||wrappedLines.push(subline)}else wrappedLines.push(line)}rscratch("labelWrapCachedLines",wrappedLines),text=rscratch("labelWrapCachedText",wrappedLines.join("\n")),rscratch("labelWrapKey",labelKey)}return text},BRp.calculateLabelDimensions=function(ele,text,extraKey){var r=this,cacheKey=ele._private.labelStyleKey+"$@$"+text;extraKey&&(cacheKey+="$@$"+extraKey);var cache=r.labelDimCache||(r.labelDimCache={});if(cache[cacheKey])return cache[cacheKey];var sizeMult=1,fStyle=ele.pstyle("font-style").strValue,size=sizeMult*ele.pstyle("font-size").pfValue+"px",family=ele.pstyle("font-family").strValue,weight=ele.pstyle("font-weight").strValue,div=this.labelCalcDiv;div||(div=this.labelCalcDiv=document.createElement("div"),document.body.appendChild(div));var ds=div.style;return ds.fontFamily=family,ds.fontStyle=fStyle,ds.fontSize=size,ds.fontWeight=weight,ds.position="absolute",ds.left="-9999px",ds.top="-9999px",ds.zIndex="-1",ds.visibility="hidden",ds.pointerEvents="none",ds.padding="0",ds.lineHeight="1","wrap"===ele.pstyle("text-wrap").value?ds.whiteSpace="pre":ds.whiteSpace="normal",div.textContent=text,cache[cacheKey]={width:Math.ceil(div.clientWidth/sizeMult),height:Math.ceil(div.clientHeight/sizeMult)},cache[cacheKey]},BRp.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)},BRp.findEdgeControlPoints=function(edges){if(edges&&0!==edges.length){for(var r=this,cy=r.cy,hasCompounds=cy.hasCompoundNodes(),hashTable={},pairIds=[],haystackEdges=[],pairId,i=0;i<edges.length;i++){var edge=edges[i],_p=edge._private,data=_p.data,curveStyle=edge.pstyle("curve-style").value,edgeIsUnbundled="unbundled-bezier"===curveStyle||"segments"===curveStyle;if("none"!==edge.pstyle("display").value)if("haystack"!==curveStyle){var srcId=data.source,tgtId=data.target;pairId=srcId>tgtId?tgtId+"$-$"+srcId:srcId+"$-$"+tgtId,edgeIsUnbundled&&(pairId="unbundled$-$"+data.id),null==hashTable[pairId]&&(hashTable[pairId]=[],pairIds.push(pairId)),hashTable[pairId].push(edge),edgeIsUnbundled&&(hashTable[pairId].hasUnbundled=!0)}else haystackEdges.push(edge);
}for(var src,tgt,src_p,tgt_p,srcPos,tgtPos,srcW,srcH,tgtW,tgtH,srcShape,tgtShape,vectorNormInverse,badBezier,p=0;p<pairIds.length;p++){pairId=pairIds[p];var pairEdges=hashTable[pairId];if(pairEdges.sort(function(edge1,edge2){return edge1.poolIndex()-edge2.poolIndex()}),src=pairEdges[0]._private.source,tgt=pairEdges[0]._private.target,!pairEdges.hasUnbundled&&src.id()>tgt.id()){var temp=src;src=tgt,tgt=temp}if(src_p=src._private,tgt_p=tgt._private,srcPos=src_p.position,tgtPos=tgt_p.position,srcW=src.outerWidth(),srcH=src.outerHeight(),tgtW=tgt.outerWidth(),tgtH=tgt.outerHeight(),srcShape=r.nodeShapes[this.getNodeShape(src)],tgtShape=r.nodeShapes[this.getNodeShape(tgt)],badBezier=!1,pairEdges.length>1&&src!==tgt||pairEdges.hasUnbundled){var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,0),tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,0),midptSrcPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]},posPts={x1:srcPos.x,x2:tgtPos.x,y1:srcPos.y,y2:tgtPos.y},dy=tgtOutside[1]-srcOutside[1],dx=tgtOutside[0]-srcOutside[0],l=Math.sqrt(dx*dx+dy*dy),vector={x:dx,y:dy},vectorNorm={x:vector.x/l,y:vector.y/l};vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x},tgtShape.checkPoint(srcOutside[0],srcOutside[1],0,tgtW,tgtH,tgtPos.x,tgtPos.y)&&srcShape.checkPoint(tgtOutside[0],tgtOutside[1],0,srcW,srcH,srcPos.x,srcPos.y)&&(vectorNormInverse={},badBezier=!0)}for(var edge,edge_p,rs,i=0;i<pairEdges.length;i++){edge=pairEdges[i],edge_p=edge._private,rs=edge_p.rscratch;var edgeIndex1=rs.lastEdgeIndex,edgeIndex2=i,numEdges1=rs.lastNumEdges,numEdges2=pairEdges.length,curveStyle=edge.pstyle("curve-style").value,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptWs=edge.pstyle("control-point-weights"),bezierN=ctrlptDists&&ctrlptWs?Math.min(ctrlptDists.value.length,ctrlptWs.value.length):1,stepSize=edge.pstyle("control-point-step-size").pfValue,ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,ctrlptWeight=ctrlptWs.value[0],edgeIsUnbundled="unbundled-bezier"===curveStyle||"segments"===curveStyle,edgeDistances=edge.pstyle("edge-distances").value,segmentWs=edge.pstyle("segment-weights"),segmentDs=edge.pstyle("segment-distances"),segmentsN=Math.min(segmentWs.pfValue.length,segmentDs.pfValue.length),srcX1=rs.lastSrcCtlPtX,srcX2=srcPos.x,srcY1=rs.lastSrcCtlPtY,srcY2=srcPos.y,srcW1=rs.lastSrcCtlPtW,srcW2=src.outerWidth(),srcH1=rs.lastSrcCtlPtH,srcH2=src.outerHeight(),tgtX1=rs.lastTgtCtlPtX,tgtX2=tgtPos.x,tgtY1=rs.lastTgtCtlPtY,tgtY2=tgtPos.y,tgtW1=rs.lastTgtCtlPtW,tgtW2=tgt.outerWidth(),tgtH1=rs.lastTgtCtlPtH,tgtH2=tgt.outerHeight(),curveStyle1=rs.lastCurveStyle,curveStyle2=curveStyle,ctrlptDists1=rs.lastCtrlptDists,ctrlptDists2=ctrlptDists?ctrlptDists.strValue:null,ctrlptWs1=rs.lastCtrlptWs,ctrlptWs2=ctrlptWs.strValue,segmentWs1=rs.lastSegmentWs,segmentWs2=segmentWs.strValue,segmentDs1=rs.lastSegmentDs,segmentDs2=segmentDs.strValue,stepSize1=rs.lastStepSize,stepSize2=stepSize,edgeDistances1=rs.lastEdgeDistances,edgeDistances2=edgeDistances;if(badBezier?rs.badBezier=!0:rs.badBezier=!1,srcX1!==srcX2||srcY1!==srcY2||srcW1!==srcW2||srcH1!==srcH2||tgtX1!==tgtX2||tgtY1!==tgtY2||tgtW1!==tgtW2||tgtH1!==tgtH2||curveStyle1!==curveStyle2||ctrlptDists1!==ctrlptDists2||ctrlptWs1!==ctrlptWs2||segmentWs1!==segmentWs2||segmentDs1!==segmentDs2||stepSize1!==stepSize2||edgeDistances1!==edgeDistances2||!(edgeIndex1===edgeIndex2&&numEdges1===numEdges2||edgeIsUnbundled)){if(rs.lastSrcCtlPtX=srcX2,rs.lastSrcCtlPtY=srcY2,rs.lastSrcCtlPtW=srcW2,rs.lastSrcCtlPtH=srcH2,rs.lastTgtCtlPtX=tgtX2,rs.lastTgtCtlPtY=tgtY2,rs.lastTgtCtlPtW=tgtW2,rs.lastTgtCtlPtH=tgtH2,rs.lastEdgeIndex=edgeIndex2,rs.lastNumEdges=numEdges2,rs.lastCurveStyle=curveStyle2,rs.lastCtrlptDists=ctrlptDists2,rs.lastCtrlptWs=ctrlptWs2,rs.lastSegmentDs=segmentDs2,rs.lastSegmentWs=segmentWs2,rs.lastStepSize=stepSize2,rs.lastEdgeDistances=edgeDistances2,src===tgt){rs.edgeType="self";var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist),rs.ctrlpts=[srcPos.x,srcPos.y-(1+Math.pow(srcH,1.12)/100)*loopDist*(j/3+1),srcPos.x-(1+Math.pow(srcW,1.12)/100)*loopDist*(j/3+1),srcPos.y]}else if(hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src))){rs.edgeType="compound",rs.badBezier=!1;var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist);var loopW=50,loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2},loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2},loopPos={x:Math.min(loopaPos.x,loopbPos.x),y:Math.min(loopaPos.y,loopbPos.y)},minCompoundStretch=.5,compoundStretchA=Math.max(minCompoundStretch,Math.log(.01*srcW)),compoundStretchB=Math.max(minCompoundStretch,Math.log(.01*tgtW));rs.ctrlpts=[loopPos.x,loopPos.y-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchA,loopPos.x-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchB,loopPos.y]}else if("segments"===curveStyle){rs.edgeType="segments",rs.segpts=[];for(var s=0;s<segmentsN;s++){var w=segmentWs.pfValue[s],d=segmentDs.pfValue[s],w1=1-w,w2=w,midptPts="node-position"===edgeDistances?posPts:midptSrcPts,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.segpts.push(adjustedMidpt.x+vectorNormInverse.x*d,adjustedMidpt.y+vectorNormInverse.y*d)}}else if(pairEdges.length%2!==1||i!==Math.floor(pairEdges.length/2)||edgeIsUnbundled){var multi=edgeIsUnbundled;rs.edgeType=multi?"multibezier":"bezier",rs.ctrlpts=[];for(var b=0;b<bezierN;b++){var normctrlptDist=(.5-pairEdges.length/2+i)*stepSize,manctrlptDist,sign=math.signum(normctrlptDist);multi&&(ctrlptDist=ctrlptDists?ctrlptDists.pfValue[b]:stepSize,ctrlptWeight=ctrlptWs.value[b]),manctrlptDist=edgeIsUnbundled?ctrlptDist:void 0!==ctrlptDist?sign*ctrlptDist:void 0;var distanceFromMidpoint=void 0!==manctrlptDist?manctrlptDist:normctrlptDist,w1=1-ctrlptWeight,w2=ctrlptWeight,midptPts="node-position"===edgeDistances?posPts:midptSrcPts,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.ctrlpts.push(adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint)}}else rs.edgeType="straight";this.findEndpoints(edge);var badStart=!is.number(rs.startX)||!is.number(rs.startY),badAStart=!is.number(rs.arrowStartX)||!is.number(rs.arrowStartY),badEnd=!is.number(rs.endX)||!is.number(rs.endY),badAEnd=!is.number(rs.arrowEndX)||!is.number(rs.arrowEndY),minCpADistFactor=3,arrowW=this.getArrowWidth(edge.pstyle("width").pfValue)*this.arrowShapeWidth,minCpADist=minCpADistFactor*arrowW;if("bezier"===rs.edgeType){var startACpDist=math.dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.startX,y:rs.startY}),closeStartACp=startACpDist<minCpADist,endACpDist=math.dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.endX,y:rs.endY}),closeEndACp=endACpDist<minCpADist,overlapping=!1;if(badStart||badAStart||closeStartACp){overlapping=!0;var cpD={x:rs.ctrlpts[0]-srcPos.x,y:rs.ctrlpts[1]-srcPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.ctrlpts[0]+2*cpM.x*radius,y:rs.ctrlpts[1]+2*cpM.y*radius},srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,0);closeStartACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-startACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-startACpDist)):(rs.ctrlpts[0]=srcCtrlPtIntn[0]+cpM.x*minCpADist,rs.ctrlpts[1]=srcCtrlPtIntn[1]+cpM.y*minCpADist)}if(badEnd||badAEnd||closeEndACp){overlapping=!0;var cpD={x:rs.ctrlpts[0]-tgtPos.x,y:rs.ctrlpts[1]-tgtPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.ctrlpts[0]+2*cpM.x*radius,y:rs.ctrlpts[1]+2*cpM.y*radius},tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,cpProj.x,cpProj.y,0);closeEndACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-endACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-endACpDist)):(rs.ctrlpts[0]=tgtCtrlPtIntn[0]+cpM.x*minCpADist,rs.ctrlpts[1]=tgtCtrlPtIntn[1]+cpM.y*minCpADist)}overlapping&&this.findEndpoints(edge)}if("multibezier"===rs.edgeType||"bezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType){rs.allpts=[],rs.allpts.push(rs.startX,rs.startY);for(var b=0;b+1<rs.ctrlpts.length;b+=2)rs.allpts.push(rs.ctrlpts[b],rs.ctrlpts[b+1]),b+3<rs.ctrlpts.length&&rs.allpts.push((rs.ctrlpts[b]+rs.ctrlpts[b+2])/2,(rs.ctrlpts[b+1]+rs.ctrlpts[b+3])/2);rs.allpts.push(rs.endX,rs.endY);var m,mt;rs.ctrlpts.length/2%2===0?(m=rs.allpts.length/2-1,rs.midX=rs.allpts[m],rs.midY=rs.allpts[m+1]):(m=rs.allpts.length/2-3,mt=.5,rs.midX=math.qbezierAt(rs.allpts[m],rs.allpts[m+2],rs.allpts[m+4],mt),rs.midY=math.qbezierAt(rs.allpts[m+1],rs.allpts[m+3],rs.allpts[m+5],mt))}else if("straight"===rs.edgeType)rs.allpts=[rs.startX,rs.startY,rs.endX,rs.endY],rs.midX=(rs.startX+rs.endX+rs.arrowStartX+rs.arrowEndX)/4,rs.midY=(rs.startY+rs.endY+rs.arrowStartY+rs.arrowEndY)/4;else if("segments"===rs.edgeType)if(rs.allpts=[],rs.allpts.push(rs.startX,rs.startY),rs.allpts.push.apply(rs.allpts,rs.segpts),rs.allpts.push(rs.endX,rs.endY),rs.segpts.length%4===0){var i2=rs.segpts.length/2,i1=i2-2;rs.midX=(rs.segpts[i1]+rs.segpts[i2])/2,rs.midY=(rs.segpts[i1+1]+rs.segpts[i2+1])/2}else{var i1=rs.segpts.length/2-1;rs.midX=rs.segpts[i1],rs.midY=rs.segpts[i1+1]}this.projectLines(edge),this.calculateArrowAngles(edge),this.recalculateEdgeLabelProjections(edge),this.calculateLabelAngles(edge)}}}for(var i=0;i<haystackEdges.length;i++){var edge=haystackEdges[i],_p=edge._private,rscratch=_p.rscratch,rs=rscratch;if(!rscratch.haystack){var angle=2*Math.random()*Math.PI;rscratch.source={x:Math.cos(angle),y:Math.sin(angle)};var angle=2*Math.random()*Math.PI;rscratch.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source,tgt=_p.target,srcPos=src._private.position,tgtPos=tgt._private.position,srcW=src.width(),tgtW=tgt.width(),srcH=src.height(),tgtH=tgt.height(),radius=edge.pstyle("haystack-radius").value,halfRadius=radius/2;rs.haystackPts=rs.allpts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y],rs.midX=(rs.allpts[0]+rs.allpts[2])/2,rs.midY=(rs.allpts[1]+rs.allpts[3])/2,rscratch.edgeType="haystack",rscratch.haystack=!0,this.projectLines(edge),this.calculateArrowAngles(edge),this.recalculateEdgeLabelProjections(edge),this.calculateLabelAngles(edge)}return hashTable}};var getAngleFromDisp=function(dispX,dispY){return Math.atan2(dispY,dispX)-Math.PI/2};BRp.calculateArrowAngles=function(edge){var rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType,isMultibezier="multibezier"===rs.edgeType,isSegments="segments"===rs.edgeType,isCompound="compound"===rs.edgeType,isSelf="self"===rs.edgeType,dispX,dispY,startX,startY,endX,endY,srcPos=edge._private.source._private.position,tgtPos=edge._private.target._private.position;isHaystack?(startX=rs.haystackPts[0],startY=rs.haystackPts[1],endX=rs.haystackPts[2],endY=rs.haystackPts[3]):(startX=rs.arrowStartX,startY=rs.arrowStartY,endX=rs.arrowEndX,endY=rs.arrowEndY),dispX=srcPos.x-startX,dispY=srcPos.y-startY,rs.srcArrowAngle=getAngleFromDisp(dispX,dispY);var midX=rs.midX,midY=rs.midY;if(isHaystack&&(midX=(startX+endX)/2,midY=(startY+endY)/2),dispX=endX-startX,dispY=endY-startY,isSelf)dispX=-1,dispY=1;else if(isSegments){var pts=rs.allpts;if(pts.length/2%2===0){var i2=pts.length/2,i1=i2-2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}else{var i2=pts.length/2-1,i1=i2-2,i3=i2+2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}}else if(isMultibezier||isCompound){var pts=rs.allpts,cpts=rs.ctrlpts,bp0x,bp0y,bp1x,bp1y;if(cpts.length/2%2===0){var p0=pts.length/2-1,ic=p0+2,p1=ic+2;bp0x=math.qbezierAt(pts[p0],pts[ic],pts[p1],0),bp0y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],0),bp1x=math.qbezierAt(pts[p0],pts[ic],pts[p1],1e-4),bp1y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],1e-4)}else{var ic=pts.length/2-1,p0=ic-2,p1=ic+2;bp0x=math.qbezierAt(pts[p0],pts[ic],pts[p1],.4999),bp0y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.4999),bp1x=math.qbezierAt(pts[p0],pts[ic],pts[p1],.5),bp1y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.5)}dispX=bp1x-bp0x,dispY=bp1y-bp0y}if(rs.midtgtArrowAngle=getAngleFromDisp(dispX,dispY),rs.midDispX=dispX,rs.midDispY=dispY,dispX*=-1,dispY*=-1,isSegments){var pts=rs.allpts;if(pts.length/2%2===0);else{var i2=pts.length/2-1,i3=i2+2;dispX=-(pts[i3]-pts[i2]),dispY=-(pts[i3+1]-pts[i2+1])}}rs.midsrcArrowAngle=getAngleFromDisp(dispX,dispY),dispX=tgtPos.x-endX,dispY=tgtPos.y-endY,rs.tgtArrowAngle=getAngleFromDisp(dispX,dispY)},BRp.calculateLabelAngles=function(ele){var _p=ele._private,rs=_p.rscratch,isEdge=ele.isEdge(),rot=ele.pstyle("text-rotation"),rotStr=rot.strValue;"none"===rotStr?rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=0:isEdge&&"autorotate"===rotStr?(rs.labelAngle=Math.atan(rs.midDispY/rs.midDispX),rs.sourceLabelAngle=rs.sourceLabelAutoAngle,rs.targetLabelAngle=rs.targetLabelAutoAngle):"autorotate"===rotStr?rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=0:rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=rot.pfValue},BRp.findEndpoints=function(edge){var r=this,intersect,source=edge.source()[0],target=edge.target()[0],src_p=source._private,tgt_p=target._private,srcPos=src_p.position,tgtPos=tgt_p.position,tgtArShape=edge.pstyle("target-arrow-shape").value,srcArShape=edge.pstyle("source-arrow-shape").value,rs=edge._private.rscratch,et=rs.edgeType,bezier="bezier"===et||"multibezier"===et||"self"===et||"compound"===et,multi="bezier"!==et,lines="straight"===et||"segments"===et,segments="segments"===et,hasEndpts=bezier||multi||lines,p1,p2;if(bezier){var cpStart=[rs.ctrlpts[0],rs.ctrlpts[1]],cpEnd=multi?[rs.ctrlpts[rs.ctrlpts.length-2],rs.ctrlpts[rs.ctrlpts.length-1]]:cpStart;p1=cpEnd,p2=cpStart}else if(lines){var srcArrowFromPt=segments?rs.segpts.slice(0,2):[tgtPos.x,tgtPos.y],tgtArrowFromPt=segments?rs.segpts.slice(rs.segpts.length-2):[srcPos.x,srcPos.y];p1=tgtArrowFromPt,p2=srcArrowFromPt}intersect=r.nodeShapes[this.getNodeShape(target)].intersectLine(tgtPos.x,tgtPos.y,target.outerWidth(),target.outerHeight(),p1[0],p1[1],0);var arrowEnd=math.shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].spacing(edge)),edgeEnd=math.shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].gap(edge));rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1],intersect=r.nodeShapes[this.getNodeShape(source)].intersectLine(srcPos.x,srcPos.y,source.outerWidth(),source.outerHeight(),p2[0],p2[1],0);var arrowStart=math.shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].spacing(edge)),edgeStart=math.shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].gap(edge));rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1],hasEndpts&&(is.number(rs.startX)&&is.number(rs.startY)&&is.number(rs.endX)&&is.number(rs.endY)?rs.badLine=!1:rs.badLine=!0)},BRp.getArrowWidth=BRp.getArrowHeight=function(edgeWidth){var cache=this.arrowWidthCache=this.arrowWidthCache||{},cachedVal=cache[edgeWidth];return cachedVal?cachedVal:(cachedVal=Math.max(Math.pow(13.37*edgeWidth,.9),29),cache[edgeWidth]=cachedVal,cachedVal)},module.exports=BRp},{"../../../collection/zsort":32,"../../../is":83,"../../../math":85,"../../../util":100,"../../../window":107}],59:[function(_dereq_,module,exports){"use strict";var BRp={};BRp.getCachedImage=function(url,crossOrigin,onLoad){var r=this,imageCache=r.imageCache=r.imageCache||{},cache=imageCache[url];if(cache)return cache.image.complete||cache.image.addEventListener("load",onLoad),cache.image;cache=imageCache[url]=imageCache[url]||{};var image=cache.image=new Image;image.addEventListener("load",onLoad);var dataUriPrefix="data:",isDataUri=url.substring(0,dataUriPrefix.length).toLowerCase()===dataUriPrefix;return isDataUri||(image.crossOrigin=crossOrigin),image.src=url,image},module.exports=BRp},{}],60:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../../is"),util=_dereq_("../../../util"),BaseRenderer=function(options){this.init(options)},BR=BaseRenderer,BRp=BR.prototype;BRp.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],BRp.init=function(options){var r=this;r.options=options,r.cy=options.cy,r.container=options.cy.container(),r.selection=[void 0,void 0,void 0,void 0,0],r.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],r.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},r.dragData={possibleDragElements:[]},r.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},r.redraws=0,r.showFps=options.showFps,r.hideEdgesOnViewport=options.hideEdgesOnViewport,r.hideLabelsOnViewport=options.hideLabelsOnViewport,r.textureOnViewport=options.textureOnViewport,r.wheelSensitivity=options.wheelSensitivity,r.motionBlurEnabled=options.motionBlur,r.forcedPixelRatio=options.pixelRatio,r.motionBlur=options.motionBlur,r.motionBlurOpacity=options.motionBlurOpacity,r.motionBlurTransparency=1-r.motionBlurOpacity,r.motionBlurPxRatio=1,r.mbPxRBlurry=1,r.minMbLowQualFrames=4,r.fullQualityMb=!1,r.clearedForMotionBlur=[],r.desktopTapThreshold=options.desktopTapThreshold,r.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold,r.touchTapThreshold=options.touchTapThreshold,r.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold,r.tapholdDuration=500,r.bindings=[],r.beforeRenderCallbacks=[],r.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:100},r.registerNodeShapes(),r.registerArrowShapes(),r.registerCalculationListeners(),r.load()},BRp.notify=function(params){var types,r=this;if(!this.destroyed){types=is.array(params.type)?params.type:[params.type];for(var has={},i=0;i<types.length;i++){var type=types[i];has[type]=!0}if(has.destroy)return void r.destroy();(has.add||has.remove||has.load||has.style)&&r.updateCachedZSortedEles(),has.viewport&&r.redrawHint("select",!0),(has.load||has.resize)&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}},BRp.destroy=function(){var r=this;r.destroyed=!0,r.cy.stopAnimationLoop();for(var i=0;i<r.bindings.length;i++){var binding=r.bindings[i],b=binding,tgt=b.target;(tgt.off||tgt.removeEventListener).apply(tgt,b.args)}if(r.bindings=[],r.beforeRenderCallbacks=[],r.onUpdateEleCalcsFns=[],r.removeObserver&&r.removeObserver.disconnect(),r.styleObserver&&r.styleObserver.disconnect(),r.labelCalcDiv)try{document.body.removeChild(r.labelCalcDiv)}catch(e){}},[_dereq_("./arrow-shapes"),_dereq_("./coord-ele-math"),_dereq_("./images"),_dereq_("./load-listeners"),_dereq_("./node-shapes"),_dereq_("./redraw")].forEach(function(props){util.extend(BRp,props)}),module.exports=BR},{"../../../is":83,"../../../util":100,"./arrow-shapes":57,"./coord-ele-math":58,"./images":59,"./load-listeners":61,"./node-shapes":62,"./redraw":63}],61:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../../is"),util=_dereq_("../../../util"),math=_dereq_("../../../math"),Event=_dereq_("../../../event"),BRp={};BRp.registerBinding=function(target,event,handler,useCapture){var args=Array.prototype.slice.apply(arguments,[1]),b=this.binder(target);return b.on.apply(b,args)},BRp.binder=function(tgt){var r=this,tgtIsDom=tgt===window||tgt===document||tgt===document.body||is.domElement(tgt);if(null==r.supportsPassiveEvents){var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("test",null,opts)}catch(err){}r.supportsPassiveEvents=supportsPassive}var on=function(event,handler,useCapture){var args=Array.prototype.slice.call(arguments);return tgtIsDom&&r.supportsPassiveEvents&&(args[2]={capture:null!=useCapture&&useCapture,passive:!1,once:!1}),r.bindings.push({target:tgt,args:args}),(tgt.addEventListener||tgt.on).apply(tgt,args),this};return{on:on,addEventListener:on,addListener:on,bind:on}},BRp.nodeIsDraggable=function(node){return node&&node.isNode()&&!node.locked()&&node.grabbable()},BRp.nodeIsGrabbable=function(node){return this.nodeIsDraggable(node)&&0!==node.pstyle("opacity").value&&"visible"===node.pstyle("visibility").value&&"element"===node.pstyle("display").value},BRp.load=function(){var r=this,triggerEvents=function(target,names,e,props){null==target&&(target=r.cy);for(var i=0;i<names.length;i++){var name=names[i],event=new Event(e,util.extend({type:name},props));target.trigger(event)}},isMultSelKeyDown=function(e){return e.shiftKey||e.metaKey||e.ctrlKey},allowPanningPassthrough=function(down,downs){var allowPassthrough=!0;if(r.cy.hasCompoundNodes()&&down&&down.isEdge())for(var i=0;downs&&i<downs.length;i++){var down=downs[i];if(down.isNode()&&down.isParent()){allowPassthrough=!1;break}}else allowPassthrough=!0;return allowPassthrough},getDragListIds=function(opts){var listHasId;if(opts.addToList&&r.cy.hasCompoundNodes()){if(!opts.addToList.hasId){opts.addToList.hasId={};for(var i=0;i<opts.addToList.length;i++){var ele=opts.addToList[i];opts.addToList.hasId[ele.id()]=!0}}listHasId=opts.addToList.hasId}return listHasId||{}},setGrabbed=function(ele){ele[0]._private.grabbed=!0},setFreed=function(ele){ele[0]._private.grabbed=!1},setInDragLayer=function(ele){ele[0]._private.rscratch.inDragLayer=!0},setOutDragLayer=function(ele){ele[0]._private.rscratch.inDragLayer=!1},setGrabTarget=function(ele){ele[0]._private.rscratch.isGrabTarget=!0},removeGrabTarget=function(ele){ele[0]._private.rscratch.isGrabTarget=!1},addToDragList=function(ele,opts){var listHasId=getDragListIds(opts);listHasId[ele.id()]||(opts.addToList.push(ele),listHasId[ele.id()]=!0,setGrabbed(ele))},addDescendantsToDrag=function(node,opts){if(node.cy().hasCompoundNodes()&&(null!=opts.inDragLayer||null!=opts.addToList)){var innerNodes=node.descendants();opts.inDragLayer&&(innerNodes.forEach(setInDragLayer),innerNodes.connectedEdges().forEach(setInDragLayer)),opts.addToList&&innerNodes.forEach(function(ele){addToDragList(ele,opts)})}},addNodesToDrag=function(nodes,opts){opts=opts||{};var hasCompoundNodes=nodes.cy().hasCompoundNodes();opts.inDragLayer&&(nodes.forEach(setInDragLayer),nodes.neighborhood().stdFilter(function(ele){return!hasCompoundNodes||ele.isEdge()}).forEach(setInDragLayer)),opts.addToList&&nodes.forEach(function(ele){addToDragList(ele,opts)}),addDescendantsToDrag(nodes,opts),updateAncestorsInDragLayer(nodes,{inDragLayer:opts.inDragLayer}),r.updateCachedGrabbedEles()},addNodeToDrag=addNodesToDrag,freeDraggedElements=function(grabbedEles){grabbedEles&&(grabbedEles.hasId={},r.getCachedZSortedEles().forEach(function(ele){setFreed(ele),setOutDragLayer(ele),removeGrabTarget(ele)}),r.updateCachedGrabbedEles())},updateAncestorsInDragLayer=function(node,opts){if((null!=opts.inDragLayer||null!=opts.addToList)&&node.cy().hasCompoundNodes()){var parent=node.ancestors().orphans();if(!parent.same(node)){var nodes=parent.descendants().spawnSelf().merge(parent).unmerge(node).unmerge(node.descendants()),edges=nodes.connectedEdges();opts.inDragLayer&&(edges.forEach(setInDragLayer),nodes.forEach(setInDragLayer)),opts.addToList&&nodes.forEach(function(ele){addToDragList(ele,opts)})}}},haveMutationsApi="undefined"!=typeof MutationObserver;haveMutationsApi?(r.removeObserver=new MutationObserver(function(mutns){for(var i=0;i<mutns.length;i++){var mutn=mutns[i],rNodes=mutn.removedNodes;if(rNodes)for(var j=0;j<rNodes.length;j++){var rNode=rNodes[j];if(rNode===r.container){r.destroy();break}}}}),r.container.parentNode&&r.removeObserver.observe(r.container.parentNode,{childList:!0})):r.registerBinding(r.container,"DOMNodeRemoved",function(e){r.destroy()});var onResize=util.debounce(function(){r.cy.invalidateSize(),r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container),r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},100);haveMutationsApi&&(r.styleObserver=new MutationObserver(onResize),r.styleObserver.observe(r.container,{attributes:!0})),r.registerBinding(window,"resize",onResize);for(var invalCtnrBBOnScroll=function(domEle){r.registerBinding(domEle,"scroll",function(e){r.invalidateContainerClientCoordsCache()})},bbCtnr=r.cy.container();invalCtnrBBOnScroll(bbCtnr),bbCtnr.parentNode;)bbCtnr=bbCtnr.parentNode;r.registerBinding(r.container,"contextmenu",function(e){e.preventDefault()});var inBoxSelection=function(){return 0!==r.selection[4]},eventInContainer=function(e){for(var containerPageCoords=r.findContainerClientCoords(),x=containerPageCoords[0],y=containerPageCoords[1],width=containerPageCoords[2],height=containerPageCoords[3],positions=e.touches?e.touches:[e],atLeastOnePosInside=!1,i=0;i<positions.length;i++){var p=positions[i];if(x<=p.clientX&&p.clientX<=x+width&&y<=p.clientY&&p.clientY<=y+height){atLeastOnePosInside=!0;break}}if(!atLeastOnePosInside)return!1;for(var container=r.container,target=e.target,tParent=target.parentNode,containerIsTarget=!1;tParent;){if(tParent===container){containerIsTarget=!0;break}tParent=tParent.parentNode}return!!containerIsTarget};r.registerBinding(r.container,"mousedown",function mousedownHandler(e){if(eventInContainer(e)){e.preventDefault(),r.hoverData.capture=!0,r.hoverData.which=e.which;var cy=r.cy,gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),select=r.selection,nears=r.findNearestElements(pos[0],pos[1],!0,!1),near=nears[0],draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos,r.hoverData.mdownGPos=gpos;var checkForTaphold=function(){r.hoverData.tapholdCancelled=!1,clearTimeout(r.hoverData.tapholdTimeout),r.hoverData.tapholdTimeout=setTimeout(function(){if(!r.hoverData.tapholdCancelled){var ele=r.hoverData.down;ele?ele.trigger(new Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}})):cy.trigger(new Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}}))}},r.tapholdDuration)};if(3==e.which){r.hoverData.cxtStarted=!0;var cxtEvt=new Event(e,{type:"cxttapstart",cyPosition:{x:pos[0],y:pos[1]}});near?(near.activate(),near.trigger(cxtEvt),r.hoverData.down=near):cy.trigger(cxtEvt),r.hoverData.downTime=(new Date).getTime(),r.hoverData.cxtDragged=!1}else if(1==e.which){if(near&&near.activate(),null!=near&&r.nodeIsGrabbable(near)){var grabEvent=new Event(e,{type:"grab",cyPosition:{x:pos[0],y:pos[1]}});if(setGrabTarget(near),near.selected()){if(near.selected()){draggedElements=r.dragData.possibleDragElements=[];var selectedNodes=cy.$(function(){return this.isNode()&&this.selected()&&r.nodeIsGrabbable(this)});addNodesToDrag(selectedNodes,{addToList:draggedElements}),near.trigger(grabEvent)}}else draggedElements=r.dragData.possibleDragElements=[],addNodeToDrag(near,{addToList:draggedElements}),near.trigger(grabEvent);r.redrawHint("eles",!0),r.redrawHint("drag",!0)}r.hoverData.down=near,r.hoverData.downs=nears,r.hoverData.downTime=(new Date).getTime(),triggerEvents(near,["mousedown","tapstart","vmousedown"],e,{cyPosition:{x:pos[0],y:pos[1]}}),null==near?(select[4]=1,r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()):near.isEdge()&&(select[4]=1),checkForTaphold()}select[0]=select[2]=pos[0],select[1]=select[3]=pos[1]}},!1),r.registerBinding(window,"mousemove",function mousemoveHandler(e){var capture=r.hoverData.capture;if(capture||eventInContainer(e)){var preventDefault=!1,cy=r.cy,zoom=cy.zoom(),gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),mdownPos=r.hoverData.mdownPos,mdownGPos=r.hoverData.mdownGPos,select=r.selection,near=null;r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.selecting||(near=r.findNearestElement(pos[0],pos[1],!0,!1));var last=r.hoverData.last,down=r.hoverData.down,disp=[pos[0]-select[2],pos[1]-select[3]],draggedElements=r.dragData.possibleDragElements,isOverThresholdDrag;if(mdownGPos){var dx=gpos[0]-mdownGPos[0],dx2=dx*dx,dy=gpos[1]-mdownGPos[1],dy2=dy*dy,dist2=dx2+dy2;isOverThresholdDrag=dist2>=r.desktopTapThreshold2}var multSelKeyDown=isMultSelKeyDown(e);isOverThresholdDrag&&(r.hoverData.tapholdCancelled=!0);var updateDragDelta=function(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])};if(preventDefault=!0,triggerEvents(near,["mousemove","vmousemove","tapdrag"],e,{cyPosition:{x:pos[0],y:pos[1]}}),3===r.hoverData.which){if(isOverThresholdDrag){var cxtEvt=new Event(e,{type:"cxtdrag",cyPosition:{x:pos[0],y:pos[1]}});down?down.trigger(cxtEvt):cy.trigger(cxtEvt),r.hoverData.cxtDragged=!0,r.hoverData.cxtOver&&near===r.hoverData.cxtOver||(r.hoverData.cxtOver&&r.hoverData.cxtOver.trigger(new Event(e,{type:"cxtdragout",cyPosition:{x:pos[0],y:pos[1]}})),r.hoverData.cxtOver=near,near&&near.trigger(new Event(e,{type:"cxtdragover",cyPosition:{x:pos[0],y:pos[1]}})))}}else if(r.hoverData.dragging){if(preventDefault=!0,cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom},r.hoverData.justStartedPan=!1}else deltaP={x:disp[0]*zoom,y:disp[1]*zoom};cy.panBy(deltaP),r.hoverData.dragged=!0}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(1!=select[4]||null!=down&&!down.isEdge()){if(down&&down.isEdge()&&down.active()&&down.unactivate(),down&&down.grabbed()||near==last||(last&&triggerEvents(last,["mouseout","tapdragout"],e,{cyPosition:{x:pos[0],y:pos[1]}}),near&&triggerEvents(near,["mouseover","tapdragover"],e,{cyPosition:{x:pos[0],y:pos[1]}}),r.hoverData.last=near),down&&r.nodeIsDraggable(down))if(isOverThresholdDrag){var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&r.redrawHint("eles",!0),r.dragData.didDrag=!0;var toTrigger=[];r.hoverData.draggingEles||addNodesToDrag(cy.collection(draggedElements),{inDragLayer:!0});for(var i=0;i<draggedElements.length;i++){var dEle=draggedElements[i];if(r.nodeIsDraggable(dEle)&&dEle.grabbed()){var dPos=dEle._private.position;if(toTrigger.push(dEle),is.number(disp[0])&&is.number(disp[1])){var updatePos=!dEle.isParent();if(updatePos&&(dPos.x+=disp[0],dPos.y+=disp[1]),justStartedDrag){var dragDelta=r.hoverData.dragDelta;updatePos&&dragDelta&&is.number(dragDelta[0])&&is.number(dragDelta[1])&&(dPos.x+=dragDelta[0],dPos.y+=dragDelta[1])}}}}r.hoverData.draggingEles=!0;var tcol=cy.collection(toTrigger);tcol.updateCompoundBounds(),tcol.trigger("position drag"),r.redrawHint("drag",!0),r.redraw()}else updateDragDelta();preventDefault=!0}else if(isOverThresholdDrag){if(r.hoverData.dragging||!cy.boxSelectionEnabled()||!multSelKeyDown&&cy.panningEnabled()&&cy.userPanningEnabled()){if(!r.hoverData.selecting&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(down,r.hoverData.downs);allowPassthrough&&(r.hoverData.dragging=!0,r.hoverData.justStartedPan=!0,select[4]=0,r.data.bgActivePosistion=math.array2point(mdownPos),r.redrawHint("select",!0),r.redraw())}}else r.data.bgActivePosistion=void 0,r.hoverData.selecting||cy.trigger("boxstart"),r.hoverData.selecting=!0,r.redrawHint("select",!0),r.redraw();down&&down.isEdge()&&down.active()&&down.unactivate()}return select[2]=pos[0],select[3]=pos[1],preventDefault?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1):void 0}},!1),r.registerBinding(window,"mouseup",function mouseupHandler(e){var capture=r.hoverData.capture;if(capture){r.hoverData.capture=!1;var cy=r.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.selection,near=r.findNearestElement(pos[0],pos[1],!0,!1),draggedElements=r.dragData.possibleDragElements,down=r.hoverData.down,multSelKeyDown=isMultSelKeyDown(e);if(r.data.bgActivePosistion&&(r.redrawHint("select",!0),r.redraw()),r.hoverData.tapholdCancelled=!0,r.data.bgActivePosistion=void 0,down&&down.unactivate(),3===r.hoverData.which){
var cxtEvt=new Event(e,{type:"cxttapend",cyPosition:{x:pos[0],y:pos[1]}});if(down?down.trigger(cxtEvt):cy.trigger(cxtEvt),!r.hoverData.cxtDragged){var cxtTap=new Event(e,{type:"cxttap",cyPosition:{x:pos[0],y:pos[1]}});down?down.trigger(cxtTap):cy.trigger(cxtTap)}r.hoverData.cxtDragged=!1,r.hoverData.which=null}else if(1===r.hoverData.which){if(null!=down||r.dragData.didDrag||r.hoverData.selecting||r.hoverData.dragged||isMultSelKeyDown(e)||(cy.$(function(){return this.selected()}).unselect(),draggedElements.length>0&&r.redrawHint("eles",!0),r.dragData.possibleDragElements=draggedElements=[]),triggerEvents(near,["mouseup","tapend","vmouseup"],e,{cyPosition:{x:pos[0],y:pos[1]}}),r.dragData.didDrag||r.hoverData.dragged||r.hoverData.selecting||triggerEvents(down,["click","tap","vclick"],e,{cyPosition:{x:pos[0],y:pos[1]}}),near!=down||r.dragData.didDrag||r.hoverData.selecting||null!=near&&near._private.selectable&&(r.hoverData.dragging||("additive"===cy.selectionType()||multSelKeyDown?near.selected()?near.unselect():near.select():multSelKeyDown||(cy.$(":selected").unmerge(near).unselect(),near.select())),r.redrawHint("eles",!0)),r.hoverData.selecting){var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));r.redrawHint("select",!0),box.length>0&&r.redrawHint("eles",!0),cy.trigger("boxend");var eleWouldBeSelected=function(ele){return ele.selectable()&&!ele.selected()};"additive"===cy.selectionType()?box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect"):(multSelKeyDown||cy.$(":selected").unmerge(box).unselect(),box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect")),r.redraw()}if(r.hoverData.dragging&&(r.hoverData.dragging=!1,r.redrawHint("select",!0),r.redrawHint("eles",!0),r.redraw()),!select[4]){r.redrawHint("drag",!0),r.redrawHint("eles",!0);var downWasGrabbed=down&&down.grabbed();freeDraggedElements(draggedElements),downWasGrabbed&&down.trigger("free")}}select[4]=0,r.hoverData.down=null,r.hoverData.cxtStarted=!1,r.hoverData.draggingEles=!1,r.hoverData.selecting=!1,r.dragData.didDrag=!1,r.hoverData.dragged=!1,r.hoverData.dragDelta=[],r.hoverData.mdownPos=null,r.hoverData.mdownGPos=null}},!1);var wheelHandler=function(e){if(!r.scrollingPage){var cy=r.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),rpos=[pos[0]*cy.zoom()+cy.pan().x,pos[1]*cy.zoom()+cy.pan().y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||inBoxSelection())return void e.preventDefault();if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){e.preventDefault(),r.data.wheelZooming=!0,clearTimeout(r.data.wheelTimeout),r.data.wheelTimeout=setTimeout(function(){r.data.wheelZooming=!1,r.redrawHint("eles",!0),r.redraw()},150);var diff;diff=null!=e.deltaY?e.deltaY/-250:null!=e.wheelDeltaY?e.wheelDeltaY/1e3:e.wheelDelta/1e3,diff*=r.wheelSensitivity;var needsWheelFix=1===e.deltaMode;needsWheelFix&&(diff*=33),cy.zoom({level:cy.zoom()*Math.pow(10,diff),renderedPosition:{x:rpos[0],y:rpos[1]}})}}};r.registerBinding(r.container,"wheel",wheelHandler,!0),r.registerBinding(window,"scroll",function scrollHandler(e){r.scrollingPage=!0,clearTimeout(r.scrollingPageTimeout),r.scrollingPageTimeout=setTimeout(function(){r.scrollingPage=!1},250)},!0),r.registerBinding(r.container,"mouseout",function mouseOutHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.trigger(new Event(e,{type:"mouseout",cyPosition:{x:pos[0],y:pos[1]}}))},!1),r.registerBinding(r.container,"mouseover",function mouseOverHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.trigger(new Event(e,{type:"mouseover",cyPosition:{x:pos[0],y:pos[1]}}))},!1);var f1x1,f1y1,f2x1,f2y1,distance1,distance1Sq,center1,modelCenter1,offsetLeft,offsetTop,containerWidth,containerHeight,twoFingersStartInside,distance=function(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))},distanceSq=function(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)},touchstartHandler;r.registerBinding(r.container,"touchstart",touchstartHandler=function(e){if(eventInContainer(e)){r.touchData.capture=!0,r.data.bgActivePosistion=void 0;var cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}if(e.touches[1]){freeDraggedElements(r.dragData.touchDragEles);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0],offsetTop=offsets[1],containerWidth=offsets[2],containerHeight=offsets[3],f1x1=e.touches[0].clientX-offsetLeft,f1y1=e.touches[0].clientY-offsetTop,f2x1=e.touches[1].clientX-offsetLeft,f2y1=e.touches[1].clientY-offsetTop,twoFingersStartInside=0<=f1x1&&f1x1<=containerWidth&&0<=f2x1&&f2x1<=containerWidth&&0<=f1y1&&f1y1<=containerHeight&&0<=f2y1&&f2y1<=containerHeight;var pan=cy.pan(),zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1),distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1),center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2],modelCenter1=[(center1[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];var cxtDistThreshold=200,cxtDistThresholdSq=cxtDistThreshold*cxtDistThreshold;if(distance1Sq<cxtDistThresholdSq&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],!0,!0),near2=r.findNearestElement(now[2],now[3],!0,!0);return near1&&near1.isNode()?(near1.activate().trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start=near1):near2&&near2.isNode()?(near2.activate().trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start=near2):cy.trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!0,r.touchData.cxtDragged=!1,r.data.bgActivePosistion=void 0,void r.redraw()}}if(e.touches[2]);else if(e.touches[1]);else if(e.touches[0]){var nears=r.findNearestElements(now[0],now[1],!0,!0),near=nears[0];if(null!=near&&(near.activate(),r.touchData.start=near,r.touchData.starts=nears,r.nodeIsGrabbable(near))){var draggedEles=r.dragData.touchDragEles=[];if(r.redrawHint("eles",!0),r.redrawHint("drag",!0),near.selected()){var selectedNodes=cy.$(function(){return this.selected()&&r.nodeIsGrabbable(this)});addNodesToDrag(selectedNodes,{addToList:draggedEles})}else addNodeToDrag(near,{addToList:draggedEles});setGrabTarget(near),near.trigger(new Event(e,{type:"grab",cyPosition:{x:now[0],y:now[1]}}))}triggerEvents(near,["touchstart","tapstart","vmousedown"],e,{cyPosition:{x:now[0],y:now[1]}}),null==near&&(r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()),r.touchData.singleTouchMoved=!1,r.touchData.singleTouchStartTime=+new Date,clearTimeout(r.touchData.tapholdTimeout),r.touchData.tapholdTimeout=setTimeout(function(){r.touchData.singleTouchMoved!==!1||r.pinching||r.touchData.selecting||(triggerEvents(r.touchData.start,["taphold"],e,{cyPosition:{x:now[0],y:now[1]}}),r.touchData.start||cy.$(":selected").unselect())},r.tapholdDuration)}if(e.touches.length>=1){for(var sPos=r.touchData.startPosition=[],i=0;i<now.length;i++)sPos[i]=earlier[i]=now[i];var touch0=e.touches[0];r.touchData.startGPosition=[touch0.clientX,touch0.clientY]}}},!1);var touchmoveHandler;r.registerBinding(window,"touchmove",touchmoveHandler=function(e){var capture=r.touchData.capture;if(capture||eventInContainer(e)){var select=r.selection,cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier,zoom=cy.zoom();if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}var startGPos=r.touchData.startGPosition,isOverThresholdDrag;if(capture&&e.touches[0]&&startGPos){for(var disp=[],j=0;j<now.length;j++)disp[j]=now[j]-earlier[j];var dx=e.touches[0].clientX-startGPos[0],dx2=dx*dx,dy=e.touches[0].clientY-startGPos[1],dy2=dy*dy,dist2=dx2+dy2;isOverThresholdDrag=dist2>=r.touchTapThreshold2}if(capture&&r.touchData.cxt){e.preventDefault();var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2),factorSq=distance2Sq/distance1Sq,distThreshold=150,distThresholdSq=distThreshold*distThreshold,factorThreshold=1.5,factorThresholdSq=factorThreshold*factorThreshold;if(factorSq>=factorThresholdSq||distance2Sq>=distThresholdSq){r.touchData.cxt=!1,r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var cxtEvt=new Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}});r.touchData.start?(r.touchData.start.unactivate().trigger(cxtEvt),r.touchData.start=null):cy.trigger(cxtEvt)}}if(capture&&r.touchData.cxt){var cxtEvt=new Event(e,{type:"cxtdrag",cyPosition:{x:now[0],y:now[1]}});r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.touchData.start?r.touchData.start.trigger(cxtEvt):cy.trigger(cxtEvt),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxtDragged=!0;var near=r.findNearestElement(now[0],now[1],!0,!0);r.touchData.cxtOver&&near===r.touchData.cxtOver||(r.touchData.cxtOver&&r.touchData.cxtOver.trigger(new Event(e,{type:"cxtdragout",cyPosition:{x:now[0],y:now[1]}})),r.touchData.cxtOver=near,near&&near.trigger(new Event(e,{type:"cxtdragover",cyPosition:{x:now[0],y:now[1]}})))}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled())e.preventDefault(),r.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,r.touchData.selecting||cy.trigger("boxstart"),r.touchData.selecting=!0,r.redrawHint("select",!0),select&&0!==select.length&&void 0!==select[0]?(select[2]=(now[0]+now[2]+now[4])/3,select[3]=(now[1]+now[3]+now[5])/3):(select[0]=(now[0]+now[2]+now[4])/3,select[1]=(now[1]+now[3]+now[5])/3,select[2]=(now[0]+now[2]+now[4])/3+1,select[3]=(now[1]+now[3]+now[5])/3+1),select[4]=1,r.touchData.selecting=!0,r.redraw();else if(capture&&e.touches[1]&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){e.preventDefault(),r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var draggedEles=r.dragData.touchDragEles;if(draggedEles){r.redrawHint("drag",!0);for(var i=0;i<draggedEles.length;i++){var de_p=draggedEles[i]._private;de_p.grabbed=!1,de_p.rscratch.inDragLayer=!1}}var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2=distance(f1x2,f1y2,f2x2,f2y2),factor=distance2/distance1;if(twoFingersStartInside){var df1x=f1x2-f1x1,df1y=f1y2-f1y1,df2x=f2x2-f2x1,df2y=f2y2-f2y1,tx=(df1x+df2x)/2,ty=(df1y+df2y)/2,zoom1=cy.zoom(),zoom2=zoom1*factor,pan1=cy.pan(),ctrx=modelCenter1[0]*zoom1+pan1.x,ctry=modelCenter1[1]*zoom1+pan1.y,pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(r.touchData.start&&r.touchData.start.active()){var draggedEles=r.dragData.touchDragEles;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),r.touchData.start.unactivate().trigger("free")}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:!0}),distance1=distance2,f1x1=f1x2,f1y1=f1y2,f2x1=f2x2,f2y1=f2y2,r.pinching=!0}if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}}else if(e.touches[0]){var start=r.touchData.start,last=r.touchData.last,near;if(r.hoverData.draggingEles||r.swipePanning||(near=r.findNearestElement(now[0],now[1],!0,!0)),capture&&null!=start&&e.preventDefault(),capture&&null!=start&&r.nodeIsDraggable(start))if(isOverThresholdDrag){var draggedEles=r.dragData.touchDragEles,justStartedDrag=!r.dragData.didDrag;justStartedDrag&&addNodesToDrag(cy.collection(draggedEles),{inDragLayer:!0});for(var k=0;k<draggedEles.length;k++){var draggedEle=draggedEles[k];if(r.nodeIsDraggable(draggedEle)&&draggedEle.grabbed()){r.dragData.didDrag=!0;var dPos=draggedEle._private.position,updatePos=!draggedEle.isParent();if(updatePos&&is.number(disp[0])&&is.number(disp[1])&&(dPos.x+=disp[0],dPos.y+=disp[1]),justStartedDrag){r.redrawHint("eles",!0);var dragDelta=r.touchData.dragDelta;updatePos&&dragDelta&&is.number(dragDelta[0])&&is.number(dragDelta[1])&&(dPos.x+=dragDelta[0],dPos.y+=dragDelta[1])}}}var tcol=cy.collection(draggedEles);tcol.updateCompoundBounds(),tcol.trigger("position drag"),r.hoverData.draggingEles=!0,r.redrawHint("drag",!0),r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]&&r.redrawHint("eles",!0),r.redraw()}else{var dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}if(triggerEvents(start||near,["touchmove","tapdrag","vmousemove"],e,{cyPosition:{x:now[0],y:now[1]}}),start&&start.grabbed()||near==last||(last&&last.trigger(new Event(e,{type:"tapdragout",cyPosition:{x:now[0],y:now[1]}})),near&&near.trigger(new Event(e,{type:"tapdragover",cyPosition:{x:now[0],y:now[1]}}))),r.touchData.last=near,capture)for(var i=0;i<now.length;i++)now[i]&&r.touchData.startPosition[i]&&isOverThresholdDrag&&(r.touchData.singleTouchMoved=!0);if(capture&&(null==start||start.isEdge())&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(start,r.touchData.starts);allowPassthrough&&(e.preventDefault(),r.swipePanning?cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom}):isOverThresholdDrag&&(r.swipePanning=!0,cy.panBy({x:dx*zoom,y:dy*zoom}),start&&(start.unactivate(),r.data.bgActivePosistion||(r.data.bgActivePosistion=math.array2point(r.touchData.startPosition)),r.redrawHint("select",!0),r.touchData.start=null)));var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}}for(var j=0;j<now.length;j++)earlier[j]=now[j]}},!1);var touchcancelHandler;r.registerBinding(window,"touchcancel",touchcancelHandler=function(e){var start=r.touchData.start;r.touchData.capture=!1,start&&start.unactivate()});var touchendHandler;if(r.registerBinding(window,"touchend",touchendHandler=function(e){var start=r.touchData.start,capture=r.touchData.capture;if(capture){r.touchData.capture=!1,e.preventDefault();var select=r.selection;r.swipePanning=!1,r.hoverData.draggingEles=!1;var cy=r.cy,zoom=cy.zoom(),now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}start&&start.unactivate();var ctxTapend;if(r.touchData.cxt){if(ctxTapend=new Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}}),start?start.trigger(ctxTapend):cy.trigger(ctxTapend),!r.touchData.cxtDragged){var ctxTap=new Event(e,{type:"cxttap",cyPosition:{x:now[0],y:now[1]}});start?start.trigger(ctxTap):cy.trigger(ctxTap)}return r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!1,r.touchData.start=null,void r.redraw()}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=!1;var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));select[0]=void 0,select[1]=void 0,select[2]=void 0,select[3]=void 0,select[4]=0,r.redrawHint("select",!0),cy.trigger("boxend");var eleWouldBeSelected=function(ele){return ele.selectable()&&!ele.selected()};box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect"),box.nonempty()&&r.redrawHint("eles",!0),r.redraw()}if(null!=start&&start.unactivate(),e.touches[2])r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var draggedEles=r.dragData.touchDragEles;if(null!=start){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),startWasGrabbed&&start.trigger("free"),triggerEvents(start,["touchend","tapend","vmouseup","tapdragout"],e,{cyPosition:{x:now[0],y:now[1]}}),start.unactivate(),r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],!0,!0);triggerEvents(near,["touchend","tapend","vmouseup","tapdragout"],e,{cyPosition:{x:now[0],y:now[1]}})}var dx=r.touchData.startPosition[0]-now[0],dx2=dx*dx,dy=r.touchData.startPosition[1]-now[1],dy2=dy*dy,dist2=dx2+dy2,rdist2=dist2*zoom*zoom;null!=start&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching&&("single"===cy.selectionType()?(cy.$(":selected").unmerge(start).unselect(),start.select()):start.selected()?start.unselect():start.select(),r.redrawHint("eles",!0)),r.touchData.singleTouchMoved||triggerEvents(start,["tap","vclick"],e,{cyPosition:{x:now[0],y:now[1]}}),r.touchData.singleTouchMoved=!0}for(var j=0;j<now.length;j++)earlier[j]=now[j];r.dragData.didDrag=!1,0===e.touches.length&&(r.touchData.dragDelta=[],r.touchData.startPosition=null,r.touchData.startGPosition=null),e.touches.length<2&&(r.pinching=!1,r.redrawHint("eles",!0),r.redraw())}},!1),"undefined"==typeof TouchEvent){var pointers=[],makeTouch=function(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}},makePointer=function(e){return{event:e,touch:makeTouch(e)}},addPointer=function(e){pointers.push(makePointer(e))},removePointer=function(e){for(var i=0;i<pointers.length;i++){var p=pointers[i];if(p.event.pointerId===e.pointerId)return void pointers.splice(i,1)}},updatePointer=function(e){var p=pointers.filter(function(p){return p.event.pointerId===e.pointerId})[0];p.event=e,p.touch=makeTouch(e)},addTouchesToEvent=function(e){e.touches=pointers.map(function(p){return p.touch})};r.registerBinding(r.container,"pointerdown",function(e){"mouse"!==e.pointerType&&(e.preventDefault(),addPointer(e),addTouchesToEvent(e),touchstartHandler(e))}),r.registerBinding(r.container,"pointerup",function(e){"mouse"!==e.pointerType&&(removePointer(e),addTouchesToEvent(e),touchendHandler(e))}),r.registerBinding(r.container,"pointercancel",function(e){"mouse"!==e.pointerType&&(removePointer(e),addTouchesToEvent(e),touchcancelHandler(e))}),r.registerBinding(r.container,"pointermove",function(e){"mouse"!==e.pointerType&&(e.preventDefault(),updatePointer(e),addTouchesToEvent(e),touchmoveHandler(e))})}},module.exports=BRp},{"../../../event":45,"../../../is":83,"../../../math":85,"../../../util":100}],62:[function(_dereq_,module,exports){"use strict";var math=_dereq_("../../../math"),BRp={};BRp.generatePolygon=function(name,points){return this.nodeShapes[name]={renderer:this,name:name,points:points,draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl("polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.polygonIntersectLine(x,y,this.points,nodeX,nodeY,width/2,height/2,padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){return math.pointInsidePolygon(x,y,this.points,centerX,centerY,width,height,[0,-1],padding)}}},BRp.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.intersectLineEllipse(x,y,nodeX,nodeY,width/2+padding,height/2+padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){return x-=centerX,y-=centerY,x/=width/2+padding,y/=height/2+padding,x*x+y*y<=1}}},BRp.generateRoundRectangle=function(){return this.nodeShapes.roundrectangle={renderer:this,name:"roundrectangle",points:math.generateUnitNgonPointsFitToSquare(4,0),draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){var cornerRadius=math.getRoundRectangleRadius(width,height);if(math.pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*cornerRadius,[0,-1],padding))return!0;if(math.pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*cornerRadius,height,[0,-1],padding))return!0;var checkInEllipse=function(x,y,centerX,centerY,width,height,padding){return x-=centerX,y-=centerY,x/=width/2+padding,y/=height/2+padding,x*x+y*y<=1};return!!checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY-height/2+cornerRadius,2*cornerRadius,2*cornerRadius,padding)||(!!checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY-height/2+cornerRadius,2*cornerRadius,2*cornerRadius,padding)||(!!checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,2*cornerRadius,2*cornerRadius,padding)||!!checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,2*cornerRadius,2*cornerRadius,padding)))}}},BRp.registerNodeShapes=function(){var nodeShapes=this.nodeShapes={},renderer=this;this.generateEllipse(),this.generatePolygon("triangle",math.generateUnitNgonPointsFitToSquare(3,0)),this.generatePolygon("rectangle",math.generateUnitNgonPointsFitToSquare(4,0)),nodeShapes.square=nodeShapes.rectangle,this.generateRoundRectangle(),this.generatePolygon("diamond",[0,1,1,0,0,-1,-1,0]),this.generatePolygon("pentagon",math.generateUnitNgonPointsFitToSquare(5,0)),this.generatePolygon("hexagon",math.generateUnitNgonPointsFitToSquare(6,0)),this.generatePolygon("heptagon",math.generateUnitNgonPointsFitToSquare(7,0)),this.generatePolygon("octagon",math.generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20),outerPoints=math.generateUnitNgonPoints(5,0),innerPoints=math.generateUnitNgonPoints(5,Math.PI/5),innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++)innerPoints[2*i]*=innerRadius,innerPoints[2*i+1]*=innerRadius;for(var i=0;i<5;i++)star5Points[4*i]=outerPoints[2*i],star5Points[4*i+1]=outerPoints[2*i+1],star5Points[4*i+2]=innerPoints[2*i],star5Points[4*i+3]=innerPoints[2*i+1];star5Points=math.fitPolygonToSquare(star5Points),this.generatePolygon("star",star5Points),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),nodeShapes.makePolygon=function(points){var key=points.join("$"),name="polygon-"+key,shape;return(shape=this[name])?shape:renderer.generatePolygon(name,points)}},module.exports=BRp},{"../../../math":85}],63:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../../../util"),BRp={};BRp.timeToRender=function(){return this.redrawTotalTime/this.redrawCount},BRp.redraw=function(options){options=options||util.staticEmptyObject();var r=this;void 0===r.averageRedrawTime&&(r.averageRedrawTime=0),void 0===r.lastRedrawTime&&(r.lastRedrawTime=0),void 0===r.lastDrawTime&&(r.lastDrawTime=0),r.requestedFrame=!0,r.renderOptions=options},BRp.beforeRender=function(fn,priority){if(!this.destroyed){priority=priority||0;var cbs=this.beforeRenderCallbacks;cbs.push({fn:fn,priority:priority}),cbs.sort(function(a,b){return b.priority-a.priority})}};var beforeRenderCallbacks=function(r,willDraw,startTime){for(var cbs=r.beforeRenderCallbacks,i=0;i<cbs.length;i++)cbs[i].fn(willDraw,startTime)};BRp.startRenderLoop=function(){var r=this;if(!r.renderLoopStarted){r.renderLoopStarted=!0;var renderFn=function(requestTime){if(!r.destroyed){if(r.requestedFrame&&!r.skipFrame){beforeRenderCallbacks(r,!0,requestTime);var startTime=util.performanceNow();r.render(r.renderOptions);var endTime=r.lastDrawTime=util.performanceNow();void 0===r.averageRedrawTime&&(r.averageRedrawTime=endTime-startTime),void 0===r.redrawCount&&(r.redrawCount=0),r.redrawCount++,void 0===r.redrawTotalTime&&(r.redrawTotalTime=0);var duration=endTime-startTime;r.redrawTotalTime+=duration,r.lastRedrawTime=duration,r.averageRedrawTime=r.averageRedrawTime/2+duration/2,r.requestedFrame=!1}else beforeRenderCallbacks(r,!1,requestTime);r.skipFrame=!1,util.requestAnimationFrame(renderFn)}};util.requestAnimationFrame(renderFn)}},module.exports=BRp},{"../../../util":100}],64:[function(_dereq_,module,exports){"use strict";var CRp={},impl;CRp.arrowShapeImpl=function(name){return(impl||(impl={polygon:function(context,points){for(var i=0;i<points.length;i++){var pt=points[i];context.lineTo(pt.x,pt.y)}},"triangle-backcurve":function(context,points,controlPoint){for(var firstPt,i=0;i<points.length;i++){var pt=points[i];0===i&&(firstPt=pt),context.lineTo(pt.x,pt.y)}context.quadraticCurveTo(controlPoint.x,controlPoint.y,firstPt.x,firstPt.y)},"triangle-tee":function(context,trianglePoints,teePoints){context.beginPath&&context.beginPath();for(var triPts=trianglePoints,i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath(),context.beginPath&&context.beginPath();var teePts=teePoints,firstTeePt=teePoints[0];context.moveTo(firstTeePt.x,firstTeePt.y);for(var i=0;i<teePts.length;i++){var pt=teePts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath()},circle:function(context,rx,ry,r){context.arc(rx,ry,r,0,2*Math.PI,!1)}}))[name]},module.exports=CRp},{}],65:[function(_dereq_,module,exports){"use strict";var CRp={};CRp.drawEdge=function(context,edge,shiftToOriginWithBb,drawLabel,drawOverlayInstead){var rs=edge._private.rscratch,usePaths=this.usePaths();if(!rs.badLine&&!isNaN(rs.allpts[0])&&edge.visible()){var bb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));var overlayPadding=edge.pstyle("overlay-padding").pfValue,overlayOpacity=edge.pstyle("overlay-opacity").value,overlayColor=edge.pstyle("overlay-color").value;if(drawOverlayInstead){if(0===overlayOpacity)return;this.strokeStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity),context.lineCap="round","self"!=rs.edgeType||usePaths||(context.lineCap="butt")}else{var lineColor=edge.pstyle("line-color").value;this.strokeStyle(context,lineColor[0],lineColor[1],lineColor[2],edge.pstyle("opacity").value),context.lineCap="butt"}context.lineJoin="round";var edgeWidth=edge.pstyle("width").pfValue+(drawOverlayInstead?2*overlayPadding:0),lineStyle=drawOverlayInstead?"solid":edge.pstyle("line-style").value;context.lineWidth=edgeWidth;var shadowBlur=edge.pstyle("shadow-blur").pfValue,shadowOpacity=edge.pstyle("shadow-opacity").value,shadowColor=edge.pstyle("shadow-color").value,shadowOffsetX=edge.pstyle("shadow-offset-x").pfValue,shadowOffsetY=edge.pstyle("shadow-offset-y").pfValue;this.shadowStyle(context,shadowColor,drawOverlayInstead?0:shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY),this.drawEdgePath(edge,context,rs.allpts,lineStyle,edgeWidth),this.drawArrowheads(context,edge,drawOverlayInstead),this.shadowStyle(context,"transparent",0),drawOverlayInstead||this.drawEdge(context,edge,!1,drawLabel,!0),this.drawElementText(context,edge,drawLabel),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}},CRp.drawEdgePath=function(edge,context,pts,type,width){var rs=edge._private.rscratch,canvasCxt=context,path,pathCacheHit=!1,usePaths=this.usePaths();if(usePaths){var pathCacheKey=pts.join("$"),keyMatches=rs.pathCacheKey&&rs.pathCacheKey===pathCacheKey;keyMatches?(path=context=rs.pathCache,pathCacheHit=!0):(path=context=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(canvasCxt.setLineDash)switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash([6,3]);break;case"solid":canvasCxt.setLineDash([])}if(!pathCacheHit&&!rs.badLine)switch(context.beginPath&&context.beginPath(),context.moveTo(pts[0],pts[1]),rs.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var i=2;i+3<pts.length;i+=4)context.quadraticCurveTo(pts[i],pts[i+1],pts[i+2],pts[i+3]);break;case"straight":case"segments":case"haystack":for(var i=2;i+1<pts.length;i+=2)context.lineTo(pts[i],pts[i+1])}context=canvasCxt,usePaths?context.stroke(path):context.stroke(),context.setLineDash&&context.setLineDash([])},CRp.drawArrowheads=function(context,edge,drawOverlayInstead){if(!drawOverlayInstead){var rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType;isHaystack||this.drawArrowhead(context,edge,"source",rs.arrowStartX,rs.arrowStartY,rs.srcArrowAngle),this.drawArrowhead(context,edge,"mid-target",rs.midX,rs.midY,rs.midtgtArrowAngle),this.drawArrowhead(context,edge,"mid-source",rs.midX,rs.midY,rs.midsrcArrowAngle),isHaystack||this.drawArrowhead(context,edge,"target",rs.arrowEndX,rs.arrowEndY,rs.tgtArrowAngle)}},CRp.drawArrowhead=function(context,edge,prefix,x,y,angle){if(!(isNaN(x)||null==x||isNaN(y)||null==y||isNaN(angle)||null==angle)){var self=this,arrowShape=edge.pstyle(prefix+"-arrow-shape").value;if("none"!==arrowShape){var gco=context.globalCompositeOperation,arrowClearFill="hollow"===edge.pstyle(prefix+"-arrow-fill").value?"both":"filled",arrowFill=edge.pstyle(prefix+"-arrow-fill").value,opacity=edge.pstyle("opacity").value;"half-triangle-overshot"===arrowShape&&(arrowFill="hollow",arrowClearFill="hollow"),1===opacity&&"hollow"!==arrowFill||(context.globalCompositeOperation="destination-out",self.fillStyle(context,255,255,255,1),self.strokeStyle(context,255,255,255,1),self.drawArrowShape(edge,prefix,context,arrowClearFill,edge.pstyle("width").pfValue,edge.pstyle(prefix+"-arrow-shape").value,x,y,angle),context.globalCompositeOperation=gco);var color=edge.pstyle(prefix+"-arrow-color").value;self.fillStyle(context,color[0],color[1],color[2],opacity),self.strokeStyle(context,color[0],color[1],color[2],opacity),self.drawArrowShape(edge,prefix,context,arrowFill,edge.pstyle("width").pfValue,edge.pstyle(prefix+"-arrow-shape").value,x,y,angle)}}},CRp.drawArrowShape=function(edge,arrowType,context,fill,edgeWidth,shape,x,y,angle){var r=this,usePaths=this.usePaths(),rs=edge._private.rscratch,pathCacheHit=!1,path,canvasContext=context,translation={x:x,y:y},size=this.getArrowWidth(edgeWidth),shapeImpl=r.arrowShapes[shape];if(usePaths){var pathCacheKey=size+"$"+shape+"$"+angle+"$"+x+"$"+y;rs.arrowPathCacheKey=rs.arrowPathCacheKey||{},rs.arrowPathCache=rs.arrowPathCache||{};var alreadyCached=rs.arrowPathCacheKey[arrowType]===pathCacheKey;alreadyCached?(path=context=rs.arrowPathCache[arrowType],pathCacheHit=!0):(path=context=new Path2D,rs.arrowPathCacheKey[arrowType]=pathCacheKey,rs.arrowPathCache[arrowType]=path)}context.beginPath&&context.beginPath(),pathCacheHit||shapeImpl.draw(context,size,angle,translation),!shapeImpl.leavePathOpen&&context.closePath&&context.closePath(),context=canvasContext,"filled"!==fill&&"both"!==fill||(usePaths?context.fill(path):context.fill()),"hollow"!==fill&&"both"!==fill||(context.lineWidth=shapeImpl.matchEdgeWidth?edgeWidth:1,context.lineJoin="miter",usePaths?context.stroke(path):context.stroke())},module.exports=CRp},{}],66:[function(_dereq_,module,exports){"use strict";var math=_dereq_("../../../math"),CRp={};CRp.drawElement=function(context,ele,shiftToOriginWithBb,showLabel){var r=this;ele.isNode()?r.drawNode(context,ele,shiftToOriginWithBb,showLabel):r.drawEdge(context,ele,shiftToOriginWithBb,showLabel)},CRp.drawCachedElement=function(context,ele,pxRatio,extent){
var r=this,bb=ele.boundingBox();if(0!==bb.w&&0!==bb.h&&(!extent||math.boundingBoxesIntersect(bb,extent))){var cache=r.data.eleTxrCache.getElement(ele,bb,pxRatio);cache?context.drawImage(cache.texture.canvas,cache.x,0,cache.width,cache.height,bb.x1,bb.y1,bb.w,bb.h):r.drawElement(context,ele)}},CRp.drawElements=function(context,eles){for(var r=this,i=0;i<eles.length;i++){var ele=eles[i];r.drawElement(context,ele)}},CRp.drawCachedElements=function(context,eles,pxRatio,extent){for(var r=this,i=0;i<eles.length;i++){var ele=eles[i];r.drawCachedElement(context,ele,pxRatio,extent)}},CRp.drawCachedNodes=function(context,eles,pxRatio,extent){for(var r=this,i=0;i<eles.length;i++){var ele=eles[i];ele.isNode()&&r.drawCachedElement(context,ele,pxRatio,extent)}},CRp.drawLayeredElements=function(context,eles,pxRatio,extent){var r=this,layers=r.data.lyrTxrCache.getLayers(eles,pxRatio);if(layers)for(var i=0;i<layers.length;i++){var layer=layers[i],bb=layer.bb;0!==bb.w&&0!==bb.h&&context.drawImage(layer.canvas,bb.x1,bb.y1,bb.w,bb.h)}else r.drawCachedElements(context,eles,pxRatio,extent)},module.exports=CRp},{"../../../math":85}],67:[function(_dereq_,module,exports){"use strict";var CRp={};CRp.safeDrawImage=function(context,img,ix,iy,iw,ih,x,y,w,h){var r=this;try{context.drawImage(img,ix,iy,iw,ih,x,y,w,h)}catch(e){r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.drawingImage=!0,r.redraw()}},CRp.drawInscribedImage=function(context,img,node){var r=this,nodeX=node._private.position.x,nodeY=node._private.position.y,fit=node.pstyle("background-fit").value,xPos=node.pstyle("background-position-x"),yPos=node.pstyle("background-position-y"),repeat=node.pstyle("background-repeat").value,nodeW=node.width(),nodeH=node.height(),rs=node._private.rscratch,clip=node.pstyle("background-clip").value,shouldClip="node"===clip,imgOpacity=node.pstyle("background-image-opacity").value,imgW=img.width||img.cachedW,imgH=img.height||img.cachedH;null!=imgW&&null!=imgH||(document.body.appendChild(img),imgW=img.cachedW=img.width||img.offsetWidth,imgH=img.cachedH=img.height||img.offsetHeight,document.body.removeChild(img));var w=imgW,h=imgH,bgW=node.pstyle("background-width");"auto"!==bgW.value&&(w="%"===bgW.units?bgW.value/100*nodeW:bgW.pfValue);var bgH=node.pstyle("background-height");if("auto"!==bgH.value&&(h="%"===bgH.units?bgH.value/100*nodeH:bgH.pfValue),0!==w&&0!==h){if("contain"===fit){var scale=Math.min(nodeW/w,nodeH/h);w*=scale,h*=scale}else if("cover"===fit){var scale=Math.max(nodeW/w,nodeH/h);w*=scale,h*=scale}var x=nodeX-nodeW/2;x+="%"===xPos.units?(nodeW-w)*xPos.value/100:xPos.pfValue;var y=nodeY-nodeH/2;y+="%"===yPos.units?(nodeH-h)*yPos.value/100:yPos.pfValue,rs.pathCache&&(x-=nodeX,y-=nodeY,nodeX=0,nodeY=0);var gAlpha=context.globalAlpha;if(context.globalAlpha=imgOpacity,"no-repeat"===repeat)shouldClip&&(context.save(),rs.pathCache?context.clip(rs.pathCache):(r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeW,nodeH),context.clip())),r.safeDrawImage(context,img,0,0,imgW,imgH,x,y,w,h),shouldClip&&context.restore();else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern,r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeW,nodeH),context.translate(x,y),context.fill(),context.translate(-x,-y)}context.globalAlpha=gAlpha}},module.exports=CRp},{}],68:[function(_dereq_,module,exports){"use strict";function roundRect(ctx,x,y,width,height,radius){var radius=radius||5;ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.lineTo(x+width-radius,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius),ctx.lineTo(x+width,y+height-radius),ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height),ctx.lineTo(x+radius,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius),ctx.lineTo(x,y+radius),ctx.quadraticCurveTo(x,y,x+radius,y),ctx.closePath(),ctx.fill()}var util=_dereq_("../../../util"),math=_dereq_("../../../math"),CRp={};CRp.eleTextBiggerThanMin=function(ele,scale){if(!scale){var zoom=ele.cy().zoom(),pxRatio=this.getPixelRatio(),lvl=Math.ceil(math.log2(zoom*pxRatio));scale=Math.pow(2,lvl)}var computedSize=ele.pstyle("font-size").pfValue*scale,minSize=ele.pstyle("min-zoomed-font-size").pfValue;return!(computedSize<minSize)},CRp.drawElementText=function(context,ele,force){var r=this;if(void 0===force){if(!r.eleTextBiggerThanMin(ele))return}else if(!force)return;if(ele.isNode()){var label=ele.pstyle("label");if(!label||!label.value)return;var textHalign=ele.pstyle("text-halign").strValue,textValign=ele.pstyle("text-valign").strValue;switch(textHalign){case"left":context.textAlign="right";break;case"right":context.textAlign="left";break;default:context.textAlign="center"}context.textBaseline="bottom"}else{var label=ele.pstyle("label"),srcLabel=ele.pstyle("source-label"),tgtLabel=ele.pstyle("target-label");if(!(label&&label.value||srcLabel&&srcLabel.value||tgtLabel&&tgtLabel.value))return;context.textAlign="center",context.textBaseline="bottom"}r.drawText(context,ele),ele.isEdge()&&(r.drawText(context,ele,"source"),r.drawText(context,ele,"target"))},CRp.drawNodeText=CRp.drawEdgeText=CRp.drawElementText,CRp.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++)if(cache=this.fontCaches[i],cache.context===context)return cache;return cache={context:context},this.fontCaches.push(cache),cache},CRp.setupTextStyle=function(context,ele){var parentOpacity=ele.effectiveOpacity(),labelStyle=ele.pstyle("font-style").strValue,labelSize=ele.pstyle("font-size").pfValue+"px",labelFamily=ele.pstyle("font-family").strValue,labelWeight=ele.pstyle("font-weight").strValue,opacity=ele.pstyle("text-opacity").value*ele.pstyle("opacity").value*parentOpacity,outlineOpacity=ele.pstyle("text-outline-opacity").value*opacity,color=ele.pstyle("color").value,outlineColor=ele.pstyle("text-outline-color").value,shadowBlur=ele.pstyle("text-shadow-blur").pfValue,shadowOpacity=ele.pstyle("text-shadow-opacity").value,shadowColor=ele.pstyle("text-shadow-color").value,shadowOffsetX=ele.pstyle("text-shadow-offset-x").pfValue,shadowOffsetY=ele.pstyle("text-shadow-offset-y").pfValue,fontCacheKey=ele._private.fontKey,cache=this.getFontCache(context);cache.key!==fontCacheKey&&(context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily,cache.key=fontCacheKey),context.lineJoin="round",this.fillStyle(context,color[0],color[1],color[2],opacity),this.strokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity),this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY)},CRp.drawText=function(context,ele,prefix){var _p=ele._private,rscratch=_p.rscratch,parentOpacity=ele.effectiveOpacity();if(0!==parentOpacity&&0!==ele.pstyle("text-opacity").value){var textX=util.getPrefixedProperty(rscratch,"labelX",prefix),textY=util.getPrefixedProperty(rscratch,"labelY",prefix),text=this.getLabelText(ele,prefix);if(null!=text&&""!==text&&!isNaN(textX)&&!isNaN(textY)){this.setupTextStyle(context,ele);var pdash=prefix?prefix+"-":"",textW=util.getPrefixedProperty(rscratch,"labelWidth",prefix),textH=util.getPrefixedProperty(rscratch,"labelHeight",prefix),textAngle=util.getPrefixedProperty(rscratch,"labelAngle",prefix),marginX=ele.pstyle(pdash+"text-margin-x").pfValue,marginY=ele.pstyle(pdash+"text-margin-y").pfValue,isEdge=ele.isEdge(),isNode=ele.isNode(),halign=ele.pstyle("text-halign").value,valign=ele.pstyle("text-valign").value;isEdge&&(halign="center",valign="center"),textX+=marginX,textY+=marginY;var rotation=ele.pstyle("text-rotation"),theta;if(theta="autorotate"===rotation.strValue?isEdge?textAngle:0:"none"===rotation.strValue?0:rotation.pfValue,0!==theta){var orgTextX=textX,orgTextY=textY;context.translate(orgTextX,orgTextY),context.rotate(theta),textX=0,textY=0}switch(valign){case"top":break;case"center":textY+=textH/2;break;case"bottom":textY+=textH}var backgroundOpacity=ele.pstyle("text-background-opacity").value,borderOpacity=ele.pstyle("text-border-opacity").value,textBorderWidth=ele.pstyle("text-border-width").pfValue;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var bgX=textX;switch(halign){case"left":bgX-=textW;break;case"center":bgX-=textW/2;break;case"right":}var bgY=textY-textH;if(backgroundOpacity>0){var textFill=context.fillStyle,textBackgroundColor=ele.pstyle("text-background-color").value;context.fillStyle="rgba("+textBackgroundColor[0]+","+textBackgroundColor[1]+","+textBackgroundColor[2]+","+backgroundOpacity*parentOpacity+")";var styleShape=ele.pstyle("text-background-shape").strValue;"roundrectangle"==styleShape?roundRect(context,bgX,bgY,textW,textH,2):context.fillRect(bgX,bgY,textW,textH),context.fillStyle=textFill}if(textBorderWidth>0&&borderOpacity>0){var textStroke=context.strokeStyle,textLineWidth=context.lineWidth,textBorderColor=ele.pstyle("text-border-color").value,textBorderStyle=ele.pstyle("text-border-style").value;if(context.strokeStyle="rgba("+textBorderColor[0]+","+textBorderColor[1]+","+textBorderColor[2]+","+borderOpacity*parentOpacity+")",context.lineWidth=textBorderWidth,context.setLineDash)switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4,context.setLineDash([]);break;case"solid":context.setLineDash([])}if(context.strokeRect(bgX,bgY,textW,textH),"double"===textBorderStyle){var whiteWidth=textBorderWidth/2;context.strokeRect(bgX+whiteWidth,bgY+whiteWidth,textW-2*whiteWidth,textH-2*whiteWidth)}context.setLineDash&&context.setLineDash([]),context.lineWidth=textLineWidth,context.strokeStyle=textStroke}}var lineWidth=2*ele.pstyle("text-outline-width").pfValue;if(lineWidth>0&&(context.lineWidth=lineWidth),"wrap"===ele.pstyle("text-wrap").value){var lines=util.getPrefixedProperty(rscratch,"labelWrapCachedLines",prefix),lineHeight=textH/lines.length;switch(valign){case"top":textY-=(lines.length-1)*lineHeight;break;case"center":case"bottom":textY-=(lines.length-1)*lineHeight}for(var l=0;l<lines.length;l++)lineWidth>0&&context.strokeText(lines[l],textX,textY),context.fillText(lines[l],textX,textY),textY+=lineHeight}else lineWidth>0&&context.strokeText(text,textX,textY),context.fillText(text,textX,textY);0!==theta&&(context.rotate(-theta),context.translate(-orgTextX,-orgTextY)),this.shadowStyle(context,"transparent",0)}}},module.exports=CRp},{"../../../math":85,"../../../util":100}],69:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../../is"),CRp={};CRp.drawNode=function(context,node,shiftToOriginWithBb,drawLabel){var r=this,nodeWidth,nodeHeight,rs=node._private.rscratch,_p=node._private,pos=pos||_p.position;if(is.number(pos.x)&&is.number(pos.y)&&node.visible()){var parentOpacity=node.effectiveOpacity(),usePaths=this.usePaths(),path,pathCacheHit=!1,padding=node.pstyle("padding").pfValue;nodeWidth=node.width()+2*padding,nodeHeight=node.height()+2*padding,context.lineWidth=node.pstyle("border-width").pfValue;var bb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));var bgImgProp=node.pstyle("background-image"),url=bgImgProp.value[2]||bgImgProp.value[1],image;if(void 0!==url){var bgImgCrossOrigin=node.pstyle("background-image-crossorigin");image=this.getCachedImage(url,bgImgCrossOrigin,function(){node.trigger("background"),r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.drawingImage=!0,r.redraw()});var prevBging=_p.backgrounding;_p.backgrounding=!image.complete,prevBging!==_p.backgrounding&&node.updateStyle(!1)}var bgColor=node.pstyle("background-color").value,borderColor=node.pstyle("border-color").value,borderStyle=node.pstyle("border-style").value;this.fillStyle(context,bgColor[0],bgColor[1],bgColor[2],node.pstyle("background-opacity").value*parentOpacity),this.strokeStyle(context,borderColor[0],borderColor[1],borderColor[2],node.pstyle("border-opacity").value*parentOpacity);var shadowBlur=node.pstyle("shadow-blur").pfValue,shadowOpacity=node.pstyle("shadow-opacity").value,shadowColor=node.pstyle("shadow-color").value,shadowOffsetX=node.pstyle("shadow-offset-x").pfValue,shadowOffsetY=node.pstyle("shadow-offset-y").pfValue;if(this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY),context.lineJoin="miter",context.setLineDash)switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([])}var styleShape=node.pstyle("shape").strValue,shapePts=node.pstyle("shape-polygon-points").pfValue;if(usePaths){var pathCacheKey=styleShape+"$"+nodeWidth+"$"+nodeHeight+("polygon"===styleShape?"$"+shapePts.join("$"):"");context.translate(pos.x,pos.y),rs.pathCacheKey===pathCacheKey?(path=rs.pathCache,pathCacheHit=!0):(path=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(!pathCacheHit){var npos=pos;usePaths&&(npos={x:0,y:0}),r.nodeShapes[this.getNodeShape(node)].draw(path||context,npos.x,npos.y,nodeWidth,nodeHeight)}usePaths?context.fill(path):context.fill(),this.shadowStyle(context,"transparent",0),void 0!==url&&image.complete&&this.drawInscribedImage(context,image,node);var darkness=node.pstyle("background-blacken").value,borderWidth=node.pstyle("border-width").pfValue;if(this.hasPie(node)&&(this.drawPie(context,node,parentOpacity),0===darkness&&0===borderWidth||usePaths||r.nodeShapes[this.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight)),darkness>0?(this.fillStyle(context,0,0,0,darkness),usePaths?context.fill(path):context.fill()):darkness<0&&(this.fillStyle(context,255,255,255,-darkness),usePaths?context.fill(path):context.fill()),borderWidth>0&&(usePaths?context.stroke(path):context.stroke(),"double"===borderStyle)){context.lineWidth=node.pstyle("border-width").pfValue/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",usePaths?context.stroke(path):context.stroke(),context.globalCompositeOperation=gco}usePaths&&context.translate(-pos.x,-pos.y),context.setLineDash&&context.setLineDash([]),r.drawElementText(context,node,drawLabel);var overlayPadding=node.pstyle("overlay-padding").pfValue,overlayOpacity=node.pstyle("overlay-opacity").value,overlayColor=node.pstyle("overlay-color").value;overlayOpacity>0&&(this.fillStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity),r.nodeShapes.roundrectangle.draw(context,node._private.position.x,node._private.position.y,nodeWidth+2*overlayPadding,nodeHeight+2*overlayPadding),context.fill()),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}},CRp.hasPie=function(node){return node=node[0],node._private.hasPie},CRp.drawPie=function(context,node,nodeOpacity,pos){node=node[0];var _p=node._private,cyStyle=node.cy().style(),pieSize=node.pstyle("pie-size"),nodeW=node.width(),nodeH=node.height(),pos=pos||_p.position,x=pos.x,y=pos.y,radius=Math.min(nodeW,nodeH)/2,lastPercent=0,usePaths=this.usePaths();usePaths&&(x=0,y=0),"%"===pieSize.units?radius=radius*pieSize.value/100:void 0!==pieSize.pfValue&&(radius=pieSize.pfValue/2);for(var i=1;i<=cyStyle.pieBackgroundN;i++){var size=node.pstyle("pie-"+i+"-background-size").value,color=node.pstyle("pie-"+i+"-background-color").value,opacity=node.pstyle("pie-"+i+"-background-opacity").value*nodeOpacity,percent=size/100;percent+lastPercent>1&&(percent=1-lastPercent);var angleStart=1.5*Math.PI+2*Math.PI*lastPercent,angleDelta=2*Math.PI*percent,angleEnd=angleStart+angleDelta;0===size||lastPercent>=1||lastPercent+percent>1||(context.beginPath(),context.moveTo(x,y),context.arc(x,y,radius,angleStart,angleEnd),context.closePath(),this.fillStyle(context,color[0],color[1],color[2],opacity),context.fill(),lastPercent+=percent)}},module.exports=CRp},{"../../../is":83}],70:[function(_dereq_,module,exports){"use strict";var CRp={},util=_dereq_("../../../util"),motionBlurDelay=100;CRp.getPixelRatio=function(){var context=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore},CRp.paintCache=function(context){for(var caches=this.paintCaches=this.paintCaches||[],needToCreateCache=!0,cache,i=0;i<caches.length;i++)if(cache=caches[i],cache.context===context){needToCreateCache=!1;break}return needToCreateCache&&(cache={context:context},caches.push(cache)),cache},CRp.fillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"},CRp.strokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"},CRp.shadowStyle=function(context,color,opacity,blur,offsetX,offsetY){var zoom=this.cy.zoom();opacity>0?(context.shadowBlur=blur*zoom,context.shadowColor="rgba("+color[0]+","+color[1]+","+color[2]+","+opacity+")",context.shadowOffsetX=offsetX*zoom,context.shadowOffsetY=offsetY*zoom):(context.shadowBlur=0,context.shadowColor="transparent",context.shadowOffsetX=0,context.shadowOffsetY=0)},CRp.matchCanvasSize=function(container){var r=this,data=r.data,bb=r.findContainerClientCoords(),width=bb[2],height=bb[3],pixelRatio=r.getPixelRatio(),mbPxRatio=r.motionBlurPxRatio;container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE]&&container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG]||(pixelRatio=mbPxRatio);var canvasWidth=width*pixelRatio,canvasHeight=height*pixelRatio,canvas;if(canvasWidth!==r.canvasWidth||canvasHeight!==r.canvasHeight){r.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px",canvasContainer.style.height=height+"px";for(var i=0;i<r.CANVAS_LAYERS;i++)canvas=data.canvases[i],canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";for(var i=0;i<r.BUFFER_COUNT;i++)canvas=data.bufferCanvases[i],canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";r.textureMult=1,pixelRatio<=1&&(canvas=data.bufferCanvases[r.TEXTURE_BUFFER],r.textureMult=2,canvas.width=canvasWidth*r.textureMult,canvas.height=canvasHeight*r.textureMult),r.canvasWidth=canvasWidth,r.canvasHeight=canvasHeight}},CRp.renderTo=function(cxt,zoom,pan,pxRatio){this.render({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:!0,forcedPxRatio:pxRatio})},CRp.render=function(options){function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",r.fillStyle(context,255,255,255,r.motionBlurTransparency),context.fillRect(x,y,w,h),context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;r.clearingMotionBlur||context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]&&context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]?(ePan=effectivePan,eZoom=effectiveZoom,w=r.canvasWidth,h=r.canvasHeight):(ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio},eZoom=zoom*mbPxRatio,w=r.canvasWidth*mbPxRatio,h=r.canvasHeight*mbPxRatio),context.setTransform(1,0,0,1,0,0),"motionBlur"===clear?mbclear(context,0,0,w,h):forcedContext||void 0!==clear&&!clear||context.clearRect(0,0,w,h),drawAllLayers||(context.translate(ePan.x,ePan.y),context.scale(eZoom,eZoom)),forcedPan&&context.translate(forcedPan.x,forcedPan.y),forcedZoom&&context.scale(forcedZoom,forcedZoom)}options=options||util.staticEmptyObject();var forcedContext=options.forcedContext,drawAllLayers=options.drawAllLayers,drawOnlyNodeLayer=options.drawOnlyNodeLayer,forcedZoom=options.forcedZoom,forcedPan=options.forcedPan,r=this,pixelRatio=void 0===options.forcedPxRatio?this.getPixelRatio():options.forcedPxRatio,cy=r.cy,data=r.data,needDraw=data.canvasNeedsRedraw,textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming),motionBlur=void 0!==options.motionBlur?options.motionBlur:r.motionBlur,mbPxRatio=r.motionBlurPxRatio,hasCompoundNodes=cy.hasCompoundNodes(),inNodeDragGesture=r.hoverData.draggingEles,inBoxSelection=!(!r.hoverData.selecting&&!r.touchData.selecting);motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;var motionBlurFadeEffect=motionBlur;forcedContext||(r.prevPxRatio!==pixelRatio&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container),r.redrawHint("eles",!0),r.redrawHint("drag",!0)),r.prevPxRatio=pixelRatio),!forcedContext&&r.motionBlurTimeout&&clearTimeout(r.motionBlurTimeout),motionBlur&&(null==r.mbFrames&&(r.mbFrames=0),r.drawingImage||r.mbFrames++,r.mbFrames<3&&(motionBlurFadeEffect=!1),r.mbFrames>r.minMbLowQualFrames&&(r.motionBlurPxRatio=r.mbPxRBlurry)),r.clearingMotionBlur&&(r.motionBlurPxRatio=1),r.textureDrawLastFrame&&!textureDraw&&(needDraw[r.NODE]=!0,needDraw[r.SELECT_BOX]=!0);var coreStyle=cy.style()._private.coreStyle,zoom=cy.zoom(),effectiveZoom=void 0!==forcedZoom?forcedZoom:zoom,pan=cy.pan(),effectivePan={x:pan.x,y:pan.y},vp={zoom:zoom,pan:{x:pan.x,y:pan.y}},prevVp=r.prevViewport,viewportIsDiff=void 0===prevVp||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y;viewportIsDiff||inNodeDragGesture&&!hasCompoundNodes||(r.motionBlurPxRatio=1),forcedPan&&(effectivePan=forcedPan),effectiveZoom*=pixelRatio,effectivePan.x*=pixelRatio,effectivePan.y*=pixelRatio;var eles=r.getCachedZSortedEles();if(textureDraw||(r.textureDrawLastFrame=!1),textureDraw){r.textureDrawLastFrame=!0;var bb;if(!r.textureCache){r.textureCache={},bb=r.textureCache.bb=cy.mutableElements().boundingBox(),r.textureCache.texture=r.data.bufferCanvases[r.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[r.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0),cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult),r.render({forcedContext:cxt,drawOnlyNodeLayer:!0,forcedPxRatio:pixelRatio*r.textureMult});var vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight};vp.mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[r.DRAG]=!1,needDraw[r.NODE]=!1;var context=data.contexts[r.NODE],texture=r.textureCache.texture,vp=r.textureCache.viewport;bb=r.textureCache.bb,context.setTransform(1,0,0,1,0,0),motionBlur?mbclear(context,0,0,vp.width,vp.height):context.clearRect(0,0,vp.width,vp.height);var outsideBgColor=coreStyle["outside-texture-bg-color"].value,outsideBgOpacity=coreStyle["outside-texture-bg-opacity"].value;r.fillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity),context.fillRect(0,0,vp.width,vp.height);var zoom=cy.zoom();setContextTransform(context,!1),context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio),context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else r.textureOnViewport&&!forcedContext&&(r.textureCache=null);var extent=cy.extent(),vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles,hideEdges=r.hideEdgesOnViewport&&vpManip,needMbClear=[];if(needMbClear[r.NODE]=!needDraw[r.NODE]&&motionBlur&&!r.clearedForMotionBlur[r.NODE]||r.clearingMotionBlur,needMbClear[r.NODE]&&(r.clearedForMotionBlur[r.NODE]=!0),needMbClear[r.DRAG]=!needDraw[r.DRAG]&&motionBlur&&!r.clearedForMotionBlur[r.DRAG]||r.clearingMotionBlur,needMbClear[r.DRAG]&&(r.clearedForMotionBlur[r.DRAG]=!0),needDraw[r.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[r.NODE]){var useBuffer=motionBlur&&!needMbClear[r.NODE]&&1!==mbPxRatio,context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]:data.contexts[r.NODE]),clear=motionBlur&&!useBuffer?"motionBlur":void 0;setContextTransform(context,clear),hideEdges?r.drawCachedNodes(context,eles.nondrag,pixelRatio,extent):r.drawLayeredElements(context,eles.nondrag,pixelRatio,extent),drawAllLayers||motionBlur||(needDraw[r.NODE]=!1)}if(!drawOnlyNodeLayer&&(needDraw[r.DRAG]||drawAllLayers||needMbClear[r.DRAG])){var useBuffer=motionBlur&&!needMbClear[r.DRAG]&&1!==mbPxRatio,context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]:data.contexts[r.DRAG]);setContextTransform(context,motionBlur&&!useBuffer?"motionBlur":void 0),hideEdges?r.drawCachedNodes(context,eles.drag,pixelRatio,extent):r.drawCachedElements(context,eles.drag,pixelRatio,extent),drawAllLayers||motionBlur||(needDraw[r.DRAG]=!1)}if(r.showFps||!drawOnlyNodeLayer&&needDraw[r.SELECT_BOX]&&!drawAllLayers){var context=forcedContext||data.contexts[r.SELECT_BOX];if(setContextTransform(context),1==r.selection[4]&&(r.hoverData.selecting||r.touchData.selecting)){var zoom=r.cy.zoom(),borderWidth=coreStyle["selection-box-border-width"].value/zoom;context.lineWidth=borderWidth,context.fillStyle="rgba("+coreStyle["selection-box-color"].value[0]+","+coreStyle["selection-box-color"].value[1]+","+coreStyle["selection-box-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")",context.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),borderWidth>0&&(context.strokeStyle="rgba("+coreStyle["selection-box-border-color"].value[0]+","+coreStyle["selection-box-border-color"].value[1]+","+coreStyle["selection-box-border-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")",context.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(data.bgActivePosistion&&!r.hoverData.selecting){var zoom=r.cy.zoom(),pos=data.bgActivePosistion;context.fillStyle="rgba("+coreStyle["active-bg-color"].value[0]+","+coreStyle["active-bg-color"].value[1]+","+coreStyle["active-bg-color"].value[2]+","+coreStyle["active-bg-opacity"].value+")",context.beginPath(),context.arc(pos.x,pos.y,coreStyle["active-bg-size"].pfValue/zoom,0,2*Math.PI),context.fill()}var timeToRender=r.lastRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender);context.setTransform(1,0,0,1,0,0),context.fillStyle="rgba(255, 0, 0, 0.75)",context.strokeStyle="rgba(255, 0, 0, 0.75)",context.lineWidth=1,context.fillText("1 frame = "+timeToRender+" ms = "+fps+" fps",0,20);var maxFps=60;context.strokeRect(0,30,250,20),context.fillRect(0,30,250*Math.min(fps/maxFps,1),20)}drawAllLayers||(needDraw[r.SELECT_BOX]=!1)}if(motionBlur&&1!==mbPxRatio){var cxtNode=data.contexts[r.NODE],txtNode=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE],cxtDrag=data.contexts[r.DRAG],txtDrag=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG],drawMotionBlur=function(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0),needClear||!motionBlurFadeEffect?cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight):mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight);var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};(needDraw[r.NODE]||needMbClear[r.NODE])&&(drawMotionBlur(cxtNode,txtNode,needMbClear[r.NODE]),needDraw[r.NODE]=!1),(needDraw[r.DRAG]||needMbClear[r.DRAG])&&(drawMotionBlur(cxtDrag,txtDrag,needMbClear[r.DRAG]),needDraw[r.DRAG]=!1)}r.prevViewport=vp,r.clearingMotionBlur&&(r.clearingMotionBlur=!1,r.motionBlurCleared=!0,r.motionBlur=!0),motionBlur&&(r.motionBlurTimeout=setTimeout(function(){r.motionBlurTimeout=null,r.clearedForMotionBlur[r.NODE]=!1,r.clearedForMotionBlur[r.DRAG]=!1,r.motionBlur=!1,r.clearingMotionBlur=!textureDraw,r.mbFrames=0,needDraw[r.NODE]=!0,needDraw[r.DRAG]=!0,r.redraw()},motionBlurDelay)),r.drawingImage=!1,forcedContext||r.initrender||(r.initrender=!0,cy.trigger("initrender")),forcedContext||cy.trigger("render")},module.exports=CRp},{"../../../util":100}],71:[function(_dereq_,module,exports){"use strict";var math=_dereq_("../../../math"),CRp={};CRp.drawPolygonPath=function(context,x,y,width,height,points){var halfW=width/2,halfH=height/2;context.beginPath&&context.beginPath(),context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++)context.lineTo(x+halfW*points[2*i],y+halfH*points[2*i+1]);context.closePath()},CRp.drawRoundRectanglePath=function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2,cornerRadius=math.getRoundRectangleRadius(width,height);context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius),context.lineTo(x,y-halfHeight),context.closePath()};for(var sin0=Math.sin(0),cos0=Math.cos(0),sin={},cos={},ellipseStepSize=Math.PI/40,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)sin[i]=Math.sin(i),cos[i]=Math.cos(i);CRp.drawEllipsePath=function(context,centerX,centerY,width,height){if(context.beginPath&&context.beginPath(),context.ellipse)context.ellipse(centerX,centerY,width/2,height/2,0,0,2*Math.PI);else for(var xPos,yPos,rw=width/2,rh=height/2,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0,yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0,0===i?context.moveTo(xPos,yPos):context.lineTo(xPos,yPos);context.closePath()},module.exports=CRp},{"../../../math":85}],72:[function(_dereq_,module,exports){"use strict";var math=_dereq_("../../../math"),util=_dereq_("../../../util"),Heap=_dereq_("../../../heap"),defs=_dereq_("./texture-cache-defs"),minTxrH=25,txrStepH=50,minLvl=-4,maxLvl=2,maxZoom=3.99,eleTxrSpacing=8,defTxrWidth=1024,maxTxrW=1024,maxTxrH=1024,minUtility=.5,maxFullness=.8,maxFullnessChecks=10,allowEdgeTxrCaching=!1,allowParentTxrCaching=!1,deqCost=.15,deqAvgCost=.1,deqNoDrawCost=.9,deqFastCost=.9,deqRedrawThreshold=100,maxDeqSize=1,getTxrReasons={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},ElementTextureCache=function(renderer){var self=this;self.renderer=renderer,self.onDequeues=[],self.setupDequeueing()},ETCp=ElementTextureCache.prototype;ETCp.reasons=getTxrReasons,ETCp.getTextureQueue=function(txrH){var self=this;return self.eleImgCaches=self.eleImgCaches||{},self.eleImgCaches[txrH]=self.eleImgCaches[txrH]||[]},ETCp.getRetiredTextureQueue=function(txrH){var self=this,rtxtrQs=self.eleImgCaches.retired=self.eleImgCaches.retired||{},rtxtrQ=rtxtrQs[txrH]=rtxtrQs[txrH]||[];return rtxtrQ},ETCp.getElementQueue=function(){var self=this,q=self.eleCacheQueue=self.eleCacheQueue||new Heap(function(a,b){return b.reqs-a.reqs});return q},ETCp.getElementIdToQueue=function(){var self=this,id2q=self.eleIdToCacheQueue=self.eleIdToCacheQueue||{};return id2q},ETCp.getElement=function(ele,bb,pxRatio,lvl,reason){var self=this,r=this.renderer,rs=ele._private.rscratch,zoom=r.cy.zoom();if(0===bb.w||0===bb.h)return null;if(null==lvl&&(lvl=Math.ceil(math.log2(zoom*pxRatio))),lvl<minLvl)lvl=minLvl;else if(zoom>=maxZoom||lvl>maxLvl)return null;var scale=Math.pow(2,lvl),eleScaledH=bb.h*scale,eleScaledW=bb.w*scale,caches=rs.imgCaches=rs.imgCaches||{},eleCache=caches[lvl];if(eleCache)return eleCache;var txrH;if(txrH=eleScaledH<=minTxrH?minTxrH:eleScaledH<=txrStepH?txrStepH:Math.ceil(eleScaledH/txrStepH)*txrStepH,eleScaledH>maxTxrH||eleScaledW>maxTxrW||!allowEdgeTxrCaching&&ele.isEdge()||!allowParentTxrCaching&&ele.isParent())return null;var txrQ=self.getTextureQueue(txrH),txr=txrQ[txrQ.length-2],addNewTxr=function(){return self.recycleTexture(txrH,eleScaledW)||self.addTexture(txrH,eleScaledW)};txr||(txr=txrQ[txrQ.length-1]),txr||(txr=addNewTxr()),txr.width-txr.usedWidth<eleScaledW&&(txr=addNewTxr());for(var scaledLabelShown=r.eleTextBiggerThanMin(ele,scale),scalableFrom=function(otherCache){return otherCache&&otherCache.scaledLabelShown===scaledLabelShown},deqing=reason&&reason===getTxrReasons.dequeue,highQualityReq=reason&&reason===getTxrReasons.highQuality,downscaleReq=reason&&reason===getTxrReasons.downscale,higherCache,l=lvl+1;l<=maxLvl;l++){var c=caches[l];if(c){higherCache=c;break}}var oneUpCache=higherCache&&higherCache.level===lvl+1?higherCache:null,downscale=function(){txr.context.drawImage(oneUpCache.texture.canvas,oneUpCache.x,0,oneUpCache.width,oneUpCache.height,txr.usedWidth,0,eleScaledW,eleScaledH);
};if(scalableFrom(oneUpCache))downscale();else if(scalableFrom(higherCache)){if(!highQualityReq)return self.queueElement(ele,bb,higherCache.level-1),higherCache;for(var l=higherCache.level;l>lvl;l--)oneUpCache=self.getElement(ele,bb,pxRatio,l,getTxrReasons.downscale);downscale()}else{var lowerCache;if(!deqing&&!highQualityReq&&!downscaleReq)for(var l=lvl-1;l>=minLvl;l--){var c=caches[l];if(c){lowerCache=c;break}}if(scalableFrom(lowerCache))return self.queueElement(ele,bb,lvl),lowerCache;txr.context.translate(txr.usedWidth,0),txr.context.scale(scale,scale),r.drawElement(txr.context,ele,bb,scaledLabelShown),txr.context.scale(1/scale,1/scale),txr.context.translate(-txr.usedWidth,0)}return eleCache=caches[lvl]={ele:ele,x:txr.usedWidth,texture:txr,level:lvl,scale:scale,width:eleScaledW,height:eleScaledH,scaledLabelShown:scaledLabelShown},txr.usedWidth+=Math.ceil(eleScaledW+eleTxrSpacing),txr.eleCaches.push(eleCache),self.checkTextureFullness(txr),eleCache},ETCp.invalidateElement=function(ele){var self=this,caches=ele._private.rscratch.imgCaches;if(caches)for(var lvl=minLvl;lvl<=maxLvl;lvl++){var cache=caches[lvl];if(cache){var txr=cache.texture;txr.invalidatedWidth+=cache.width,caches[lvl]=null,util.removeFromArray(txr.eleCaches,cache),self.checkTextureUtility(txr)}}},ETCp.checkTextureUtility=function(txr){txr.invalidatedWidth>=minUtility*txr.width&&this.retireTexture(txr)},ETCp.checkTextureFullness=function(txr){var self=this,txrQ=self.getTextureQueue(txr.height);txr.usedWidth/txr.width>maxFullness&&txr.fullnessChecks>=maxFullnessChecks?util.removeFromArray(txrQ,txr):txr.fullnessChecks++},ETCp.retireTexture=function(txr){var self=this,txrH=txr.height,txrQ=self.getTextureQueue(txrH);util.removeFromArray(txrQ,txr),txr.retired=!0;for(var eleCaches=txr.eleCaches,i=0;i<eleCaches.length;i++){var eleCache=eleCaches[i],ele=eleCache.ele,lvl=eleCache.level,imgCaches=ele._private.rscratch.imgCaches;imgCaches&&(imgCaches[lvl]=null)}util.clearArray(eleCaches);var rtxtrQ=self.getRetiredTextureQueue(txrH);rtxtrQ.push(txr)},ETCp.addTexture=function(txrH,minW){var self=this,txrQ=self.getTextureQueue(txrH),txr={};return txrQ.push(txr),txr.eleCaches=[],txr.height=txrH,txr.width=Math.max(defTxrWidth,minW),txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,txr.canvas=document.createElement("canvas"),txr.canvas.width=txr.width,txr.canvas.height=txr.height,txr.context=txr.canvas.getContext("2d"),txr},ETCp.recycleTexture=function(txrH,minW){for(var self=this,txrQ=self.getTextureQueue(txrH),rtxtrQ=self.getRetiredTextureQueue(txrH),i=0;i<rtxtrQ.length;i++){var txr=rtxtrQ[i];if(txr.width>=minW)return txr.retired=!1,txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,util.clearArray(txr.eleCaches),txr.context.clearRect(0,0,txr.width,txr.height),util.removeFromArray(rtxtrQ,txr),txrQ.push(txr),txr}},ETCp.queueElement=function(ele,bb,lvl){var self=this,q=self.getElementQueue(),id2q=self.getElementIdToQueue(),id=ele.id(),existingReq=id2q[id];if(existingReq)existingReq.level=Math.max(existingReq.level,lvl),existingReq.reqs++,q.updateItem(existingReq);else{var req={ele:ele,bb:bb,position:math.copyPosition(ele.position()),level:lvl,reqs:1};ele.isEdge()&&(req.positions={source:math.copyPosition(ele.source().position()),target:math.copyPosition(ele.target().position())}),q.push(req),id2q[id]=req}},ETCp.dequeue=function(pxRatio,extent){for(var self=this,q=self.getElementQueue(),id2q=self.getElementIdToQueue(),dequeued=[],i=0;i<maxDeqSize&&q.size()>0;i++){var req=q.pop();id2q[req.ele.id()]=null,dequeued.push(req);var ele=req.ele,bb;bb=(!ele.isEdge()||math.arePositionsSame(ele.source().position(),req.positions.source)&&math.arePositionsSame(ele.target().position(),req.positions.target))&&math.arePositionsSame(ele.position(),req.position)?req.bb:ele.boundingBox(),self.getElement(req.ele,bb,pxRatio,req.level,getTxrReasons.dequeue)}return dequeued},ETCp.onDequeue=function(fn){this.onDequeues.push(fn)},ETCp.offDequeue=function(fn){util.removeFromArray(this.onDequeues,fn)},ETCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold,deqCost:deqCost,deqAvgCost:deqAvgCost,deqNoDrawCost:deqNoDrawCost,deqFastCost:deqFastCost,deq:function(self,pxRatio,extent){return self.dequeue(pxRatio,extent)},onDeqd:function(self,deqd){for(var i=0;i<self.onDequeues.length;i++){var fn=self.onDequeues[i];fn(deqd)}},shouldRedraw:function(self,deqd,pxRatio,extent){for(var i=0;i<deqd.length;i++){var bb=deqd[i].bb;if(math.boundingBoxesIntersect(bb,extent))return!0}return!1},priority:function(self){return self.renderer.beforeRenderPriorities.eleTxrDeq}}),module.exports=ElementTextureCache},{"../../../heap":81,"../../../math":85,"../../../util":100,"./texture-cache-defs":77}],73:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../../../is"),CRp={};CRp.createBuffer=function(w,h){var buffer=document.createElement("canvas");return buffer.width=w,buffer.height=h,[buffer,buffer.getContext("2d")]},CRp.bufferCanvasImage=function(options){var cy=this.cy,eles=cy.mutableElements(),bb=eles.boundingBox(),ctrRect=this.findContainerClientCoords(),width=options.full?Math.ceil(bb.w):ctrRect[2],height=options.full?Math.ceil(bb.h):ctrRect[3],specdMaxDims=is.number(options.maxWidth)||is.number(options.maxHeight),pxRatio=this.getPixelRatio(),scale=1;if(void 0!==options.scale)width*=options.scale,height*=options.scale,scale=options.scale;else if(specdMaxDims){var maxScaleW=1/0,maxScaleH=1/0;is.number(options.maxWidth)&&(maxScaleW=scale*options.maxWidth/width),is.number(options.maxHeight)&&(maxScaleH=scale*options.maxHeight/height),scale=Math.min(maxScaleW,maxScaleH),width*=scale,height*=scale}specdMaxDims||(width*=pxRatio,height*=pxRatio,scale*=pxRatio);var buffCanvas=document.createElement("canvas");buffCanvas.width=width,buffCanvas.height=height,buffCanvas.style.width=width+"px",buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0){buffCxt.clearRect(0,0,width,height),options.bg&&(buffCxt.fillStyle=options.bg,buffCxt.rect(0,0,width,height),buffCxt.fill()),buffCxt.globalCompositeOperation="source-over";var zsortedEles=this.getCachedZSortedEles();if(options.full)buffCxt.translate(-bb.x1*scale,-bb.y1*scale),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles);else{var pan=cy.pan(),translation={x:pan.x*scale,y:pan.y*scale};scale*=cy.zoom(),buffCxt.translate(translation.x,translation.y),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles)}}return buffCanvas},CRp.png=function(options){return this.bufferCanvasImage(options).toDataURL("image/png")},CRp.jpg=function(options){return this.bufferCanvasImage(options).toDataURL("image/jpeg")},module.exports=CRp},{"../../../is":83}],74:[function(_dereq_,module,exports){"use strict";function CanvasRenderer(options){var r=this;r.data={canvases:new Array(CRp.CANVAS_LAYERS),contexts:new Array(CRp.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CRp.CANVAS_LAYERS),bufferCanvases:new Array(CRp.BUFFER_COUNT),bufferContexts:new Array(CRp.CANVAS_LAYERS)},r.data.canvasContainer=document.createElement("div");var containerStyle=r.data.canvasContainer.style;r.data.canvasContainer.setAttribute("style","-webkit-tap-highlight-color: rgba(0,0,0,0);"),containerStyle.position="relative",containerStyle.zIndex="0",containerStyle.overflow="hidden";var container=options.cy.container();container.appendChild(r.data.canvasContainer),container.setAttribute("style",(container.getAttribute("style")||"")+"-webkit-tap-highlight-color: rgba(0,0,0,0);");for(var i=0;i<CRp.CANVAS_LAYERS;i++){var canvas=r.data.canvases[i]=document.createElement("canvas");r.data.contexts[i]=canvas.getContext("2d"),canvas.setAttribute("style","-webkit-user-select: none; -moz-user-select: -moz-none; user-select: none; -webkit-tap-highlight-color: rgba(0,0,0,0); outline-style: none;"+(is.ms()?" -ms-touch-action: none; touch-action: none; ":"")),canvas.style.position="absolute",canvas.setAttribute("data-id","layer"+i),canvas.style.zIndex=String(CRp.CANVAS_LAYERS-i),r.data.canvasContainer.appendChild(canvas),r.data.canvasNeedsRedraw[i]=!1}r.data.topCanvas=r.data.canvases[0],r.data.canvases[CRp.NODE].setAttribute("data-id","layer"+CRp.NODE+"-node"),r.data.canvases[CRp.SELECT_BOX].setAttribute("data-id","layer"+CRp.SELECT_BOX+"-selectbox"),r.data.canvases[CRp.DRAG].setAttribute("data-id","layer"+CRp.DRAG+"-drag");for(var i=0;i<CRp.BUFFER_COUNT;i++)r.data.bufferCanvases[i]=document.createElement("canvas"),r.data.bufferContexts[i]=r.data.bufferCanvases[i].getContext("2d"),r.data.bufferCanvases[i].style.position="absolute",r.data.bufferCanvases[i].setAttribute("data-id","buffer"+i),r.data.bufferCanvases[i].style.zIndex=String(-i-1),r.data.bufferCanvases[i].style.visibility="hidden";r.pathsEnabled=!0,r.data.eleTxrCache=new ElementTextureCache(r),r.data.lyrTxrCache=new LayeredTextureCache(r,r.data.eleTxrCache),r.onUpdateEleCalcs(function invalidateTextureCaches(willDraw,eles){for(var i=0;i<eles.length;i++){var ele=eles[i],rs=ele._private.rstyle,de=rs.dirtyEvents;ele.isNode()&&de&&1===de.length&&de.position||r.data.eleTxrCache.invalidateElement(ele)}eles.length>0&&r.data.lyrTxrCache.invalidateElements(eles)})}var util=_dereq_("../../../util"),is=_dereq_("../../../is"),ElementTextureCache=_dereq_("./ele-texture-cache"),LayeredTextureCache=_dereq_("./layered-texture-cache"),CR=CanvasRenderer,CRp=CanvasRenderer.prototype;CRp.CANVAS_LAYERS=3,CRp.SELECT_BOX=0,CRp.DRAG=1,CRp.NODE=2,CRp.BUFFER_COUNT=3,CRp.TEXTURE_BUFFER=0,CRp.MOTIONBLUR_BUFFER_NODE=1,CRp.MOTIONBLUR_BUFFER_DRAG=2,CRp.redrawHint=function(group,bool){var r=this;switch(group){case"eles":r.data.canvasNeedsRedraw[CRp.NODE]=bool;break;case"drag":r.data.canvasNeedsRedraw[CRp.DRAG]=bool;break;case"select":r.data.canvasNeedsRedraw[CRp.SELECT_BOX]=bool}};var pathsImpld="undefined"!=typeof Path2D;CRp.path2dEnabled=function(on){return void 0===on?this.pathsEnabled:void(this.pathsEnabled=!!on)},CRp.usePaths=function(){return pathsImpld&&this.pathsEnabled},[_dereq_("./arrow-shapes"),_dereq_("./drawing-elements"),_dereq_("./drawing-edges"),_dereq_("./drawing-images"),_dereq_("./drawing-label-text"),_dereq_("./drawing-nodes"),_dereq_("./drawing-redraw"),_dereq_("./drawing-shapes"),_dereq_("./export-image"),_dereq_("./node-shapes")].forEach(function(props){util.extend(CRp,props)}),module.exports=CR},{"../../../is":83,"../../../util":100,"./arrow-shapes":64,"./drawing-edges":65,"./drawing-elements":66,"./drawing-images":67,"./drawing-label-text":68,"./drawing-nodes":69,"./drawing-redraw":70,"./drawing-shapes":71,"./ele-texture-cache":72,"./export-image":73,"./layered-texture-cache":75,"./node-shapes":76}],75:[function(_dereq_,module,exports){"use strict";function imgSmoothing(context,bool){null!=context.imageSmoothingEnabled?context.imageSmoothingEnabled=bool:(context.webkitImageSmoothingEnabled=bool,context.mozImageSmoothingEnabled=bool,context.msImageSmoothingEnabled=bool)}var util=_dereq_("../../../util"),math=_dereq_("../../../math"),Heap=_dereq_("../../../heap"),is=_dereq_("../../../is"),defs=_dereq_("./texture-cache-defs"),defNumLayers=1,minLvl=-4,maxLvl=2,maxZoom=3.99,deqRedrawThreshold=50,refineEleDebounceTime=50,disableEleImgSmoothing=!0,deqCost=.15,deqAvgCost=.1,deqNoDrawCost=.9,deqFastCost=.9,maxDeqSize=1,invalidThreshold=250,maxLayerArea=16e6,alwaysQueue=!0,useHighQualityEleTxrReqs=!0,useEleTxrCaching=!0,LayeredTextureCache=function(renderer,eleTxrCache){var self=this,r=self.renderer=renderer;self.layersByLevel={},self.firstGet=!0,self.lastInvalidationTime=util.performanceNow()-2*invalidThreshold,self.skipping=!1,r.beforeRender(function(willDraw,now){now-self.lastInvalidationTime<=invalidThreshold?self.skipping=!0:self.skipping=!1});var qSort=function(a,b){return b.reqs-a.reqs};self.layersQueue=new Heap(qSort),self.eleTxrCache=eleTxrCache,self.setupEleCacheInvalidation(),self.setupDequeueing()},LTCp=LayeredTextureCache.prototype,layerIdPool=0,MAX_INT=Math.pow(2,53)-1;LTCp.makeLayer=function(bb,lvl){var scale=Math.pow(2,lvl),w=Math.ceil(bb.w*scale),h=Math.ceil(bb.h*scale),canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;var layer={id:layerIdPool=++layerIdPool%MAX_INT,bb:bb,level:lvl,width:w,height:h,canvas:canvas,context:canvas.getContext("2d"),eles:[],elesQueue:[],reqs:0},cxt=layer.context,dx=-layer.bb.x1,dy=-layer.bb.y1;return cxt.scale(scale,scale),cxt.translate(dx,dy),layer},LTCp.getLayers=function(eles,pxRatio,lvl){var self=this,r=self.renderer,cy=r.cy,zoom=cy.zoom(),firstGet=self.firstGet;if(self.firstGet=!1,null==lvl)if(lvl=Math.ceil(math.log2(zoom*pxRatio)),lvl<minLvl)lvl=minLvl;else if(zoom>=maxZoom||lvl>maxLvl)return null;self.validateLayersElesOrdering(lvl,eles);var layersByLvl=self.layersByLevel,scale=Math.pow(2,lvl),layers=layersByLvl[lvl]=layersByLvl[lvl]||[],bb,lvlComplete=self.levelIsComplete(lvl,eles),tmpLayers,checkTempLevels=function(){var canUseAsTmpLvl=function(l){if(self.validateLayersElesOrdering(l,eles),self.levelIsComplete(l,eles))return tmpLayers=layersByLvl[l],!0},checkLvls=function(dir){if(!tmpLayers)for(var l=lvl+dir;minLvl<=l&&l<=maxLvl&&!canUseAsTmpLvl(l);l+=dir);};checkLvls(1),checkLvls(-1);for(var i=layers.length-1;i>=0;i--){var layer=layers[i];layer.invalid&&util.removeFromArray(layers,layer)}};if(lvlComplete)return layers;checkTempLevels();var getBb=function(){if(!bb){bb=math.makeBoundingBox();for(var i=0;i<eles.length;i++)math.updateBoundingBox(bb,eles[i].boundingBox())}return bb},makeLayer=function(opts){opts=opts||{};var after=opts.after;getBb();var area=bb.w*scale*(bb.h*scale);if(area>maxLayerArea)return null;var layer=self.makeLayer(bb,lvl);if(null!=after){var index=layers.indexOf(after)+1;layers.splice(index,0,layer)}else(void 0===opts.insert||opts.insert)&&layers.unshift(layer);return layer};if(self.skipping&&!firstGet)return null;for(var layer=null,maxElesPerLayer=eles.length/defNumLayers,allowLazyQueueing=alwaysQueue&&!firstGet,i=0;i<eles.length;i++){var ele=eles[i],rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},existingLayer=caches[lvl];if(existingLayer)layer=existingLayer;else{if((!layer||layer.eles.length>=maxElesPerLayer||!math.boundingBoxInBoundingBox(layer.bb,ele.boundingBox()))&&(layer=makeLayer({insert:!0,after:layer}),!layer))return null;tmpLayers||allowLazyQueueing?self.queueLayer(layer,ele):self.drawEleInLayer(layer,ele,lvl,pxRatio),layer.eles.push(ele),caches[lvl]=layer}}return tmpLayers?tmpLayers:allowLazyQueueing?null:layers},LTCp.getEleLevelForLayerLevel=function(lvl,pxRatio){return lvl},LTCp.drawEleInLayer=function(layer,ele,lvl,pxRatio){var self=this,r=this.renderer,context=layer.context,bb=ele.boundingBox();if(0!==bb.w&&0!==bb.h){var eleCache=self.eleTxrCache,reason=useHighQualityEleTxrReqs?eleCache.reasons.highQuality:void 0;lvl=self.getEleLevelForLayerLevel(lvl,pxRatio);var cache=useEleTxrCaching?eleCache.getElement(ele,bb,null,lvl,reason):null;cache?(disableEleImgSmoothing&&imgSmoothing(context,!1),context.drawImage(cache.texture.canvas,cache.x,0,cache.width,cache.height,bb.x1,bb.y1,bb.w,bb.h),disableEleImgSmoothing&&imgSmoothing(context,!0)):r.drawElement(context,ele)}},LTCp.levelIsComplete=function(lvl,eles){var self=this,layers=self.layersByLevel[lvl];if(!layers||0===layers.length)return!1;for(var numElesInLayers=0,i=0;i<layers.length;i++){var layer=layers[i];if(layer.reqs>0)return!1;if(layer.invalid)return!1;numElesInLayers+=layer.eles.length}return numElesInLayers===eles.length},LTCp.validateLayersElesOrdering=function(lvl,eles){var layers=this.layersByLevel[lvl];if(layers)for(var i=0;i<layers.length;i++){for(var layer=layers[i],offset=-1,j=0;j<eles.length;j++)if(layer.eles[0]===eles[j]){offset=j;break}if(offset<0)this.invalidateLayer(layer);else for(var o=offset,j=0;j<layer.eles.length;j++)if(layer.eles[j]!==eles[o+j]){this.invalidateLayer(layer);break}}},LTCp.updateElementsInLayers=function(eles,update){for(var self=this,isEles=is.element(eles[0]),i=0;i<eles.length;i++)for(var req=isEles?null:eles[i],ele=isEles?eles[i]:eles[i].ele,rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},l=minLvl;l<=maxLvl;l++){var layer=caches[l];layer&&(req&&self.getEleLevelForLayerLevel(layer.level)!==req.level||update(layer,ele,req))}},LTCp.haveLayers=function(){for(var self=this,haveLayers=!1,l=minLvl;l<=maxLvl;l++){var layers=self.layersByLevel[l];if(layers&&layers.length>0){haveLayers=!0;break}}return haveLayers},LTCp.invalidateElements=function(eles){var self=this;self.lastInvalidationTime=util.performanceNow(),0!==eles.length&&self.haveLayers()&&self.updateElementsInLayers(eles,function invalAssocLayers(layer,ele,req){self.invalidateLayer(layer)})},LTCp.invalidateLayer=function(layer){if(this.lastInvalidationTime=util.performanceNow(),!layer.invalid){var lvl=layer.level,eles=layer.eles,layers=this.layersByLevel[lvl];util.removeFromArray(layers,layer),layer.elesQueue=[],layer.invalid=!0,layer.replacement&&(layer.replacement.invalid=!0);for(var i=0;i<eles.length;i++){var caches=eles[i]._private.rscratch.imgLayerCaches;caches&&(caches[lvl]=null)}}},LTCp.refineElementTextures=function(eles){var self=this;self.updateElementsInLayers(eles,function refineEachEle(layer,ele,req){var rLyr=layer.replacement;if(rLyr||(rLyr=layer.replacement=self.makeLayer(layer.bb,layer.level),rLyr.replaces=layer,rLyr.eles=layer.eles),!rLyr.reqs)for(var i=0;i<rLyr.eles.length;i++)self.queueLayer(rLyr,rLyr.eles[i])})},LTCp.setupEleCacheInvalidation=function(){var self=this,eleDeqs=[];if(useEleTxrCaching){var updatedElesInLayers=util.debounce(function(){self.refineElementTextures(eleDeqs),eleDeqs=[]},refineEleDebounceTime);self.eleTxrCache.onDequeue(function(reqs){for(var i=0;i<reqs.length;i++)eleDeqs.push(reqs[i]);updatedElesInLayers()})}},LTCp.queueLayer=function(layer,ele){var self=this,q=self.layersQueue,elesQ=layer.elesQueue,hasId=elesQ.hasId=elesQ.hasId||{};if(!layer.replacement){if(ele){if(hasId[ele.id()])return;elesQ.push(ele),hasId[ele.id()]=!0}layer.reqs?(layer.reqs++,q.updateItem(layer)):(layer.reqs=1,q.push(layer))}},LTCp.dequeue=function(pxRatio){for(var self=this,q=self.layersQueue,deqd=[],eleDeqs=0;eleDeqs<maxDeqSize&&0!==q.size();){var layer=q.peek();if(layer.replacement)q.pop();else if(layer.replaces&&layer!==layer.replaces.replacement)q.pop();else if(layer.invalid)q.pop();else{var ele=layer.elesQueue.shift();ele&&(self.drawEleInLayer(layer,ele,layer.level,pxRatio),eleDeqs++),0===deqd.length&&deqd.push(!0),0===layer.elesQueue.length&&(q.pop(),layer.reqs=0,layer.replaces&&self.applyLayerReplacement(layer),self.requestRedraw())}}return deqd},LTCp.applyLayerReplacement=function(layer){var self=this,layersInLevel=self.layersByLevel[layer.level],replaced=layer.replaces,index=layersInLevel.indexOf(replaced);if(!(index<0||replaced.invalid)){layersInLevel[index]=layer;for(var i=0;i<layer.eles.length;i++){var _p=layer.eles[i]._private,cache=_p.imgLayerCaches=_p.imgLayerCaches||{};cache&&(cache[layer.level]=layer)}self.requestRedraw()}},LTCp.requestRedraw=util.debounce(function(){var r=this.renderer;r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},100),LTCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold,deqCost:deqCost,deqAvgCost:deqAvgCost,deqNoDrawCost:deqNoDrawCost,deqFastCost:deqFastCost,deq:function(self,pxRatio){return self.dequeue(pxRatio)},onDeqd:util.noop,shouldRedraw:util.trueify,priority:function(self){return self.renderer.beforeRenderPriorities.lyrTxrDeq}}),module.exports=LayeredTextureCache},{"../../../heap":81,"../../../is":83,"../../../math":85,"../../../util":100,"./texture-cache-defs":77}],76:[function(_dereq_,module,exports){"use strict";var CRp={};CRp.nodeShapeImpl=function(name,context,centerX,centerY,width,height,points){switch(name){case"ellipse":return this.drawEllipsePath(context,centerX,centerY,width,height);case"polygon":return this.drawPolygonPath(context,centerX,centerY,width,height,points);case"roundrectangle":return this.drawRoundRectanglePath(context,centerX,centerY,width,height)}},module.exports=CRp},{}],77:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../../../util"),fullFpsTime=1e3/60;module.exports={setupDequeueing:function(opts){return function setupDequeueingImpl(){var self=this,r=this.renderer;if(!self.dequeueingSetup){self.dequeueingSetup=!0;var queueRedraw=util.debounce(function(){r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},opts.deqRedrawThreshold),dequeue=function(willDraw,frameStartTime){for(var startTime=util.performanceNow(),avgRenderTime=r.averageRedrawTime,renderTime=r.lastRedrawTime,deqd=[],extent=r.cy.extent(),pixelRatio=r.getPixelRatio();;){var now=util.performanceNow(),duration=now-startTime,frameDuration=now-frameStartTime;if(renderTime<fullFpsTime){var timeAvailable=fullFpsTime-(willDraw?avgRenderTime:0);if(frameDuration>=opts.deqFastCost*timeAvailable)break}else if(willDraw){if(duration>=opts.deqCost*renderTime||duration>=opts.deqAvgCost*avgRenderTime)break}else if(frameDuration>=opts.deqNoDrawCost*fullFpsTime)break;var thisDeqd=opts.deq(self,pixelRatio,extent);if(!(thisDeqd.length>0))break;for(var i=0;i<thisDeqd.length;i++)deqd.push(thisDeqd[i])}deqd.length>0&&(opts.onDeqd(self,deqd),!willDraw&&opts.shouldRedraw(self,deqd,pixelRatio,extent)&&queueRedraw())},priority=opts.priority||util.noop;r.beforeRender(dequeue,priority(self))}}}}},{"../../../util":100}],78:[function(_dereq_,module,exports){"use strict";module.exports=[{name:"null",impl:_dereq_("./null")},{name:"base",impl:_dereq_("./base")},{name:"canvas",impl:_dereq_("./canvas")}]},{"./base":60,"./canvas":74,"./null":79}],79:[function(_dereq_,module,exports){"use strict";function NullRenderer(options){this.options=options,this.notifications=0}var noop=function(){};NullRenderer.prototype={recalculateRenderedStyle:noop,notify:function(){this.notifications++},init:noop},module.exports=NullRenderer},{}],80:[function(_dereq_,module,exports){"use strict";var is=_dereq_("./is"),util=_dereq_("./util"),Thread=_dereq_("./thread"),Promise=_dereq_("./promise"),define=_dereq_("./define"),Fabric=function(N){if(!(this instanceof Fabric))return new Fabric(N);this._private={pass:[]};var defN=4;if(is.number(N),"undefined"!=typeof navigator&&null!=navigator.hardwareConcurrency)N=navigator.hardwareConcurrency;else try{N=_dereq_("os").cpus().length}catch(err){N=defN}for(var i=0;i<N;i++)this[i]=new Thread;this.length=N},fabfn=Fabric.prototype;util.extend(fabfn,{instanceString:function(){return"fabric"},require:function(fn,as){for(var i=0;i<this.length;i++){var thread=this[i];thread.require(fn,as)}return this},random:function(){var i=Math.round((this.length-1)*Math.random()),thread=this[i];return thread},run:function(fn){var pass=this._private.pass.shift();return this.random().pass(pass).run(fn)},message:function(m){return this.random().message(m)},broadcast:function(m){for(var i=0;i<this.length;i++){var thread=this[i];thread.message(m)}return this},stop:function(){for(var i=0;i<this.length;i++){var thread=this[i];thread.stop()}return this},pass:function(data){var pass=this._private.pass;if(!is.array(data))throw"Only arrays may be used with fabric.pass()";return pass.push(data),this},spreadSize:function(){var subsize=Math.ceil(this._private.pass[0].length/this.length);return subsize=Math.max(1,subsize)},spread:function(fn){for(var self=this,_p=self._private,subsize=self.spreadSize(),pass=_p.pass.shift().concat([]),runPs=[],i=0;i<this.length;i++){var thread=this[i],slice=pass.splice(0,subsize),runP=thread.pass(slice).run(fn);runPs.push(runP);var doneEarly=0===pass.length;if(doneEarly)break}return Promise.all(runPs).then(function(thens){for(var postpass=[],p=0,i=0;i<thens.length;i++)for(var then=thens[i],j=0;j<then.length;j++){var t=then[j];postpass[p++]=t}return postpass})},map:function(fn){var self=this;return self.require(fn,"_$_$_fabmap"),self.spread(function(split){var mapped=[],origResolve=resolve;resolve=function(val){mapped.push(val)};for(var i=0;i<split.length;i++){var oldLen=mapped.length,ret=_$_$_fabmap(split[i]),nothingInsdByResolve=oldLen===mapped.length;nothingInsdByResolve&&mapped.push(ret)}return resolve=origResolve,mapped})},filter:function(fn){var _p=this._private,pass=_p.pass[0];return this.map(fn).then(function(include){for(var ret=[],i=0;i<pass.length;i++){var datum=pass[i],incDatum=include[i];incDatum&&ret.push(datum)}return ret})},sort:function(cmp){var self=this,P=this._private.pass[0].length,subsize=this.spreadSize();return cmp=cmp||function(a,b){return a<b?-1:a>b?1:0},self.require(cmp,"_$_$_cmp"),self.spread(function(split){var sortedSplit=split.sort(_$_$_cmp);resolve(sortedSplit)}).then(function(joined){for(var merge=function(i,j,max){j=Math.min(j,P),max=Math.min(max,P);for(var l=i,r=j,sorted=[],k=l;k<max;k++){var eleI=joined[i],eleJ=joined[j];i<r&&(j>=max||cmp(eleI,eleJ)<=0)?(sorted.push(eleI),i++):(sorted.push(eleJ),j++)}for(var k=0;k<sorted.length;k++){var index=l+k;joined[index]=sorted[k]}},splitL=subsize;splitL<P;splitL*=2)for(var i=0;i<P;i+=2*splitL)merge(i,i+splitL,i+2*splitL);return joined})}});var defineRandomPasser=function(opts){return opts=opts||{},function(fn,arg1){var pass=this._private.pass.shift();return this.random().pass(pass)[opts.threadFn](fn,arg1)}};util.extend(fabfn,{randomMap:defineRandomPasser({threadFn:"map"}),reduce:defineRandomPasser({threadFn:"reduce"}),reduceRight:defineRandomPasser({threadFn:"reduceRight"})});var fn=fabfn;fn.promise=fn.run,fn.terminate=fn.halt=fn.stop,fn.include=fn.require,util.extend(fabfn,{on:define.on(),one:define.on({unbindSelfOnTrigger:!0}),off:define.off(),trigger:define.trigger()}),define.eventAliasesOn(fabfn),module.exports=Fabric},{"./define":44,"./is":83,"./promise":86,"./thread":98,"./util":100,os:void 0}],81:[function(_dereq_,module,exports){"use strict";var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min,defaultCmp=function(x,y){return x<y?-1:x>y?1:0},insort=function(a,x,lo,hi,cmp){var mid;if(null==lo&&(lo=0),null==cmp&&(cmp=defaultCmp),lo<0)throw new Error("lo must be non-negative");for(null==hi&&(hi=a.length);lo<hi;)mid=floor((lo+hi)/2),cmp(x,a[mid])<0?hi=mid:lo=mid+1;return[].splice.apply(a,[lo,lo-lo].concat(x)),x},heappush=function(array,item,cmp){return null==cmp&&(cmp=defaultCmp),array.push(item),_siftdown(array,0,array.length-1,cmp)},heappop=function(array,cmp){var lastelt,returnitem;return null==cmp&&(cmp=defaultCmp),lastelt=array.pop(),array.length?(returnitem=array[0],array[0]=lastelt,_siftup(array,0,cmp)):returnitem=lastelt,returnitem},heapreplace=function(array,item,cmp){var returnitem;return null==cmp&&(cmp=defaultCmp),returnitem=array[0],array[0]=item,_siftup(array,0,cmp),returnitem},heappushpop=function(array,item,cmp){var _ref;return null==cmp&&(cmp=defaultCmp),array.length&&cmp(array[0],item)<0&&(_ref=[array[0],item],item=_ref[0],array[0]=_ref[1],_siftup(array,0,cmp)),item},heapify=function(array,cmp){var i,_i,_j,_len,_ref,_ref1,_results,_results1;for(null==cmp&&(cmp=defaultCmp),_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--)_results1.push(_j);return _results1}.apply(this).reverse(),_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)i=_ref1[_i],_results.push(_siftup(array,i,cmp));return _results},updateItem=function(array,item,cmp){var pos;if(null==cmp&&(cmp=defaultCmp),pos=array.indexOf(item),pos!==-1)return _siftdown(array,0,pos,cmp),_siftup(array,pos,cmp)},nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(null==cmp&&(cmp=defaultCmp),result=array.slice(0,n),!result.length)return result;for(heapify(result,cmp),_ref=array.slice(n),_i=0,_len=_ref.length;_i<_len;_i++)elem=_ref[_i],heappushpop(result,elem,cmp);return result.sort(cmp).reverse()},nsmallest=function(array,n,cmp){var elem,i,los,result,_i,_j,_len,_ref,_ref1,_results;if(null==cmp&&(cmp=defaultCmp),10*n<=array.length){if(result=array.slice(0,n).sort(cmp),!result.length)return result;for(los=result[result.length-1],_ref=array.slice(n),_i=0,_len=_ref.length;_i<_len;_i++)elem=_ref[_i],cmp(elem,los)<0&&(insort(result,elem,0,null,cmp),result.pop(),los=result[result.length-1]);return result}for(heapify(array,cmp),_results=[],i=_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;i=0<=_ref1?++_j:--_j)_results.push(heappop(array,cmp));return _results},_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;for(null==cmp&&(cmp=defaultCmp),newitem=array[pos];pos>startpos&&(parentpos=pos-1>>1,parent=array[parentpos],cmp(newitem,parent)<0);)array[pos]=parent,pos=parentpos;return array[pos]=newitem},_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;for(null==cmp&&(cmp=defaultCmp),endpos=array.length,startpos=pos,newitem=array[pos],childpos=2*pos+1;childpos<endpos;)rightpos=childpos+1,rightpos<endpos&&!(cmp(array[childpos],array[rightpos])<0)&&(childpos=rightpos),array[pos]=array[childpos],pos=childpos,childpos=2*pos+1;return array[pos]=newitem,_siftdown(array,startpos,pos,cmp)},Heap=function(){function Heap(cmp){this.cmp=null!=cmp?cmp:defaultCmp,this.nodes=[]}return Heap.push=heappush,Heap.pop=heappop,Heap.replace=heapreplace,Heap.pushpop=heappushpop,Heap.heapify=heapify,Heap.updateItem=updateItem,Heap.nlargest=nlargest,Heap.nsmallest=nsmallest,Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)},Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)},Heap.prototype.peek=function(){return this.nodes[0]},Heap.prototype.contains=function(x){return this.nodes.indexOf(x)!==-1},Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)},Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)},Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)},Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)},Heap.prototype.clear=function(){return this.nodes=[]},Heap.prototype.empty=function(){return 0===this.nodes.length},Heap.prototype.size=function(){return this.nodes.length},Heap.prototype.clone=function(){var heap;return heap=new Heap,heap.nodes=this.nodes.slice(0),heap},Heap.prototype.toArray=function(){return this.nodes.slice(0)},Heap.prototype.insert=Heap.prototype.push,Heap.prototype.top=Heap.prototype.peek,Heap.prototype.front=Heap.prototype.peek,Heap.prototype.has=Heap.prototype.contains,Heap.prototype.copy=Heap.prototype.clone,Heap}(),module.exports=Heap},{}],82:[function(_dereq_,module,exports){"use strict";_dereq_("./-preamble");var window=_dereq_("./window"),is=_dereq_("./is"),Core=_dereq_("./core"),extension=_dereq_("./extension"),registerJquery=_dereq_("./jquery-plugin"),Stylesheet=_dereq_("./stylesheet"),Thread=_dereq_("./thread"),Fabric=_dereq_("./fabric"),cytoscape=function(options){return void 0===options&&(options={}),is.plainObject(options)?new Core(options):is.string(options)?extension.apply(extension,arguments):void 0};cytoscape.version=_dereq_("./version"),window&&window.jQuery&&registerJquery(window.jQuery,cytoscape),cytoscape.registerJquery=function(jQuery){registerJquery(jQuery,cytoscape)},cytoscape.stylesheet=cytoscape.Stylesheet=Stylesheet,cytoscape.thread=cytoscape.Thread=Thread,cytoscape.fabric=cytoscape.Fabric=Fabric,module.exports=cytoscape},{"./-preamble":1,"./core":37,"./extension":46,"./fabric":80,"./is":83,"./jquery-plugin":84,"./stylesheet":97,"./thread":98,"./version":106,"./window":107}],83:[function(_dereq_,module,exports){"use strict";var window=_dereq_("./window"),navigator=window?window.navigator:null,document=window?window.document:null,typeofstr="string",typeofobj=typeof{},typeoffn="function",typeofhtmlele=typeof HTMLElement,instanceStr=function(obj){return obj&&obj.instanceString&&is.fn(obj.instanceString)?obj.instanceString():null},is={defined:function(obj){return null!=obj},string:function(obj){return null!=obj&&typeof obj==typeofstr},fn:function(obj){return null!=obj&&typeof obj===typeoffn},array:function(obj){return Array.isArray?Array.isArray(obj):null!=obj&&obj instanceof Array;
},plainObject:function(obj){return null!=obj&&typeof obj===typeofobj&&!is.array(obj)&&obj.constructor===Object},object:function(obj){return null!=obj&&typeof obj===typeofobj},number:function(obj){return null!=obj&&"number"==typeof obj&&!isNaN(obj)},integer:function(obj){return is.number(obj)&&Math.floor(obj)===obj},bool:function(obj){return null!=obj&&typeof obj==typeof!0},htmlElement:function(obj){return"undefined"===typeofhtmlele?void 0:null!=obj&&obj instanceof HTMLElement},elementOrCollection:function(obj){return is.element(obj)||is.collection(obj)},element:function(obj){return"collection"===instanceStr(obj)&&obj._private.single},collection:function(obj){return"collection"===instanceStr(obj)&&!obj._private.single},core:function(obj){return"core"===instanceStr(obj)},style:function(obj){return"style"===instanceStr(obj)},stylesheet:function(obj){return"stylesheet"===instanceStr(obj)},event:function(obj){return"event"===instanceStr(obj)},thread:function(obj){return"thread"===instanceStr(obj)},fabric:function(obj){return"fabric"===instanceStr(obj)},emptyString:function(obj){return void 0===obj||null===obj||!(""!==obj&&!obj.match(/^\s+$/))},nonemptyString:function(obj){return!(!obj||!is.string(obj)||""===obj||obj.match(/^\s+$/))},domElement:function(obj){return"undefined"!=typeof HTMLElement&&obj instanceof HTMLElement},boundingBox:function(obj){return is.plainObject(obj)&&is.number(obj.x1)&&is.number(obj.x2)&&is.number(obj.y1)&&is.number(obj.y2)},promise:function(obj){return is.object(obj)&&is.fn(obj.then)},touch:function(){return window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},gecko:function(){return window&&("undefined"!=typeof InstallTrigger||"MozAppearance"in document.documentElement.style)},webkit:function(){return window&&("undefined"!=typeof webkitURL||"WebkitAppearance"in document.documentElement.style)},chromium:function(){return window&&"undefined"!=typeof chrome},khtml:function(){return navigator&&navigator.vendor.match(/kde/i)},khtmlEtc:function(){return is.khtml()||is.webkit()||is.chromium()},ms:function(){return navigator&&navigator.userAgent.match(/msie|trident|edge/i)},windows:function(){return navigator&&navigator.appVersion.match(/Win/i)},mac:function(){return navigator&&navigator.appVersion.match(/Mac/i)},linux:function(){return navigator&&navigator.appVersion.match(/Linux/i)},unix:function(){return navigator&&navigator.appVersion.match(/X11/i)}};module.exports=is},{"./window":107}],84:[function(_dereq_,module,exports){"use strict";var is=_dereq_("./is"),cyReg=function($ele){var d=$ele[0]._cyreg=$ele[0]._cyreg||{};return d},registerJquery=function($,cytoscape){$&&($.fn.cytoscape||($.fn.cytoscape=function(opts){var $this=$(this);if("get"===opts)return cyReg($this).cy;if(is.fn(opts)){var ready=opts,cy=cyReg($this).cy;if(cy&&cy.isReady())cy.trigger("ready",[],ready);else{var data=cyReg($this),readies=data.readies=data.readies||[];readies.push(ready)}}else if(is.plainObject(opts))return $this.each(function(){var options=$.extend({},opts,{container:$(this)[0]});cytoscape(options)})},$.cytoscape=cytoscape,null==$.fn.cy&&null==$.cy&&($.fn.cy=$.fn.cytoscape,$.cy=$.cytoscape)))};module.exports=registerJquery},{"./is":83}],85:[function(_dereq_,module,exports){"use strict";var math={};math.arePositionsSame=function(p1,p2){return p1.x===p2.x&&p1.y===p2.y},math.copyPosition=function(p){return{x:p.x,y:p.y}},math.array2point=function(arr){return{x:arr[0],y:arr[1]}},math.deg2rad=function(deg){return Math.PI*deg/180},math.log2=Math.log2||function(n){return Math.log(n)/Math.log(2)},math.signum=function(x){return x>0?1:x<0?-1:0},math.dist=function(p1,p2){return Math.sqrt(math.sqdist(p1,p2))},math.sqdist=function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},math.qbezierAt=function(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2},math.qbezierPtAt=function(p0,p1,p2,t){return{x:math.qbezierAt(p0.x,p1.x,p2.x,t),y:math.qbezierAt(p0.y,p1.y,p2.y,t)}},math.lineAt=function(p0,p1,t,d){var vec={x:p1.x-p0.x,y:p1.y-p0.y},vecDist=math.dist(p0,p1),normVec={x:vec.x/vecDist,y:vec.y/vecDist};t=null==t?0:t;var d=null!=d?d:t*vecDist;return{x:p0.x+normVec.x*d,y:p0.y+normVec.y*d}},math.lineAtDist=function(p0,p1,d){return math.lineAt(p0,p1,void 0,d)},math.triangleAngle=function(A,B,C){var a=math.dist(B,C),b=math.dist(A,C),c=math.dist(A,B);return Math.acos((a*a+b*b-c*c)/(2*a*b))},math.bound=function(min,val,max){return Math.max(min,Math.min(max,val))},math.makeBoundingBox=function(bb){if(null==bb)return{x1:1/0,y1:1/0,x2:-(1/0),y2:-(1/0),w:0,h:0};if(null!=bb.x1&&null!=bb.y1){if(null!=bb.x2&&null!=bb.y2&&bb.x2>=bb.x1&&bb.y2>=bb.y1)return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1};if(null!=bb.w&&null!=bb.h&&bb.w>=0&&bb.h>=0)return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}},math.updateBoundingBox=function(bb1,bb2){bb1.x1=Math.min(bb1.x1,bb2.x1),bb1.x2=Math.max(bb1.x2,bb2.x2),bb1.w=bb1.x2-bb1.x1,bb1.y1=Math.min(bb1.y1,bb2.y1),bb1.y2=Math.max(bb1.y2,bb2.y2),bb1.h=bb1.y2-bb1.y1},math.expandBoundingBox=function(bb,padding){return bb.x1-=padding,bb.x2+=padding,bb.y1-=padding,bb.y2+=padding,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,bb},math.boundingBoxesIntersect=function(bb1,bb2){return!(bb1.x1>bb2.x2)&&(!(bb2.x1>bb1.x2)&&(!(bb1.x2<bb2.x1)&&(!(bb2.x2<bb1.x1)&&(!(bb1.y2<bb2.y1)&&(!(bb2.y2<bb1.y1)&&(!(bb1.y1>bb2.y2)&&!(bb2.y1>bb1.y2)))))))},math.inBoundingBox=function(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2},math.pointInBoundingBox=function(bb,pt){return this.inBoundingBox(bb,pt.x,pt.y)},math.boundingBoxInBoundingBox=function(bb1,bb2){return math.inBoundingBox(bb1,bb2.x1,bb2.y1)&&math.inBoundingBox(bb1,bb2.x2,bb2.y2)},math.roundRectangleIntersectLine=function(x,y,nodeX,nodeY,width,height,padding){var cornerRadius=this.getRoundRectangleRadius(width,height),halfWidth=width/2,halfHeight=height/2,straightLineIntersections,topStartX=nodeX-halfWidth+cornerRadius-padding,topStartY=nodeY-halfHeight-padding,topEndX=nodeX+halfWidth-cornerRadius+padding,topEndY=topStartY;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,topStartX,topStartY,topEndX,topEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var rightStartX=nodeX+halfWidth+padding,rightStartY=nodeY-halfHeight+cornerRadius-padding,rightEndX=rightStartX,rightEndY=nodeY+halfHeight-cornerRadius+padding;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,rightStartY,rightEndX,rightEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var bottomStartX=nodeX-halfWidth+cornerRadius-padding,bottomStartY=nodeY+halfHeight+padding,bottomEndX=nodeX+halfWidth-cornerRadius+padding,bottomEndY=bottomStartY;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,bottomStartX,bottomStartY,bottomEndX,bottomEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var leftStartX=nodeX-halfWidth-padding,leftStartY=nodeY-halfHeight+cornerRadius-padding,leftEndX=leftStartX,leftEndY=nodeY+halfHeight-cornerRadius+padding;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,leftStartY,leftEndX,leftEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var arcIntersections,topLeftCenterX=nodeX-halfWidth+cornerRadius,topLeftCenterY=nodeY-halfHeight+cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY)return[arcIntersections[0],arcIntersections[1]];var topRightCenterX=nodeX+halfWidth-cornerRadius,topRightCenterY=nodeY-halfHeight+cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomRightCenterX=nodeX+halfWidth-cornerRadius,bottomRightCenterY=nodeY+halfHeight-cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomLeftCenterX=nodeX-halfWidth+cornerRadius,bottomLeftCenterY=nodeY+halfHeight-cornerRadius;return arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY?[arcIntersections[0],arcIntersections[1]]:[]},math.inLineVicinity=function(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance,x1=Math.min(lx1,lx2),x2=Math.max(lx1,lx2),y1=Math.min(ly1,ly2),y2=Math.max(ly1,ly2);return x1-t<=x&&x<=x2+t&&y1-t<=y&&y<=y2+t},math.inBezierVicinity=function(x,y,x1,y1,x2,y2,x3,y3,tolerance){var bb={x1:Math.min(x1,x3,x2)-tolerance,x2:Math.max(x1,x3,x2)+tolerance,y1:Math.min(y1,y3,y2)-tolerance,y2:Math.max(y1,y3,y2)+tolerance};return!(x<bb.x1||x>bb.x2||y<bb.y1||y>bb.y2)},math.solveCubic=function(a,b,c,d,result){b/=a,c/=a,d/=a;var discriminant,q,r,dum1,s,t,term1,r13;return q=(3*c-b*b)/9,r=-(27*d)+b*(9*c-2*(b*b)),r/=54,discriminant=q*q*q+r*r,result[1]=0,term1=b/3,discriminant>0?(s=r+Math.sqrt(discriminant),s=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3),t=r-Math.sqrt(discriminant),t=t<0?-Math.pow(-t,1/3):Math.pow(t,1/3),result[0]=-term1+s+t,term1+=(s+t)/2,result[4]=result[2]=-term1,term1=Math.sqrt(3)*(-t+s)/2,result[3]=term1,void(result[5]=-term1)):(result[5]=result[3]=0,0===discriminant?(r13=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3),result[0]=-term1+2*r13,void(result[4]=result[2]=-(r13+term1))):(q=-q,dum1=q*q*q,dum1=Math.acos(r/Math.sqrt(dum1)),r13=2*Math.sqrt(q),result[0]=-term1+r13*Math.cos(dum1/3),result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3),void(result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3))))},math.sqdistToQuadraticBezier=function(x,y,x1,y1,x2,y2,x3,y3){var a=1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3,b=9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3,c=3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y,d=1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y,roots=[];this.solveCubic(a,b,c,d,roots);for(var zeroThreshold=1e-7,params=[],index=0;index<6;index+=2)Math.abs(roots[index+1])<zeroThreshold&&roots[index]>=0&&roots[index]<=1&&params.push(roots[index]);params.push(1),params.push(0);for(var minDistanceSquared=-1,closestParam,curX,curY,distSquared,i=0;i<params.length;i++)curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3,curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3,distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2),minDistanceSquared>=0?distSquared<minDistanceSquared&&(minDistanceSquared=distSquared,closestParam=params[i]):(minDistanceSquared=distSquared,closestParam=params[i]);return minDistanceSquared},math.sqdistToFiniteLine=function(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1],line=[x2-x1,y2-y1],lineSq=line[0]*line[0]+line[1]*line[1],hypSq=offset[0]*offset[0]+offset[1]*offset[1],dotProduct=offset[0]*line[0]+offset[1]*line[1],adjSq=dotProduct*dotProduct/lineSq;return dotProduct<0?hypSq:adjSq>lineSq?(x-x2)*(x-x2)+(y-y2)*(y-y2):hypSq-adjSq},math.pointInsidePolygonPoints=function(x,y,points){for(var x1,y1,x2,y2,y3,up=0,down=0,i=0;i<points.length/2;i++)if(x1=points[2*i],y1=points[2*i+1],i+1<points.length/2?(x2=points[2*(i+1)],y2=points[2*(i+1)+1]):(x2=points[2*(i+1-points.length/2)],y2=points[2*(i+1-points.length/2)+1]),x1==x&&x2==x);else{if(!(x1>=x&&x>=x2||x1<=x&&x<=x2))continue;y3=(x-x1)/(x2-x1)*(y2-y1)+y1,y3>y&&up++,y3<y&&down++}return up%2!==0},math.pointInsidePolygon=function(x,y,basePoints,centerX,centerY,width,height,direction,padding){var transformedPoints=new Array(basePoints.length),angle;null!=direction[0]?(angle=Math.atan(direction[1]/direction[0]),direction[0]<0?angle+=Math.PI/2:angle=-angle-Math.PI/2):angle=direction;for(var cos=Math.cos(-angle),sin=Math.sin(-angle),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=width/2*(basePoints[2*i]*cos-basePoints[2*i+1]*sin),transformedPoints[2*i+1]=height/2*(basePoints[2*i+1]*cos+basePoints[2*i]*sin),transformedPoints[2*i]+=centerX,transformedPoints[2*i+1]+=centerY;var points;if(padding>0){var expandedLineSet=this.expandPolygon(transformedPoints,-padding);points=this.joinLines(expandedLineSet)}else points=transformedPoints;return math.pointInsidePolygonPoints(x,y,points)},math.joinLines=function(lineSet){for(var vertices=new Array(lineSet.length/2),currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[4*i],currentLineStartY=lineSet[4*i+1],currentLineEndX=lineSet[4*i+2],currentLineEndY=lineSet[4*i+3],i<lineSet.length/4-1?(nextLineStartX=lineSet[4*(i+1)],nextLineStartY=lineSet[4*(i+1)+1],nextLineEndX=lineSet[4*(i+1)+2],nextLineEndY=lineSet[4*(i+1)+3]):(nextLineStartX=lineSet[0],nextLineStartY=lineSet[1],nextLineEndX=lineSet[2],nextLineEndY=lineSet[3]);var intersection=this.finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,!0);vertices[2*i]=intersection[0],vertices[2*i+1]=intersection[1]}return vertices},math.expandPolygon=function(points,pad){for(var expandedLineSet=new Array(2*points.length),currentPointX,currentPointY,nextPointX,nextPointY,i=0;i<points.length/2;i++){currentPointX=points[2*i],currentPointY=points[2*i+1],i<points.length/2-1?(nextPointX=points[2*(i+1)],nextPointY=points[2*(i+1)+1]):(nextPointX=points[0],nextPointY=points[1]);var offsetX=nextPointY-currentPointY,offsetY=-(nextPointX-currentPointX),offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY),normalizedOffsetX=offsetX/offsetLength,normalizedOffsetY=offsetY/offsetLength;expandedLineSet[4*i]=currentPointX+normalizedOffsetX*pad,expandedLineSet[4*i+1]=currentPointY+normalizedOffsetY*pad,expandedLineSet[4*i+2]=nextPointX+normalizedOffsetX*pad,expandedLineSet[4*i+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet},math.intersectLineEllipse=function(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x,dispY=centerY-y;dispX/=ellipseWradius,dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY),newLength=len-1;if(newLength<0)return[];var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]},math.intersectLineCircle=function(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1],c=[centerX,centerY],f=[x1-centerX,y1-centerY],a=d[0]*d[0]+d[1]*d[1],b=2*(f[0]*d[0]+f[1]*d[1]),c=f[0]*f[0]+f[1]*f[1]-radius*radius,discriminant=b*b-4*a*c;if(discriminant<0)return[];var t1=(-b+Math.sqrt(discriminant))/(2*a),t2=(-b-Math.sqrt(discriminant))/(2*a),tMin=Math.min(t1,t2),tMax=Math.max(t1,t2),inRangeParams=[];if(tMin>=0&&tMin<=1&&inRangeParams.push(tMin),tMax>=0&&tMax<=1&&inRangeParams.push(tMax),0===inRangeParams.length)return[];var nearIntersectionX=inRangeParams[0]*d[0]+x1,nearIntersectionY=inRangeParams[0]*d[1]+y1;if(inRangeParams.length>1){if(inRangeParams[0]==inRangeParams[1])return[nearIntersectionX,nearIntersectionY];var farIntersectionX=inRangeParams[1]*d[0]+x1,farIntersectionY=inRangeParams[1]*d[1]+y1;return[nearIntersectionX,nearIntersectionY,farIntersectionX,farIntersectionY]}return[nearIntersectionX,nearIntersectionY]},math.findCircleNearPoint=function(centerX,centerY,radius,farX,farY){var displacementX=farX-centerX,displacementY=farY-centerY,distance=Math.sqrt(displacementX*displacementX+displacementY*displacementY),unitDisplacementX=displacementX/distance,unitDisplacementY=displacementY/distance;return[centerX+unitDisplacementX*radius,centerY+unitDisplacementY*radius]},math.findMaxSqDistanceToOrigin=function(points){for(var maxSqDistance=1e-6,sqDistance,i=0;i<points.length/2;i++)sqDistance=points[2*i]*points[2*i]+points[2*i+1]*points[2*i+1],sqDistance>maxSqDistance&&(maxSqDistance=sqDistance);return maxSqDistance},math.midOfThree=function(a,b,c){return b<=a&&a<=c||c<=a&&a<=b?a:a<=b&&b<=c||c<=b&&b<=a?b:c},math.finiteLinesIntersect=function(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var dx13=x1-x3,dx21=x2-x1,dx43=x4-x3,dy13=y1-y3,dy21=y2-y1,dy43=y4-y3,ua_t=dx43*dy13-dy43*dx13,ub_t=dx21*dy13-dy21*dx13,u_b=dy43*dx21-dx43*dy21;if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b,flptThreshold=.001,min=0-flptThreshold,max=1+flptThreshold;return min<=ua&&ua<=max&&min<=ub&&ub<=max?[x1+ua*dx21,y1+ua*dy21]:infiniteLines?[x1+ua*dx21,y1+ua*dy21]:[]}return 0===ua_t||0===ub_t?this.midOfThree(x1,x2,x4)===x4?[x4,y4]:this.midOfThree(x1,x2,x3)===x3?[x3,y3]:this.midOfThree(x3,x4,x2)===x2?[x2,y2]:[]:[]},math.polygonIntersectLine=function(x,y,basePoints,centerX,centerY,width,height,padding){for(var intersections=[],intersection,transformedPoints=new Array(basePoints.length),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=basePoints[2*i]*width+centerX,transformedPoints[2*i+1]=basePoints[2*i+1]*height+centerY;var points;if(padding>0){var expandedLineSet=math.expandPolygon(transformedPoints,-padding);points=math.joinLines(expandedLineSet)}else points=transformedPoints;for(var currentX,currentY,nextX,nextY,i=0;i<points.length/2;i++)currentX=points[2*i],currentY=points[2*i+1],i<points.length/2-1?(nextX=points[2*(i+1)],nextY=points[2*(i+1)+1]):(nextX=points[0],nextY=points[1]),intersection=this.finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY),0!==intersection.length&&intersections.push(intersection[0],intersection[1]);return intersections},math.shortenIntersection=function(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]],length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]),lenRatio=(length-amount)/length;return lenRatio<0&&(lenRatio=1e-5),[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]},math.generateUnitNgonPointsFitToSquare=function(sides,rotationRadians){var points=math.generateUnitNgonPoints(sides,rotationRadians);return points=math.fitPolygonToSquare(points)},math.fitPolygonToSquare=function(points){for(var x,y,sides=points.length/2,minX=1/0,minY=1/0,maxX=-(1/0),maxY=-(1/0),i=0;i<sides;i++)x=points[2*i],y=points[2*i+1],minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);for(var sx=2/(maxX-minX),sy=2/(maxY-minY),i=0;i<sides;i++)x=points[2*i]=points[2*i]*sx,y=points[2*i+1]=points[2*i+1]*sy,minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);if(minY<-1)for(var i=0;i<sides;i++)y=points[2*i+1]=points[2*i+1]+(-1-minY);return points},math.generateUnitNgonPoints=function(sides,rotationRadians){var increment=1/sides*2*Math.PI,startAngle=sides%2===0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;for(var points=new Array(2*sides),currentAngle,x,y,i=0;i<sides;i++)currentAngle=i*increment+startAngle,x=points[2*i]=Math.cos(currentAngle),y=points[2*i+1]=Math.sin(-currentAngle);return points},math.getRoundRectangleRadius=function(width,height){return Math.min(width/4,height/4,8)},module.exports=math},{}],86:[function(_dereq_,module,exports){"use strict";var STATE_PENDING=0,STATE_FULFILLED=1,STATE_REJECTED=2,api=function(executor){return this instanceof api?(this.id="Thenable/1.0.7",this.state=STATE_PENDING,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},void("function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new api(executor)};api.prototype={fulfill:function(value){return deliver(this,STATE_FULFILLED,"fulfillValue",value)},reject:function(value){return deliver(this,STATE_REJECTED,"rejectReason",value)},then:function(onFulfilled,onRejected){var curr=this,next=new api;return curr.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),curr.onRejected.push(resolver(onRejected,next,"reject")),execute(curr),next.proxy}};var deliver=function(curr,state,name,value){return curr.state===STATE_PENDING&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function(curr){curr.state===STATE_FULFILLED?execute_handlers(curr,"onFulfilled",curr.fulfillValue):curr.state===STATE_REJECTED&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){return void next.reject(e)}resolve(next,result)}}},resolve=function(promise,x){if(promise===x||promise.proxy===x)return void promise.reject(new TypeError("cannot resolve promise with itself"));var then;if("object"==typeof x&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):resolve(promise,y))},function(r){resolved||(resolved=!0,promise.reject(r))})}catch(e){resolved||promise.reject(e)}}};api.all=function(ps){return new api(function(resolveAll,rejectAll){for(var vals=new Array(ps.length),doneCount=0,fulfill=function(i,val){vals[i]=val,doneCount++,doneCount===ps.length&&resolveAll(vals)},i=0;i<ps.length;i++)!function(i){var p=ps[i],isPromise=null!=p&&null!=p.then;if(isPromise)p.then(function(val){fulfill(i,val)},function(err){rejectAll(err)});else{var val=p;fulfill(i,val)}}(i)})},api.resolve=function(val){return new api(function(resolve,reject){resolve(val)})},api.reject=function(val){return new api(function(resolve,reject){reject(val)})},module.exports="undefined"!=typeof Promise?Promise:api},{}],87:[function(_dereq_,module,exports){"use strict";var is=_dereq_("./is"),util=_dereq_("./util"),Selector=function(selector){if(!(this instanceof Selector))return new Selector(selector);var self=this;self._private={selectorText:null,invalid:!0};var newQuery=function(){return{classes:[],colonSelectors:[],data:[],group:null,ids:[],meta:[],collection:null,filter:null,parent:null,ancestor:null,subject:null,child:null,descendant:null}};if(!selector||is.string(selector)&&selector.match(/^\s*$/))self.length=0;else if("*"===selector||"edge"===selector||"node"===selector)self[0]=newQuery(),self[0].group="*"===selector?selector:selector+"s",self[0].groupOnly=!0,self._private.invalid=!1,self._private.selectorText=selector,self.length=1;else if(is.elementOrCollection(selector)){var collection=selector.collection();self[0]=newQuery(),self[0].collection=collection,self.length=1}else if(is.fn(selector))self[0]=newQuery(),self[0].filter=selector,self.length=1;else{if(!is.string(selector))return void util.error("A selector must be created from a string; found "+selector);var currentSubject=null,tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:'"(?:\\\\"|[^"])*"|'+"'(?:\\\\'|[^'])*'",number:util.regex.number,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$"};tokens.variable="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+",tokens.value=tokens.string+"|"+tokens.number,tokens.className=tokens.variable,tokens.id=tokens.variable;for(var cleanMetaChars=function(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),function(match,$1,offset,original){return $1})},ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++){var op=ops[i];tokens.comparatorOp+="|@"+op}for(var ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++){var op=ops[i];op.indexOf("!")>=0||"="!==op&&(tokens.comparatorOp+="|\\!"+op)}var exprs=[{name:"group",query:!0,regex:"(node|edge|\\*)",populate:function(group){this.group="*"===group?group:group+"s"}},{name:"state",query:!0,regex:"(:selected|:unselected|:locked|:unlocked|:visible|:hidden|:transparent|:grabbed|:free|:removed|:inside|:grabbable|:ungrabbable|:animated|:unanimated|:selectable|:unselectable|:orphan|:nonorphan|:parent|:child|:loop|:simple|:active|:inactive|:touch|:backgrounding|:nonbackgrounding)",populate:function(state){this.colonSelectors.push(state)}},{name:"id",query:!0,regex:"\\#("+tokens.id+")",populate:function(id){this.ids.push(cleanMetaChars(id))}},{name:"className",query:!0,regex:"\\.("+tokens.className+")",populate:function(className){this.classes.push(cleanMetaChars(className))}},{name:"dataExists",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function(variable){this.data.push({field:cleanMetaChars(variable)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function(variable,comparatorOp,value){var valueIsString=null!=new RegExp("^"+tokens.string+"$").exec(value);value=valueIsString?value.substring(1,value.length-1):parseFloat(value),this.data.push({field:cleanMetaChars(variable),operator:comparatorOp,value:value})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function(boolOp,variable){this.data.push({field:cleanMetaChars(variable),operator:boolOp})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function(meta,comparatorOp,number){this.meta.push({field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},{name:"nextQuery",separator:!0,regex:tokens.separator,populate:function(){self[++i]=newQuery(),currentSubject=null}},{name:"child",separator:!0,regex:tokens.child,populate:function(){var childQuery=newQuery();childQuery.parent=this,childQuery.subject=currentSubject,self[i]=childQuery}},{name:"descendant",separator:!0,regex:tokens.descendant,populate:function(){var descendantQuery=newQuery();descendantQuery.ancestor=this,descendantQuery.subject=currentSubject,self[i]=descendantQuery}},{name:"subject",modifier:!0,regex:tokens.subject,populate:function(){return null!=currentSubject&&this.subject!=this?(util.error("Redefinition of subject in selector `"+selector+"`"),!1):(currentSubject=this,void(this.subject=this))}}];self._private.selectorText=selector;var remaining=selector,i=0,consumeExpr=function(expectation){for(var expr,match,name,j=0;j<exprs.length;j++){var e=exprs[j],n=e.name;if(!is.fn(expectation)||expectation(n,e)){var m=remaining.match(new RegExp("^"+e.regex));if(null!=m){match=m,expr=e,name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}}return{expr:expr,match:match,name:name}},consumeWhitespace=function(){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}};for(self[0]=newQuery(),consumeWhitespace();;){var check=consumeExpr();if(null==check.expr)return void util.error("The selector `"+selector+"`is invalid");for(var args=[],j=1;j<check.match.length;j++)args.push(check.match[j]);var ret=check.expr.populate.apply(self[i],args);if(ret===!1)return;if(remaining.match(/^\s*$/))break}self.length=i+1;for(var j=0;j<self.length;j++){var query=self[j];if(null!=query.subject){for(;query.subject!=query;)if(null!=query.parent){var parent=query.parent,child=query;child.parent=null,parent.child=child,query=parent}else{if(null==query.ancestor){util.error("When adjusting references for the selector `"+query+"`, neither parent nor ancestor was found");break}var ancestor=query.ancestor,descendant=query;descendant.ancestor=null,ancestor.descendant=descendant,query=ancestor}self[j]=query.subject}}}self._private.invalid=!1},selfn=Selector.prototype;selfn.size=function(){return this.length},selfn.eq=function(i){return this[i]};var queryMatches=function(query,ele){var ele_p=ele._private;if(query.groupOnly)return"*"===query.group||query.group===ele_p.group;if(null!=query.group&&"*"!=query.group&&query.group!=ele_p.group)return!1;for(var cy=ele.cy(),allColonSelectorsMatch=!0,k=0;k<query.colonSelectors.length;k++){var sel=query.colonSelectors[k];switch(sel){case":selected":allColonSelectorsMatch=ele.selected();break;case":unselected":allColonSelectorsMatch=!ele.selected();break;case":selectable":allColonSelectorsMatch=ele.selectable();break;case":unselectable":allColonSelectorsMatch=!ele.selectable();break;case":locked":allColonSelectorsMatch=ele.locked();break;case":unlocked":allColonSelectorsMatch=!ele.locked();break;case":visible":allColonSelectorsMatch=ele.visible();break;case":hidden":allColonSelectorsMatch=!ele.visible();break;case":transparent":allColonSelectorsMatch=ele.transparent();break;case":grabbed":allColonSelectorsMatch=ele.grabbed();break;case":free":allColonSelectorsMatch=!ele.grabbed();break;case":removed":allColonSelectorsMatch=ele.removed();break;case":inside":allColonSelectorsMatch=!ele.removed();break;case":grabbable":allColonSelectorsMatch=ele.grabbable();break;case":ungrabbable":allColonSelectorsMatch=!ele.grabbable();break;case":animated":allColonSelectorsMatch=ele.animated();break;case":unanimated":allColonSelectorsMatch=!ele.animated();break;case":parent":allColonSelectorsMatch=ele.isNode()&&ele.children().nonempty();break;case":child":case":nonorphan":allColonSelectorsMatch=ele.isNode()&&ele.parent().nonempty();break;case":orphan":allColonSelectorsMatch=ele.isNode()&&ele.parent().empty();break;case":loop":allColonSelectorsMatch=ele.isEdge()&&ele.data("source")===ele.data("target");break;case":simple":allColonSelectorsMatch=ele.isEdge()&&ele.data("source")!==ele.data("target");break;case":active":allColonSelectorsMatch=ele.active();break;case":inactive":allColonSelectorsMatch=!ele.active();break;case":touch":allColonSelectorsMatch=is.touch();break;case":backgrounding":allColonSelectorsMatch=ele.backgrounding();break;case":nonbackgrounding":allColonSelectorsMatch=!ele.backgrounding()}if(!allColonSelectorsMatch)break}if(!allColonSelectorsMatch)return!1;for(var allIdsMatch=!0,k=0;k<query.ids.length;k++){var id=query.ids[k],actualId=ele_p.data.id;if(allIdsMatch=allIdsMatch&&id==actualId,!allIdsMatch)break}if(!allIdsMatch)return!1;for(var allClassesMatch=!0,k=0;k<query.classes.length;k++){var cls=query.classes[k];if(allClassesMatch=allClassesMatch&&ele.hasClass(cls),!allClassesMatch)break}if(!allClassesMatch)return!1;var operandsMatch=function(params){for(var allDataMatches=!0,k=0;k<query[params.name].length;k++){var data=query[params.name][k],operator=data.operator,value=data.value,field=data.field,matches;if(null!=operator&&null!=value){var fieldVal=params.fieldValue(field),fieldStr=is.string(fieldVal)||is.number(fieldVal)?""+fieldVal:"",valStr=""+value,caseInsensitive=!1;operator.indexOf("@")>=0&&(fieldStr=fieldStr.toLowerCase(),valStr=valStr.toLowerCase(),operator=operator.replace("@",""),caseInsensitive=!0);var notExpr=!1;operator.indexOf("!")>=0&&(operator=operator.replace("!",""),notExpr=!0),caseInsensitive&&(value=valStr.toLowerCase(),fieldVal=fieldStr.toLowerCase());var isIneqCmp=!1;switch(operator){case"*=":matches=fieldStr.indexOf(valStr)>=0;break;case"$=":matches=fieldStr.indexOf(valStr,fieldStr.length-valStr.length)>=0;break;case"^=":matches=0===fieldStr.indexOf(valStr);break;case"=":matches=fieldVal===value;break;case">":isIneqCmp=!0,matches=fieldVal>value;break;case">=":isIneqCmp=!0,matches=fieldVal>=value;break;case"<":isIneqCmp=!0,matches=fieldVal<value;break;case"<=":isIneqCmp=!0,matches=fieldVal<=value;break;default:matches=!1}!notExpr||null==fieldVal&&isIneqCmp||(matches=!matches)}else if(null!=operator)switch(operator){case"?":matches=params.fieldTruthy(field);break;case"!":matches=!params.fieldTruthy(field);
break;case"^":matches=params.fieldUndefined(field)}else matches=!params.fieldUndefined(field);if(!matches){allDataMatches=!1;break}}return allDataMatches},allDataMatches=operandsMatch({name:"data",fieldValue:function(field){return ele_p.data[field]},fieldUndefined:function(field){return void 0===ele_p.data[field]},fieldTruthy:function(field){return!!ele_p.data[field]}});if(!allDataMatches)return!1;var allMetaMatches=operandsMatch({name:"meta",fieldValue:function(field){return ele[field]()},fieldUndefined:function(field){return null==ele[field]()},fieldTruthy:function(field){return!!ele[field]()}});if(!allMetaMatches)return!1;if(null!=query.collection){var matchesAny=query.collection.hasElementWithId(ele.id());if(!matchesAny)return!1}if(null!=query.filter&&0===ele.collection().filter(query.filter).size())return!1;var confirmRelations=function(query,eles){if(null!=query){var matches=!1;if(!cy.hasCompoundNodes())return!1;eles=eles();for(var i=0;i<eles.length;i++)if(queryMatches(query,eles[i])){matches=!0;break}return matches}return!0};return!!confirmRelations(query.parent,function(){return ele.parent()})&&(!!confirmRelations(query.ancestor,function(){return ele.parents()})&&(!!confirmRelations(query.child,function(){return ele.children()})&&!!confirmRelations(query.descendant,function(){return ele.descendants()})))};selfn.filter=function(collection){var self=this,cy=collection.cy();if(self._private.invalid)return cy.collection();var selectorFunction=function(i,element){for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,element))return!0}return!1};null==self._private.selectorText&&(selectorFunction=function(){return!0});var filteredCollection=collection.filter(selectorFunction);return filteredCollection},selfn.matches=function(ele){var self=this;if(self._private.invalid)return!1;for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,ele))return!0}return!1},selfn.toString=selfn.selector=function(){for(var str="",clean=function(obj){return null==obj?"":obj},cleanVal=function(val){return is.string(val)?'"'+val+'"':clean(val)},space=function(val){return" "+val+" "},queryToString=function(query){var str="";query.subject===query&&(str+="$");var group=clean(query.group);str+=group.substring(0,group.length-1);for(var j=0;j<query.data.length;j++){var data=query.data[j];str+=data.value?"["+data.field+space(clean(data.operator))+cleanVal(data.value)+"]":"["+clean(data.operator)+data.field+"]"}for(var j=0;j<query.meta.length;j++){var meta=query.meta[j];str+="[["+meta.field+space(clean(meta.operator))+cleanVal(meta.value)+"]]"}for(var j=0;j<query.colonSelectors.length;j++){var sel=query.colonSelectors[i];str+=sel}for(var j=0;j<query.ids.length;j++){var sel="#"+query.ids[i];str+=sel}for(var j=0;j<query.classes.length;j++){var sel="."+query.classes[j];str+=sel}return null!=query.parent&&(str=queryToString(query.parent)+" > "+str),null!=query.ancestor&&(str=queryToString(query.ancestor)+" "+str),null!=query.child&&(str+=" > "+queryToString(query.child)),null!=query.descendant&&(str+=" "+queryToString(query.descendant)),str},i=0;i<this.length;i++){var query=this[i];str+=queryToString(query),this.length>1&&i<this.length-1&&(str+=", ")}return str},module.exports=Selector},{"./is":83,"./util":100}],88:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),styfn={};styfn.apply=function(eles){var self=this,_p=self._private;_p.newStyle&&(_p.contextStyles={},_p.propDiffs={},self.cleanElements(eles,!0));for(var ie=0;ie<eles.length;ie++){var ele=eles[ie],cxtMeta=self.getContextMeta(ele),cxtStyle=self.getContextStyle(cxtMeta),app=self.applyContextStyle(cxtMeta,cxtStyle,ele);self.updateTransitions(ele,app.diffProps),self.updateStyleHints(ele)}_p.newStyle=!1},styfn.getPropertiesDiff=function(oldCxtKey,newCxtKey){var self=this,cache=self._private.propDiffs=self._private.propDiffs||{},dualCxtKey=oldCxtKey+"-"+newCxtKey,cachedVal=cache[dualCxtKey];if(cachedVal)return cachedVal;for(var diffProps=[],addedProp={},i=0;i<self.length;i++){var cxt=self[i],oldHasCxt="t"===oldCxtKey[i],newHasCxt="t"===newCxtKey[i],cxtHasDiffed=oldHasCxt!==newHasCxt,cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||cxtHasMappedProps){var props;cxtHasDiffed&&cxtHasMappedProps?props=cxt.properties:cxtHasDiffed?props=cxt.properties:cxtHasMappedProps&&(props=cxt.mappedProperties);for(var j=0;j<props.length;j++){for(var prop=props[j],name=prop.name,laterCxtOverrides=!1,k=i+1;k<self.length;k++){var laterCxt=self[k],hasLaterCxt="t"===newCxtKey[k];if(hasLaterCxt&&(laterCxtOverrides=null!=laterCxt.properties[prop.name]))break}addedProp[name]||laterCxtOverrides||(addedProp[name]=!0,diffProps.push(name))}}}return cache[dualCxtKey]=diffProps,diffProps},styfn.getContextMeta=function(ele){var self=this,cxtKey="",diffProps,prevKey=ele._private.styleCxtKey||"";self._private.newStyle&&(prevKey="");for(var i=0;i<self.length;i++){var context=self[i],contextSelectorMatches=context.selector&&context.selector.matches(ele);cxtKey+=contextSelectorMatches?"t":"f"}return diffProps=self.getPropertiesDiff(prevKey,cxtKey),ele._private.styleCxtKey=cxtKey,{key:cxtKey,diffPropNames:diffProps}},styfn.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key,self=this,cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey])return cxtStyles[cxtKey];for(var style={_private:{key:cxtKey}},i=0;i<self.length;i++){var cxt=self[i],hasCxt="t"===cxtKey[i];if(hasCxt)for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j],styProp=style[prop.name]=prop;styProp.context=cxt}}return cxtStyles[cxtKey]=style,style},styfn.applyContextStyle=function(cxtMeta,cxtStyle,ele){for(var self=this,diffProps=cxtMeta.diffPropNames,retDiffProps={},i=0;i<diffProps.length;i++){var diffPropName=diffProps[i],cxtProp=cxtStyle[diffPropName],eleProp=ele.pstyle(diffPropName);if(!cxtProp){if(!eleProp)continue;cxtProp=eleProp.bypass?{name:diffPropName,deleteBypassed:!0}:{name:diffPropName,delete:!0}}if(eleProp!==cxtProp){var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};self.applyParsedProperty(ele,cxtProp),retDiffProp.next=ele.pstyle(diffPropName),retDiffProp.next&&retDiffProp.next.bypass&&(retDiffProp.next=retDiffProp.next.bypassed)}}return{diffProps:retDiffProps}},styfn.updateStyleHints=function(ele){var _p=ele._private,self=this;if(!ele.removed()){var hasPie=!1;if("nodes"===_p.group)for(var i=1;i<=self.pieBackgroundN;i++){var size=ele.pstyle("pie-"+i+"-background-size").value;if(size>0){hasPie=!0;break}}_p.hasPie=hasPie;var transform=ele.pstyle("text-transform").strValue,content=ele.pstyle("label").strValue,srcContent=ele.pstyle("source-label").strValue,tgtContent=ele.pstyle("target-label").strValue,fStyle=ele.pstyle("font-style").strValue,size=ele.pstyle("font-size").pfValue+"px",family=ele.pstyle("font-family").strValue,weight=ele.pstyle("font-weight").strValue,valign=ele.pstyle("text-valign").strValue,halign=ele.pstyle("text-valign").strValue,oWidth=ele.pstyle("text-outline-width").pfValue,wrap=ele.pstyle("text-wrap").strValue,wrapW=ele.pstyle("text-max-width").pfValue,labelStyleKey=fStyle+"$"+size+"$"+family+"$"+weight+"$"+transform+"$"+valign+"$"+halign+"$"+oWidth+"$"+wrap+"$"+wrapW;_p.labelStyleKey=labelStyleKey,_p.sourceLabelKey=labelStyleKey+"$"+srcContent,_p.targetLabelKey=labelStyleKey+"$"+tgtContent,_p.labelKey=labelStyleKey+"$"+content,_p.fontKey=fStyle+"$"+weight+"$"+size+"$"+family,_p.styleKey=Date.now()}},styfn.applyParsedProperty=function(ele,parsedProp){var self=this,prop=parsedProp,style=ele._private.style,fieldVal,flatProp,types=self.types,type=self.properties[prop.name].type,propIsBypass=prop.bypass,origProp=style[prop.name],origPropIsBypass=origProp&&origProp.bypass,_p=ele._private;if("curve-style"===parsedProp.name&&"haystack"===parsedProp.value&&ele.isEdge()&&(ele.isLoop()||ele.source().isParent()||ele.target().isParent())&&(prop=parsedProp=this.parse(parsedProp.name,"bezier",propIsBypass)),prop.delete)return style[prop.name]=void 0,!0;if(prop.deleteBypassed)return!origProp||!!origProp.bypass&&(origProp.bypassed=void 0,!0);if(prop.deleteBypass)return!origProp||!!origProp.bypass&&(style[prop.name]=origProp.bypassed,!0);var printMappingErr=function(){util.error("Do not assign mappings to elements without corresponding data (e.g. ele `"+ele.id()+"` for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:case types.mapLayoutData:case types.mapScratch:var isLayout=prop.mapped===types.mapLayoutData,isScratch=prop.mapped===types.mapScratch,fields=prop.field.split("."),fieldVal;fieldVal=isScratch||isLayout?_p.scratch:_p.data;for(var i=0;i<fields.length&&fieldVal;i++){var field=fields[i];fieldVal=fieldVal[field]}var percent;if(percent=is.number(fieldVal)?(fieldVal-prop.fieldMin)/(prop.fieldMax-prop.fieldMin):0,percent<0?percent=0:percent>1&&(percent=1),type.color){var r1=prop.valueMin[0],r2=prop.valueMax[0],g1=prop.valueMin[1],g2=prop.valueMax[1],b1=prop.valueMin[2],b2=prop.valueMax[2],a1=null==prop.valueMin[3]?1:prop.valueMin[3],a2=null==prop.valueMax[3]?1:prop.valueMax[3],clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else{if(!type.number)return!1;var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,!0)}flatProp||(flatProp=this.parse(prop.name,origProp.strValue,prop.bypass,!0)),flatProp||printMappingErr(),flatProp.mapping=prop,prop=flatProp;break;case types.data:case types.layoutData:case types.scratch:var isLayout=prop.mapped===types.layoutData,isScratch=prop.mapped===types.scratch,fields=prop.field.split("."),fieldVal;if(fieldVal=isScratch||isLayout?_p.scratch:_p.data)for(var i=0;i<fields.length;i++){var field=fields[i];fieldVal=fieldVal[field]}if(flatProp=this.parse(prop.name,fieldVal,prop.bypass,!0),!flatProp){var flatPropVal=origProp?origProp.strValue:"";flatProp=this.parse(prop.name,flatPropVal,prop.bypass,!0)}flatProp||printMappingErr(),flatProp.mapping=prop,prop=flatProp;break;case types.fn:var fn=prop.value,fnRetVal=fn(ele);flatProp=this.parse(prop.name,fnRetVal,prop.bypass,!0),flatProp.mapping=prop,prop=flatProp;break;case void 0:break;default:return!1}return propIsBypass?(origPropIsBypass?prop.bypassed=origProp.bypassed:prop.bypassed=origProp,style[prop.name]=prop):origPropIsBypass?origProp.bypassed=prop:style[prop.name]=prop,!0},styfn.cleanElements=function(eles,keepBypasses){for(var self=this,props=self.properties,i=0;i<eles.length;i++){var ele=eles[i];if(keepBypasses)for(var style=ele._private.style,j=0;j<props.length;j++){var prop=props[j],eleProp=style[prop.name];eleProp&&(eleProp.bypass?eleProp.bypassed=null:style[prop.name]=null)}else ele._private.style={}}},styfn.update=function(){var cy=this._private.cy,eles=cy.mutableElements();eles.updateStyle()},styfn.updateMappers=function(eles){for(var self=this,i=0;i<eles.length;i++){for(var ele=eles[i],style=ele._private.style,j=0;j<self.properties.length;j++){var prop=self.properties[j],propInStyle=style[prop.name];if(propInStyle&&propInStyle.mapping){var mapping=propInStyle.mapping;this.applyParsedProperty(ele,mapping)}}this.updateStyleHints(ele)}},styfn.updateTransitions=function(ele,diffProps,isBypass){var self=this,_p=ele._private,props=ele.pstyle("transition-property").value,duration=ele.pstyle("transition-duration").pfValue,delay=ele.pstyle("transition-delay").pfValue;if(props.length>0&&duration>0){for(var css={},anyPrev=!1,i=0;i<props.length;i++){var prop=props[i],styProp=ele.pstyle(prop),diffProp=diffProps[prop];if(diffProp){var prevProp=diffProp.prev,fromProp=prevProp,toProp=null!=diffProp.next?diffProp.next:styProp,diff=!1,initVal,initDt=1e-6;fromProp&&(is.number(fromProp.pfValue)&&is.number(toProp.pfValue)?(diff=toProp.pfValue-fromProp.pfValue,initVal=fromProp.pfValue+initDt*diff):is.number(fromProp.value)&&is.number(toProp.value)?(diff=toProp.value-fromProp.value,initVal=fromProp.value+initDt*diff):is.array(fromProp.value)&&is.array(toProp.value)&&(diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2],initVal=fromProp.strValue),diff&&(css[prop]=toProp.strValue,this.applyBypass(ele,prop,initVal),anyPrev=!0))}}if(!anyPrev)return;_p.transitioning=!0,ele.stop(),delay>0&&ele.delay(delay),ele.animate({css:css},{duration:duration,easing:ele.pstyle("transition-timing-function").value,queue:!1,complete:function(){isBypass||self.removeBypasses(ele,props),_p.transitioning=!1}})}else _p.transitioning&&(ele.stop(),this.removeBypasses(ele,props),_p.transitioning=!1)},module.exports=styfn},{"../is":83,"../util":100}],89:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),util=_dereq_("../util"),styfn={};styfn.applyBypass=function(eles,name,value,updateTransitions){var self=this,props=[],isBypass=!0;if("*"===name||"**"===name){if(void 0!==value)for(var i=0;i<self.properties.length;i++){var prop=self.properties[i],name=prop.name,parsedProp=this.parse(name,value,!0);parsedProp&&props.push(parsedProp)}}else if(is.string(name)){var parsedProp=this.parse(name,value,!0);parsedProp&&props.push(parsedProp)}else{if(!is.plainObject(name))return!1;var specifiedProps=name;updateTransitions=value;for(var i=0;i<self.properties.length;i++){var prop=self.properties[i],name=prop.name,value=specifiedProps[name];if(void 0===value&&(value=specifiedProps[util.dash2camel(name)]),void 0!==value){var parsedProp=this.parse(name,value,!0);parsedProp&&props.push(parsedProp)}}}if(0===props.length)return!1;for(var ret=!1,i=0;i<eles.length;i++){for(var ele=eles[i],diffProps={},diffProp,j=0;j<props.length;j++){var prop=props[j];if(updateTransitions){var prevProp=ele.pstyle(prop.name);diffProp=diffProps[prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,prop)||ret,updateTransitions&&(diffProp.next=ele.pstyle(prop.name))}ret&&this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,isBypass)}return ret},styfn.overrideBypass=function(eles,name,value){name=util.camel2dash(name);for(var i=0;i<eles.length;i++){var ele=eles[i],prop=ele._private.style[name],type=this.properties[name].type,isColor=type.color,isMulti=type.mutiple;prop&&prop.bypass?(prop.value=value,null!=prop.pfValue&&(prop.pfValue=value),isColor?prop.strValue="rgb("+value.join(",")+")":isMulti?prop.strValue=value.join(" "):prop.strValue=""+value):this.applyBypass(ele,name,value)}},styfn.removeAllBypasses=function(eles,updateTransitions){return this.removeBypasses(eles,this.propertyNames,updateTransitions)},styfn.removeBypasses=function(eles,props,updateTransitions){for(var isBypass=!0,j=0;j<eles.length;j++){for(var ele=eles[j],diffProps={},i=0;i<props.length;i++){var name=props[i],prop=this.properties[name],prevProp=ele.pstyle(prop.name);if(prevProp&&prevProp.bypass){var value="",parsedProp=this.parse(name,value,!0),diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp),diffProp.next=ele.pstyle(prop.name)}}this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,isBypass)}},module.exports=styfn},{"../is":83,"../util":100}],90:[function(_dereq_,module,exports){"use strict";var window=_dereq_("../window"),styfn={};styfn.getEmSizeInPixels=function(){var px=this.containerCss("font-size");return null!=px?parseFloat(px):1},styfn.containerCss=function(propName){var cy=this._private.cy,domElement=cy.container();if(window&&domElement&&window.getComputedStyle)return window.getComputedStyle(domElement).getPropertyValue(propName)},module.exports=styfn},{"../window":107}],91:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),styfn={};styfn.getRenderedStyle=function(ele){return this.getRawStyle(ele,!0)},styfn.getRawStyle=function(ele,isRenderedVal){var self=this,ele=ele[0];if(ele){for(var rstyle={},i=0;i<self.properties.length;i++){var prop=self.properties[i],val=self.getStylePropertyValue(ele,prop.name,isRenderedVal);val&&(rstyle[prop.name]=val,rstyle[util.dash2camel(prop.name)]=val)}return rstyle}},styfn.getStylePropertyValue=function(ele,propName,isRenderedVal){var self=this,ele=ele[0];if(ele){var prop=self.properties[propName];prop.alias&&(prop=prop.pointsTo);var type=prop.type,styleProp=ele.pstyle(prop.name),zoom=ele.cy().zoom();if(styleProp){var units=styleProp.units?type.implicitUnits||"px":null,val=units?[].concat(styleProp.pfValue).map(function(pfValue){return pfValue*(isRenderedVal?zoom:1)+units}).join(" "):styleProp.strValue;return val}}},styfn.getAnimationStartStyle=function(ele,aniProps){for(var rstyle={},i=0;i<aniProps.length;i++){var aniProp=aniProps[i],name=aniProp.name,styleProp=ele.pstyle(name);void 0!==styleProp&&(styleProp=is.plainObject(styleProp)?this.parse(name,styleProp.strValue):this.parse(name,styleProp)),styleProp&&(rstyle[name]=styleProp)}return rstyle},styfn.getPropsList=function(propsObj){var self=this,rstyle=[],style=propsObj,props=self.properties;if(style)for(var names=Object.keys(style),i=0;i<names.length;i++){var name=names[i],val=style[name],prop=props[name]||props[util.camel2dash(name)],styleProp=this.parse(prop.name,val);rstyle.push(styleProp)}return rstyle},module.exports=styfn},{"../is":83,"../util":100}],92:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),util=_dereq_("../util"),Selector=_dereq_("../selector"),Style=function(cy){return this instanceof Style?is.core(cy)?(this._private={cy:cy,coreStyle:{}},this.length=0,void this.resetToDefault()):void util.error("A style must have a core reference"):new Style(cy)},styfn=Style.prototype;styfn.instanceString=function(){return"style"},styfn.clear=function(){for(var i=0;i<this.length;i++)this[i]=void 0;this.length=0;var _p=this._private;return _p.newStyle=!0,this},styfn.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},styfn.core=function(){return this._private.coreStyle},styfn.selector=function(selectorStr){var selector="core"===selectorStr?null:new Selector(selectorStr),i=this.length++;return this[i]={selector:selector,properties:[],mappedProperties:[],index:i},this},styfn.css=function(){var self=this,args=arguments;switch(args.length){case 1:for(var map=args[0],i=0;i<self.properties.length;i++){var prop=self.properties[i],mapVal=map[prop.name];void 0===mapVal&&(mapVal=map[util.dash2camel(prop.name)]),void 0!==mapVal&&this.cssRule(prop.name,mapVal)}break;case 2:this.cssRule(args[0],args[1])}return this},styfn.style=styfn.css,styfn.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property),this[i].properties[property.name]=property,property.name.match(/pie-(\d+)-background-size/)&&property.value&&(this._private.hasPie=!0),property.mapped&&this[i].mappedProperties.push(property);var currentSelectorIsCore=!this[i].selector;currentSelectorIsCore&&(this._private.coreStyle[property.name]=property)}return this},Style.fromJson=function(cy,json){var style=new Style(cy);return style.fromJson(json),style},Style.fromString=function(cy,string){return new Style(cy).fromString(string)},[_dereq_("./apply"),_dereq_("./bypass"),_dereq_("./container"),_dereq_("./get-for-ele"),_dereq_("./json"),_dereq_("./string-sheet"),_dereq_("./properties"),_dereq_("./parse")].forEach(function(props){util.extend(styfn,props)}),Style.types=styfn.types,Style.properties=styfn.properties,module.exports=Style},{"../is":83,"../selector":87,"../util":100,"./apply":88,"./bypass":89,"./container":90,"./get-for-ele":91,"./json":93,"./parse":94,"./properties":95,"./string-sheet":96}],93:[function(_dereq_,module,exports){"use strict";var styfn={};styfn.applyFromJson=function(json){for(var style=this,i=0;i<json.length;i++){var context=json[i],selector=context.selector,props=context.style||context.css,names=Object.keys(props);style.selector(selector);for(var j=0;j<names.length;j++){var name=names[j],value=props[name];style.css(name,value)}}return style},styfn.fromJson=function(json){var style=this;return style.resetToDefault(),style.applyFromJson(json),style},styfn.json=function(){for(var json=[],i=this.defaultLength;i<this.length;i++){for(var cxt=this[i],selector=cxt.selector,props=cxt.properties,css={},j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:selector?selector.toString():"core",style:css})}return json},module.exports=styfn},{}],94:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),is=_dereq_("../is"),math=_dereq_("../math"),styfn={};styfn.parse=function(name,value,propIsBypass,propIsFlat){var self=this;if(is.fn(value))return self.parseImpl(name,value,propIsBypass,propIsFlat);var argHash=[name,value,propIsBypass,propIsFlat].join("$"),propCache=self.propCache=self.propCache||{},ret;return(ret=propCache[argHash])||(ret=propCache[argHash]=self.parseImpl(name,value,propIsBypass,propIsFlat)),ret=util.copy(ret),ret&&(ret.value=util.copy(ret.value)),ret};var parseImpl=function(name,value,propIsBypass,propIsFlat){var self=this;name=util.camel2dash(name);var property=self.properties[name],passedValue=value,types=self.types;if(!property)return null;if(void 0===value||null===value)return null;property.alias&&(property=property.pointsTo,name=property.name);var valueIsString=is.string(value);valueIsString&&(value=value.trim());var type=property.type;if(!type)return null;if(propIsBypass&&(""===value||null===value))return{name:name,value:value,bypass:!0,deleteBypass:!0};if(is.fn(value))return{name:name,value:value,strValue:"fn",mapped:types.fn,bypass:propIsBypass};var data,mapData,layoutData,mapLayoutData,scratch,mapScratch;if(!valueIsString||propIsFlat);else{if((data=new RegExp(types.data.regex).exec(value))||(layoutData=new RegExp(types.layoutData.regex).exec(value))||(scratch=new RegExp(types.scratch.regex).exec(value))){if(propIsBypass)return!1;var mapped;return mapped=data?types.data:layoutData?types.layoutData:types.scratch,data=data||layoutData||scratch,{name:name,value:data,strValue:""+value,mapped:mapped,field:data[1],bypass:propIsBypass}}if((mapData=new RegExp(types.mapData.regex).exec(value))||(mapLayoutData=new RegExp(types.mapLayoutData.regex).exec(value))||(mapScratch=new RegExp(types.mapScratch.regex).exec(value))){if(propIsBypass)return!1;if(type.multiple)return!1;var mapped;if(mapped=mapData?types.mapData:mapLayoutData?types.mapLayoutData:types.mapScratch,mapData=mapData||mapLayoutData||mapScratch,!type.color&&!type.number)return!1;var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped)return!1;var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped)return!1;if(valueMin.value===valueMax.value)return!1;if(type.color){var c1=valueMin.value,c2=valueMax.value,same=!(c1[0]!==c2[0]||c1[1]!==c2[1]||c1[2]!==c2[2]||c1[3]!==c2[3]&&(null!=c1[3]&&1!==c1[3]||null!=c2[3]&&1!==c2[3]));if(same)return!1}return{name:name,value:mapData,strValue:""+value,mapped:mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass}}}if(type.multiple&&"multiple"!==propIsFlat){var vals;if(vals=valueIsString?value.split(/\s+/):is.array(value)?value:[value],type.evenMultiple&&vals.length%2!==0)return null;var valArr=vals.map(function(v){var p=self.parse(name,v,propIsBypass,"multiple");return null!=p.pfValue?p.pfValue:p.value});return{name:name,value:valArr,pfValue:valArr,strValue:valArr.join(" "),bypass:propIsBypass,units:type.number&&!type.unitless?type.implicitUnits||"px":void 0}}var checkEnums=function(){for(var i=0;i<type.enums.length;i++){var en=type.enums[i];if(en===value)return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}return null};if(type.number){var units,implicitUnits="px";if(type.units&&(units=type.units),type.implicitUnits&&(implicitUnits=type.implicitUnits),!type.unitless)if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");units&&(unitsRegex=units);var match=value.match("^("+util.regex.number+")("+unitsRegex+")?$");match&&(value=match[1],units=match[2]||implicitUnits)}else units&&!type.implicitUnits||(units=implicitUnits);if(value=parseFloat(value),isNaN(value)&&void 0===type.enums)return null;if(isNaN(value)&&void 0!==type.enums)return value=passedValue,checkEnums();if(type.integer&&!is.integer(value))return null;if(void 0!==type.min&&value<type.min||void 0!==type.max&&value>type.max)return null;var ret={name:name,value:value,strValue:""+value+(units?units:""),units:units,bypass:propIsBypass};return type.unitless||"px"!==units&&"em"!==units?ret.pfValue=value:ret.pfValue="px"!==units&&units?this.getEmSizeInPixels()*value:value,"ms"!==units&&"s"!==units||(ret.pfValue="ms"===units?value:1e3*value),"deg"!==units&&"rad"!==units||(ret.pfValue="rad"===units?value:math.deg2rad(value)),ret}if(type.propList){var props=[],propsStr=""+value;if("none"===propsStr);else{for(var propsSplit=propsStr.split(","),i=0;i<propsSplit.length;i++){var propName=propsSplit[i].trim();self.properties[propName]&&props.push(propName)}if(0===props.length)return null}return{name:name,value:props,strValue:0===props.length?"none":props.join(", "),bypass:propIsBypass}}if(type.color){var tuple=util.color2tuple(value);return tuple?{name:name,value:tuple,strValue:""+value,bypass:propIsBypass,roundValue:!0}:null}if(type.regex||type.regexes){if(type.enums){var enumProp=checkEnums();if(enumProp)return enumProp}for(var regexes=type.regexes?type.regexes:[type.regex],i=0;i<regexes.length;i++){var regex=new RegExp(regexes[i]),m=regex.exec(value);if(m)return{name:name,value:m,strValue:""+value,bypass:propIsBypass}}return null}return type.string?{name:name,value:""+value,strValue:""+value,bypass:propIsBypass}:type.enums?checkEnums():null};styfn.parseImpl=parseImpl,module.exports=styfn},{"../is":83,"../math":85,"../util":100}],95:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),styfn={};!function(){var number=util.regex.number,rgba=util.regex.rgbaNoBackRefs,hsla=util.regex.hslaNoBackRefs,hex3=util.regex.hex3,hex6=util.regex.hex6,data=function(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},mapData=function(prefix){var mapArg=number+"|\\w+|"+rgba+"|"+hsla+"|"+hex3+"|"+hex6;return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number+")\\s*\\,\\s*("+number+")\\s*,\\s*("+mapArg+")\\s*\\,\\s*("+mapArg+")\\)$"};styfn.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizes:{number:!0,multiple:!0},bgSize:{number:!0,min:0,allowPercent:!0},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"]},bgPos:{number:!0,allowPercent:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"]},bgFit:{enums:["none","contain","cover"]},bgCrossOrigin:{enums:["anonymous","use-credentials"]},bgClip:{enums:["none","node"]},color:{color:!0},bool:{enums:["yes","no"]},lineStyle:{enums:["solid","dotted","dashed"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontVariant:{enums:["small-caps","normal"]},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap"]},textBackgroundShape:{enums:["rectangle","roundrectangle"]},nodeShape:{enums:["rectangle","roundrectangle","ellipse","triangle","square","pentagon","hexagon","heptagon","octagon","star","diamond","vee","rhomboid","polygon"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","triangle-backcurve","half-triangle-overshot","vee","square","circle","diamond","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},text:{string:!0},data:{mapping:!0,regex:data("data")},layoutData:{mapping:!0,regex:data("layoutData")},scratch:{mapping:!0,regex:data("scratch")},mapData:{mapping:!0,regex:mapData("mapData")},mapLayoutData:{mapping:!0,regex:mapData("mapLayoutData")},mapScratch:{mapping:!0,regex:mapData("mapScratch")},fn:{mapping:!0,fn:!0},url:{regex:"url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)|none|(.+)$"},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position"]},easing:{regexes:["^(spring)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]}};var t=styfn.types,props=styfn.properties=[{name:"label",type:t.text},{name:"text-rotation",type:t.textRotation},{name:"text-margin-x",type:t.bidirectionalSize},{name:"text-margin-y",type:t.bidirectionalSize},{name:"source-label",type:t.text},{name:"source-text-rotation",type:t.textRotation},{name:"source-text-margin-x",type:t.bidirectionalSize},{name:"source-text-margin-y",type:t.bidirectionalSize},{name:"source-text-offset",type:t.size},{name:"target-label",type:t.text},{name:"target-text-rotation",type:t.textRotation},{name:"target-text-margin-x",type:t.bidirectionalSize},{name:"target-text-margin-y",type:t.bidirectionalSize},{name:"target-text-offset",type:t.size},{name:"text-valign",type:t.valign},{name:"text-halign",type:t.halign},{name:"color",type:t.color},{name:"text-outline-color",type:t.color},{name:"text-outline-width",type:t.size},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-margin",type:t.size},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size},{name:"text-border-style",type:t.borderStyle},{name:"text-background-shape",type:t.textBackgroundShape},{name:"text-transform",type:t.textTransform},{name:"text-wrap",type:t.textWrap},{name:"text-max-width",type:t.size},{name:"text-events",type:t.bool},{name:"font-family",type:t.fontFamily},{name:"font-style",type:t.fontStyle},{name:"font-weight",type:t.fontWeight},{name:"font-size",type:t.size},{name:"min-zoomed-font-size",type:t.size},{name:"events",type:t.bool},{name:"display",type:t.display},{name:"visibility",type:t.visibility},{name:"opacity",type:t.zeroOneNumber},{name:"z-index",type:t.nonNegativeInt},{name:"overlay-padding",type:t.size},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber},{name:"shadow-blur",type:t.size
},{name:"shadow-color",type:t.color},{name:"shadow-opacity",type:t.zeroOneNumber},{name:"shadow-offset-x",type:t.bidirectionalSize},{name:"shadow-offset-y",type:t.bidirectionalSize},{name:"text-shadow-blur",type:t.size},{name:"text-shadow-color",type:t.color},{name:"text-shadow-opacity",type:t.zeroOneNumber},{name:"text-shadow-offset-x",type:t.bidirectionalSize},{name:"text-shadow-offset-y",type:t.bidirectionalSize},{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"transition-timing-function",type:t.easing},{name:"height",type:t.nodeSize},{name:"width",type:t.nodeSize},{name:"shape",type:t.nodeShape},{name:"shape-polygon-points",type:t.polygonPointList},{name:"background-color",type:t.color},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"padding",type:t.size},{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size},{name:"border-style",type:t.borderStyle},{name:"background-image",type:t.url},{name:"background-image-crossorigin",type:t.bgCrossOrigin},{name:"background-image-opacity",type:t.zeroOneNumber},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"position",type:t.position},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels},{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"curve-style",type:t.curveStyle},{name:"haystack-radius",type:t.zeroOneNumber},{name:"control-point-step-size",type:t.size},{name:"control-point-distances",type:t.bidirectionalSizes},{name:"control-point-weights",type:t.numbers},{name:"segment-distances",type:t.bidirectionalSizes},{name:"segment-weights",type:t.numbers},{name:"edge-distances",type:t.edgeDistances},{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}],aliases=styfn.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];styfn.pieBackgroundN=16,props.push({name:"pie-size",type:t.bgSize});for(var i=1;i<=styfn.pieBackgroundN;i++)props.push({name:"pie-"+i+"-background-color",type:t.color}),props.push({name:"pie-"+i+"-background-size",type:t.percent}),props.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber});var arrowPrefixes=styfn.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:t.arrowShape},{name:"arrow-color",type:t.color},{name:"arrow-fill",type:t.arrowFill}].forEach(function(prop){arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name,type=prop.type;props.push({name:name,type:type})})},{}),styfn.propertyNames=props.map(function(p){return p.name});for(var i=0;i<props.length;i++){var prop=props[i];props[prop.name]=prop}for(var i=0;i<aliases.length;i++){var alias=aliases[i],pointsToProp=props[alias.pointsTo],aliasProp={name:alias.name,alias:!0,pointsTo:pointsToProp};props.push(aliasProp),props[alias.name]=aliasProp}}(),styfn.getDefaultProperty=function(name){return this.getDefaultProperties()[name]},styfn.getDefaultProperties=util.memoize(function(){for(var rawProps=util.extend({events:"yes","text-events":"no","text-valign":"top","text-halign":"center",color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-margin":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","text-background-shape":"rectangle","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"shadow-opacity":0,"shadow-color":"#000","shadow-blur":10,"shadow-offset-x":0,"shadow-offset-y":0,"text-shadow-opacity":0,"text-shadow-color":"#000","text-shadow-blur":5,"text-shadow-offset-x":0,"text-shadow-offset-y":0,"transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-position-x":"50%","background-position-y":"50%","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1",padding:0,position:"origin","compound-sizing-wrt-labels":"include"},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(css,prop){for(var i=1;i<=styfn.pieBackgroundN;i++){var name=prop.name.replace("{{i}}",i),val=prop.value;css[name]=val}return css},{}),{"line-style":"solid","line-color":"#999","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"edge-distances":"intersection","curve-style":"bezier","haystack-radius":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"}].reduce(function(css,prop){return styfn.arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name,val=prop.value;css[name]=val}),css},{})),parsedProps={},i=0;i<this.properties.length;i++){var prop=this.properties[i];if(!prop.pointsTo){var name=prop.name,val=rawProps[name],parsedProp=this.parse(name,val);parsedProps[name]=parsedProp}}return parsedProps}),styfn.addDefaultStylesheet=function(){this.selector("$node > node").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3,"curve-style":"haystack"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector("node:parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}).selector("core").css({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125}),this.defaultLength=this.length},module.exports=styfn},{"../util":100}],96:[function(_dereq_,module,exports){"use strict";var util=_dereq_("../util"),Selector=_dereq_("../selector"),styfn={};styfn.applyFromString=function(string){function removeSelAndBlockFromRemaining(){remaining=remaining.length>selAndBlockStr.length?remaining.substr(selAndBlockStr.length):""}function removePropAndValFromRem(){blockRem=blockRem.length>propAndValStr.length?blockRem.substr(propAndValStr.length):""}var self=this,style=this,remaining=""+string,selAndBlockStr,blockRem,propAndValStr;for(remaining=remaining.replace(/[\/][*](\s|.)+?[*][\/]/g,"");;){var nothingLeftToParse=remaining.match(/^\s*$/);if(nothingLeftToParse)break;var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){util.error("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if("core"!==selectorStr){var selector=new Selector(selectorStr);if(selector._private.invalid){util.error("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr),removeSelAndBlockFromRemaining();continue}}var blockStr=selAndBlock[2],invalidBlock=!1;blockRem=blockStr;for(var props=[];;){var nothingLeftToParse=blockRem.match(/^\s*$/);if(nothingLeftToParse)break;var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!propAndVal){util.error("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr),invalidBlock=!0;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1],valStr=propAndVal[2],prop=self.properties[propStr];if(prop){var parsedProp=style.parse(propStr,valStr);parsedProp?(props.push({name:propStr,val:valStr}),removePropAndValFromRem()):(util.error("Skipping property: Invalid property definition in: "+propAndValStr),removePropAndValFromRem())}else util.error("Skipping property: Invalid property name in: "+propAndValStr),removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}style.selector(selectorStr);for(var i=0;i<props.length;i++){var prop=props[i];style.css(prop.name,prop.val)}removeSelAndBlockFromRemaining()}return style},styfn.fromString=function(string){var style=this;return style.resetToDefault(),style.applyFromString(string),style},module.exports=styfn},{"../selector":87,"../util":100}],97:[function(_dereq_,module,exports){"use strict";var is=_dereq_("./is"),util=_dereq_("./util"),Style=_dereq_("./style"),Stylesheet=function(){return this instanceof Stylesheet?void(this.length=0):new Stylesheet},sheetfn=Stylesheet.prototype;sheetfn.instanceString=function(){return"stylesheet"},sheetfn.selector=function(selector){var i=this.length++;return this[i]={selector:selector,properties:[]},this},sheetfn.css=function(name,value){var i=this.length-1;if(is.string(name))this[i].properties.push({name:name,value:value});else if(is.plainObject(name))for(var map=name,j=0;j<Style.properties.length;j++){var prop=Style.properties[j],mapVal=map[prop.name];if(void 0===mapVal&&(mapVal=map[util.dash2camel(prop.name)]),void 0!==mapVal){var name=prop.name,value=mapVal;this[i].properties.push({name:name,value:value})}}return this},sheetfn.style=sheetfn.css,sheetfn.generateStyle=function(cy){for(var style=new Style(cy),i=0;i<this.length;i++){var context=this[i],selector=context.selector,props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style},module.exports=Stylesheet},{"./is":83,"./style":92,"./util":100}],98:[function(_dereq_,module,exports){"use strict";var window=_dereq_("./window"),util=_dereq_("./util"),Promise=_dereq_("./promise"),Event=_dereq_("./event"),define=_dereq_("./define"),is=_dereq_("./is"),Thread=function(opts){if(!(this instanceof Thread))return new Thread(opts);var _p=this._private={requires:[],files:[],queue:null,pass:[],disabled:!1};is.plainObject(opts)&&null!=opts.disabled&&(_p.disabled=!!opts.disabled)},thdfn=Thread.prototype,stringifyFieldVal=function(val){var valStr=is.fn(val)?val.toString():"JSON.parse('"+JSON.stringify(val)+"')";return valStr},fnAsRequire=function(fn){var req,fnName;is.object(fn)&&fn.fn?(req=fnAs(fn.fn,fn.name),fnName=fn.name,fn=fn.fn):is.fn(fn)?(req=fn.toString(),fnName=fn.name):is.string(fn)?req=fn:is.object(fn)&&(req=fn.proto?"":fn.name+" = {};",fnName=fn.name,fn=fn.obj),req+="\n";var protoreq=function(val,subname){if(val.prototype){var protoNonempty=!1;for(var prop in val.prototype){protoNonempty=!0;break}protoNonempty&&(req+=fnAsRequire({name:subname,obj:val,proto:!0},val))}};if(fn.prototype&&null!=fnName)for(var name in fn.prototype){var protoStr="",val=fn.prototype[name],valStr=stringifyFieldVal(val),subname=fnName+".prototype."+name;protoStr+=subname+" = "+valStr+";\n",protoStr&&(req+=protoStr),protoreq(val,subname)}if(!is.string(fn))for(var name in fn){var propsStr="";if(fn.hasOwnProperty(name)){var val=fn[name],valStr=stringifyFieldVal(val),subname=fnName+'["'+name+'"]';propsStr+=subname+" = "+valStr+";\n"}propsStr&&(req+=propsStr),protoreq(val,subname)}return req},isPathStr=function(str){return is.string(str)&&str.match(/\.js$/)};util.extend(thdfn,{instanceString:function(){return"thread"},require:function(fn,as){var requires=this._private.requires;if(isPathStr(fn))return this._private.files.push(fn),this;if(as)fn=is.fn(fn)?{name:as,fn:fn}:{name:as,obj:fn};else if(is.fn(fn)){if(!fn.name)throw'The function name could not be automatically determined.  Use thread.require( someFunction, "someFunction" )';fn={name:fn.name,fn:fn}}return requires.push(fn),this},pass:function(data){return this._private.pass.push(data),this},run:function(fn,pass){var self=this,_p=this._private;if(pass=pass||_p.pass.shift(),_p.stopped)throw"Attempted to run a stopped thread!  Start a new thread or do not stop the existing thread and reuse it.";if(_p.running)return _p.queue=_p.queue.then(function(){return self.run(fn,pass)});var useWW=null!=window&&!_p.disabled,useNode=!window&&"undefined"!=typeof module&&!_p.disabled;self.trigger("run");var runP=new Promise(function(resolve,reject){_p.running=!0;var threadTechAlreadyExists=_p.ran,fnImplStr=is.string(fn)?fn:fn.toString(),fnStr="\n"+_p.requires.map(function(r){return fnAsRequire(r)}).concat(_p.files.map(function(f){if(useWW){var wwifyFile=function(file){return file.match(/^\.\//)||file.match(/^\.\./)?window.location.origin+window.location.pathname+file:file.match(/^\//)?window.location.origin+"/"+file:file};return'importScripts("'+wwifyFile(f)+'");'}if(useNode)return'eval( require("fs").readFileSync("'+f+'", { encoding: "utf8" }) );';throw"External file `"+f+"` can not be required without any threading technology."})).concat(["( function(){","var ret = ("+fnImplStr+")("+JSON.stringify(pass)+");","if( ret !== undefined ){ resolve(ret); }","} )()\n"]).join("\n");if(_p.requires=[],_p.files=[],useWW){var fnBlob,fnUrl;if(!threadTechAlreadyExists){var fnPre=fnStr+"";fnStr=["function _ref_(o){ return eval(o); };","function broadcast(m){ return message(m); };","function message(m){ postMessage(m); };","function listen(fn){",'  self.addEventListener("message", function(m){ ','    if( typeof m === "object" && (m.data.$$eval || m.data === "$$start") ){',"    } else { ","      fn( m.data );","    }","  });","};",'self.addEventListener("message", function(m){  if( m.data.$$eval ){ eval( m.data.$$eval ); }  });',"function resolve(v){ postMessage({ $$resolve: v }); };","function reject(v){ postMessage({ $$reject: v }); };"].join("\n"),fnStr+=fnPre,fnBlob=new Blob([fnStr],{type:"application/javascript"}),fnUrl=window.URL.createObjectURL(fnBlob)}var ww=_p.webworker=_p.webworker||new Worker(fnUrl);threadTechAlreadyExists&&ww.postMessage({$$eval:fnStr});var cb;ww.addEventListener("message",cb=function(m){var isObject=is.object(m)&&is.object(m.data);isObject&&"$$resolve"in m.data?(ww.removeEventListener("message",cb),resolve(m.data.$$resolve)):isObject&&"$$reject"in m.data?(ww.removeEventListener("message",cb),reject(m.data.$$reject)):self.trigger(new Event(m,{type:"message",message:m.data}))},!1),threadTechAlreadyExists||ww.postMessage("$$start")}else if(useNode){_p.child||(_p.child=_dereq_("child_process").fork(_dereq_("path").join(__dirname,"thread-node-fork")));var child=_p.child,cb;child.on("message",cb=function(m){is.object(m)&&"$$resolve"in m?(child.removeListener("message",cb),resolve(m.$$resolve)):is.object(m)&&"$$reject"in m?(child.removeListener("message",cb),reject(m.$$reject)):self.trigger(new Event({},{type:"message",message:m}))}),child.send({$$eval:fnStr})}else{var promiseResolve=resolve,promiseReject=reject,timer=_p.timer=_p.timer||{listeners:[],exec:function(){fnStr=["function _ref_(o){ return eval(o); };","function broadcast(m){ return message(m); };",'function message(m){ self.trigger( new Event({}, { type: "message", message: m }) ); };',"function listen(fn){ timer.listeners.push( fn ); };","function resolve(v){ promiseResolve(v); };","function reject(v){ promiseReject(v); };"].join("\n")+fnStr,eval(fnStr)},message:function(m){for(var ls=timer.listeners,i=0;i<ls.length;i++){var fn=ls[i];fn(m)}}};timer.exec()}}).then(function(v){return _p.running=!1,_p.ran=!0,self.trigger("ran"),v});return null==_p.queue&&(_p.queue=runP),runP},message:function(m){var _p=this._private;return _p.webworker&&_p.webworker.postMessage(m),_p.child&&_p.child.send(m),_p.timer&&_p.timer.message(m),this},stop:function(){var _p=this._private;return _p.webworker&&_p.webworker.terminate(),_p.child&&_p.child.kill(),_p.timer,_p.stopped=!0,this.trigger("stop")},stopped:function(){return this._private.stopped}});var fnAs=function(fn,name){var fnStr=fn.toString();return fnStr=fnStr.replace(/function\s*?\S*?\s*?\(/,"function "+name+"(")},defineFnal=function(opts){return opts=opts||{},function fnalImpl(fn,arg1){var fnStr=fnAs(fn,"_$_$_"+opts.name);return this.require(fnStr),this.run(["function( data ){","  var origResolve = resolve;","  var res = [];","  ","  resolve = function( val ){","    res.push( val );","  };","  ","  var ret = data."+opts.name+"( _$_$_"+opts.name+(arguments.length>1?", "+JSON.stringify(arg1):"")+" );","  ","  resolve = origResolve;","  resolve( res.length > 0 ? res : ret );","}"].join("\n"))}};util.extend(thdfn,{reduce:defineFnal({name:"reduce"}),reduceRight:defineFnal({name:"reduceRight"}),map:defineFnal({name:"map"})});var fn=thdfn;fn.promise=fn.run,fn.terminate=fn.halt=fn.stop,fn.include=fn.require,util.extend(thdfn,{on:define.on(),one:define.on({unbindSelfOnTrigger:!0}),off:define.off(),trigger:define.trigger()}),define.eventAliasesOn(thdfn),module.exports=Thread},{"./define":44,"./event":45,"./is":83,"./promise":86,"./util":100,"./window":107,child_process:void 0,path:void 0}],99:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is");module.exports={hex2tuple:function(hex){if((4===hex.length||7===hex.length)&&"#"===hex[0]){var shortHex=4===hex.length,r,g,b,base=16;return shortHex?(r=parseInt(hex[1]+hex[1],base),g=parseInt(hex[2]+hex[2],base),b=parseInt(hex[3]+hex[3],base)):(r=parseInt(hex[1]+hex[2],base),g=parseInt(hex[3]+hex[4],base),b=parseInt(hex[5]+hex[6],base)),[r,g,b]}},hsl2tuple:function(hsl){function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}var ret,h,s,l,a,r,g,b,m=new RegExp("^"+this.regex.hsla+"$").exec(hsl);if(m){if(h=parseInt(m[1]),h<0?h=(360- -1*h%360)%360:h>360&&(h%=360),h/=360,s=parseFloat(m[2]),s<0||s>100)return;if(s/=100,l=parseFloat(m[3]),l<0||l>100)return;if(l/=100,a=m[4],void 0!==a&&(a=parseFloat(a),a<0||a>1))return;if(0===s)r=g=b=Math.round(255*l);else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3)),g=Math.round(255*hue2rgb(p,q,h)),b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret},rgb2tuple:function(rgb){var ret,m=new RegExp("^"+this.regex.rgba+"$").exec(rgb);if(m){ret=[];for(var isPct=[],i=1;i<=3;i++){var channel=m[i];if("%"===channel[channel.length-1]&&(isPct[i]=!0),channel=parseFloat(channel),isPct[i]&&(channel=channel/100*255),channel<0||channel>255)return;ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3],allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct)return;var alpha=m[4];if(void 0!==alpha){if(alpha=parseFloat(alpha),alpha<0||alpha>1)return;ret.push(alpha)}}return ret},colorname2tuple:function(color){return this.colors[color.toLowerCase()]},color2tuple:function(color){return(is.array(color)?color:null)||this.colorname2tuple(color)||this.hex2tuple(color)||this.rgb2tuple(color)||this.hsl2tuple(color)},colors:{transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}},{"../is":83}],100:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is"),math=_dereq_("../math"),util={trueify:function(){return!0},falsify:function(){return!1},zeroify:function(){return 0},noop:function(){},error:function(msg){console.error?(console.error.apply(console,arguments),console.trace&&console.trace()):(console.log.apply(console,arguments),console.trace&&console.trace())},clone:function(obj){return this.extend({},obj)},copy:function(obj){return null==obj?obj:is.array(obj)?obj.slice():is.plainObject(obj)?this.clone(obj):obj},uuid:function(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b}};util.makeBoundingBox=math.makeBoundingBox.bind(math),util._staticEmptyObject={},util.staticEmptyObject=function(){return util._staticEmptyObject},util.extend=null!=Object.assign?Object.assign:function(tgt){for(var args=arguments,i=1;i<args.length;i++){var obj=args[i];if(obj)for(var keys=Object.keys(obj),j=0;j<keys.length;j++){var k=keys[j];tgt[k]=obj[k]}}return tgt},util.default=function(val,def){return void 0===val?def:val},util.removeFromArray=function(arr,ele,manyCopies){for(var i=arr.length;i>=0&&(arr[i]!==ele||(arr.splice(i,1),manyCopies));i--);},util.clearArray=function(arr){arr.splice(0,arr.length)},util.getPrefixedProperty=function(obj,propName,prefix){return prefix&&(propName=this.prependCamel(prefix,propName)),obj[propName]},util.setPrefixedProperty=function(obj,propName,prefix,value){prefix&&(propName=this.prependCamel(prefix,propName)),obj[propName]=value},[_dereq_("./colors"),_dereq_("./maps"),{memoize:_dereq_("./memoize")},_dereq_("./regex"),_dereq_("./strings"),_dereq_("./timing")].forEach(function(req){util.extend(util,req)}),module.exports=util},{"../is":83,"../math":85,"./colors":99,"./maps":101,"./memoize":102,"./regex":103,"./strings":104,"./timing":105}],101:[function(_dereq_,module,exports){"use strict";var is=_dereq_("../is");module.exports={mapEmpty:function(map){var empty=!0;return null!=map?0===Object.keys(map).length:empty},pushMap:function(options){var array=this.getMap(options);null==array?this.setMap(this.extend({},options,{value:[options.value]})):array.push(options.value)},setMap:function(options){for(var obj=options.map,key,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];is.plainObject(key)&&this.error("Tried to set map with object key"),i<keys.length-1?(null==obj[key]&&(obj[key]={}),obj=obj[key]):obj[key]=options.value}},getMap:function(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];if(is.plainObject(key)&&this.error("Tried to get map with object key"),obj=obj[key],null==obj)return obj}return obj},deleteMap:function(options){for(var obj=options.map,keys=options.keys,l=keys.length,keepChildren=options.keepChildren,i=0;i<l;i++){var key=keys[i];is.plainObject(key)&&this.error("Tried to delete map with object key");var lastKey=i===options.keys.length-1;if(lastKey)if(keepChildren)for(var children=Object.keys(obj),j=0;j<children.length;j++){var child=children[j];keepChildren[child]||(obj[child]=void 0)}else obj[key]=void 0;else obj=obj[key]}}}},{"../is":83}],102:[function(_dereq_,module,exports){"use strict";module.exports=function memoize(fn,keyFn){keyFn||(keyFn=function(){if(1===arguments.length)return arguments[0];if(0===arguments.length)return"undefined";for(var args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);return args.join("$")});var memoizedFn=function(){var self=this,args=arguments,ret,k=keyFn.apply(self,args),cache=memoizedFn.cache;return(ret=cache[k])||(ret=cache[k]=fn.apply(self,args)),ret};return memoizedFn.cache={},memoizedFn}},{}],103:[function(_dereq_,module,exports){"use strict";var number="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",rgba="rgb[a]?\\(("+number+"[%]?)\\s*,\\s*("+number+"[%]?)\\s*,\\s*("+number+"[%]?)(?:\\s*,\\s*("+number+"))?\\)",rgbaNoBackRefs="rgb[a]?\\((?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)(?:\\s*,\\s*(?:"+number+"))?\\)",hsla="hsl[a]?\\(("+number+")\\s*,\\s*("+number+"[%])\\s*,\\s*("+number+"[%])(?:\\s*,\\s*("+number+"))?\\)",hslaNoBackRefs="hsl[a]?\\((?:"+number+")\\s*,\\s*(?:"+number+"[%])\\s*,\\s*(?:"+number+"[%])(?:\\s*,\\s*(?:"+number+"))?\\)",hex3="\\#[0-9a-fA-F]{3}",hex6="\\#[0-9a-fA-F]{6}";module.exports={regex:{number:number,rgba:rgba,rgbaNoBackRefs:rgbaNoBackRefs,hsla:hsla,hslaNoBackRefs:hslaNoBackRefs,hex3:hex3,hex6:hex6}}},{}],104:[function(_dereq_,module,exports){"use strict";var memoize=_dereq_("./memoize"),is=_dereq_("../is");module.exports={camel2dash:memoize(function(str){return str.replace(/([A-Z])/g,function(v){return"-"+v.toLowerCase()})}),dash2camel:memoize(function(str){return str.replace(/(-\w)/g,function(v){return v[1].toUpperCase()})}),prependCamel:memoize(function(prefix,str){return prefix+str[0].toUpperCase()+str.substring(1)},function(prefix,str){return prefix+"$"+str}),capitalize:function(str){return is.emptyString(str)?str:str.charAt(0).toUpperCase()+str.substring(1)}}},{"../is":83,"./memoize":102}],105:[function(_dereq_,module,exports){"use strict";var window=_dereq_("../window"),is=_dereq_("../is"),performance=window?window.performance:null,util={},raf=window?function(){return window.requestAnimationFrame?function(fn){window.requestAnimationFrame(fn)}:window.mozRequestAnimationFrame?function(fn){window.mozRequestAnimationFrame(fn)}:window.webkitRequestAnimationFrame?function(fn){window.webkitRequestAnimationFrame(fn)}:window.msRequestAnimationFrame?function(fn){window.msRequestAnimationFrame(fn)}:void 0}():function(fn){fn&&setTimeout(function(){fn(pnow())},1e3/60)};util.requestAnimationFrame=function(fn){raf(fn)};var pnow=performance&&performance.now?function(){return performance.now()}:function(){return Date.now()};util.performanceNow=pnow,util.throttle=function(func,wait,options){var leading=!0,trailing=!0;return options===!1?leading=!1:is.plainObject(options)&&(leading="leading"in options?options.leading:leading,trailing="trailing"in options?options.trailing:trailing),options=options||{},options.leading=leading,options.maxWait=wait,options.trailing=trailing,util.debounce(func,wait,options)},util.now=function(){return Date.now()},util.debounce=function(func,wait,options){var util=this,args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if(is.fn(func)){if(wait=Math.max(0,wait)||0,options===!0){var leading=!0;trailing=!1}else is.plainObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&(Math.max(wait,options.maxWait)||0),trailing="trailing"in options?options.trailing:trailing);var delayed=function(){var remaining=wait-(util.now()-stamp);if(remaining<=0){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=void 0,isCalled&&(lastCalled=util.now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}else timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId=timeoutId=trailingCall=void 0,(trailing||maxWait!==wait)&&(lastCalled=util.now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))};return function(){if(args=arguments,stamp=util.now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}}},module.exports=util},{"../is":83,"../window":107}],106:[function(_dereq_,module,exports){module.exports="2.7.16"},{}],
107:[function(_dereq_,module,exports){module.exports="undefined"==typeof window?null:window},{}]},{},[82])(82)});
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){}});

            Rally.launchApp('CustomApp', {
                name:"nodes",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
